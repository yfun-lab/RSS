[{"title":"派早报：华硕发布新款 ROG 真无线耳机、宜家发布 BETTORP 无线充电台灯","date":"2022-07-08 00:52:29","description":"贝尔金发布蓝牙降噪耳机 SoundForm Immerse，CDPR 新作《昆特牌：盗贼法师》现已发售等<a href=\"https://sspai.com/post/74164\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74164"},{"title":"新玩意 111｜少数派的编辑们最近买了啥？","date":"2022-07-07 09:51:53","description":"关于栏目很多读者都会好奇少数派的编辑们到底平时都「买了啥」。我们希望通过「编辑部的新玩意」介绍编辑部成员们最近在用的新奇产品，让他们自己来谈谈这些新玩意的使用体验究竟如何。内容声明：《新玩意》栏目如含 ...<a href=\"https://sspai.com/post/74158\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74158"},{"title":"可能是 iOS 平台的最强录音工具——Just Press Record 使用体验","date":"2022-07-07 08:00:00","description":"对于需要经常使用手机录音的朋友们来说，JPR 肯定值得一试。<p>[......]</p>\n<a href=\"https://sspai.com/prime/story/just-press-record\" target=\"_blank\">查看全文</a><p>本文为会员文章，出自<a href=\"https://sspai.com/prime/precog/single\" target=\"_blank\">《单篇文章》</a>，订阅后可阅读全文。</p>\n","link":"https://sspai.com/prime/story/just-press-record"},{"title":"汽车上的48伏轻混系统的原理是什么？它的用处大吗？","date":"2022-07-07 07:22:10","description":"\n<h2>精华预告：今天我要谈的是这个：</h2>\n<p><img src=\"https://picx.zhimg.com/v2-dd3270041220beb9acbd92f16ea8abbe_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2000\" data-rawheight=\"939\" data-watermark=\"watermark\" data-original-src=\"v2-dd3270041220beb9acbd92f16ea8abbe\" data-watermark-src=\"v2-0da10b7851150ba56dcdc8941f471ae5\" data-private-watermark-src=\"v2-50ae9d0cb816030cd5fce71ca9612295\"></p>\n<hr>\n<p data-pid=\"R4mFmlYK\">首先写出我的观点：</p>\n<h2>48V弱混是一个小而美的技术，它有效弥补了内燃机最重要的一处缺憾，但是可惜在中国，它遇到了一个叫“双积分”的恶魔。</h2>\n<hr>\n<p data-pid=\"VRi5WcoL\">48V弱混，又叫MHEV，是混合动力系统中电气化程度最低的一种模式。很多人认为48V轻混就是P0的BAS系统，其实并非如此。48V MHEV理论上有多种模式，包括P0/P1/P2/P3/P4均有设计方案。比较常见的是P0和P1方案。</p>\n<p><img src=\"https://pic4.zhimg.com/v2-497adffe4283d83541e6c5e3ff88f5e9_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"300\" data-rawheight=\"178\" data-watermark=\"watermark\" data-original-src=\"v2-497adffe4283d83541e6c5e3ff88f5e9\" data-watermark-src=\"v2-f2d2f47b3594b3e73d98389e4e1d376d\" data-private-watermark-src=\"v2-d95b2e984ae83fead9c058e748d9321d\"></p>\n<hr>\n<h2>P0- 皮带驱动架构</h2>\n<p><img src=\"https://pic1.zhimg.com/v2-49266e8c9e3992f93cb4a0671dacd47d_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"904\" data-rawheight=\"595\" data-watermark=\"watermark\" data-original-src=\"v2-49266e8c9e3992f93cb4a0671dacd47d\" data-watermark-src=\"v2-350ec8aa8407ff0cecd5876c09e3ac01\" data-private-watermark-src=\"v2-71bb0bdeb4e8f24919c76960942018d7\"></p>\n<p data-pid=\"pZpHRvQt\"><b>P0模式是将电机通过皮带</b>与内燃机连接，在前端附件系统上，它可以实现的功能（不同机型可能实现的功能范围略有不同）包括：</p>\n<ol>\n<li data-pid=\"8KcAgsx8\">怠速启停功能</li>\n<li data-pid=\"d2AUclFb\">行驶中的启停功能</li>\n<li data-pid=\"yDfFg9wo\">发动机载荷的调整（通过电机的助力或发电，将发动机的负载向经济区偏移）</li>\n<li data-pid=\"Wo2_Snxk\">加快扭矩响应</li>\n<li data-pid=\"uLBvSNZw\">总输出扭矩提升</li>\n<li data-pid=\"-EEqaIIv\">巡航工况电机驱动</li>\n<li data-pid=\"SKQn2Su5\">能量回收</li>\n<li data-pid=\"I_WRc9L-\">制动能量再生</li>\n</ol>\n<p data-pid=\"EnnOgfMK\">一般来说P0的电机可以提供最大50Nm的扭矩，电机最大功率在12-14kW左右，持续功率在2.5-3.5kW左右。</p>\n<p data-pid=\"KQHhP6f0\">我之前介绍过的上汽通用升功率破百的阿凡达1.5T就是配的48V搭上了昂科威S这个级别的SUV，而且动力性让你根本想不到这是1.5T。尤其是启停功能的响应，完全颠覆你在靠启动电机实现启停的车辆上感受到的自动启停的感受。而且它更可靠，效率更高。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-ef70289db171e99fe7b62fe059b763ac_720w.png?source=b1748391?rss\" data-caption=\"上汽通用阿凡达1.5T+48V\" data-size=\"normal\" data-rawwidth=\"1200\" data-rawheight=\"671\" data-watermark=\"watermark\" data-original-src=\"v2-ef70289db171e99fe7b62fe059b763ac\" data-watermark-src=\"v2-c80ae393d7f42ae3fc5c70dd00ad29b2\" data-private-watermark-src=\"v2-2ff4a8ceaf8a866b23eb376681f8f8a9\"></p>\n<p data-pid=\"ots8pdb5\">此外其他主机厂的案例还包括：</p>\n<p><img src=\"https://pic3.zhimg.com/v2-f3506da76fec0214c201aa94fb1c3aa7_720w.png?source=b1748391?rss\" data-caption=\"奥迪 P0 - 48V MHEV系统\" data-size=\"normal\" data-rawwidth=\"1018\" data-rawheight=\"722\" data-watermark=\"watermark\" data-original-src=\"v2-f3506da76fec0214c201aa94fb1c3aa7\" data-watermark-src=\"v2-6cc7a328d8ea8714ef905d8bf91721e1\" data-private-watermark-src=\"v2-6a03b28009013f599f618799d9225fb2\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-bcd1e4c1e6b4fec70535d3e0642ac9dd_720w.png?source=b1748391?rss\" data-caption=\"法雷奥 48V P0解决方案\" data-size=\"normal\" data-rawwidth=\"1024\" data-rawheight=\"401\" data-watermark=\"watermark\" data-original-src=\"v2-bcd1e4c1e6b4fec70535d3e0642ac9dd\" data-watermark-src=\"v2-444201cfb7d1740bd093affcca762d9c\" data-private-watermark-src=\"v2-5d1dea50ff1870f2953bf127fded1487\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-e259c54dbafff2f0760f166a109ef919_720w.png?source=b1748391?rss\" data-caption=\"博世 P0 48V解决方案\" data-size=\"normal\" data-rawwidth=\"1146\" data-rawheight=\"750\" data-watermark=\"watermark\" data-original-src=\"v2-e259c54dbafff2f0760f166a109ef919\" data-watermark-src=\"v2-9b38ca6a82b6d2d56759fa41b366ed7c\" data-private-watermark-src=\"v2-55103b59c8c337e98950a382494de1f1\"></p>\n<hr>\n<p data-pid=\"myQwdabj\">P1-曲轴电机方案</p>\n<p><img src=\"https://pic1.zhimg.com/v2-b97beea25cdc753446f5e735a7577840_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"908\" data-rawheight=\"511\" data-watermark=\"watermark\" data-original-src=\"v2-b97beea25cdc753446f5e735a7577840\" data-watermark-src=\"v2-331a59e879e6b97a35fa2dd91683495c\" data-private-watermark-src=\"v2-60598c53a0b69160b4b8be3ae8d0bbc7\"></p>\n<p data-pid=\"TmlCloSA\">电机直接连接到曲轴的 P1 架构是本田在其第一代<b>集成电机辅助 (IMA)</b>技术中采用的解决方案。电动机在车辆减速期间用作发电机，用作发动机启动器，在车辆加速期间用作电动机（辅助发动机）。</p>\n<p data-pid=\"0P9NQiQE\">该方案的最大优势之一是电动机可以提供比基于P0：BAS附件系统更高的扭矩，因为没有皮带打滑的限制。</p>\n<p data-pid=\"I-G5isRF\">它的缺点是：由于电机和曲轴之间没有速比，因此对电机的扭矩和效率要求非常苛刻。</p>\n<p data-pid=\"xiqza7qX\">P1-48V的典型产品包括： 本田 Insight Hybrid 2009（采用集成电机辅助技术）、梅赛德斯奔驰 S400 Bluehybrid 2010</p>\n<p><img src=\"https://pic1.zhimg.com/v2-eb074220dbf1da4094c926f160ceae12_720w.png?source=b1748391?rss\" data-caption=\"本田\" data-size=\"normal\" data-rawwidth=\"593\" data-rawheight=\"663\" data-watermark=\"watermark\" data-original-src=\"v2-eb074220dbf1da4094c926f160ceae12\" data-watermark-src=\"v2-45efbc5e124178e9fd3f32dcfdc22147\" data-private-watermark-src=\"v2-6d4e5df2c2685354a83c13de25a7c586\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-cfc002cb7ecbe01310ab6e020433e136_720w.png?source=b1748391?rss\" data-caption=\"奔驰\" data-size=\"normal\" data-rawwidth=\"1024\" data-rawheight=\"769\" data-watermark=\"watermark\" data-original-src=\"v2-cfc002cb7ecbe01310ab6e020433e136\" data-watermark-src=\"v2-10d9ab47cdc9a9ecf0242a382dcc1f25\" data-private-watermark-src=\"v2-0720c757db51c4a22c4aaf92d02bc4e8\"></p>\n<hr>\n<p data-pid=\"b_aV9AAC\">P0和P1结构由于在发动机测，因此一个较大的弊端是它们无法实现在机械上与发动机脱开，并直接从车轮侧获得能量。这就导致了P0和P1在对电机的利用、能量回收的程度以及对电机扭矩的利用方面存在很大的局限性。</p>\n<p data-pid=\"ez1uZ4gH\">此外，在滑行期间，在发动机关闭的情况下（离合器与发动机脱开）回收电能是不可能的。</p>\n<p data-pid=\"OjB8DDZ_\">采用P2/P3/P4的48V就可以避免这些缺憾，并充分利用这些能量。</p>\n<p data-pid=\"WqI1JVkY\">但是，这样的架构成本较高，而且48V的电压限制了电机的性能。反过来说，既然我都选择了如此复杂的结构，为什么是48V？所以48V的P2/P3/P4结构的实际产品比较少，主要是一些供应商开发的解决方案。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-b9be0df4fdbbc737db86fa6db3ecfd0d_720w.png?source=b1748391?rss\" data-caption=\"Getrag Powershift 变速箱 \" data-size=\"normal\" data-rawwidth=\"1166\" data-rawheight=\"984\" data-watermark=\"watermark\" data-original-src=\"v2-b9be0df4fdbbc737db86fa6db3ecfd0d\" data-watermark-src=\"v2-fc97a6fdc4ad974ad2accf71488a5b74\" data-private-watermark-src=\"v2-ff087cf3af19266c830e4762ce927002\"></p>\n<p><img src=\"https://pic1.zhimg.com/v2-87a682975fe7cb4c53e3f4780083b635_720w.png?source=b1748391?rss\" data-caption=\"法雷奥48V电桥\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"667\" data-watermark=\"watermark\" data-original-src=\"v2-87a682975fe7cb4c53e3f4780083b635\" data-watermark-src=\"v2-8c64a217ed1b090daf1ed8e7d05a6ee0\" data-private-watermark-src=\"v2-320057636fc6071d6d7fdf070258bdc8\"></p>\n<hr>\n<p data-pid=\"WaVE5dmv\">我们把48V的各种变种谈完了，接下来我们还是围绕P0-48V谈谈这个系统吧。</p>\n<p data-pid=\"CY3T5X8V\">首先我们谈优点，主要有三大优点：</p>\n<ol>\n<li data-pid=\"pdaEC2u9\">小而美的解决方案： 48V没有破坏原来的动力总成生态，采用电机辅助的方式解决了内燃机一个核心痛点：没有能量回收功能。其实内燃机的效率可以做的很好，但是由于动态驾驶以及传统内燃机没有能量回收，因此内燃机燃烧能量（燃油）好不容易提起来的速度被刹车的热量完全消耗掉了。</li>\n<li data-pid=\"EDwjwJHj\">燃油效率的提升：除了前面提到的能量回收功能，P0-48V可以实现发动机负载的移动也可以获得燃油耗的收益。</li>\n<li data-pid=\"6FrglaN0\">启停功能的平顺化：减少了传统启动电机靠齿轮啮合的冲击启动，采用皮带电机带动更加平顺。</li>\n</ol>\n<p><img src=\"https://pic1.zhimg.com/v2-d0fec0b0f94e8f79d8294e06ac5b84df_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1380\" data-rawheight=\"976\" data-watermark=\"watermark\" data-original-src=\"v2-d0fec0b0f94e8f79d8294e06ac5b84df\" data-watermark-src=\"v2-733b93e54fba8de456e5aac34e84d496\" data-private-watermark-src=\"v2-e0532e9b31c984858f13b9c1d1601b95\"></p>\n<p data-pid=\"0ud1iiVA\">其实最重要一点，为什么是48V？因为48V是欧洲实践下来平衡人体安全和电机效率的一个安全电压平衡点。因此让48V的车子的电气结构不需要按照高压电的相关标准规格进行人体安全的防护级别。这就可以节省很多的成本。</p>\n<p data-pid=\"x8_rswQl\">HEV的电压在200-240V左右。微型电动车的电压一般在96V以上，高性能纯电动的电压在400V以上，作为参考。</p>\n<h2>48V从2017年开始，就曾被大量的咨询机构、资本运作团队看好，认为在中国不断压榨法规油耗的情况下，48V肯定会爆发式增长。然而很遗憾，在中国他们遇到了一个怪物，叫双积分法规。双积分硬生生的把48V拖了三年不知，很多企业，包括合资企业，从2018年开始就开发并完成了48V的准备，但是就是不上市，理由就是按照中国的法规账面算不平。</h2>\n<p data-pid=\"yiLsz0-X\">48V系统在很多市场宣传的时候，一般都声称节油率可以达到14%以上，然而这些成绩都是建立在老的大发动机上的成果。随着内燃机的小排量化和节能话，到2018年测试了大量的机型发现，48V的节油率只有8%左右，甚至以下。那么也就是说，对于一款轿车来说，48V系统的整车节油只有0.4L左右。实际上大部分车根本做不到0.4L，只能到0.3L附近。</p>\n<h2>然而问题是48V系统的系统投入过大，差不多一套新增系统的成本大几千，结果就是0.1L油耗改进对应的48V系统投入超过了1000元。而一般来说，车企的0.1L油耗改进的可接受成本在600元左右。</h2>\n<h2>更可怕的是双积分政策的影响，由于双积分政策下，尤其是纯电动汽车两处杠杆积分的特点，使得节能发动机的节能技术显得没有性价比，还不如直接卖一些微型电动车，以0油耗来稀释自己的燃油耗积分，而且还能卖新能源积分。</h2>\n<p><img src=\"https://pic1.zhimg.com/v2-e3875df2a14112b73c9f382e8566f1b9_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1005\" data-rawheight=\"173\" data-watermark=\"watermark\" data-original-src=\"v2-e3875df2a14112b73c9f382e8566f1b9\" data-watermark-src=\"v2-e07462c36b22f5a6ea73066ca6a56408\" data-private-watermark-src=\"v2-f9940987d2c2a3d71f4fba9939054073\"></p>\n<h2>0油耗已经够可怕的了，而且在2018-2019年，还可以按照3倍数量进行稀释！</h2>\n<p><img src=\"https://pic1.zhimg.com/v2-dd3270041220beb9acbd92f16ea8abbe_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2000\" data-rawheight=\"939\" data-watermark=\"watermark\" data-original-src=\"v2-dd3270041220beb9acbd92f16ea8abbe\" data-watermark-src=\"v2-0da10b7851150ba56dcdc8941f471ae5\" data-private-watermark-src=\"v2-50ae9d0cb816030cd5fce71ca9612295\"></p>\n<p data-pid=\"NYuLQFzG\">看上面的计算表格：</p>\n<h2>对于一个10辆车的简化车队模型，可以看到我只要投入1辆纯电动汽车，就可以让整个10辆车的车队的平均油耗下降25%！</h2>\n<h2>我再说一遍，对于一个轿车的车队，我只需要将10%的数量更换为纯电动汽车，就可以实现整个车队25%的法规油耗降低！如果这是一个SUV或者MPV的高油耗车队，稀释的比例将会更为恐怖！</h2>\n<p data-pid=\"GguduSKP\">如果这这辆电动车按照40kwh带电量计算，一般额外投入的金额就是电池包的成本，那就是40kwh*1200元/kwh=4.8万元人民币。而且当时的国家补贴还有几万元。那么投入成本就更低了。而且我还同时拿到了燃油耗积分和新能源积分。</p>\n<h2>而如果我把钱投入做48V，其结果是：即便我把所有的车队全部变成48V，我依然是负积分，更可怕的是我的投入还比纯电动都大，而且对新能源积分毫无帮助，只会是严重负分。</h2>\n<p><img src=\"https://pic1.zhimg.com/v2-787707ded9452d77976d3ef5ac7a5591_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1765\" data-rawheight=\"626\" data-watermark=\"watermark\" data-original-src=\"v2-787707ded9452d77976d3ef5ac7a5591\" data-watermark-src=\"v2-aa0c366a7c112408bb151b7430854afa\" data-private-watermark-src=\"v2-202616ac4700bc19fee5cf0ae6a56c74\"></p>\n<h2>这是2019年的双积分核算结果，可以看到，燃油车基本是越野车和SUV的北汽，车队平均燃油耗只有1.12升，而混动占了一半多的广汽丰田，以1.5%的新能源汽车的比例依然能拿到燃油耗积分，但是还是拿不到新能源积分。</h2>\n<h2>所以双积分给中国企业指明了一条道路：只要做小电动车稀释积分，就可以让燃油车滥排，不需要开发节能燃油技术。这就是为什么中国的双积分政策是一部恶法。</h2>\n<hr>\n<h2>在这样的恶法之下，中国的48V的推广，被整整拖延了超过4年，而且未来的发展也将依然受制于性价比。只能寄希望于未来在碳计算的背景下，基于碳计算的碳积分可以拨乱反正，彻底终结双积分的XX逻辑。</h2>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/JackyQ?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">JackyQ</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/532021977/answer/2560448817?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">45 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/523994544?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">中国目前在电动车行业换道超车，是否有可能发展电动飞机解决航空发动机问题？</a><br><a href=\"http://www.zhihu.com/question/537175229?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">蔚来为什么要有重服务和换电路线？会不会本末倒置？</a><br>\n","link":"http://www.zhihu.com/question/532021977/answer/2560448817?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"比亚迪推出了DM-i、吉利推出了雷神、长城有了柠檬DHT……国产混动技术究竟是什么水平？","date":"2022-07-07 07:18:31","description":"\n<p data-pid=\"wbH8j_Mw\">这个问题，北航的徐向阳教授在今年刚刚发表的一篇论文专门提到了这些系统的对比。我个人对这个文章研究后对其技术分析观点也很认可，所以就直接编辑论文的核心内容了。</p>\n<p data-pid=\"kb0bQgqv\">我适当节选一下，方便阅读，关于本论文具体研究成果内容沟通，请联系 北航的 刘艳芳老师，liuyf@buaa.edu.cn，18513557198</p>\n<p data-pid=\"fU6O7sdW\">如下内容表述，均来自于北航徐向阳教授团队的研究成果。</p>\n<hr>\n<p data-pid=\"4WUIR-A9\">中国自主混动技术的研究起步于吉利的双模功率分流混动系统，但产业化很不顺利，后来吉利在其7DCT的基础上，集成P2.5电机，推出了P2.5-7DCT并联混动变速器，2021年吉利推出了雷神混动系统，发布了国际上首个发动机3挡驱动的串并联混动变速器3DHT。</p>\n<p data-pid=\"aD7dyS6u\">2008年，比亚迪推出第一代混动变速器，采用双电机串并联方案；2013年和2018年比亚迪推出第二代和第三代P3-6DCT并联混动变速器；比亚迪最新一代混动变速器DM-i则是单挡串并联混动变速器。</p>\n<p data-pid=\"2fy5Sc4k\">长城首先在7DCT和9DCT、9AT的基础上，推出了P2-7DCT和P2-9DCT、P2-9AT并联混动变速器，2021年又推出了发动机2挡驱动的串并联混动变速器2DHT--柠檬混动变速器。</p>\n<p data-pid=\"KD6d4gPo\">2008年北京奥运，长安汽车投入混动车型开展示范化运营，2017年和2018年分别推出了搭载P2-7DCT的逸动PHEV和搭载P134串并联电四驱的CS75PHEV量产车型，2021年最新推出的蓝鲸iDD混动系统，采用P2-6DCT并联混动变速器。</p>\n<p data-pid=\"yCjc8CjP\">奇瑞2021年发布了3挡串并联混动变速器鲲鹏混动系统。广汽在GMC一代单挡串并联混动变速器的基础上，2022年推出了GMC二代2挡串并联混动变速器。上汽第二代EDU在2019年发布，采用的是P2.5路线的单电机并联混动系统。目前主流国产汽车厂商均推出了各自的最新一代混动系统，可谓百花齐放，各家技术均各不相同，实车表现相对各自的前一代产品均有明显优化。</p>\n<p data-pid=\"s3HZfnoY\">比亚迪DM-i(_单挡，DHT)、长城柠檬混动（两挡，2DHT）、吉利雷神（三挡，3DHT）和长安蓝鲸iDD(P2-6DCT)。尽管是4款混动变速器，其实就是两大类，一类是采用双电机的串并联混动变速器（比亚迪DM-i、长城柠檬、吉利雷神），另一类是采用单电机的并联混动变速器（长安蓝鲸iDD）。串并联混动变速器和并联混动变速器的构型示意图如图1示。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-5c0d18a58de7a4f24b789c7dcb6266cf_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"410\" data-watermark=\"watermark\" data-original-src=\"v2-5c0d18a58de7a4f24b789c7dcb6266cf\" data-watermark-src=\"v2-2a44da3094b1cf2a26be52e93aea6007\" data-private-watermark-src=\"v2-7ad3e3ca4e70ef847e724658cd497533\"></p>\n<hr>\n<p data-pid=\"-wdZe8vF\">混动变速器的技术和产业基础是传统自动变速器，各国技术路线的选择与其技术基础和产业基础密切相关。</p>\n<p data-pid=\"E7Sf-FLe\">由于丰田有爱信AT技术基础，对行星排应用得心应手，因此丰田是基于行星排的功率分流型混动变速器（THS）；而本田的AT技术是基于定轴齿轮传动，因此本田的混动变速器是基于定轴齿轮传动技术的串并联混动变速器（i-MMD）。</p>\n<p data-pid=\"PelSDRPq\">在欧洲，ZF是全球最大AT变速器企业之一，大众则是最早推出DCT的企业，因此以德国为代表的欧洲的主流技术路线是：P2-DCT/AT并联混动。</p>\n<p data-pid=\"jPmk8rMU\">韩国的技术路线与欧洲相似。美国通用是AT变速器的鼻祖，对行星排的运用更是非常娴熟，因此以通用为代表的美国的技术路线是基于行星排的双模功率分流型混动变速器。</p>\n<p data-pid=\"uXzvurvT\">中国自动变速器技术路线百花齐放，因此混动技术路线也是多元化，既有P2/P2.5-DCT/AT并联混动变速器，也有不同发动机和电机驱动挡位数量的串并联混动变速器（DHT）。</p>\n<p data-pid=\"IX4SWvYI\"><b>混动技术路线的多样化表明：混动变速器技术路线有技术和产业基础的传承，不同混动技术路线各有优势和劣势，没有最好的技术路线和产品，只有最适合企业自身优势和车型的技术路线和产品。</b></p>\n<hr>\n<p data-pid=\"TvirED3P\">为了对插电混动技术路线的性能有直观认识，考虑自主PHEV混动技术路线的代表性和PHEV车型的市场表现，选择比亚迪DM-i(单挡，DHT)、长城柠檬混动（两挡，2DHT）、吉利雷神（三挡，3DHT）和长安蓝鲸iDD (P2-6DCT)进行对比。这四款PHEV混动变速器的构型简图、工作模式/挡位逻辑简图、发动机和驱动电机等的关键技术参数见图2。</p>\n<p data-pid=\"BfM0Q_Dg\">各款混动系统特点总结如下。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-07ca6e03a0bc71839007b4d99e3cbbad_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1188\" data-watermark=\"watermark\" data-original-src=\"v2-07ca6e03a0bc71839007b4d99e3cbbad\" data-watermark-src=\"v2-3dc51cc703f444f5dedb35f994e6996d\" data-private-watermark-src=\"v2-30c134734d6fadc9b22e2dfc26e2f798\"></p>\n<p data-pid=\"dOO3avnw\"><b>1.长安蓝鲸iDD混动系统</b></p>\n<p data-pid=\"Kxxchpf5\">蓝鲸iDD混动系统采用了S-winding绕组技术的低速大扭矩电机，发动机在4款发动机中输出扭矩是最高的，再加上6个直驱挡位，使蓝鲸iDD的起步和中高速加速性能都很优秀。6个直驱挡使发动机直驱的动力响应性更好，亏电行驶时，驾驶感受与燃油车几乎完全相同；纯电行驶、特别是中高速亏电行驶时，借助多档纯电驱动，驾驶感受好于串并联构型，这使蓝鲸iDD混动系统特别适合喜欢长途旅行、对动力响应要求快、驾驶感受追求高的消费者。</p>\n<p data-pid=\"BvCZHW0S\">并联混动属单电机混动系统，比串并联混动少了一个电机及控制器，所以蓝鲸iDD混动系统受电机和电机控制器原材料成本影响波动小，并可在传统变速箱基础上通过改造升级实现，开发成本较小，综合性价比高。得益于蓝鲸发动机的高热效率和iDD混动变速器高效率设计技术（智能双电子油泵、高压液压系统等），和发动机具有更多的直驱挡位，iDD的燃油经济性也很优秀，UNI-K 2.075吨车重，NEDC循环亏电油耗百公里仅5升。虽然iDD将高集成度三离合器P2模块与6DCT高效集成，但6DCT轴向尺寸较大，影响其轴向紧凑性，结构复杂度也比串并联混动系统要高。 </p>\n<p data-pid=\"M8PgYgkP\"><b>2.比亚迪DM-i混动系统</b></p>\n<p data-pid=\"27GdCiIA\">比亚迪DM-i是国内最早大批量产业化应用的新一代插电混动系统，也是目前市场上占有率最高、知名度最高的插电混动系统，因此，其产品和技术的成熟度在四款混动系统中是最成熟的。大容量电池插电混动技术在中国市场异军突起，比亚迪DM-i是开拓者，比亚迪DM-i为插电混动技术市场化和串并联混动技术路线被市场认可做出了重大贡献。另外，比亚迪DM-i发动机和电机都是单挡驱动，因此，其结构最简单，工作时没有挡位切换，只有工作模式切换，换模换挡控制简单、换模换挡平顺性优秀。</p>\n<p data-pid=\"6AUfx-Lc\">尽管如此，由于DM-i发动机和电机仅1个挡位，纯电驱动不能改变传动比，增加电驱动能力，这影响了其动力性和纯电驱动性能，尤其在低速爬坡和高速超车的场景的影响更明显。另外，在轻量化设计方面，尽管DM-i结构简单，但系统重量并没有明显优势。</p>\n<p data-pid=\"9KGe5s05\"><b>3.长城柠檬混动系统</b></p>\n<p data-pid=\"1Pv3xwLC\">长城柠檬混动系统也属于串并联混动系统，发动机有2个挡位，电机1个挡位，与比亚迪DM-i相比，发动机有更多的高效直驱工作时间，燃油经济性也表现更好。与其他三款混动系统相比，长城柠檬混动系统的各个性能没有最好的，但也没有最差的，各项指标都是处于较好的水平，非常的均衡，这种均衡性的设计本身就是很大的挑战。</p>\n<p data-pid=\"Vg9iSvbD\">与比亚迪单挡串并联和吉利3档串并联混动系统相比，长城柠檬混动系统应该是性价比最高的串并联混动系统。因此，长城柠檬混动系统的设计富有中国智慧，具有典型的中国文化特征：中庸，但不平庸，与长城柠檬和摩卡系列车型定位非常匹配。</p>\n<p data-pid=\"iEsVwFkK\"><b>4.吉利雷神混动系统</b></p>\n<p data-pid=\"1PYbKOtC\">吉利雷神混动系统是世界上第一套发动机3挡电机2挡的串并联混动系统，巧妙地利用了行星变速机构功率密度高、传动路线多、离合器和制动器与电机嵌套设计等集成化设计手段，实现了轴向尺寸仅有354mm、重量仅120kg的高紧凑性、高集成化和高水平轻量化设计。</p>\n<p data-pid=\"_SCiq-vl\">由于发动机有3个直驱挡位、电机有2个挡位，使雷神混动系统的燃油经济性和纯电驱动性能都很优秀。但两个行星排、两个离合器和两个制动器的传动方案，增加了系统的复杂度和控制的难度，也增加了系统的制造成本。另外，吉利雷神混动系统是这四款插电混动系统推向市场最晚的，其产品还需要更多的市场考验。但好饭不怕晚，作为国际上目前技术上最先进的串并联混动系统，相信吉利雷神混动系统在未来会有很好的市场表现。</p>\n<p data-pid=\"Hw7sGBJz\">综上所述，自主四款混动系统得分非常接近，各有优势和特色，可以说这四款混动系统代表了中国自主混动系统不同细分技术路线的最高水平。</p>\n<p><img src=\"https://pic4.zhimg.com/v2-13fe5c28746dbbc09ef80420f9b2e049_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"717\" data-watermark=\"watermark\" data-original-src=\"v2-13fe5c28746dbbc09ef80420f9b2e049\" data-watermark-src=\"v2-f80aed231ebb267b45866fb8523ea86c\" data-private-watermark-src=\"v2-df32d23486f0045406b3be78ac1abf7e\"></p>\n<h2><b>结论</b></h2>\n<p data-pid=\"z0o8GtCI\">（1）串联、并联、混联三种技术路线各有优缺点。混动技术路线选择通常是企业结合自身资源优势、混动技术特点、产品属性需求、成本等综合考虑而做出的最适合自身企业的结果。</p>\n<p data-pid=\"QpSwuwU1\">（2）混动技术路线多样化是国内外共同的发展趋势，不同混动技术路线各有优势和劣势，没有最好的技术路线和产品，只有最适合企业自身优势和车型的技术路线和产品。消费者在混合产品选择时，也需要结合自身的需求进行混动产品的选择。</p>\n<p data-pid=\"G_pff0ry\">（3）对串并联混动系统，发动机挡位数量的增加比电机挡位数量的增加对改善经济性贡献更大；电机挡位数量的增加比发动机挡位数量的增加对提高动力性贡献更大；2挡或3挡串并联混动系统性能更优。对于并联混动，挡位数量的增加，也会改善动力性和经济性，但6-8挡之间相差很少。因此，并联混动6挡是性价比最高的方案。</p>\n<p data-pid=\"a2XOb4UQ\">（4）无论是串并联混动还是并联混动，发动机热效率提高5个百分点，WLTC亏电工况下，整车油耗可以降低10个百分点以上。因此，提高发动机热效率是提高各类混动系统燃油经济性最有效的手段。</p>\n<p data-pid=\"e1r1ZUp-\">（5）总体而言，当前市面上的串并联和并联混动系统均是完成进化的第二代、甚至第三代产品，相对上一代产品的整车表现均有明显提升。自主插电混动技术路线百花齐放，串并联和并联等各种技术路线优势互补，自主混动系统技术和产品关键技术指标总体上都已达到国际领先水平，在国内插电混动的市场占有率也遥遥领先于外资品牌。自主插电混动已经成为中国汽车工业突破卡脖子技术、从跟跑到并跑再到领跑的成功案例，为中国汽车工业从汽车大国走向汽车强国和汽车工业双碳目标的早日达成做出了重要贡献。</p>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/JackyQ?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">JackyQ</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/531029649/answer/2555913925?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">18 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/539819879?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">长城汽车称「柠檬混动 DHT 车型年底登陆巴西市场」，该车型会有哪些亮点？对此你期待吗？</a><br><a href=\"http://www.zhihu.com/question/540391559?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">长城汽车柠檬混动 DHT 车型年底登陆巴西市场，你觉得该车型会不会畅销？</a><br>\n","link":"http://www.zhihu.com/question/531029649/answer/2555913925?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"谁能很全面的解释一下汽车的排量、马力、功率、扭矩之间的关系以及作用？","date":"2022-07-07 07:17:37","description":"\n<p data-pid=\"DjiR9KSC\">在我们开始所有的介绍之前，我们先明确一个概念：</p>\n<h2>一台发动机的输出能力，取决于他的进气能力。</h2>\n<p data-pid=\"vBHWU9QY\">我们再说一遍：</p>\n<h2>一台发动机的输出能力，取决于他的进气能力。</h2>\n<p data-pid=\"_oUeJgZ8\">好好理解这句话，能帮助你理解很多汽车发动机的概念。</p>\n<hr>\n<p><img src=\"https://pic4.zhimg.com/v2-cd4b97fb3eaba8600f56a79e1783f036_720w.gif?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"630\" data-rawheight=\"446\" data-watermark=\"watermark\" data-original-src=\"v2-cd4b97fb3eaba8600f56a79e1783f036\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"lvPaGo51\">汽车发动机是一种内燃机，是燃料在缸内燃烧，形成高温高压气体推动活塞做功，并将活塞的往复运动转换为曲轴的旋转运动，从而输出机械能的一种机械。</p>\n<p data-pid=\"4dXPf40Z\">我们经常说的一个词，叫做加油。这让人产生一种错觉，当我们需要提升发动机动力的时候，只要往缸内多喷油就好了。</p>\n<p data-pid=\"LyymHDDr\">然而实际上，当我们踩下汽车油门的时候，实际调节的是发动机节气门体的开度，这个东西的作用是让发动机进入更多的空气。而只有当发动机确认进气已经变多了之后，才会增加喷油量，然后让你感觉到动力的提升。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-3e639653985b08474af3ab226e511ff5_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"500\" data-rawheight=\"333\" data-watermark=\"watermark\" data-original-src=\"v2-3e639653985b08474af3ab226e511ff5\" data-watermark-src=\"v2-ee7e1797d26ea19e9119157fc89921d6\" data-private-watermark-src=\"v2-a6cac78e8003efb60db250f92c3af0db\"></p>\n<p data-pid=\"SDAoFbDn\">当你理解了这一点，我们的讨论才能继续下去，因为后面的所有内容，都是在讨论发动机的进气问题。</p>\n<hr>\n<h2>首先我们谈排量。</h2>\n<p><img src=\"https://pic1.zhimg.com/v2-42e0f78d53439f3cd217579eb434e19b_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1100\" data-rawheight=\"800\" data-watermark=\"watermark\" data-original-src=\"v2-42e0f78d53439f3cd217579eb434e19b\" data-watermark-src=\"v2-244743ce7a186a34fe601b8d9095c93c\" data-private-watermark-src=\"v2-fe595d1c22eb4d7d6ab795707e4b6788\"></p>\n<p data-pid=\"ZnUUojrn\">发动机的排量是一个纯物理空间的概念， <img src=\"https://www.zhihu.com/equation?tex=%E6%8E%92%E9%87%8F%3D%E5%8D%95%E7%BC%B8%E5%B7%A5%E4%BD%9C%E5%AE%B9%E7%A7%AF%5Ctimes%E7%BC%B8%E6%95%B0\" alt=\"排量=单缸工作容积\\times缸数\" eeimg=\"1\"></p>\n<p data-pid=\"ocpRPoq0\">而 <img src=\"https://www.zhihu.com/equation?tex=%E5%8D%95%E7%BC%B8%E5%B7%A5%E4%BD%9C%E5%AE%B9%E7%A7%AF%3D%E5%8F%91%E5%8A%A8%E6%9C%BA%E7%9A%84%E5%86%B2%E7%A8%8B%5Ctimes%E5%8D%95%E7%BC%B8%E6%88%AA%E9%9D%A2%E9%9D%A2%E7%A7%AF%3D%E5%86%B2%E7%A8%8B%5Ctimes%5Cpi%5Ctimes%E7%BC%B8%E5%BE%84%5E%7B2%7D%5Cdiv4\" alt=\"单缸工作容积=发动机的冲程\\times单缸截面面积=冲程\\times\\pi\\times缸径^{2}\\div4\" eeimg=\"1\"></p>\n<p data-pid=\"Ryb5iikG\">具体的物理意义就是活塞从上止点移动到下止点，之间发动机缸内的物理空间，就是排量。</p>\n<h2>有回答认为排量代表的“每行程或每循环吸入或排出的流体体积”。这个观点从某种意义上来说是错误的，或者至少是定义不完全的。因为对于气体来说，体积这个概念必须要与温度和压力的概念同时存在。</h2>\n<p data-pid=\"vkWXCU4p\">排量仅仅是一个物理空间定义，并不等于实际吸入空气的量，更不等于排出燃烧后气体的量。</p>\n<p data-pid=\"WkwxLQZO\">最简单的例子：2.0T和2.0L排量都是2.0L，可是2.0T比2.0L的功率高50%左右。这里面的差别的根本来源并不是2.0T比2.0L多喷了50%的油，而是实际多进了50%的空气。</p>\n<p data-pid=\"cacSJeP5\"><img src=\"https://www.zhihu.com/equation?tex=%E5%8D%95%E7%BC%B8%E6%AF%8F%E5%BE%AA%E7%8E%AF%E5%90%B8%E5%85%A5%E7%A9%BA%E6%B0%94%E4%BD%93%E7%A7%AF%EF%BC%88%E7%8E%AF%E5%A2%83%E5%8E%8B%E5%8A%9B%2F%E7%8E%AF%E5%A2%83%E6%B8%A9%E5%BA%A6%E6%9D%A1%E4%BB%B6%E4%B8%8B%EF%BC%89%3D%E5%8D%95%E7%BC%B8%E6%8E%92%E9%87%8F%5Ctimes%E5%85%85%E9%87%8F%E7%B3%BB%E6%95%B0%5Ctimes%E8%BF%9B%E6%B0%94%E7%AE%A1%E7%B3%BB%E6%95%B0\" alt=\"单缸每循环吸入空气体积（环境压力/环境温度条件下）=单缸排量\\times充量系数\\times进气管系数\" eeimg=\"1\"></p>\n<p data-pid=\"9chA9jVV\">充量系数的定义： 将每循环吸入气缸的空气量，换算为进气管状态（压力/温度）的体积V1，这个体积与单缸物理排量的比值，叫做充量系数。</p>\n<p data-pid=\"Y2WqWtum\">进气管系数的定义：将进气管状态（温度/压力）下的单位空气量，换算为环境大气压/环境温度下的体积，将后者除以前者，得到的数值就是进气管系数。</p>\n<p data-pid=\"Pf8kW-sT\">简单的图解如下：</p>\n<p><img src=\"https://pica.zhimg.com/v2-982203d9115bfb2e9bd4a43ecca9d7fa_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2000\" data-rawheight=\"897\" data-watermark=\"watermark\" data-original-src=\"v2-982203d9115bfb2e9bd4a43ecca9d7fa\" data-watermark-src=\"v2-9dd91c17dce32ec5a9f929c8400bd08c\" data-private-watermark-src=\"v2-4041d83af6df8835ae2c9ff06932ad82\"></p>\n<hr>\n<h2>如果我们把环境大气压/温度等同于标准大气压和温度，那么我们就可以把新鲜空气的体积和空气量建立标准的对应关系。那么排量对于发动机做功能力的影响，以及我们能够做的事情就一目了然了。</h2>\n<h2>再次回忆一开始我说的话：一台发动机的输出能力，取决于他的进气能力。</h2>\n<p data-pid=\"tAXf-l58\">发动机的排量，是一台发动机做功能力的物理基础。在相同的技术配置下，排量越大，发动机的功率扭矩输出能力越大。</p>\n<p data-pid=\"aFSx4oGR\">但是，排量只决定了体积，再回忆一下前面我说的：</p>\n<h2>对于气体来说，体积这个概念必须要与温度和压力的概念同时存在。</h2>\n<p data-pid=\"0JGN6UGn\">看看这张图：</p>\n<p><img src=\"https://pic3.zhimg.com/v2-982203d9115bfb2e9bd4a43ecca9d7fa_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2000\" data-rawheight=\"897\" data-watermark=\"watermark\" data-original-src=\"v2-982203d9115bfb2e9bd4a43ecca9d7fa\" data-watermark-src=\"v2-9dd91c17dce32ec5a9f929c8400bd08c\" data-private-watermark-src=\"v2-4041d83af6df8835ae2c9ff06932ad82\"></p>\n<p data-pid=\"GMKz4xuG\">V2的大小受到了Vs的直接影响。但是V0的大小不仅取决于V2或者Vs，还取决于P2和T2与环境温度与压力之间的差异。</p>\n<h2>简单的来说，在相同的排量下，发动机每循环实际吸入缸内的空气量，还和进气的温度T2，和进气的压力P2相关。进气温度越低，进气压力越高，实际进气量就越多，发动机的做功能力就更强。</h2>\n<h2>首先我们谈进气压力。</h2>\n<p data-pid=\"dTf3AVf8\">对于自然吸气发动机来说，吸气的所有动力都来自于发动机吸气冲程形成的真空度，所以优雅的设计进气歧管，千方百计地减少进气阻力，特别是充分利用进气谐振，且避免进气脉冲对进气效率地干扰变得非常重要。一般来说1.5L以上的发动机就会采用可变长度进气歧管来进行优化。</p>\n<p data-pid=\"jSBH749Q\">这就是为什么，自然吸气发动机往往有一个很复杂和体积看起来很大地进气歧管结构，而增压发动机则比较简单。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-d46d254ca868b8dd2d87313af758b9e0_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1677\" data-rawheight=\"628\" data-watermark=\"watermark\" data-original-src=\"v2-d46d254ca868b8dd2d87313af758b9e0\" data-watermark-src=\"v2-666a1a914a34dacaee6e9cc6098ca5ef\" data-private-watermark-src=\"v2-9cb5e2cbc934578c9622cc05764e2a64\"></p>\n<p data-pid=\"WL84QGWJ\">增压发动机就简单粗暴了，直接增压就完了，减少了很多在进气歧管方面做的气流方面的研究。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-87e9c7f4638e96a319e2fabbf12f7817_720w.jpg?source=b1748391?rss\" data-caption=\"机械增压器\" data-size=\"normal\" data-rawwidth=\"1200\" data-rawheight=\"800\" data-watermark=\"watermark\" data-original-src=\"v2-87e9c7f4638e96a319e2fabbf12f7817\" data-watermark-src=\"v2-533aed698e7276346a24eaebde144ec9\" data-private-watermark-src=\"v2-fa30cbca1ccc026f634f0da6f7969061\"></p>\n<p><img src=\"https://pic1.zhimg.com/v2-8192eaa832d72059f206b2b2a13ed7a2_720w.jpg?source=b1748391?rss\" data-caption=\"废气涡轮增压器\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"800\" data-watermark=\"watermark\" data-original-src=\"v2-8192eaa832d72059f206b2b2a13ed7a2\" data-watermark-src=\"v2-abee29fbbfbd40f1e5659c89919c192d\" data-private-watermark-src=\"v2-4ae744fb41b2a257b7ffe67bbf09ce15\"></p>\n<p data-pid=\"bZXw-VBq\">此外，阿特金森循环与米勒循环这类通过调节气门机构，从而令进气门在进气冲程提前关闭，或者排气门在压缩冲程开始后继续打开，从而实现减少实际进气量，并进而实现膨胀比大于压缩比的这类情况也会带来实际进气量的不足，或者说排量与实际进气量的差异扩大的情况发生。</p>\n<h2>接下来我们谈温度T2的控制</h2>\n<p data-pid=\"02-u3mgK\">简单的来说，就是要尽可能的降低进气的温度，从而提升进气的密度。</p>\n<p data-pid=\"z4cxUhia\">特别是对于增压发动机，整车从环境中吸取的空气，在被废气涡轮增压的过程中，会被废气温度所加热，导致进气温度高，并进而导致进气的密度不够，相同体积下的实际进气量少。所以需要进行冷却，发动机的这个结构叫做中冷器。</p>\n<p data-pid=\"4R7AlNe5\">一般的发动机的中冷器采用的是空空中冷，就是用空气冷却的中冷器冷却进气。这个东西一般是归属于整车前舱结构。大概长这个样子：</p>\n<p><img src=\"https://pic2.zhimg.com/v2-40dd0528025c87ceac38e9c0f9d33e32_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"480\" data-watermark=\"watermark\" data-original-src=\"v2-40dd0528025c87ceac38e9c0f9d33e32\" data-watermark-src=\"v2-c137d7a8f6a6df0eb028c4e7971e1aa8\" data-private-watermark-src=\"v2-ad4087347284a4816fa8857a75cc0707\"></p>\n<p data-pid=\"PtlBaUyU\">空气冷却的效果肯定没有水冷的好，对于高性能发动机来说，这几年水冷的比例越来越高，进一步提升了扭矩响应。（下图右上角）</p>\n<p><img src=\"https://pic2.zhimg.com/v2-31fd87980d590eade4e957873d0bcfc0_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1282\" data-rawheight=\"720\" data-watermark=\"watermark\" data-original-src=\"v2-31fd87980d590eade4e957873d0bcfc0\" data-watermark-src=\"v2-9419d2a85908d1b919f2c78507e9c498\" data-private-watermark-src=\"v2-38365ebbde8ae6a30f80c8f7a89fe4c3\"></p>\n<p data-pid=\"TlaCzOp-\">我们总结一下：</p>\n<h2>单缸的排量是发动机活塞上下行程之间缸内物理空间，它是一台发动机进气量的基础。通过增压、减少进气阻力，调整进排气的气门型线本身及相位策略等方式来改变实际进气压力，通过中冷器等方式来改变进气温度，可以进一步的改变实际的进气量。而实际进气量决定了发动机的性能。</h2>\n<hr>\n<h2>接下来我们来说说马力、功率和扭矩。</h2>\n<h2>马力是一个功率单位</h2>\n<p data-pid=\"jyvBFPuA\">最早的马力的定义是：一匹拉力为180磅的马能在一小时之内将一架半径12英尺的水车拉动144圈，计算为33000英尺•磅/分钟，他就命名其为1马力，换算成现在就是746W。</p>\n<p><img src=\"https://pica.zhimg.com/v2-96b7955c0da4525819788943ca681051_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"400\" data-rawheight=\"335\" data-watermark=\"watermark\" data-original-src=\"v2-96b7955c0da4525819788943ca681051\" data-watermark-src=\"v2-16a86947f8082bdbd490742b96e7777c\" data-private-watermark-src=\"v2-0475645a20f21335290ddb28d59703f4\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-38d01abe3dae72a066154deb95a91d4f_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"702\" data-rawheight=\"256\" data-watermark=\"watermark\" data-original-src=\"v2-38d01abe3dae72a066154deb95a91d4f\" data-watermark-src=\"v2-1fe5dde4201782eb50ec3dfb57ce8fa2\" data-private-watermark-src=\"v2-5f9e755acc34b1b85a3866662092f2df\"></p>\n<h2>功率和扭矩的定义：</h2>\n<p data-pid=\"RQJZkV99\">其实学术叫法应该是发动机的有效功率，定义是：发动机在单位时间内所作的有效功。</p>\n<p data-pid=\"FCnY5x3X\">发动机的有效功率是通过测功机测试在特定工况下，发动机输出的扭矩Ttq和发动机的转速n而得到的。功率=扭矩*转速</p>\n<p data-pid=\"OJQt7knw\">如果有效功率Pe的单位是kW，而扭矩Ttq的单位是Nm，转速n的单位是rpm（转/分钟），那么公式是</p>\n<p data-pid=\"Pa0dZldh\"><img src=\"https://www.zhihu.com/equation?tex=Pe%3D%5Cfrac%7BTtq%5Ctimes+n%7D%7B9550%7D\" alt=\"Pe=\\frac{Ttq\\times n}{9550}\" eeimg=\"1\"></p>\n<h2>扭矩是一种旋转力矩，而功率要考虑的是单位时间的做功的总量。</h2>\n<h2>很多人纠结功率和扭矩，本质是不理解看一辆车子的性能怎么样，到底是看功率还是看扭矩。</h2>\n<p data-pid=\"IkmRlvsr\">2019年，当时的38号车评专门就这个问题和很多人进行了讨论，他想要说明的是：车辆的零百加速主要由功率而不是扭矩决定。发生这个讨论的原因，是德系的车辆一般采用增压等方式来提升低速扭矩响应，但是功率一般并不高（这几年更是快速下降），但是很多大排量自吸发动机是功率更高。国内的很多车企也在学习德系的方法。但是38号认为，功率才是决定车辆性能，尤其是零百加速的表现。</p>\n<h2>这个问题看起来简单，但是由于车辆存在变速箱变速换挡策略，以及发动机是需要将最高功率、最高扭矩以及扭矩曲线结合来看才能得到结果，所以其实是很难回答的一个问题。</h2>\n<p data-pid=\"uw5eCFEJ\">我结合我们的实际开发经验，给出2个简单粗暴的结论：</p>\n<h2>0-40加速，扭矩优先；40-100加速，功率优先。0-100加速，功率优先。</h2>\n<h2>扭矩不仅要看最高扭矩，还要看扭矩随转速的扭矩曲线。将扭矩和峰值和扭矩曲线的平台宽度结合在一起来看，就能够将功率和扭矩与车辆性能挂上钩了。</h2>\n<p data-pid=\"TUvBPUJe\">其实德系为什么对低扭这么执着，是由德国的国情带来的，因为我曾经有一款发动机，是原计划到欧洲销售的，欧洲的同事当时给我发了一些欧洲市场需求。其中有一个我印象很深刻，欧洲市场有差不多10%的份额来自于公司用车，公司用车的司机很关心在启动后一脚油门的加速响应，这是低速扭矩的主要作用范围，所以不断地要求改进最高扭矩的最低转速以及扭矩响应性。</p>\n<p data-pid=\"mS1kd-M8\">以我之前写的为通用全新1.5T与市场同级性能对比文章可以作为一个更加详细的参考：</p>\n<a href=\"https://zhuanlan.zhihu.com/p/395131247\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://picx.zhimg.com/v2-22483dc4ce6f4b87b6a39b55df79aac4_qhd.jpg?source=b1748391\" data-image-width=\"1905\" data-image-height=\"962\" class=\"internal\">JackyQ：同级功率输出地表最强 支持OTA升级的燃油平台 - 万字解析通用第八代Ecotec全新1.5T的“阿凡达”计划</a><p><img src=\"https://pic2.zhimg.com/v2-0caef0bab9ad0e1d14a00e3a26f474c4_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"893\" data-rawheight=\"561\" data-watermark=\"watermark\" data-original-src=\"v2-0caef0bab9ad0e1d14a00e3a26f474c4\" data-watermark-src=\"v2-be7182ff57d0bf3fe3a6f17da7f83711\" data-private-watermark-src=\"v2-11c3b1ab093c48a17757d55ca6fdae1f\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-06fd0fb5358849ea62efb8068e19acb0_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"934\" data-rawheight=\"671\" data-watermark=\"watermark\" data-original-src=\"v2-06fd0fb5358849ea62efb8068e19acb0\" data-watermark-src=\"v2-611fa19da4123d9389fb9f3277d505b4\" data-private-watermark-src=\"v2-ee663534e1b55797a08e684a406eecd1\"></p>\n<h2>-------以下为引文---------</h2>\n<h2><b>在动力性对比方面我想要谈3点： 1. 动力性功率优先还是扭矩优先？ 2. 低扭响应受到什么影响；3. 扭矩是光看一个最高扭矩吗？</b></h2>\n<h2><b>为了直面问题，我们先从第3点：扭矩曲线的调教来谈起：</b></h2>\n<p data-pid=\"b6THovqR\">我们将这四款发动机连同本田1.5T的扭矩数据放在一起，可以看的更明显：</p>\n<p><img src=\"https://pic1.zhimg.com/v2-17c070f42cf3ec2a942c33e688d78615_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"934\" data-rawheight=\"671\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"IlakLRet\">解读一下这张表代表了什么：</p>\n<ul>\n<li data-pid=\"raxLe_Tt\">\n<b>橙黄色的是奇瑞1.6T，在扭矩方面排量优势给了它峰值扭矩上的一些优势，但是峰值扭矩的出现时间比较晚，峰值扭矩平台为2000-4000rpm。</b>排量给了总扭矩的优势，但又带来了增压器扭矩爬升迟缓的问题，进气端没有做太多的优化。总体表现来说中规中矩。（奇瑞数据来自于奇瑞发布1.6T的PPT图，原图就表现出峰值扭矩290Nm@2000rpm 后轻微下飘到4000rpm@285Nm左右的情况，这和长城在1750rpm扭矩数据轻微上漂到285Nm，整体扭矩平台在280-283Nm附近情况差不多。）</li>\n<li data-pid=\"g2SbbY8o\">\n<b>红色是奔驰1.5T的数据，</b>这个扭矩曲线看起来很奇怪，主要我确实没有找到其他的M264的功率扭矩图。这张图对应其本次官方数据中峰值扭矩仅出现在3000-4000之间这个信息，这个信息是正确的。<b>和奇瑞一样，尽管在1.5T上压榨出了280Nm扭矩，出现时间太晚，持续时间太短。</b>\n</li>\n<li data-pid=\"jDs-ujCx\">\n<b>长城1.5T则是另一个极端，低速时候扭矩随着转速的提升很快，但是不到3000转就泄了。</b>这个表现在车辆上就是起步感觉好，但是中高速竞速驾驶过程中会出现频繁换挡，没有稳定的扭矩平台就意味着更大的变速箱调整需求。这一点和长城的增压器选择以及整车调教方向有关系，看起来其实有点把汽油机调出柴油机的味道来了。</li>\n<li data-pid=\"IinGM9NL\"><b>这里我没有列长安蓝鲸NE 1.5T 300Nm版的数据，因为我没有找到长安发布的扭矩图。只知道蓝鲸动力和长城1.5T类似，扭矩随转速提升的速度很快，官宣的扭矩平台为1250 - 3500rpm。不过考虑到蓝鲸的最大额定功率只有132kW，预计转速提升后的扭矩衰退曲线介于长城和奇瑞之间。</b></li>\n</ul>\n<h2><b>将功率和扭矩都低于通用新1.5T的本田1.5T高功率版加进来的原因是，通用新1.5T发动机的调教理念和本田1.5T高功率版颇有点异曲同工的意思。通用新1.5T在1500rpm达到95%扭矩，接近本田1.5T高功版峰值扭矩，而对比行业水平超级宽广的峰值扭矩平台对应的是车辆在中高速竞速中充沛且持续的动力，避免在关键提速中触发冲击换挡和动力中断！</b></h2>\n<h2><b>更重要的是，通用1.5T的高功版是配合48V系统开发的，目前上汽通用还没有官方公布电机数据，但是参考类似BSG电机的水平，预计峰值扭矩可以达到50Nm左右，作为发动机的低速扭矩补偿，快速介入。</b></h2>\n<p data-pid=\"70H0dL0W\">本田1.5T的260Turbo版上市后在北美的口碑很好，目前通用汽车和本田公司在发动机开发和汽车的动力调教方面其实有很好的技术交流合作模式。在2020年9月两家公司签署了不具约束力的战略合作协议，共同开发汽油动力和纯电动汽车。</p>\n<p data-pid=\"IvssdxkH\"><b>通用汽车近年来在中大扭矩强力推进9AT/10AT，在中小扭矩采用CVT和部分6AT，将日系平顺性动力调教与美系的高性能调教相结合的意味非常明显。变速箱方面的上汽通用9AT的表现就是最好的证明。通用汽车最新一代的研发体系采用了更加全面的ARM1驾驶质量，就是要把发动机的动力输出与变速箱的调教相结合，结合整车驾驶质量联合开发，这就不是一个简单的刷一个点的峰值的问题，而是更加重视实际的驾驶品质。</b></p>\n<p><img src=\"https://pica.zhimg.com/v2-17ac2c23ddf8eaed4545214ec3b90c57_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"676\" data-rawheight=\"239\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<h2><b>接下来我们回过头来谈第1点，动力性是功率优先还是扭矩优先？</b></h2>\n<p data-pid=\"iC6lTkaI\">这个问题在几年前由38号重点“辟谣”0-100加速到底看功率还是扭矩开始，从微博到知乎发生过很长时间的辩论。这篇文章篇幅所限我无意讨论过程，<b>直接抛出结论： 整车的动力性表现是发动机和变速箱结合输出的结果，一般来说，0-40kph的动力表现更看重扭矩，40-100kph的动力表现更看重功率，车速更高自然功率的影响更大。</b></p>\n<h2><b>紧接着是第2点：低速扭矩的表现受到什么影响？</b></h2>\n<p data-pid=\"yco3lv29\">为了能够实现更强劲的功率扭矩输出，那么就需要更大的增压进气量，而当发动机转速提升后，每缸的进气时间快速减少，要保持稳定的功率扭矩输出，就必须要更加强大的进气。<b>所以各位一定要明白这个道理：实际真正决定发动机动力的不是喷油器，而是包括增压器在内的进气系统。</b>如果只是从增压器端的设计考虑这个问题，要么你选择一个比较大的增压器，但是低转速段的响应会比较慢，要么你选择一个小一点的增压器，但是到转速提升后就会遭遇增压不足过早泄扭的问题。要获得峰值扭矩平台那就更难了，要么就是直接把峰值扭矩做低，但是大家可以看看如果按照通用1.5T的1750-5500rpm的标准来划扭矩平台，那么这些高扭矩发动机的峰值扭矩就不能看了。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-c588faffe310d7fbe1f71872827ace1e_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"934\" data-rawheight=\"671\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"PKjKJTTW\"><b>那么上汽通用新1.5T的做法比较聪明，它实际上是采用的集成优化的形式来实现实际驾驶工况的低速扭矩响应的提升。</b></p>\n<p><img src=\"https://pic3.zhimg.com/v2-675601874a04f9c31f4f06c437f0c6e9_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1282\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"extNTkSj\">扭矩图中扭矩随着发动机转速的提升效果只是实际驾驶中低速扭矩响应的一部分，它只代表了发动机本身的性能表现。</p>\n<ul>\n<li data-pid=\"F8HcZjLp\">\n<b>水冷中冷进气系统一般是出现在重视低扭的德系上，它通过降低进气温度实现空气密度更大，在相同的增压器风扇的作用下可以更快，更多的压入新鲜空气。</b>水冷不仅可以提升最大功率，而且它使得进气系统的所需容积大大降低，增压器的响应改进超过17%。</li>\n<li data-pid=\"o8kcIwdq\">\n<b>基于35Mpa的高效燃烧系统是神器。</b>这个我们在第2点在讲。简单的来说，这套系统和基于先进喷射算法的控制逻辑可以让燃烧控制避开很多排放与安全性的限制，实现更加迅速的燃烧控制响应。</li>\n<li data-pid=\"r9LPl0-G\">\n<b>Dual Fast相位调节器是通用汽车和供应商战略合作联合开发的产品，全球首发，实现了进排气气门的开闭相位切换速度提升了1倍。</b>发动机能够更快的进入目标状态。</li>\n<li data-pid=\"68YG-WST\"><b>响应性优化的低排气压力高响应排气系统，而且这套排气系统是包含了高集成GPF，当法规和整车性能要求需要GPF时，这种布置方式使得即便是在低负荷工况下，GPF能够尽快进入合适的温度正常工作，结合35Mpa系统和智能燃烧控制带来的良好原排，最大限度的减少客户处的风险。</b></li>\n</ul>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/JackyQ?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">JackyQ</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/268735662/answer/2555381239?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">21 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/529627169?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">同样的发动机为什么会产生不同的马力与功率?</a><br><a href=\"http://www.zhihu.com/question/538898270?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">汽车发动机的进气门和排气门的开关是靠什么控制的？</a><br>\n","link":"http://www.zhihu.com/question/268735662/answer/2555381239?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"增程式电动车一定要用传统的汽油发动机驱动发电机来发电吗？","date":"2022-07-07 07:17:17","description":"\n<p data-pid=\"KLpfYCyY\">增程式本身就是为了弥补电池的储能与充电能力不足，而通过使用高能量密度燃料和驱动方式的其他动力来源都可以作为增城器。</p>\n<p data-pid=\"HXBbUAbL\">对比常用锂电池中能量密度最高的三元锂电池，汽油的能量密度是它的58倍。即便考虑汽油发动机的热效率损失，也是一个量级的差距。而且汽油是一种可以在常温常压下以液态存储的完美燃料。这是汽油发动机能够作为电动汽车增程器的基础。这背后的化学基础，请参考我之前的回答，避免对这个答案的主线带来干扰：</p>\n<p><img src=\"https://pic2.zhimg.com/v2-d971f5ec72b01f919d560263ddfd0db9_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"813\" data-rawheight=\"581\" data-watermark=\"watermark\" data-original-src=\"v2-d971f5ec72b01f919d560263ddfd0db9\" data-watermark-src=\"v2-cc8edf170c4f34fe5945066c133a0f96\" data-private-watermark-src=\"v2-095b342a05975d4f37ab4fe1b8dfaaad\"></p>\n<a href=\"https://www.zhihu.com/question/23527698/answer/2525527217\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pica.zhimg.com/v2-34fc458a439d18b43339779759eb0c14_qhd.jpg?source=b1748391\" data-image-width=\"813\" data-image-height=\"581\" class=\"internal\">究竟是什么限制了电池的容量？</a><h2>首先，我们从大的形式来说，来谈什么还可以作为增程器：</h2>\n<ol><li data-pid=\"Vmmc5H5W\"><b>从能量转换效率的角度来说，效率最高的增程器是氢燃料电池</b></li></ol>\n<p data-pid=\"KNEGrq7e\"><b>所有的氢燃料电池汽车，都是增程式。</b></p>\n<p data-pid=\"TFNYOpry\"><b>氢燃料电池的发出功率对比车辆的电驱输出功率越小，带电池量越大，那么就越接近充电宝式的增城器。也就是说增程器发出的电更多的先冲到电池里面，然后电池再输出到电机中。中国过去很多氢燃料电池大巴就是这样的，很大的一辆车，就带一个30kw - 60kw的燃料电池就够了。这样的增程器控制比较简单，燃料电池基本上启动了就是稳定输出峰值功率就好了。优点是简单，缺点是电力多次进出电池，转换损耗大。</b></p>\n<p data-pid=\"Vdk7E9zm\"><b>氢燃料电池的发出功率对比电驱的输出功率比值越大，带电池量越少，那么车辆就越接近直驱式增程。这种增程办法，燃料电池发出的电更多的直接到电驱，电池作为一个补充。这样的系统要求对燃料电池的控制非常灵活，电堆的输出响应也很快，难度比较大。这样的优点主要是转换效率更高。比较典型的代表丰田的Mirai。</b></p>\n<p><img src=\"https://pica.zhimg.com/v2-4160a16d30de5da987bbda8fd547b0c1_720w.png?source=b1748391?rss\" data-caption=\"奔驰氢燃料电池卡车\" data-size=\"normal\" data-rawwidth=\"3096\" data-rawheight=\"2060\" data-watermark=\"watermark\" data-original-src=\"v2-4160a16d30de5da987bbda8fd547b0c1\" data-watermark-src=\"v2-94013218b31302cd5bfd50f8e28ef46f\" data-private-watermark-src=\"v2-eb4b3af65458a2e144a2ce69da0c5cc3\"></p>\n<p data-pid=\"Mxtcrav-\">2.燃气轮机也可以做到最高转换效率超越汽油发动机，但是局限性很大</p>\n<p data-pid=\"2A_BBP2J\">燃气轮机在车辆上的应用最早可以追溯到1940年代，英国的罗孚公司在1949年基于他们在1945年制成的罗孚燃气轮机上，打造了世界上第一台真正意义上的燃气轮机汽车：罗孚 P4 Rover 75。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-8590b315daeed4860295f6fdde564fec_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"536\" data-watermark=\"watermark\" data-original-src=\"v2-8590b315daeed4860295f6fdde564fec\" data-watermark-src=\"v2-abec4a7c35da806d937d83e4a3ac4388\" data-private-watermark-src=\"v2-7a9bdf28970bc430cf770df367b0177b\"></p>\n<p><img src=\"https://pic3.zhimg.com/v2-80be03b1249bfce08091bc1c85845233_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1224\" data-rawheight=\"852\" data-watermark=\"watermark\" data-original-src=\"v2-80be03b1249bfce08091bc1c85845233\" data-watermark-src=\"v2-091ce4c6ad19c8e607e29c4f3fff7526\" data-private-watermark-src=\"v2-0db212756d9403abb5563ca1bed323a1\"></p>\n<p><img src=\"https://pic4.zhimg.com/v2-bf59ebf61b75a7e6513c7166f9ec1e04_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"782\" data-rawheight=\"508\" data-watermark=\"watermark\" data-original-src=\"v2-bf59ebf61b75a7e6513c7166f9ec1e04\" data-watermark-src=\"v2-4a6500b65c99d6587f07d5f571cbfdc0\" data-private-watermark-src=\"v2-e483358d55fb23b34e79a283acffec21\"></p>\n<p data-pid=\"rSZfdkAl\">罗孚公司曾经把这种动力称为“未来动力”，但是这项技术并没有发展下去。第一代燃气轮机汽车的点火转速达到3万转，在当时的工艺条件下，批量民用车辆的转速达到这个水平是很危险的。首台车辆的工程师驾驶员都在提心吊胆如果燃气轮机失效，高速飞出的金属碎片就会像子弹一样直接打穿他的身体。</p>\n<p data-pid=\"oE0Lflar\">真正现代意义上的微型燃气轮机的研究是从1970s年开始兴起的，最早是为了分布式能源的需求。我在上大学的时候，有一个课题就是做微型燃气轮机的调研，那时候研究的方向是跟踪国外在小的军事单位甚至单兵领域应用的情况，谁能想到快20年后我在网站上回答这个问题。</p>\n<p><img src=\"https://pica.zhimg.com/v2-7a0c9d96141226edafb0b8e1a4489991_720w.png?source=b1748391?rss\" data-caption=\"1994年美国的商业化微型燃气轮机\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"687\" data-watermark=\"watermark\" data-original-src=\"v2-7a0c9d96141226edafb0b8e1a4489991\" data-watermark-src=\"v2-1230d44be7267a072e91db1e46592b5e\" data-private-watermark-src=\"v2-b94480eba1263a9ba1e2ceba63c5d0d2\"></p>\n<p data-pid=\"sD34NZwu\">微型燃气轮机的成熟型号最早被应用在军事领域，例如在1981年，美国的微型燃气轮机轮机公司就开始为爱国者导弹的战斗系统提供供电系统，当年就交付了超过2000台。通过80年代的逐渐完善后，微型燃气轮机在90年代越来越成熟而且在民用领域广泛商业化，并引起了汽车公司的高度关注，克莱斯勒、菲亚特、福特、通用、梅赛德斯-奔驰、沃尔沃都进行了基于微型燃气轮机的混动系统的开发。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-de08abb76f70ebfb8b2f6c372d856d54_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"450\" data-watermark=\"watermark\" data-original-src=\"v2-de08abb76f70ebfb8b2f6c372d856d54\" data-watermark-src=\"v2-bc1856d64bccef19e342e5d91708baae\" data-private-watermark-src=\"v2-8230b297724b736565605938d995cc60\"></p>\n<p data-pid=\"9u-uwzwH\">上图是福特公司在2009年发布的一款微型燃气轮机PHEV混动车型，其实就是增程式。因为高达70000转的燃气轮机不可能直接机械连接到车轮上。</p>\n<p data-pid=\"IzbLa8zH\">燃气轮机作为汽车增程器的技术没有能够继续成熟发展的原因其实还是很直白的。汽油机的发展已经非常成熟了，燃气轮机如果要实现高能量转换，那么必须要实现更高的燃烧温度和超高的转速，一般70000-90000之间（是9万转，你没输错0的数量）。噪音、震动、零部件的安全性（任何机械结构，当转速超过1.5万转，对于轴承的设计和制造要求都是指数性的上升）、密封的要求等都超过了一般民用品能接受的程度。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-d53fcf917786eb69f5828693f71fd70a_720w.png?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"550\" data-rawheight=\"306\" data-watermark=\"watermark\" data-original-src=\"v2-d53fcf917786eb69f5828693f71fd70a\" data-watermark-src=\"v2-f10652786a33c0bfc3d288823a99ec40\" data-private-watermark-src=\"v2-487bc3402e4bc384989ebf2f07903c06\"></p>\n<p data-pid=\"q24mj-7v\">前几年有一些汽车初创公司将新一代的微信燃气轮机再次作为增程器的方案拿来炒作，很多网站也把微型燃气轮机增程器写成了汽车工业的未来。这其实并不是汽车公司的发展成果，而是微型燃气轮机自身的发展。</p>\n<p data-pid=\"0xeBtS6B\">不过我个人认为微型燃气轮机无论是目前的效率（肯定不如大型燃气轮机），还是如此高速的机械结构在车用上带来的风险与运行困难，将燃气轮机放在工作条件复杂的移动端都不是一个好主意。</p>\n<p><br></p>\n<hr>\n<p data-pid=\"TJLzGbVL\">然后我们来谈谈燃料类型，其实这个比较简单。</p>\n<p data-pid=\"bmD_kuRP\">同样是内燃机的压燃式柴油机当然可以作为增程器，而且有很多类似产品。柴油机的主要问题一方面是噪音和震动的问题，另一方面是燃料获取的问题，特别是在中国。中国当年错过了欧洲车用高效柴油机应用的浪潮，一个很大的原因是城市很难拿到高品质和稳定供应的柴油。柴油优先供给军事领域，然后民用的柴油品质比较差，用在农用机械和低速重载的货车上。事实上过去中国的柴油是如此至少，以至于中国的中小型运输车辆很大的比例以及很长的时间是使用汽油的。</p>\n<p data-pid=\"t6Hvcjy-\">除了常见的柴油和汽油，使用天然气、甲醇、氢气和氨气也是未来的发展趋势。</p>\n<p data-pid=\"5Gi9Do3e\">这些燃料的共同特点是燃料本身属于低碳替代燃料，而且都可以通过电解水后进行电子合成，或者通过生物合成的方式来制取，主要是为了未来的碳排放控制的角度。</p>\n<hr>\n<p data-pid=\"g1s392Op\">如果没有碳排放控制的需求，汽油依然是人类历史上发现的民用交通工具最完美的燃料，没有之一，而且刨除地缘政治因素，绝对储量本身在200年尺度其实完全可以说是取之不尽用之不竭，基础设施广泛，燃烧适应性好。这也是为什么汽油发动机成为传统民用乘用车的动力王者的原因。</p>\n<p></p>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/JackyQ?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">JackyQ</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/528171482/answer/2554895380?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">17 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/58208559?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">增程式新能源汽车，更适合用哪种发动机？</a><br><a href=\"http://www.zhihu.com/question/538035735?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">增程式发动机与传统发动机有什么区别？</a><br>\n","link":"http://www.zhihu.com/question/528171482/answer/2554895380?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"堵车时，发动机频繁启停会对发动机寿命造成严重的不良影响吗？","date":"2022-07-07 07:15:23","description":"\n<p data-pid=\"TJrylz5c\">本人从事了十几款车型升级为启停之后的设计变更和认证，以及后续机型将启停作为标配后的系统设计工作。</p>\n<h2>我介绍一下，当一台发动机被改为启停功能后，需要修改什么零件。</h2>\n<p data-pid=\"9dFNEyFg\">站在2022年的角度，启停功能是需要做区分的。分为纯燃油车的启停、带48V弱混的启停。</p>\n<p data-pid=\"hot2zdhR\">而比48V弱混更高的电气化程度，低速启动阶段是电机拖动，然后带动发动机启动，和文中的堵车导致的频繁启停工况不一样，我们就不涉及了。</p>\n<h2>传统的启停是通过调整启动电机的设计来实现的。</h2>\n<p data-pid=\"_fuu8b2R\">带启停功能的启动电机的物料价格是不带启停功能的2-4倍。当一台非启停功能的发动机需要升级为启停功能的时候，需要对启动电机、柔性盘或双质量飞轮的齿以及轴承进行升级，整车这里需要升级蓄电池就不多说了。不过也就仅此而已。</p>\n<p data-pid=\"zB8HuInY\">非启停工况的启动电机一般来说全生命周期的启动次数在6-8万次左右，而启停功能的启动电机的认证周期在35万次左右，部分自主企业会降低到25万次（后面讲为什么）。</p>\n<p data-pid=\"KG2D2teR\">特别是对于配自动变速箱的发动机来说，采用的是一种叫柔性盘的飞轮结构，这是因为自动变速箱所要求的轴向窜动，需要将连接发动机和变速箱之间的飞轮结构变成既有强度又有挠度的结构，这种结构在国外叫Flexplate，在国内被翻译为柔性盘。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-afe669241fb15ca9a5c520388bcf5ea2_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1454\" data-rawheight=\"1354\" data-watermark=\"watermark\" data-original-src=\"v2-afe669241fb15ca9a5c520388bcf5ea2\" data-watermark-src=\"v2-787cfb07d87317e8d200181046897211\" data-private-watermark-src=\"v2-cf16bcebbee6b624fb0e082d0d4902b8\"></p>\n<p data-pid=\"hrI0D-c6\">启停会带来冲击载荷，从而会对柔性盘的寿命带来影响，柔性盘（AT）或双质量飞轮（CVT）的齿与启动电机匹配，需要进行齿强度的确认或加强。</p>\n<p data-pid=\"7acU81Wj\">本土的主机厂一般会采用在柔性盘供应商处开展零部件级的疲劳试验来模拟启停冲击，采用电机模拟点火冲击。合资品牌一般是直接用点火发动机台架直接来开展启停试验。比如说在我这里的验收标准是35万次整机真实点火启动耐久冲击后，齿面磨损可接受，基本上再跑个35万次还能保持功能完整的那种。</p>\n<p data-pid=\"-5MASLGa\">对轴承的加强也是如此，不过和普通人理解不同的是，启停需要加强的是发动机前端第一档的主轴承。如果不做这样的加强，就会存在轴瓦磨损的风险。</p>\n<p><img src=\"https://picx.zhimg.com/v2-160175bf4c0741bc9cfe21de6204c461_720w.jpg?source=b1748391?rss\" data-caption=\"此图仅作参考\" data-size=\"normal\" data-rawwidth=\"1024\" data-rawheight=\"576\" data-watermark=\"watermark\" data-original-src=\"v2-160175bf4c0741bc9cfe21de6204c461\" data-watermark-src=\"v2-a14638cb2986580ee8a2d6908db970d7\" data-private-watermark-src=\"v2-1a19730d1e6f9cbe460679c24220ae42\"></p>\n<p data-pid=\"7MW9Vr-J\">我们会选择采用polymer基础的涂层来给轴瓦进行加强，这种耐磨涂层可以显著提升轴瓦的耐磨和抗咬合能力。当你拆开发动机后，如果发现主轴瓦（安装在缸体上的大轴瓦）的颜色不是铝合金的亮白色（由于轴瓦表面需要做微储油槽而有一点哑光效果），那么除了部分情况下是日系发动机采用的是低摩擦金属基涂层外，绝大多数情况下是我说的polymer耐磨涂层。</p>\n<p><img src=\"https://pica.zhimg.com/v2-f30fb1f8736f226940f12e615728e135_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"474\" data-rawheight=\"284\" data-watermark=\"watermark\" data-original-src=\"v2-f30fb1f8736f226940f12e615728e135\" data-watermark-src=\"v2-743579478daeccef9743e4794cbe2249\" data-private-watermark-src=\"v2-12b4d8c474ecd41ec095188139946148\"></p>\n<p data-pid=\"VTU2qean\">有些时候你会看到这类轴瓦的颜色不同，其实不用在意，颜色不同是由于各家供应商用的着色剂不同。比如FM公司采用的红色，而Mahle公司采用青蓝色居多，其他轴瓦厂也会采用其他颜色。这个倒没有什么法规规定，就是行业内约定俗成的一些颜色。也蛮有趣的。</p>\n<p data-pid=\"A9Ld5_hU\">启停用启动电机的结构也也会更复杂和精巧，一方面来说启动电机的功率会更大，性能更强，另一方面对于啮合要求会更高。</p>\n<h2>传统启停并没有改变靠瞬时大电流的启动电机来将发动机的转速带到200rpm以上并让点火起燃顺利发生的模式。所以启动周期依然比较长，然后会给驾驶员一个冲击的感觉。这是传统启停令客户不满的一个基础背景。</h2>\n<p><img src=\"https://picx.zhimg.com/v2-7f8bc15c4e818d286a62de6ec13e3a55_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1280\" data-rawheight=\"953\" data-watermark=\"watermark\" data-original-src=\"v2-7f8bc15c4e818d286a62de6ec13e3a55\" data-watermark-src=\"v2-2142cf8c7fddd70cf869bde68b219aea\" data-private-watermark-src=\"v2-39c7478da44fc82ce85bd7d47a94dd4a\"></p>\n<p data-pid=\"QA-y7h-t\">注意看上图的右侧收缩在暗处的齿轮，这就是启动齿轮。当车辆要启动时，首先这个齿轮会伸出来，平移到目前光亮轴的位置，并与前面说的发动机的柔性盘或者双质量飞轮的齿啮合，然后车辆提供一个大电流让这么小的一个电机带动发动机转起来，并顺利点火运行。</p>\n<p data-pid=\"cdfJQD4-\">让如此小体积的电机带动相比很大的发动机转动需要巨大的扭矩，也就是巨大的电流。事实上，电流是如此之大，以至于几乎所有的车子都要求你的单次启动时间不能超过15秒，而且当你打不着火的时候不能多次频繁启动，需要休息一下。因为过多使用会导致电机线圈热量过高，导致启动电机“烧了“，其实就是过热失效。</p>\n<h2>在传统启停时代，基于有限的硬件条件，工程师还是想了很多办法来优化这个设计的客户体验。其中，策略最为复杂的是通用汽车的启停策略。</h2>\n<p data-pid=\"UafeQmd2\">通用汽车优化启停策略的原因完全是被逼的，因为美国法律规定如果车企要在法规申报的过程中申报具有启停功能而享受了油耗的收益，那么车辆的启停功能应该被设定为不可被关闭。这就是为什么，上汽通用的车子，特别是很多全球车型，国内客户一直以来的抱怨是找不到启停开关，有些的藏得很深，有些干脆连修改的界面都没有。</p>\n<p data-pid=\"TpO2CSdf\">举个例子：通用汽车的启停有一个独门绝技，叫做COM (Change of Mind），它关注的客户痛点是这样的：</p>\n<p data-pid=\"B8H0Vpu1\">当你开车遇到拥堵或者红灯，你刹车，发动机要进入启停功能的停机状态，但是在停机的中间，突然绿灯了，或者前车动了。一般的启停系统需要等本次停车结束后，发起下次启动。但是通用汽车的COM模式启停可以实现当刹车松开的一瞬间，启动电机可以快速准确的插入并啮合到还在旋转的飞轮之中，并再次快速启动发动机。这就可以大大的改善客户再次启动的动力恢复时间。</p>\n<h2>除了这个功能之外，通用汽车的启停策略设计了数十种不同的模式，然后有一个巨大的策略库来进行各种极端情况的处理，从而尽可能地减少对客户的冲击。</h2>\n<p data-pid=\"wy62DBPG\">当然，策略的优化只能改进，却无法完全改变传统启停天生的冲击大的基础。所以，有一年我在和上汽通用品牌的人在试驾后，我说这个启停的功能很棒啊，COM我觉得不错，品牌方的人苦笑道：在中国的大环境下，启停的最好去处难道不是被关掉吗？</p>\n<p><img src=\"https://picx.zhimg.com/v2-fcf5a94f3b28948f4e10a8016835bca3_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"347\" data-rawheight=\"415\" data-watermark=\"watermark\" data-original-src=\"v2-fcf5a94f3b28948f4e10a8016835bca3\" data-watermark-src=\"v2-965abe3aceebe6609789427838fe9c84\" data-private-watermark-src=\"v2-dbba57fb622b414221b7f383bc8ea017\"></p>\n<p data-pid=\"-B-E7mQm\">这种心态带来的恶性循环，就是很多本土品牌不再优化启停策略，任由启停实际感受很糟糕，反正法规油耗拿到了，客户会关闭的。然后带来的进一步恶果，就是国内部分品牌主机厂的启停认证不仅是零部件模拟，而且将次数下降到了20万次甚至更低。</p>\n<p data-pid=\"YMTAZ1U0\">至于说大家担心的活塞、活塞环啥的。影响不大。这点冲击没什么影响。我在2012年后改的发动机从1.3L到2.5L，从没有因为改S/S而修改过这些零件，24万公里耐久后检查零件磨损并没有差别。</p>\n<hr>\n<p data-pid=\"jnpCtKrf\">P0 48V弱混的启停是通过P0皮带轮电机带动的，智能启停效果远好于传统启停。</p>\n<p data-pid=\"P1qEwouM\">以我去年参加的上汽通用的昂科威S发布上官方提供的1.5T+48V系统为例，前端的48V电机不仅可以带动发动机启动，还可以提供高达50Nm的较长时间的扭矩响应补偿功能。由于是电机辅助启动，不仅摆脱了机械齿轮传动带来的冲击感，而且耐久性更高，可以实现50万次以上的启停耐久。此外，尽管电机无法支持独立驱动车辆，但是依然可以实现对发动机的加速响应补偿、减速部分能量回收以及灵活的智能启停功能。而且发动机也因此可以将怠速转速适当提升，令平顺性进一步加强。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-9cbd33d618d2a7ad3fd19f716cde74e0_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1200\" data-rawheight=\"671\" data-watermark=\"watermark\" data-original-src=\"v2-9cbd33d618d2a7ad3fd19f716cde74e0\" data-watermark-src=\"v2-8bdf40bf1984d625604cfb930d272389\" data-private-watermark-src=\"v2-0714c600e791bea6603aeeda804df87e\"></p>\n<p data-pid=\"1lGOaUPc\">采用这种模式的启停，对于发动机的影响就很小了，只需要对轴承进行加强即可。</p>\n<hr>\n<h2>总结一下：</h2>\n<ol>\n<li data-pid=\"BEG7jt10\">传统启停会对零件寿命带来挑战，但是主机厂的工程师已经提升了对应零件的设计标准，从而让耐久寿命回归到了正常水平。事实上因为这其中使用了很多严重过设计的技术（例如涂层），你甚至可以认为启停发动机的寿命比非启停的还要高；</li>\n<li data-pid=\"l0Y7Tv2v\">主机厂想了很多办法来优化传统启停的客户感受，但是由于传统启停的基础机械机理，客户还是会感受到部分的不适感，关键看客户是否能接受。作为一个经常关注瞬时油耗，而且还经常清零油耗里程来自娱自乐本次下班的平均油耗的车主来说，启停功能真香。</li>\n<li data-pid=\"98LTjem4\">P0-48V启停大幅改善了启停感受，也减少了对发动机的硬件影响，未来车主对于启停的评价可能会有新的变化。</li>\n</ol>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/JackyQ?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">JackyQ</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/538637976/answer/2554346886?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">40 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/529662161?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">车辆空调开启时发动机转速不变化是怎么回事？</a><br><a href=\"http://www.zhihu.com/question/529672105?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">车辆空调开启时发动机转速不变化是什么原因造成的？</a><br>\n","link":"http://www.zhihu.com/question/538637976/answer/2554346886?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"用乐高，重现心目中那些「最伟大的作品」","date":"2022-07-07 03:02:07","description":"Matrix首页推荐Matrix是少数派的写作社区，我们主张分享真实的产品体验，有实用价值的经验与思考。我们会不定期挑选Matrix最优质的文章，展示来自用户的最真实的体验和观点。文章代表作者个人观点 ...<a href=\"https://sspai.com/post/74141\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74141"},{"title":"长沙有哪些深藏不露的餐馆？","date":"2022-07-07 02:14:43","description":"\n<p data-pid=\"UnolmZ2d\">铁子们，你们看到茶颜悦色的江浙沪首站选在南京的新闻了吗？</p>\n<p data-pid=\"ywSVbxti\">我在这条新闻下面看到有网友评论说，不用专门跑长沙啦。而有人是这么说的：“我再也不用去长沙了！”</p>\n<p><img src=\"https://pic1.zhimg.com/v2-6c21a4cf5989b3d0326df4c3bbac7d04_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"431\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"DZccKvgo\">这就让我这个精神长沙人不服气了，什么时候茶颜能代表整个长沙了？</p>\n<p data-pid=\"HDHaiVUa\">就不说鲜辣可口的湘菜和琳琅满目的街头小吃，就光光是为了嗦粉，长沙也值得专程跑好几趟。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-61a1ff3b367437f15de0bc2a919cfdc7_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"453\" data-rawheight=\"604\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-5c3ec15e2329bc9e6b8f6c2717a143ed_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1440\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"_v3ycxVb\"><b>长沙在我心里真的很“狂野”，会玩会吃似乎刻在了每一个长沙人的骨子里。</b>而且，越到晚上，人越精神，城市也越发热闹。</p>\n<p data-pid=\"2G_XT6jI\">我记得第一次去长沙的时候，晚上11点多跑出酒店吃宵夜，本想着街上可能没什么人了，没想到到处都热闹得像是杭州七八点的样子，我大为震惊。</p>\n<p><img src=\"https://pica.zhimg.com/v2-a8a3b1e9a1182d385ac01f970d0cd9f6_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"933\" data-rawheight=\"700\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"C9PvuS6n\">所以，每年一到夏天，我就更馋这座夜猫子城市了，尤其馋那几个在全国都排得上名的夜市，四方坪、南门口、东瓜山......彻底丰满了我枯燥贫瘠的夜生活。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-5be410b3776278a38bb56baed5247095_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"2WT9H9i2\">长沙的夜市吧，主要都是以小吃摊为主，各有特点。</p>\n<p data-pid=\"9guC-vpm\">比如四方坪就是集合了全国各地的小吃，南门口长沙本地味道居多，东瓜山似乎更专精于小吃及烧烤。不管你喜欢哪种类型的夜市，我觉得长沙都能满足。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-e07ca7bd7f6a621ab24691e405e0cac2_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"721\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"_-noRhOz\">踏进长沙人声鼎沸的夜市里，烦恼什么的瞬间不存在了，真的只想专心沉浸在夜色里，体会人间值得！要说有什么不满意的，可能就是嫌自己胃太小了吧。_(:△」∠)_</p>\n<p><img src=\"https://pic1.zhimg.com/v2-a0a206ceaf2ef33bad98b030ec78e427_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"838\" data-rawheight=\"683\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"6y-yII-z\"><b>四方坪夜市</b></p>\n<p data-pid=\"JSiCv8kv\">开福区栖凤路37号</p>\n<p data-pid=\"wQD15HoL\">地铁三号线四方坪站或雅雀湖站</p>\n<p data-pid=\"SoqGP_1m\"><b>四方坪，长沙的夜市顶流</b>，人挤人挤人是日常。</p>\n<p data-pid=\"kUt8R5vl\">夜市就是笔直一条街，有300多米长，略数数就有40多个小摊位吧，这还是没算上两边及附近门店的数字。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-e5860ed7deb025c17ebcbb36b116ab70_720w.jpg?source=b1748391?rss\" data-caption=\"@小黄要顺利毕业\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"aaeGgW_l\">刚也说了四方坪集合了全国各地的特色小吃，但“选品”才不是一般夜市上有的像铁板鱿鱼之流的大众款，而是有许多小众、有创意的美食，什么蛋包洋芋、飞饼、炒意面，都是街上的人气担当。</p>\n<p data-pid=\"--K68Y2w\">能在一众实力强劲的对手面前脱颖而出，确实是有几把刷子的。</p>\n<p><img src=\"https://pic4.zhimg.com/v2-8be238778472099c67c69f279fa9a89d_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"676\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"AX75FyTz\"><b>李记印度飞饼</b></p>\n<p data-pid=\"yRCcL2p_\">四方坪最最最火的小铺，火到要像餐厅一样发号子，排队至少一小时起步。</p>\n<p data-pid=\"TAmFM5Xf\">飞饼表皮是绝对酥脆的口感，咬下去还能听见咔嚓声。里面的皮子却还可以保持着绵密，馅料也是软软糯糯，小小一块饼也做出了很多层次，油润但不油腻。</p>\n<p><img src=\"https://pica.zhimg.com/v2-984001131242316d87dae87365aa71bc_720w.jpg?source=b1748391?rss\" data-caption=\"@陶不清\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"nx-1NcgH\">香蕉飞饼和榴莲飞饼是李记的两大王牌，水果经过高温一激，甜味更浓郁了。记得拿到了飞饼一定要赶紧炫，不然打包的水汽会让外皮失去酥脆感，灵魂就没啦。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-2eb64cf645831ba101896ab99648faf5_720w.jpg?source=b1748391?rss\" data-caption=\"@你的997\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"8AJNKJGF\">李记是四方坪的排队大户，建议大家到了就先过来排队，再慢慢逛别的小摊，等逛得差不多了，飞饼也就排到了。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-d6a046affcbf5e532e6e620c05a4070e_720w.jpg?source=b1748391?rss\" data-caption=\"@dorothywong\" data-size=\"normal\" data-rawwidth=\"993\" data-rawheight=\"662\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"J9IvVjrr\"><b>上海香酥童子鸡</b></p>\n<p data-pid=\"zG80HZwh\">这家是四方坪的老店了，每天上午就开门营业，童子鸡一天限量200只，每天大概下午七点就售罄，不算是夜市专属，更像当地居民朋友的卤菜店。</p>\n<p data-pid=\"Y4PLX2Ig\">店门口摆着一锅沸腾的卤水，香味飘散得很远。老板透露说卤水里放了几十种秘制中草料，所以味道很难被复刻。</p>\n<p><img src=\"https://pica.zhimg.com/v2-1d08a0b1e157e8c3c6fef6f0d7e58f7a_720w.jpg?source=b1748391?rss\" data-caption=\"@逮族族长\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"Wos6Swda\">童子鸡有两种做法可选，一种是原味纯卤制，另一种是先卤后炸的。付完款老板就会立即把鸡肉切成小块，再撒上一层辣椒面，差不多能把普通打包盒装得满满当当，性价比蛮高的。</p>\n<p data-pid=\"-u-eTYLX\">炸过的鸡皮金黄诱人，口感脆脆的，和里面滑嫩的鸡肉有着鲜明对比。咬开以后，鸡肉还带点汁水，吃起来也不柴。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-2ad23aa7228322c5f3acb0af9e799abf_720w.jpg?source=b1748391?rss\" data-caption=\"@又白又瘦又好看\" data-size=\"normal\" data-rawwidth=\"1005\" data-rawheight=\"670\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"z88CVX6B\"><b>梅花小蛋糕</b></p>\n<p data-pid=\"mxfYpxbt\">相信大家都对梅花小蛋糕有童年滤镜吧！四方坪就有几家卖这种小蛋糕的店，每家都很有人气。</p>\n<p data-pid=\"BqFOVFgk\">烤蛋糕的铁板依然是记忆中的样子，老板在上面刷上一层玉米油，倒上蛋奶液，烘个一两分钟热腾腾的小蛋糕就出炉啦，一口一个刚刚好。</p>\n<p><img src=\"https://picx.zhimg.com/v2-51c4426f0ee835254f99ea483c3f6a79_720w.jpg?source=b1748391?rss\" data-caption=\"@锤爆事儿精\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"H_0ViIIL\">大家一般都会选原味全熟的，底部烤得带一点焦皮，内里咬下去还是非常蓬松软嫩的，奶香味十足。</p>\n<p data-pid=\"r-2aZA9l\">老板还创新了爆浆款，点单的人也特别多。其实爆浆就是半熟状态，缩短了烤制时间，内部蛋奶液还没完全凝固，形成流心口感，湿润可口。</p>\n<p><img src=\"https://picx.zhimg.com/v2-f921c99db5490ceebbf99ca517da148b_720w.jpg?source=b1748391?rss\" data-caption=\"@每天都想吃好吃的\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"MyhuE-d6\"><b>德盛宁波水塔糕</b></p>\n<p data-pid=\"Ychzv10B\">女孩子们向来对任何糯叽叽的东西没什么抵抗力，所以这间水塔糕专门店也被挖出来了！</p>\n<p data-pid=\"o3fQ5kVD\">店铺是藏在夜市边上的菜市场里，水塔糕每天早晨新鲜现做，上午开门，卖完就收摊，晚上逛夜市来买的话一般都能买到，只是可能就和热门口味无缘了。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-95b990248d65c532ebd6f3cf0ae84d70_720w.jpg?source=b1748391?rss\" data-caption=\"@杜翊武\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"-iI8xbNr\">最热门的口味是桂花味，纯白油润的糕体，光是看着就能感受到松软，入口绵密又很有嚼头，微酸的发酵味和米的甜味缓缓化开，加上干桂花的香气，平衡得很不错。</p>\n<p><img src=\"https://pica.zhimg.com/v2-e2a12ea6d1b6c653c9674894a95daad5_720w.jpg?source=b1748391?rss\" data-caption=\"@小新的粉头\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"KnX_QBSS\">其他还有红糖、南瓜、葡萄干、芝麻、黑米等口味，都是六元一份，其实每种都想试试，但分量真的很大，建议老板搞个全家福，满足大家贪心的嘴~</p>\n<p><img src=\"https://pic1.zhimg.com/v2-46e61a84194175ee21f0755dd295ab1c_720w.jpg?source=b1748391?rss\" data-caption=\"@可爱爆了鸭\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"6TjEAOwA\"><b>清真宫廷香酥牛肉饼</b></p>\n<p data-pid=\"HONFhfzz\">四方坪又一个人气王，招牌很显眼，晚上来的话一般队伍都很长。</p>\n<p data-pid=\"j1EFW2-l\">老板手脚特别麻利，将面团摊开，刷油、铺肉、添上满满的洋葱，一气呵成。</p>\n<p><img src=\"https://pic4.zhimg.com/v2-c11f5f4e93a286811d7a924e43527676_720w.jpg?source=b1748391?rss\" data-caption=\"@异怪\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"cT4XmmTp\">牛肉饼是现包现烤，一锅有40个左右，每次轮大概十个人就卖完了，可见人气有多旺，正常来说都要等上个一两轮。</p>\n<p><img src=\"https://picx.zhimg.com/v2-26c468fa3790b52599251657a22878bf_720w.jpg?source=b1748391?rss\" data-caption=\"@小宝吃肉_\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"dEXZLp8q\">牛肉饼巨大一个，分量扎实，从外表就能看出香酥感。牛肉的汁水牢牢包裹在饼皮深层，里层被汁水浸润，牛肉与洋葱打着完美配合，留下满口鲜美。</p>\n<p data-pid=\"aSyqfihz\">碳水让人快乐，这话真的不假~</p>\n<p><img src=\"https://pic2.zhimg.com/v2-73d6c3dceecef92ead8eccb93a612e20_720w.jpg?source=b1748391?rss\" data-caption=\"@谷泥鸡哇\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"OBL0prMn\"><b>四方坪其他推荐：</b>美式炸排条、张记意大利面、仙湘锅盔</p>\n<p data-pid=\"O81bnieh\"><b>南门口夜市</b></p>\n<p data-pid=\"ocble5N3\">天心区西湖路附近</p>\n<p data-pid=\"CwjYAIM8\">地铁一号线南门口站</p>\n<p data-pid=\"27X36cre\"><b>白天就很好逛的南门口，夜晚一样精彩。</b></p>\n<p data-pid=\"POI3DTts\">南门口是以长郡中学为中心形成的小吃街，距离市中心地铁仅两个站，所以人气一直很旺。街上大多都是陪伴学生们十多年的老店，基本无踩雷。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-f3a42a1a76d5ae97116d1a0483480319_720w.jpg?source=b1748391?rss\" data-caption=\"@爱吃虾饺\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1433\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"CzMOYfii\"><b>金记糖油坨坨</b></p>\n<p data-pid=\"xgWpMd1p\">糖油坨坨是长沙人的童年记忆，金记就是陪伴了一代人成长的白月光。</p>\n<p data-pid=\"juZhWzyB\">店铺开业30多年了，从起初的小摊到现在有了店面，一直都维持着高人气，无论什么时候来，总能见到长长的队伍。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-412cd49b5ae8f5b284c579fa444a9ac1_720w.jpg?source=b1748391?rss\" data-caption=\"@4399\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"24KWRXfm\">圆滚滚的糯米团子下锅裹糖油，等外表形成一层脆壳，足够金黄诱人。（制法与成都的糖油果子相似~）</p>\n<p data-pid=\"RmUZJ_D5\">店里一般是两口锅子一起工作，效率挺高的，所以即使队伍长，等待时间也不会太久。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-120bf4186e0110c2f7808bfa058a954b_720w.jpg?source=b1748391?rss\" data-caption=\"@arigado\" data-size=\"normal\" data-rawwidth=\"989\" data-rawheight=\"659\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"dSSWAQ29\">比起糖油粑粑，我更爱糖油坨坨的圆润糯实感。</p>\n<p data-pid=\"7Dz-sX5y\">趁热吃，外表焦脆甜润，带着浓重的油香味，每个部分味道都分布得均匀。里层是压得紧实的糯米，绵密细软，越嚼越有滋味。</p>\n<p><img src=\"https://pic4.zhimg.com/v2-dd64d47103bb3fa7adfff20c1539652f_720w.jpg?source=b1748391?rss\" data-caption=\"@小飞象\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1440\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p><img src=\"https://pic2.zhimg.com/v2-775f06b2f46a80a1838c59d86be99093_720w.jpg?source=b1748391?rss\" data-caption=\"@小飞象\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1440\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"sTfYlskf\"><b>杨嗲甜酒</b></p>\n<p data-pid=\"A-R8cH3E\">南门口的传奇老店很多，杨嗲甜酒算一个。</p>\n<p data-pid=\"fZ0WEpEG\">店铺自从87年开业以来，就一直低调地躲在老巷子里，做着街坊邻居和学生的生意。这几年名气渐渐大了，上了综艺，还被天心区政府正式授牌为非物质文化遗产。杨家的甜酒手艺，民间、官方都认可。</p>\n<p><img src=\"https://picx.zhimg.com/v2-cb3359ea380bd9ee6dc848655cc69915_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"608\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"Qv9J7ykO\">店铺藏在窄到只够一个人通行的巷子深处，环境倒是打理得很清爽干净。目前是杨嗲的儿子主要负责店铺的运营，杨嗲对原材料、出品进行把关。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-03a424d0264dbf268bcd89cba7c2122a_720w.jpg?source=b1748391?rss\" data-caption=\"@颖子不吃葱\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"792\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"4uBMKWiW\">招牌甜酒，盛放在小碗里，和小时候记忆里的酒酿一个样子。淡淡的酒香先钻进鼻子，入口是淡淡的甜，糯米轻轻一抿就化开，感觉每一粒都裹满了酒香。</p>\n<p data-pid=\"xZx-ceUM\">自创的酒酿梅子冻，也是高回购款，甜酒与酸梅冻的组合，冰凉清爽，太适合夏天。如果你爱酒，那么杨嗲自家出品的桂花酿、杨梅酿、柚子酿都值得一试哦！</p>\n<p><img src=\"https://pic4.zhimg.com/v2-bb49683a64c8d7bcc383ad4583feba28_720w.jpg?source=b1748391?rss\" data-caption=\"@阿啦噜的日记\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"708\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"BeS8YcDc\"><b>金花泡菜</b></p>\n<p data-pid=\"PfPtr359\">起源于湖南怀化的金花泡菜，有20多年的历史，自从在南门口开了店，就一直是长沙泡菜扛把子级的存在。</p>\n<p data-pid=\"wI0FmOgt\">店铺不大，几十种泡菜分别码在罐子、冰柜中，想吃什么自己拿盆子夹，最后老板会浇上秘制调料混合现拌。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-04d5fcf0b744ae123f63aca1dec3d7d4_720w.jpg?source=b1748391?rss\" data-caption=\"@小桔今天买了啥\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"bOLomlu9\">推荐酸甜萝卜、酸甜萝卜皮、血粑、米豆腐、凉皮凉粉。因为是一份份现拌，所以在这个环节总是需要耐心等上一段时间。秘制辣椒油是金花的精髓，才浇进锅里翻拌，香味就升腾起来了。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-d7bf2b2d52829c76945c76146f7d06af_720w.jpg?source=b1748391?rss\" data-caption=\"@烟熏小蛋清\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"OzU8jUVz\">泡菜刚入口是纯纯的香味，腌制的甜、酸满满涌上来，咀嚼得差不多了，辣味嘭得炸开来，很复杂很多元。空口吃基本是可以的，不会太咸太重口，但如果搭配碗米饭，那就更完美了。</p>\n<p><img src=\"https://pica.zhimg.com/v2-db3cac1c00414dd188111de537567341_720w.jpg?source=b1748391?rss\" data-caption=\"@小桔今天买了啥\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1080\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"NUXDizBs\"><b>旺旺小吃店</b></p>\n<p data-pid=\"TocANtFH\">南门口的又一家神级小店，只卖凉菜，想吃得靠运气。因为老板实在太任性，天气不好、心情不好、不想做菜都能成为不开门的理由，许多人都吃过闭门羹。</p>\n<p data-pid=\"GZst4luE\">店面就是一个街角小摊头，门前支了几张桌椅板凳供堂食。刚也说了老板很任性，所以即使开店了态度也不太好，这也是旺旺小吃最具争议的点。</p>\n<p><img src=\"https://pica.zhimg.com/v2-fd09563f4169ca7171ca548f6910f914_720w.jpg?source=b1748391?rss\" data-caption=\"@多面小冯\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"5Ng-fODb\">麻辣香干丝是旺旺的招牌，几乎每个来的顾客都会点一份。事先油炸过的香干丝拌上辣酱，每一根都油滋滋的。口感极具韧劲，辣味特别强劲，是很典型的湘味凉菜，下酒绝配。</p>\n<p><img src=\"https://pica.zhimg.com/v2-16789bca08c5f3ea9a2669d717f43107_720w.jpg?source=b1748391?rss\" data-caption=\"@麻辣公主\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"Bvb4DjHY\">其他像是土豆丝、蒜苗、莴笋、藕片等常规款也值得一试，凉菜统一每份10元，可以两样混搭买。</p>\n<p data-pid=\"0QjMEo3V\">大家一般是选一份凉菜，再加一份五元的凉面，这就组成一套拯救夏天的套餐，凉爽又满足，在燥热的天气下也能胃口大开。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-a7edfe509c9f256bc2da6070d353d12c_720w.jpg?source=b1748391?rss\" data-caption=\"@丫咪酱\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"8PL6oMUr\"><b>南门口其他推荐：</b>南门口湘军剁辣椒老店、爱上酸嘢、五娭毑臭豆腐</p>\n<p data-pid=\"s-iQeydp\"><b>东瓜山夜市</b></p>\n<p data-pid=\"aYor58_M\">天心区东瓜山一条巷</p>\n<p data-pid=\"67Fiodpa\">地铁一号线、三号线侯家塘站</p>\n<p data-pid=\"P6GuQ7HH\"><b>东瓜山是长沙有名的夜市街，早些年可以说是撑起了长沙夜晚的半壁江山。</b></p>\n<p data-pid=\"ZzejNzt9\">这条有点坡度的小巷子，两侧排布着年代感的老房子，随处可见烧烤店、炸串小摊、糖水铺......霓虹灯闪耀，烟火升腾，整条街道充满市井气。</p>\n<p data-pid=\"wbiV-vXJ\">揣着100块进去，就能吃到心满意足。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-8be0319c661d1388a11cd013f531264e_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"462\" data-rawheight=\"701\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"ar2Ouv5M\"><b>盟重烧烤</b></p>\n<p data-pid=\"yGw4Ky6N\">东瓜山最有名除了东瓜山肉肠，那就是盟重了，被誉为长沙烧烤代表之一，上过《天天向上》，是不少明星的深夜食堂。</p>\n<p data-pid=\"1RHXvcXH\">名气大了自然就有争议，盟重也不例外。但到了东瓜山，不吃一顿盟重就不够完整。店铺坐落在一座老房子里，装修成了类似于湘西土城的样子，门口常常挤满排队的人。</p>\n<p><img src=\"https://pica.zhimg.com/v2-bcf4276eb438d2279719cd3b46f7ee39_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1071\" data-rawheight=\"714\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"eb0ToB7R\">盟重主打湘西小串，必点烈火牛肉。事先看了介绍说他们家的牛肉是用“擂串”烤法制作，将牛肉放上烧热的铁板上擂到变色，再迅速撒上调料即上桌。</p>\n<p data-pid=\"cxV66LXV\">抬到面前时，牛肉还在滋滋作响，香味很诱人。因为是擂制出来的，所以牛肉很弹嫩，汁水被紧紧锁在了肉质之间。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-cb215c3b7440cfcfcf74771de631d169_720w.jpg?source=b1748391?rss\" data-caption=\"@echo_半岛\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"Cjs51CGI\">Top2的烤牛油也必须点，虽说是牛油，但烤完后它真的一点也不油腻！个个都是金黄焦脆的，碳香之外还有一股馥郁的奶香。</p>\n<p><img src=\"https://picx.zhimg.com/v2-31d1e5abc272c9445298d1fa607a86c4_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"985\" data-rawheight=\"657\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"sf-6P4uu\"><b>丹丹热卤</b></p>\n<p data-pid=\"Zp2u3ig_\">在东瓜山开了10多年的丹丹热卤，从以前的推车更新换代到有了门面，承载了不少长沙人的味蕾记忆。</p>\n<p data-pid=\"OHYtYfzH\">作为一家老店，丹丹热卤同样很有争议，有人说这是长沙老底子的味道，但有人又说本地人从来不爱光顾。</p>\n<p><img src=\"https://pica.zhimg.com/v2-3f5dd44be0e698f1aab36f2bc97bfeaf_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1042\" data-rawheight=\"694\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"Lp1J3-xk\">看着大家吵来吵去，我倒是从中发现了一个结论——丹丹家的猪油拌粉，是两方都觉得特别好吃的存在！</p>\n<p data-pid=\"7eWpiDwe\">和某盛、某胡等网红热卤店不同，丹丹的猪油拌粉就是最传统的做法。上桌时白花花一碗，猪油、酱油都藏在碗底，趁热拌开，每一片粉皮都裹上香润的猪油，不用多余的配料就足够出彩了。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-708679d21195597e76252ddbbd24f165_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1071\" data-rawheight=\"714\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"MdqQ-REX\"><b>如意小吃</b></p>\n<p data-pid=\"esUa4-rh\">这是老长沙人在东瓜山的私藏据点，躲在一个不起眼的角落里。大多数人的注意力早早被边上的东瓜山肉肠摊位所吸引，根本想不到这么一家小苍蝇馆子竟然藏着地道的古早长沙味。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-4ddd26cd59e72d6a6b9eb9e370421642_720w.jpg?source=b1748391?rss\" data-caption=\"@菊发发发\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\" data-qrcode-action=\"none\" data-tags=\"qrcode\"></p>\n<p data-pid=\"ljESn71c\">如意的菜品种类非常丰富，从火锅干锅、特色口味菜到炒菜、凉拌菜都有涉猎，猪油拌粉、紫苏桃子、口味虾都是推荐必点菜。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-1ee6b3224b99f296e0d70ce5e834084b_720w.jpg?source=b1748391?rss\" data-caption=\"@一只夏夏\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1440\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p><img src=\"https://picx.zhimg.com/v2-c0624fa4bf8d00bc2c6eeff627e9cac2_720w.jpg?source=b1748391?rss\" data-caption=\"@一只夏夏\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1439\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"rALkpU3h\">一道创意铁板牛肉，好评率超高！提前码过料的新鲜牛肉直接上桌，放进铁板里将两面微煎变色，香味瞬间扑鼻，肉质软嫩，锅气十足，吃得出一股奶香。</p>\n<p><img src=\"https://pica.zhimg.com/v2-4d854248488d10806dc2a78e506b71cf_720w.jpg?source=b1748391?rss\" data-caption=\"@积极如令令\" data-size=\"normal\" data-rawwidth=\"961\" data-rawheight=\"641\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"NXSapxJP\"><b>尹记小吃</b></p>\n<p data-pid=\"bFFeyadq\">比起网红店，夫妻档小店尹记实在是低调不显眼，只有三四张桌子，布置得很温馨，人也相对来说少些，所以附近的居民也爱跑来他们家吃宵夜。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-82b712a433faec4994bac3e609ac1b07_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"nPS1FTQo\">这几年，炸炸炸在长沙遍地开花，通俗来讲就是汇集各种炸物的店。尹记的炸炸炸也算是招牌，包菜、土豆、椰奶、酥鸡骨头......一切皆可炸。</p>\n<p data-pid=\"sdKf3yMA\">还有一道老板引以为豪的独创菜秘制云豆，上桌是冰凉的状态，大芸豆裹上话梅汁，粉糯酸甜，就连不爱吃豆子的人都把持不住全部光盘。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-db2c91d052e70a28da8deba14a88a4bd_720w.jpg?source=b1748391?rss\" data-caption=\"@喜欢喝咖啡乱拍照的大棒儿\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"1080\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"-SPC-KyI\"><b>东瓜山其他推荐：</b>蒋哥长沙里手呷货铺、宝贝蒸饺、三食堂/裕南街炸炸炸</p>\n<p data-pid=\"2TK1ExXb\"><b>///</b></p>\n<p data-pid=\"KPrTMyw4\">长沙的人间烟火，可能一大半都藏在夜市里了~今天和你们聊的长沙这三大夜市，都是兼具实力与人气的存在。</p>\n<p data-pid=\"r71yT7L_\">当然，长沙的夜市也不止这三处，像是德思勤夜市、扬帆夜市、渔人码头、凌晨的国金解放西，也都有着超高的人气，每一个夜市都能让你饱腹而归。</p>\n<p><img src=\"https://pica.zhimg.com/v2-6b8ab1473f200648055416ca7025bbdc_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1080\" data-rawheight=\"720\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"Tew1ik5E\">长沙的友友们有什么私藏夜市或是夜宵小店，欢迎大方分享呀~</p>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/zhu-yin-lun?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">嬉游君</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/31025946/answer/2558267928?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">312 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/510969791?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">上海有哪些深藏不露的特色美食和餐馆不能错过？</a><br><a href=\"http://www.zhihu.com/question/541988735?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">长沙有什么正宗的特色湘菜小店值得推荐？</a><br>\n","link":"http://www.zhihu.com/question/31025946/answer/2558267928?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"派早报：M2 版 MacBook Air 将开启预购、NS 推出限定版机型等","date":"2022-07-07 00:30:19","description":"GPD 公布掌上电脑 Win Max 2 的配置详情、Apple 计划推出「锁定模式」以应对攻击风险等。<a href=\"https://sspai.com/post/74151\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74151"},{"title":"为创作者和读者建立桥梁，一站式内容创作工具：竹白","date":"2022-07-06 09:55:23","description":"让创作者可以轻易地创建付费专栏获得收入，让读者可以使用任何他常用的工具订阅到创作者的内容。为了实现这个目标，我们做了《竹白》这款产品。<a href=\"https://sspai.com/post/74066\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74066"},{"title":"如何看待北大教授姚洋表示「未来 30 年内中国世界工厂地位都不可能被印度越南取代」？","date":"2022-07-06 08:23:51","description":"\n<p data-pid=\"04ORuFHa\"><a class=\"member_mention\" href=\"http://www.zhihu.com/people/06916ab5292b620917a7be1b4945a19d\" data-hash=\"06916ab5292b620917a7be1b4945a19d\" data-hovercard=\"p$b$06916ab5292b620917a7be1b4945a19d\">@司马懿</a> 老师写了越南，我也写下印度，顺便补充一下越南和孟加拉国的情况。首先先从中国目前主要的经济问题入手，然后谈谈为什么印度、越南和孟加拉国不可能取代中国制造，最后谈谈这些新兴国家的发展前景。</p>\n<h2>姚洋为什么说中国世界工厂地位很难被替代？</h2>\n<p data-pid=\"eFEuL5DD\">姚洋发的视频里面，大概是三个依据，分别是产业替代不会这么快、我们有产业升级、目前的产业地位是我们努力得来的。<b>第一个司马懿老师也说了，这个很显然是事实</b>，而第三个没必要讨论，而最关键的是产业升级到底有没有呢？</p>\n<h3>中国的产业升级并未弥补经济成长和全要素生产率增速下降</h3>\n<p><img src=\"https://pica.zhimg.com/v2-059a58635d7abf50f4a0d2b5d15df7a7_720w.jpg?source=b1748391?rss\" data-caption=\"中国通讯信息类固定资产投入和知识创新带动增长，但是不足以弥补TFP和投资下滑\" data-size=\"normal\" data-rawwidth=\"1074\" data-rawheight=\"741\" data-watermark=\"watermark\" data-original-src=\"v2-059a58635d7abf50f4a0d2b5d15df7a7\" data-watermark-src=\"v2-1b0b995f1b1b03b1eb723295fc8c83f4\" data-private-watermark-src=\"v2-472f93360d917d7303c841e438a2dc03\"></p>\n<p data-pid=\"K_vFhB1y\">从供给侧看，产业升级确实是有。通讯信息类（ICT）资本投入和知识创新确实是有大幅度提升，大概比十年前翻了一倍，大概从过去拉动1%的GDP增加到了2%，说明现在发展质量比起十几年前的粗放式发展好多了。</p>\n<p data-pid=\"QIB5GUmQ\">但是这没法扭转整体技术进步的下滑，剔除了技术创新的TFP增速大幅下降到1%，即使是加上知识创新，也就是稳定在2%左右。也就是说产业升级中的知识创新部分，并不够成功，中国并未转向蔡昉所说的“全要素生产率驱动的经济体”。而通讯信息类资本存量增速是通过资本投入带动技术进步，本质上来源于投资，这部分增长也不足以弥补传统基建、房地产投资下滑的损失。</p>\n<p data-pid=\"07xa5r9a\">总结一下：<b>产业升级严重依赖于通讯信息类产业，以增加资本投入为主，而知识创新的比重确实也有大幅提升</b>。与之同步发生的是，剔除这些因素的全要素生产率大幅下滑，<b>产业升级并不能扭转技术进步放缓的趋势</b>。<b>而中国经济的主要推动力依旧是投资</b>，单纯看固定资产投入拉动的经济增长，投资所贡献的GDP从过去的40%进一步提升到60%。</p>\n<a href=\"http://link.zhihu.com/?target=https%3A//finance.sina.com.cn/wm/2021-12-29/doc-ikyamrmz1962732.shtml\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pica.zhimg.com/v2-d8022b911fca08302cb43c23db8a50e7_qhd.jpg?source=b1748391\" data-image-width=\"900\" data-image-height=\"382\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">高善文：房地产市场面临转折，中国经济结构转型将显著提高未来10年A股回报能力</a><p data-pid=\"xVTv_fTd\">而高善文的一篇文章，也指出了：</p>\n<blockquote data-pid=\"WZ5HkREI\">但是在当下的绝对水平上，低增长组仍然比高增长组高出差不多10个百分点。如果我们以此作为评判的标准，<b>可以说过去十年，特别是过去五年中国工业结构经历了快速的转型，但现在仍然是由传统产业来主导的。</b><br>十年之前存在着一种广泛的观点，认为未来中国经济结构的转型，将是向着高端制造业，比如汽车、工程机械、数控机床、精密仪器等方向，因为历史上其他经济体的转型是朝着向上述方向，但以截至目前的中国数据来看，这种情况似乎没有出现。<br>在中国的转型历程之中，以行业出口交货值占比的变化来看，中国的产业升级大约有70%发生在计算机、通信和电子设备制造领域（以下简称电子制造）。</blockquote>\n<p data-pid=\"l3nmrsLa\">所以中国面临的情况是：中国结构的转型并没有向上述高端制造业大幅前进，并且以传统产业为主导，但是在电子制造领域出现明显产业升级，沿产业链往上爬升，这对应了前文所述通讯信息类产业的发展。</p>\n<p data-pid=\"LZjLsd6R\">在这种情况下，依旧占据主导地位的传统产业肯定是害怕后来者的阻击。</p>\n<h3>当下中国经济的主要挑战是金融风险，而不是产业外流</h3>\n<p data-pid=\"04TZvtlr\">当然姚洋也说了，这种产业转移会是非常缓慢的，缓慢的产业转移和过快增长下滑相关性不大，<b>现在影响中国经济增长潜力的主要部分是全要素生产率的过快下滑</b>。至少在相当长的时间，产业外流不是一个紧迫的问题。</p>\n<p data-pid=\"wP6kDqZz\">而这二十年中国经济改革力度有限，加上改革边际效应递减，像是最近十年的大规模国进民退，都产生了副作用，<b>这都决定了全要素生产率增速拉不起来了</b>。现在还讨论这些已经没太多意义了，更重要的是避免再次快速下滑。</p>\n<p data-pid=\"n0gI8-xW\">在过去几年中，投资绝对贡献的GDP仅仅下降了1%，这背后是巨大的信贷杠杆带动的增长。在日韩等国的发展经验表明，后发国家在追赶过程往往打造集中式金融，以格申克龙事实的信贷模式推动增长，金融业随着信贷扩张而日益庞大，必然会去中心化的吸收资源和扩散风险，最终酿造严重的金融危机。</p>\n<p data-pid=\"XvIzeWCI\">因而在辜朝明的《资产负债表衰退》理论中，强调日本企业竞争力并未在90年代大幅下滑，但是却以负债最小化而不是扩张为经营目标，最终漫长的去杠杆拖累产业和企业竞争力。</p>\n<p data-pid=\"oRvgT_20\">中国过去几年的稳增长，同样积累了巨大的金融风险，如果爆发了，那么在漫长的去杠杆中，现在已有的产业升级或者产业竞争力都会大幅衰退。</p>\n<p data-pid=\"vvz8JtXt\">从紧迫性来说，产业外流也不是很着急的考量，紧迫的是避免系统性金融危机，防止资产负债表衰退导致的增速再次下滑。</p>\n<h2>印度、越南和孟加拉国是当下增长前景最好的新兴国家，但是制造业都较为有限</h2>\n<p data-pid=\"SDTiBl-b\">那印度和越南是什么情况呢？ <a class=\"member_mention\" href=\"http://www.zhihu.com/people/06916ab5292b620917a7be1b4945a19d\" data-hash=\"06916ab5292b620917a7be1b4945a19d\" data-hovercard=\"p$b$06916ab5292b620917a7be1b4945a19d\">@司马懿</a> 老师做了越南的介绍，做一点补充。印度、越南和孟加拉国是目前经济成长最好的新兴国家，大概都是7%的增速。而根据世界银行的统计，历史上只有13个经济体维持了25年以上的7%高增长，加上这三个国家，也就是区区十六个而已。</p>\n<p><img src=\"https://pic4.zhimg.com/v2-47ebd70c79aa52e72e651ab93d8204c8_720w.jpg?source=b1748391?rss\" data-caption=\"出自《中国经济中长期发展和转型：国际视角的思考与建议》\" data-size=\"normal\" data-rawwidth=\"649\" data-rawheight=\"711\" data-watermark=\"watermark\" data-original-src=\"v2-47ebd70c79aa52e72e651ab93d8204c8\" data-watermark-src=\"v2-b411cd5e10efe79090e6bc5bfdc9103f\" data-private-watermark-src=\"v2-f2a9b0817485f0091b7477a3511b45af\"></p>\n<p data-pid=\"fItleVZ4\">这三个国家的经济发展也是有很大的区别，有一点是一样的，那就是制造业比重很低，大概都不到20%，过去二十年平均值都只有15%。</p>\n<p data-pid=\"YkAbPp3n\">可想而知即使是发展到很高的水平，也不会达到中国的高度。中国在2000年后的“世界工厂”地位，主要是作为消费品的世界主要供给国。像中国到现在，也能供给世界大概60-70%的冰箱，在绝大多数消费产品中，中国都是有世界一半以上的产能。<b>因此这个地位是不会被取代，也没有国家能取代了</b>。</p>\n<p data-pid=\"HEZyfFCM\">当然这种庞大产能的外流也是不可避免的，随着中国制造业的劳动生产率不断提升，劳工成本必然也会大幅提升。</p>\n<p data-pid=\"KaY7KpLw\">中国的制造业如果中国想要发展到发达国家水平，那么一个制造业工人要创造5-6万美元的高产出，这是很难靠出口消费品来做到的，那自然会外流到其他国家。</p>\n<h2>印度、越南和孟加拉国的制造业结构</h2>\n<p data-pid=\"i2tN7Ktk\">总量看完了，从结构上来看，印度、越南和孟加拉国的制造业结构是有巨大的区别。印度是以资金密集型和技术密集型产业为主，越南是以劳动生产率较低的劳动密集型产业为主，孟加拉国的制造业高度集中于纺织业。</p>\n<h3>印度产业以资金密集型和技术密集型产业为主，劳动密集型产业弱，产业创造就业能力差</h3>\n<p data-pid=\"rMCENZ0x\">由于印度国内存在严重的制度阻碍，尤其是劳务市场监管的落伍和复杂，使得劳动成本过高，产业和企业竞争力差。印度虽然劳动力过剩，但是劳动密集型产业并不发达。但是印度本国的市场非常庞大，经济增长是消费驱动型，内向型产业较为发达。</p>\n<p data-pid=\"kNxaBHHA\">尤其是靠庞大资本市场以及消费市场保护堆积出来的巨型企业，可以克服劳动成本过高的障碍，有明显的规模优势，因此在资金密集型产业和技术密集型产业非常有优势。</p>\n<p data-pid=\"BhlW25Hm\">而主要劳动法律在1970年后停止出台，70年代后崛起的服务业企业，免于被严苛的劳务法管制，这导致印度服务业出口具备劳动密集型特征。林毅夫称：“而印度的增长则依赖于在呼叫中心、编程及业务流程服务中的专业分工，这些领域是信息产业内的劳动力密集型活动。”。当然这些信息出口也受益于印度国内庞大的过剩大学生供给，也有技术密集型特征，这为印度近些年来的软件业“产业升级”为互联网产业奠定了基础。</p>\n<p data-pid=\"8O4PTcMY\">根据Arvind Subramanian的划分，印度出口中最大的一部分是高技术服务业，同时有1/4来自于高技术制成品出口，以农产品和矿产品为主的初级产品比例大幅削减。</p>\n<p data-pid=\"2g1VyPht\">即使印度制造业比重一直是15%，并且出口有巨额逆差，但是出口集中于创造较高价值的部门，进一步通过溢出效应，带动其他服务业增长，逐步实现持续经济增长和产业升级。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-f92c7e59a6aeec7586fce0cf131e9899_720w.jpg?source=b1748391?rss\" data-caption=\"出自Arvind Subramanian的India’s Export-Led Growth，印度出口结构以高技能服务业和高技能制造业为主\" data-size=\"normal\" data-rawwidth=\"1028\" data-rawheight=\"670\" data-watermark=\"watermark\" data-original-src=\"v2-f92c7e59a6aeec7586fce0cf131e9899\" data-watermark-src=\"v2-e1c231caa0688229a56e56f9829d206a\" data-private-watermark-src=\"v2-0ed53929786ef7dd8a7a2266ecac880f\"></p>\n<p data-pid=\"oGBmj5qN\">Arvind Subramanian的划分，一般不太常用，像世界银行一般是分成高技术、中等技术和低技术数制成品。前段时间有一个相关项目，根据我个人计算的最新数据，初级产品、传统的低技能和中高技能制成品占商品出口比重约为13%、26%和60%。</p>\n<p data-pid=\"ac8fy3V-\">而印度商品出口和服务出口比例大概是60%和40%，也就是说根据我计算的初等产品和低技能制成品占总出口约为1/4，比Arvind Subramanian计算结果低了10%，中高技能制成品比重是35%，高了10%。再加上近40%的服务出口，印度70%的出口集中于附加值较高的产业，这在同水平的发展中国家中非常少见。</p>\n<table data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"normal\"><tbody>\n<tr>\n<th>年份\\项目（比重）</th>\n<th>初级产品<br>占商品出口比重</th>\n<th>低技能制成品占商品出口比重</th>\n<th>中高技能<br>制成品占商品出口比重</th>\n<th>商品出口比重</th>\n<th>服务业出口比重</th>\n</tr>\n<tr>\n<th>2013/14财年</th>\n<td>13.7%</td>\n<td>39.2%</td>\n<td>46.1%</td>\n<td>65.2%</td>\n<td>34.8%</td>\n</tr>\n<tr>\n<th>2021/22财年</th>\n<td>12.7%</td>\n<td>25.9%</td>\n<td>59.5%</td>\n<td>62.5%</td>\n<td>37.5%</td>\n</tr>\n</tbody></table>\n<h3>越南的制造业集中于较低效率的劳动密集型产业，竞争力高，但是劳动生产率低</h3>\n<p data-pid=\"kNMWBvez\">根据越南统计局数据，越南的制造业比重是16.5%，但是制造业从业者比重是20.6%，<b>也就是说越南的制造业劳动生产率仅为平均水平80%，存在大量低效制造业就业。</b></p>\n<p data-pid=\"bksfB1hn\">这几年越南制造业确实出现了大发展，越南制造业从业者比重从2015年从15.9%提升到20.6%，创造了300万制造业岗位。这大概带动越南制造业比重从13.7%提升到16.5%。但是创造的岗位增加值非常低，只有平均劳动生产率的60%，</p>\n<p data-pid=\"sa4pNXSf\">而越南本身制造业就业者都超过20%了，这个比中国都高多了，可想而知最多也就是还有三四百万人（30%左右劳动力）的制造业岗位潜力，<b>越南吸收中国产业外流的潜力被大大高估了。</b></p>\n<p><img src=\"https://pic2.zhimg.com/v2-42feca2e63cb33aaf2db5262ed0bb442_720w.jpg?source=b1748391?rss\" data-caption=\"越南统计年鉴数据，各产业贡献的GDP，制造业约为15%\" data-size=\"normal\" data-rawwidth=\"550\" data-rawheight=\"748\" data-watermark=\"watermark\" data-original-src=\"v2-42feca2e63cb33aaf2db5262ed0bb442\" data-watermark-src=\"v2-ee58c2afa1bf3263401559640435f4f4\" data-private-watermark-src=\"v2-72edbeb2d2436f70c28e4c1c7a82ad03\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-63e5c0610e5bc6a0160b175275cf911a_720w.jpg?source=b1748391?rss\" data-caption=\"越南统计年鉴数据，各产业就业比重，制造业就业约为15%-20%\" data-size=\"normal\" data-rawwidth=\"557\" data-rawheight=\"752\" data-watermark=\"watermark\" data-original-src=\"v2-63e5c0610e5bc6a0160b175275cf911a\" data-watermark-src=\"v2-34b7ca2537023e96c3038caf3f523386\" data-private-watermark-src=\"v2-153e4fe22d80b43afd4c733b683c60a8\"></p>\n<p data-pid=\"Aq6vt6rc\">而越南制造业只有四五百亿美元，但是他的出口却高达3000亿美元，绝大多数是不可能自产的，而是以再加工为主，甚至有大量贴牌业务。</p>\n<p data-pid=\"OAuvbccu\">从结构来看，越南出口的40%是电子制造相关的产品，而进口的33%是电子制造相关产品，是典型的大进大出，而他本国的生产和消费都非常有限，这就意味着越南电子制造产业很依赖于大进大出的加工贸易，并没有创造太多增加值，单单看进出口数据容易高估。</p>\n<p data-pid=\"CkwiMeBm\">而越南出口的20%左右是纺织业相关的产品，进口是只有5%左右是相关原材料，这代表越南的纺织业确实是主要靠本地生产，并且是靠耐克的跨国公司提供销路，但是这部分增加值比较低。</p>\n<p data-pid=\"l8pM5V5k\">因此越南制造业主要是电子制造和纺织业，创造增加值都较低，因而制造业劳动生产率偏低。当然越南也有一些内向型产业发展不错，随着房地产大发展，越南钢铁产业在过去十年翻了整整五倍，人均钢铁消费比中国同期都高了一倍，但是不足以扭转整体制造业的低效率困境。</p>\n<p data-pid=\"Y7w4wAvy\">对比一下印度，印度制造业的资金密集型特征非常明显，制造业劳动生产率较高。</p>\n<p data-pid=\"9Wtps0rm\">印度的制造业劳动力仅仅6000万，占比为12%，要比越南低了8%。而印度国内的GDP统计是不区分产业的，扣除净税补贴的GVA是区分产业的。根据印度统计局数据，2021/22财年的现价和不变价GVA中，制造业比重分别为15.5%和18.2%（印度的价格基准还是2011/12年，两者差距过大）。</p>\n<p data-pid=\"67lxaijx\">因此印度制造业单位劳动力创造的产值大概是平均水平的125-150%之间，对比之下，越南则仅仅是80%。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-c9e3861b72a1ae1e7b5a08197257d742_720w.jpg?source=b1748391?rss\" data-caption=\"印度最新财年经济数据，制造业比重约为15%\" data-size=\"normal\" data-rawwidth=\"572\" data-rawheight=\"685\" data-watermark=\"watermark\" data-original-src=\"v2-c9e3861b72a1ae1e7b5a08197257d742\" data-watermark-src=\"v2-30a46e56687fd52f300b3bb3c84f5f88\" data-private-watermark-src=\"v2-a23482ca8c14099ceb8a0b79ac3b721b\"></p>\n<p data-pid=\"DtJYoyTX\">所以印度制造业问题在于无法充分利用劳动力，无法创造就业，表现为拥有禀赋的劳动密集型产业不发达，大量消费品需要进口。而越南则是制造业劳动生产率过低，资金密集型和技术密集型产业欠发达，抑制长期发展潜力。</p>\n<h3>孟加拉国产业竞争力仅集中在劳动密集型产业的纺织业</h3>\n<p data-pid=\"rjJGF6e3\">最后谈下孟加拉国，从出口结构来看，孟加拉国90%的出口集中于纺织类产业，剩下的出口产品也是以初级产品为主，中高技能制成品基本没有，高技能的服务业出口也不能像印度一样创汇。所以，孟加拉国的国际收支情况比印度更糟糕点。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-e191444610bcbda3d0ff61de4efa13b1_720w.jpg?source=b1748391?rss\" data-caption=\"孟加拉国出口结构，集中在纺织业相关部门\" data-size=\"normal\" data-rawwidth=\"713\" data-rawheight=\"1337\" data-watermark=\"watermark\" data-original-src=\"v2-e191444610bcbda3d0ff61de4efa13b1\" data-watermark-src=\"v2-cd1cc232a0420765207f55efeb02e0df\" data-private-watermark-src=\"v2-e3058fec83c02b7f992321c36d70fca6\"></p>\n<p data-pid=\"P7jAb2To\">孟加拉国比起印度的优势在于民族国家，执政党具有一言九鼎的权力。像是征地改革和劳动改革，都是印度想做但是很难做的，孟加拉国在十几年前就做了，劳动密集型产业发展要好得多。</p>\n<p data-pid=\"054KMJmM\">再加上孟加拉国和越南积极签订FTA，基本上把印度的劳动密集型产品市场给占了大半，因此这两年印度也急了，开始积极和发达国家签订FTA。</p>\n<p data-pid=\"_Eap5jyy\">总结一下，从制造业结构来说，这三个高增长的新兴国家优缺点都很明显：</p>\n<ol>\n<li data-pid=\"uOY5Vy9B\">印度非常擅长资金密集型和技术密集型产业，出口以中高技术制成品和高技术服务业为主，技术含量在同水平发展中国家非常高。因此，制造业劳动生产率非常高，但是创造就业非常少，无法利用过剩劳动力。</li>\n<li data-pid=\"M5ndWcRW\">越南非常擅长劳动密集型产业，以大进大出、转口贴牌的电子制造为主，同时专精低附加值的纺织业，近些年来钢铁等内向型产业大发展。因此制造业岗位多、劳动生产率偏低，近些年制造业大发展强化了这种趋势。</li>\n<li data-pid=\"yZNb5YFx\">孟加拉国出口集中于纺织类产品，有技术含金量的产品基本没有，信息出口有限，国际收支问题非常严重。但是靠着改革优势和FTA优势，大幅抢占印度劳动密集型产业市场。</li>\n</ol>\n<p data-pid=\"8iNPpb3A\">从这种角度来说，去印度做投资很困难，他做得好的企业都是有壁垒的，很依赖于政治，做的不好的制造业都是竞争性的。所以印度政府要解决问题，就要解决市场开放和企业竞争力不足的问题。</p>\n<p data-pid=\"xS224RHz\">越南就基本相反，竞争性产业做得很好，不过面临高端产业的升级问题，很容易被外资限定在低价值链的水平上。所以越南政府要解决问题，要尽量吸引更高水平的外资企业，同时鼓励国内公有和私有企业都提升效率。</p>\n<h2>谈下印度、越南和孟加拉国的发展问题，城市化、劳动力、资本等各个要素的情况</h2>\n<p data-pid=\"grDAgVsm\">虽然疫情前这几个国家的潜在增长率还有7%，但是疫情都会导致增长损失，可能已经降低到6%多点的水平，需要通过结构性改革才能提振潜力。</p>\n<h3>首先谈城市化问题</h3>\n<ul><li data-pid=\"83YjqYBx\">目前印度、越南和孟加拉国城市化率都不到40%，处于中国90年代水平，而中国城市化大概完成于2030年，也就是说这三个新兴国家城市化进程依旧会持续约40年：</li></ul>\n<blockquote data-pid=\"rlmPEU3M\">根据东南亚多国经验，如果出现金融危机导致的经济结构性变动，会导致经济增长大幅下降到最低4%，也就是说这三个国家在城市化完成前，大概有最低每年4%的增长潜力<br>不能错误的拿停滞的拉美作为比较，拉美进口替代推动的高增长开始于1950年代，而巴西1950年城市化率为36%，墨西哥为43%，之后拉美国家还依靠城市化带动增长了二三十年。<br>印度、越南和孟加拉国的经济增长还处于赶超阶段的前半段，即使遇到严重经济危机，这个发展过程也会持续到城市化完成。</blockquote>\n<ul><li data-pid=\"xDT3Mp0H\">越南和孟加拉国进入城市化高速发展时期，每年城市化率提升约0.8%，这种城市化会带动至少十几年的中高速增长：</li></ul>\n<blockquote data-pid=\"-WgYpjDg\">根据发展经济学理论，一旦城市化率超过30%，城市化增速会慢慢提升到1%，目前越南和孟加拉国正处于这个状况。<br>非农就业的劳动生产率是农业就业的4倍，所以理想情况下1%的城市化增速会带动3%的劳动生产率提升，这种经济增长来源于劳动力在部门之间迁徙产生的“结构变化”（structural change）。<br>根据东亚经验，城市化率发展到50%前后，农村无限劳动供给开始消失，出现路易斯拐点，增长模式会出现转换，经济发展可能会放缓。<br>所以城市化带动的经济增长还会持续相当长的时间，目前离路易斯拐点还有十几年时间，当然不一定能维持7%的高增长。</blockquote>\n<ul><li data-pid=\"Ya_i3lFK\">印度的城市化和越南、孟加拉国不同，城市化并未进入高速发展阶段，这意味这印度发展模式将会更长，经济增速可能会更低，以超长期的中高速增长为表现。</li></ul>\n<blockquote data-pid=\"TyQ2XiWS\">目前印度城市化率和增速为35%和0.5%，低于越南、孟加拉国的38%和0.8%，印度并未进入高速城市化阶段，但近些年来已经提速。<br>印度城市化较慢，是可能来源于劳务改革和征地改革滞后，参考中国高速城市化和90年代劳务改革的相关性，可能劳务市场僵化导致的岗位不足是主要障碍。<br>印度目前的高增长是依赖于少数高增加值岗位，并且由这部分劳动力的消费扩散效应，带动经济增长，具有鲜明的资金密集型和技术密集型特征。<br>印度目前以0.5%的城市化增速创造7%的高增长，而越南、孟加拉国则是以0.8%的城市化率创造相似增长，印度较少依赖于劳动力部门迁徙产生的“结构变化”（structural change），而越南、孟加拉国创造的非农岗位质量较差。<br>以城市化率到达50%为转折点，印度至少还需要20年时间，这意味理想情况下印度可以实现20年左右的6%或7%的增长。</blockquote>\n<ul><li data-pid=\"DDEAzAbv\">考虑到路易斯拐点对经济发展的冲击，城市化发展带动的经济增长，可能会像中国一样区分为两个阶段</li></ul>\n<blockquote data-pid=\"RphBGHLA\">中国在2005-2010年路易斯拐点后，经济增长大幅下滑，但是日韩并未出现这一情况，直到城市化完成后才出现增速换挡。<br>印度、越南和孟加拉国三国可能在路易斯拐点前维持7%的高增长，或者6%的中高速增长<br>在路易斯拐点后，由于劳动力逐步短缺，有可能会像中国一样出现增速换档。如果出现类似于东南亚金融危机等，潜在增长最低下降至4%。</blockquote>\n<h3>印度、越南和孟加拉国的人口红利问题</h3>\n<ul><li data-pid=\"jPz_uhwx\">人口红利应该是东亚国家才出现的特殊人口现象，越南确实是有明显的人口红利，而且还会持续15-20年，印度则并不明显。</li></ul>\n<blockquote data-pid=\"lvzREPAL\">根据劳动经济学研究，人口红利出现的条件是：要在30年内将总和生育率从4降低至2，如果这种人口转型要限制在20年以内，会很明显。<br>这背后的机制是在30年的一代人时间内，出生人口大幅度减少，而上一代劳动力又非常多，导致工作和储蓄的人口比重上升，不事生产和消费的人口比重下降。随着这一代人老去，人口红利转化为人口负债。<br>越南总和生育率从4降低至2的时间约为15年，有非常明显的人口红利，并且推断这个窗口期为2000-2040年，目前处于人口红利的中间阶段。<br>印度人口转型大概用了25-30年，应该没有明显人口红利，印度人口红利窗口期从2015年左右开始，并可能持续至2055年。由于其人口转型缓慢，人口抑制效应可能会远至2060乃至2065年。<br>越南的人口红利会额外带来1%的增长，印度仅仅为0.5%。</blockquote>\n<h3>印度的教育问题</h3>\n<p data-pid=\"Cb7loQdp\"><a class=\"member_mention\" href=\"http://www.zhihu.com/people/06916ab5292b620917a7be1b4945a19d\" data-hash=\"06916ab5292b620917a7be1b4945a19d\" data-hovercard=\"p$b$06916ab5292b620917a7be1b4945a19d\">@司马懿</a> 老师已经说了R&amp;D研发问题，主要谈谈教育问题。印度的教育问题被国内极度高估<b>，印度教育系统产出的各级学生只比中国多，不比中国少</b>。而印度教育问题不在于普及，而在于教育质量低：</p>\n<blockquote data-pid=\"oYM-oPka\">印度研发占GDP比重仅仅为0.7%，越南近些年来从0.3%提升至0.5%，孟加拉国最低，仅仅为0.2%，都抑制了知识密集型产业发展<br>印度文盲问题主要是有2.5-3亿的存量文盲，这接近于中国90年代的情况，但是新一代教育情况较好。<br>印度10年级以前的教育基本普及，12级的高中教育普及率约为一半，大学教育普及率大概是27%。<br>从中国历史来看，中国2000年左右大概做到80%的义务教育覆盖率，印度十级小学初中教育覆盖率约为中国2000年水平。印度11和12级高中教育普及率超过一半，约为中国2005年水平，如果考虑到印度9级教育并不算为高中教育，那么实际上高中教育普及率比中国2005年略高。<br>由于印度适龄教育人口更多，印度目前高等教育人口已经和中国相当，都在4000万左右。而印度高中每年级的在校人数约为1200万，已经比中国当下高了200万人。<b>印度教育系统产出的各级学生只比中国多，不比中国少</b>。<br>因此印度教育已经产出了足够多的学生，但是教育质量低，这个看PISA结果就知道了。阿玛蒂亚森的《不确定荣耀》有专篇讨论印度教育质量低劣的问题，根据相关研究，印度学生学力大概要比学级低2年左右。</blockquote>\n<p><img src=\"https://pic1.zhimg.com/v2-72adbfbd4adf94fcecb7ce635b8e9535_720w.jpg?source=b1748391?rss\" data-caption=\"印度各级教育入学率，从各级教育入学率来说，印度约为中国2000-2010年水平，但由于印度适龄人口更多，各级教育学生人数都高于现在的中国\" data-size=\"normal\" data-rawwidth=\"894\" data-rawheight=\"542\" data-watermark=\"watermark\" data-original-src=\"v2-72adbfbd4adf94fcecb7ce635b8e9535\" data-watermark-src=\"v2-c3f3c187f83626692e3fb7f4eeeab9de\" data-private-watermark-src=\"v2-b0d730061d081ac7313d661389137654\"></p>\n<h3>印度、越南和孟加拉国的投资主导式增长问题</h3>\n<blockquote data-pid=\"bzbYTcv-\">从支出法来看，印度、越南和孟加拉国的最终消费（私人加上政府消费）占GDP比重为71%、75%和76%，而越南和孟加拉国投资（总固定资产形成）分别为27%和30%。而根据不变价和现价基准，印度投资为32.5%和28.6%。<br>中国最终消费和投资比重约为55%和45%，印度、越南和孟加拉国不符合中国经验。<br>日韩城市化分别于1970年初和1990年初完成，投资比重持续上涨，至城市化完成后开始逐步下滑<br>日韩路易斯拐点分别为1960年初和1970年初，投资比重分别为30%和20-25%，其实都差不多，所谓的投资不足问题被高估。<br>印度的投资问题在于公共投资中的基建和房地产部分偏低，抑制了城市化带动的经济增长，但是私人投资效率较高。<br>越南则和印度相反，拥有较为强劲的基建和房地产投资，公共部门投资能力强，但是公共部门投资效率低，私人投资少且效率也相比较低。<br>所以印度的累积资本产出比（ICOR）大概是4.5，近些年可能提升至5以上，越南则为6乃至更高，印度投资效率较越南更高。<br>印度、越南和孟加拉国投资比重较拉美国家更高，拉美国家高速增长时期投资比重仅为20%，这意味着长期潜力较拉美国家应该较高，不应该简单比较。</blockquote>\n<p><img src=\"https://pic1.zhimg.com/v2-ee9473d53afd1c16544d859427220e4d_720w.jpg?source=b1748391?rss\" data-caption=\"日本投资占GDP比重，现价计算可能会有一定高估。日本高速增长期投资比重大幅攀升，但是远低于现在的中国\" data-size=\"normal\" data-rawwidth=\"1446\" data-rawheight=\"697\" data-watermark=\"watermark\" data-original-src=\"v2-ee9473d53afd1c16544d859427220e4d\" data-watermark-src=\"v2-198c5a75b44ec1b390059b0c44fd2510\" data-private-watermark-src=\"v2-4f8d580f11b99364623fd9e1b58b60e1\"></p>\n<p><img src=\"https://pica.zhimg.com/v2-1fe5cce1308a80f255621968503bbac3_720w.jpg?source=b1748391?rss\" data-caption=\"韩国投资占GDP比重，历史均值为32%，现价计算可能会有一定高估。韩国高速增长期投资比重大幅攀升，但是远低于现在的中国\" data-size=\"normal\" data-rawwidth=\"1441\" data-rawheight=\"702\" data-watermark=\"watermark\" data-original-src=\"v2-1fe5cce1308a80f255621968503bbac3\" data-watermark-src=\"v2-f73c37d1c121d8c5857479031592b97f\" data-private-watermark-src=\"v2-2f104f8d05f6e5fd29d22ba0fc365936\"></p>\n<h3>为什么说这些国家是消费主导型增长？</h3>\n<blockquote data-pid=\"m2ae4jUC\">由于最终消费占比更高，经济周期体现了更明显的耐用品消费的特性，以住房、汽车为主的耐用品消费是经济增长的推动力。<br>2018年9月，印度非银金融公司IL&amp;FS违约，虽然其主营业务是基建融资，但非银金融公司还往往为住房和汽车融资，这导致消费快速下滑，进而引发经济萧条。</blockquote>\n<h3>印度和越南的贸易问题比较正常，但是孟加拉国贸易逆差较为严重</h3>\n<blockquote data-pid=\"vGdFFV_o\">印度和孟加拉国有非常严重的贸易逆差问题，越南也仅仅保持贸易平衡，这其实对应萨缪尔森对发展过程中国际收支问题四阶段论的第一阶段，即“该国存在贸易逆差，贸易逆差由资本和金融账户顺差来弥补，在这一阶段，国际收支结构为'逆差+顺差'形式”。<br>日本同发展阶段的历史过于久远，而韩国的数据表明，韩国高增长时期总是伴随高逆差，最多时期高达12%。<br>中国由于接受了大量外资投资，存在外资创造顺差的现象，但是并不会创造额外的增加值，越南也有类似现象。但是日韩国家并不存在大规模吸收外资投资的情况，因此韩国高增长伴随巨额逆差。<br>因此印度和越南的贸易情况都比较正常，分别接近大多数发展中国家和中国的情况，但是孟加拉国国际收支问题较为严重。</blockquote>\n<p><img src=\"https://pic2.zhimg.com/v2-cfc59a3d8c49c10d22a225baed891156_720w.jpg?source=b1748391?rss\" data-caption=\"韩国高增长时期进出口情况，只有80年代存在一定顺差，且80年代前逆差非常巨大\" data-size=\"normal\" data-rawwidth=\"739\" data-rawheight=\"411\" data-watermark=\"watermark\" data-original-src=\"v2-cfc59a3d8c49c10d22a225baed891156\" data-watermark-src=\"v2-0a7e785ee29c536d34dbff1cd0003560\" data-private-watermark-src=\"v2-447f31a2dfd1a0cabbc717a8f109246c\"></p>\n<h3>印度的外债问题不算严重，越南外债负担已经接近警戒线，孟加拉国严重依赖于外援</h3>\n<blockquote data-pid=\"aBlV1hVa\">外债容易导致国际收支危机，进而导致长期增长潜力大幅损失，安全标准包括：外债负债率（外债余额与国内生产总值之比）、债务率（外债余额与贸易出口收入之比）、偿债率（外债还本付息额与贸易出口收入之比）、短期外债与外汇储备，安全线分别为20%、100%、20%和100%。<br>印度债务率约为150%高于安全线，其余都在安全范围内，反映了印度出口竞争力差。<br>越南外债负债率已经接近50%的警戒线，外债规模过高。由于大进大出的贸易模式高估了出口数据，债务率和偿债率被低估，风险偏高。<br>孟加拉国的外债负债率、债务率均高于安全线，并且2016年来孟加拉国外债增速高达20%，风险在三国中最高。</blockquote>\n<h3>印度近些年来的改革进展，越南和孟加拉国不懂不谈</h3>\n<p data-pid=\"-C7RsfVu\">莫迪政府目前的改革依旧集中于资本要素领域，主要改革是2017年的税制改革，但是2018年末出现经济萧条、2020年受疫情冲击，直到2021年下半年度过delta这波后才显现出现效果：</p>\n<blockquote data-pid=\"iZ_fi9aC\">印度税制改革成功将全国各邦的间接税统一，2021/22财年增值税占GDP比重为7%，接近中国营改增后、减税降费前水平。<br>尽管2019年对企业和个人减税，但是2022/23财年到现在，企业税和个人所得税的直接税依旧有50%左右的增幅。税制改革以及后续改革较为成功，提升了印度征税能力和经济正规化程度。<br>印度整体税收占GDP比重提升到20%左右，基本达到中国预算内税收的比重。但中国土地出让金比重高达8%，此外还有5%以上的社保收入，除此之外还有国企收入、公积金等社保收入，所以政府总收入超过GDP的35%，这保证中国财政实力远超发展中国家，并且有能力进行大规模建设，印度没有足够的财力进行公共投资。<br>由于税收比重仅20%，印度政府的公共投资只有不到1000亿美元，也就是2-3%的GDP。印度需要进一步提升税收，一个方面是增加一些土地收入——需要先做起来房地产市场，一方面是大幅增加社保收入。</blockquote>\n<p><img src=\"https://pic1.zhimg.com/v2-03f69ca23be7fb69b1c07f88474f51f1_720w.jpg?source=b1748391?rss\" data-caption=\"印度今年直接税大幅增长，加上去年间接税大幅增长，税制改革带动经济正规化\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"358\" data-watermark=\"watermark\" data-original-src=\"v2-03f69ca23be7fb69b1c07f88474f51f1\" data-watermark-src=\"v2-88d8cafc74e095b4d61f5c7306bd5e45\" data-private-watermark-src=\"v2-98664f57593d2ff1190dd7c0fd0ddbcf\"></p>\n<blockquote data-pid=\"JEO4cThZ\">增值税对高技术产业竞争力的提升越来越明显，但没有对劳动密集型产业有太多影响。以印度长期弱势的机械制造和较有优势的交通设备（machinery and transport equipment)为例，2011年至税制施行前的2016年，长期停滞在四五百亿美元。尽管税制改革后很快进入萧条期，出口也有下滑，但是该类产品大幅提升至623亿美元，疫情后超过700亿美元。</blockquote>\n<p><img src=\"https://pic3.zhimg.com/v2-f3a819d2e11e37dad62f171abdfc081e_720w.jpg?source=b1748391?rss\" data-caption=\"左图为印度2010年至2019年机械和交通产品出口额，可见2017年税制改革提升印度在传统产业的竞争力，数据来源WITS\" data-size=\"normal\" data-rawwidth=\"378\" data-rawheight=\"433\" data-watermark=\"watermark\" data-original-src=\"v2-f3a819d2e11e37dad62f171abdfc081e\" data-watermark-src=\"v2-05c12b1438f58fae15079dc17ff80ff0\" data-private-watermark-src=\"v2-81583975f83dd99a2381b341bde32b3c\"></p>\n<h3>印度的银行改革，主要是处理坏账问题</h3>\n<p data-pid=\"Ru5sjteH\">银行改革是印度资本领域的另一项大改革，由于疫情影响，大概于2022年完成的银行坏账清理依旧需要两年时间，之后印度才能结束去杠杆过程，重新增加信贷资源：</p>\n<blockquote data-pid=\"0Pi8qCiR\">2011年后印度经济放缓的直接原因是坏账积累，信贷增速大幅下滑，疫情前已经低至5%。<br>2018年前印度已进行破产法、银行注资等多项改革，疫情前总不良贷款比例已逐步下降，目前已经降低至6%。<br>受疫情影响，预期于2022年末坏账降低至3%的安全范围，仍需要额外两年时间。比较积极的是，疫情中印度央行预测的坏账大幅反弹至12%-14%，也并未出现。<br>印度银行要在基本整理完资产负债表问题后，才能结束长达十年之久的去杠杆过程，重新增加信贷推动增长。</blockquote>\n<p><img src=\"https://pic1.zhimg.com/v2-a79580dbd978f5faf39766d6b6fc3716_720w.jpg?source=b1748391?rss\" data-caption=\"印度信贷增速自世纪初爆发后，出现周期性下滑，并且带动经济下行\" data-size=\"normal\" data-rawwidth=\"600\" data-rawheight=\"509\" data-watermark=\"watermark\" data-original-src=\"v2-a79580dbd978f5faf39766d6b6fc3716\" data-watermark-src=\"v2-cc7923c7c3b31c6c80b860267a649c96\" data-private-watermark-src=\"v2-5e410fc4f0feb64bc94472567a797424\"></p>\n<p><img src=\"https://pic3.zhimg.com/v2-3f2685acf0eac682fe74808a9399c69f_720w.jpg?source=b1748391?rss\" data-caption=\"印度坏账比重在2018年到顶，目前降低至6%\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"658\" data-watermark=\"watermark\" data-original-src=\"v2-3f2685acf0eac682fe74808a9399c69f\" data-watermark-src=\"v2-e7cffa8160d002a8527463f662f765d5\" data-private-watermark-src=\"v2-1d1b125e666ea29d63e7ca59de02ca1c\"></p>\n<p data-pid=\"MqL4eGci\">印度还有一些重量级改革，像是统一全国的劳动法改革，虽然说是今年各邦可以清理好本地法规，但是可能还是要继续延期。如果改革通过，可以大幅度提升产业竞争力，并且可能会提振劳动密集型产业的竞争力。</p>\n<p data-pid=\"uMUMM9c8\">而另一个重量级改革是征地法改革，印度目前也进行了灵巧细碎的改革，但是集中于土地征收流程、资金募集和法规限制，并未对征地矛盾做什么改革。征地改革至少也要放到下一个五年任期了——如果莫迪还有雄心壮志的话。</p>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/tianya_mingyue_dao?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">天涯明月刀</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/538171631/answer/2539324313?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">270 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/518105764?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">白重恩对话斯宾塞表示「中国经济的相对高增长将至少持续到下个十年」，这意味着什么？</a><br><a href=\"http://www.zhihu.com/question/532897322?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">如何评价李稻葵在演讲中分享的研究心得:过去两年的抗疫相当于为每个中国人多增加10天寿命？</a><br>\n","link":"http://www.zhihu.com/question/538171631/answer/2539324313?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"最早的房车在中国？浅谈世界房车发展史","date":"2022-07-06 08:00:00","description":"希望中国市场能出现更多亮眼的产品，在今后世界房车发展的历史上占据一席之地。<a href=\"https://sspai.com/post/74136\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74136"},{"title":"App+1 | 创造语言环境，浏览器插件 Toucan 让你边读网页边背单词","date":"2022-07-06 06:43:21","description":"Toucan 就是这样一个浏览器插件。它的主要作用就是在打开的网页中，根据用户的语言水平，随机选择一些词汇，将其翻译成想要学习的语言。<a href=\"https://sspai.com/post/74140\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74140"},{"title":"「合伙人」","date":"2022-07-06 04:27:56","description":"\n<p data-pid=\"s88PykYD\">过去几年VC行业的合伙人不太够用了，虽然行业已经量产了，但是越来越多的情况都需要「合伙人」抬头，让我们这个行业的「合伙人」抬头一度很水。现在经济下行，行业调整，「合伙人」的含金量多了一些，但还是有很多场景对于这个 SKU 需求过大，其实是前几年 QE 放水的后遗症，未来估计这个品类会慢慢恢复正常。</p>\n<p data-pid=\"cwrq7awu\">我很久以前写过一篇建议大家重视投资经理的文章，现在我还是这个观点：VC本身是一个需要为前途未卜的企业站台的业务，是一个信任层层传递的过程，不像PE/Buyout是一个定价和交易为主的业务。VC的标的绝大多数情况下都还称不上「资产」，基本上就是两杆枪和一句话的事，而PE的标的基本都是成名的地标性企业，都可以用DCF来算账，只是一个「谁」投资的问题。所以才有多年前讲KKR Nabisco案例的野蛮人系列，引人入胜，也有单伟建前辈单枪匹马拉着TPG去收购韩国第一银行的故事。PE都是资产驱动的。VC都是故事驱动的。</p>\n<p data-pid=\"0qSjhQvG\">在互联网已经收场的今天，行业百废待兴，除了大家众口一词的半导体国产替代和新能源走向全球两件事以外，还有很多日新月异的新技术在发芽，这些领域不像互联网，没法一通百通，所以才有人前两天说VC在高薪囤积化学博士。但化学博士们不是一上来就是合伙人的。中国VC的合伙人大部分都是从互联网时代成长起来的，另外一个阵营是医疗。TMT基金们今天已经转型成为技术投资者和倡导者，化学博士、生物博士、计算机博士……我们终于摆脱了这个行业「低学历」的历史（曾经有个小姑娘刚刚考上哥大的博士，听我介绍完背景之后直接说：「你们这个行业好像学历要求不高……」让我忽然哑语）。</p>\n<p data-pid=\"b7W8DsOf\">但其实合伙人懂得不多。有上进心的老同志努力跟进时代，天天看公众号，但专业知识上距离自己的 Associate / VP 仍然相差很远。就算去报个在职研究生甚至博士，大部分都是化妆而已，就像我去请教CNS的教授，老人家说完全不知道免疫是怎么回事，问免疫的主任，人家对CMC工艺细节基本没经验……隔行如隔山在科技领域里非常明显；顾不过来的基本在用外包专家网络来进行项目筛选。很多跃跃欲试要创业的专家教授们一旦开始纠结「为什么我见的不是合伙人」就陷入了GP们非要见引导基金党委书记的怪圈：他不懂你，你不懂他。</p>\n<p data-pid=\"4SQP9aoG\">其实大家过于纠结于抬头了。如果你面对的是一家市场化机构，那么你见的人越多，你在内部获得的理解可能就越多，而创业者会非常需要机构内部真正懂技术和业务的专家来做内部推荐，这些专家经常是「投资经理」或者「投资总监」，在VC行业，职级是非常扁平的，从来都是谁有业绩谁上，而合伙人的核心功能其实是募资，就像科技创业创始人的一样，我们都需要募资；如果你面对的是国字头，那么这一层级的专家就更加重要，因为合伙人可能你都见不上几次，大家都要向上看，向上沟通，VC的合伙人们不也是天天追着母基金的投资总监们吗？</p>\n<p data-pid=\"9csBM7jx\">所以呼吁大家别凡事就要合伙人参加了，我们合伙人的名片上也没抬头，和我们行政小姑娘的名片长得一样。作为一名从2007年就开始有这个抬头的从业人员，我觉得年轻同事比我懂得都多，我天天追着他们问，所以建议大家也追着他们，他们才是真正推动项目往前走的核心力量。大家多关注点实质，少在意些形式，在今天这样一个乱糟糟的市场里面，一起做一些靠谱赚钱有潜力的项目，不香么？</p>\n<p data-pid=\"wsHASFaI\">说着说着我可能又得罪了不少同行，所以最后再为中老年合伙人正一下名：我们最大的价值可能在于经历的行业周期多，没有在市场暴涨之后退休高尔夫，也没有在暴跌之后挥别江湖，所以在一些大周期的投资决策中有一些优势，对于判断国内政策有一些积累，在技术和产品方面我们虚心向团队请教，但在动作急缓上我们确实更有发言权。</p>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/wayneshiong?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">熊伟铭</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br>\n","link":"http://zhuanlan.zhihu.com/p/537835923?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"学摄影就是每天摆弄相机吗？——谈谈我眼中的摄影硕士之旅","date":"2022-07-06 03:53:40","description":"按下快门，创造好看照片这件事已经不再是首要任务，重要的是，拍下这张照片之后的回望时刻。<a href=\"https://sspai.com/post/74118\" target=\"_blank\">查看全文</a>\n","link":"https://sspai.com/post/74118"},{"title":"甘肃省甘南州值得一去吗？","date":"2022-07-06 02:33:52","description":"\n<p data-pid=\"mtLeA5iC\">2020年秋天，我在甘肃甘南州拍摄了《围城随笔》系列纪录片的第六集《点亮的地平线》，这34分钟的长片也是《围城随笔》系列时长最长的一部记录，前后花了我三个月来拍摄和整理制作。这一集记录了我在甘南游历的壮美风光和旅途中的所见所闻，这条自驾路线途径包括网称“人间仙境”的扎尕那、洛克之路（江迭公路）、甘加秘境、古叠州城遗址等，在我所有的自驾旅行里完全值得上升到我心里的不得不去的TOP5。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-a8c9b2fede604c0aa86d657471d3f64a_720w.jpg?source=b1748391?rss\" data-caption=\"b站搜索《围城随笔》可直达\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"1993\" data-watermark=\"original\" data-original-src=\"v2-a8c9b2fede604c0aa86d657471d3f64a\" data-watermark-src=\"v2-7c08d09b8406a26c853104a2ac0c1b79\" data-private-watermark-src=\"v2-16bb44e5c352fcfd51498850f6cb7ca6\"></p>\n<p data-pid=\"4hMdm2VZ\">除了拍摄一个月的沉浸式感受，制作过程中对国内国外的历史信息，当地农牧林业的相关政策文件，我都花了相当多的时间去搜寻和研究，在这个过程里，我也了解到了甘南以及迭部为了扶贫脱困所作出的大量努力，真心希望这里越来越好。</p>\n<p data-pid=\"jMN5vRyn\"><b>去年的五一假期好多观众和读者也给我发来了甘南的“远方回声“，一切依旧如我所见所感。</b></p>\n<h2>真正的精华藏在村前村后茂密的森林里的扎尕那</h2>\n<p><img src=\"https://pic1.zhimg.com/v2-7018c5e972ae1042d7b7ed01dfa64549_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"2126\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"_-ekCr0P\">前几年，网络平台铺天盖地的对扎尕那的形容——“人间天堂“，”伊甸园“以及”最后香巴拉”这，让我在到达这个地方之前并没有太大的兴趣。嗨，网络宣传嘛！谁不知道呢！<br>直到我远远看见“<a href=\"https://www.zhihu.com/search?q=%E6%89%8E%E5%B0%95%E9%82%A3%E5%B1%B1&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">扎尕那山</a>”为止：由于落差大，所以现场看上去的那种体量感，确实跟照片和视频里的它有着巨大差距——这是我在疫情之后第一次出远门，所以看啥啥都好。<br>就我的理解，<a href=\"https://www.zhihu.com/search?q=%E6%89%8E%E5%B0%95%E9%82%A3%E6%9D%91&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">扎尕那村</a>以及村中密密麻麻的民宿是整个光盖山区，探索自然景观的大本营，即交通枢纽和补给站。<br>因为扎尕那真正的精华，被藏在了村前村后茂密的森林里，以及这里通向光盖山深处的石门后。随意找一条沟往里深入，你会发现原来<b>扎尕那</b>不是在村中，而是雪藏在这些<a href=\"https://www.zhihu.com/search?q=%E7%9F%B3%E7%81%B0%E5%B2%A9%E5%B3%A1%E8%B0%B7&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">石灰岩峡谷</a>背后——那里，才是真正的原始森林和桃源秘境。请个向导再往上走，就是当地人的高山牧场，和洛克当年真正走过的<b>【洮叠古道】</b>东西线。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-2186f14c85d4e532617a7ad33be7e60d_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"2134\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<h2>\n<br>“洛克之路”，冰川造就的远古巨兽<br>\n</h2>\n<a href=\"https://www.zhihu.com/zvideo/1320681341798010880\">甘南光盖山深处的洛克之路，是我心中风光Top5的自驾之路</a><p data-pid=\"ykcw-qKq\">这条路，自驾去过的人不算少，但从全国<a href=\"https://www.zhihu.com/search?q=%E8%87%AA%E9%A9%BE%E6%B8%B8&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">自驾游</a>的尺度来看，就算是到了如今，那也算是小众中的极小众。<b>其中风景最为精华，最为无敌的路段，集中在光盖山的囊黑卡（也叫那黑卡，纪录片里有注解）到与“车巴沟”汇合的路段。</b><br>自从2020年12月纪录片发布以来，很多朋友先后前往了，尤其在今年的<a href=\"https://www.zhihu.com/search?q=%E4%BA%94%E4%B8%80%E9%95%BF%E5%81%87&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">五一长假</a>大家都给我发来了“远方回声”，可惜那时囊黑卡以西积雪覆盖无法通行。6月以后就迎来这条路最美的时候了。随便放几张图以供舔屏。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-ada857d40bc8b0f75e6b19982319db54_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"6297\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\" data-qrcode-action=\"none\" data-tags=\"qrcode\"></p>\n<p><img src=\"https://picx.zhimg.com/v2-d29cae8fd0704d2f3778d36bd7d31887_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1825\" data-rawheight=\"3543\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p><img src=\"https://pic1.zhimg.com/v2-34581af4b48245bcf3c22412de21ac9c_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1993\" data-rawheight=\"3543\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"X67JGb3O\">从囊黑卡（那黑卡）以西到江迭公路垭口的30公里是这条路最最精华的部分，大部分是在几乎完美的冰槽谷里穿行。根据一份地质考察资料，据说最盛时期，这里的冰川有120m厚。<br>古老的冰川消融之后，露出了一个发育完美的U形谷；高大的<a href=\"https://www.zhihu.com/search?q=%E4%BA%91%E6%9D%89&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">云杉</a>在这里自由自在的生长，这每一棵云杉，都像是城里的每一栋高楼，只是在这座绿色城市里，没有车水马龙，只有鸟语花香。在这种巨大山谷里穿行，一切都显得微不足道......我觉得在这个山谷里住上三天，应该是对这种极致美景最起码的尊重。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-9c3acf1882c8988837223ac050886326_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"2835\" data-rawheight=\"1772\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p><img src=\"https://pic2.zhimg.com/v2-4ed930f38efb129cf3b80b8a33a9a6d1_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"2214\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"mkSOBSmR\">光盖山下的山谷郁郁葱葱，这里的景象跟光盖山中完全不同，没有那种古老恒远的气场，而是那种country road take me home的小调牧歌。</p>\n<p><img src=\"https://pic1.zhimg.com/v2-4f3057b773745f83818878d417df1700_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"1805\" data-rawheight=\"2888\" data-watermark=\"original\" data-original-src=\"v2-4f3057b773745f83818878d417df1700\" data-watermark-src=\"v2-d86433eb0d0a371e2631d332ec8e09fc\" data-private-watermark-src=\"v2-8c4e6a22973f55ba67999df088c9d6b5\"></p>\n<p data-pid=\"Voipmmfv\">临近尼巴村时，你会惊喜的发现你的手机不再是砖头，它已经通过尼巴村的手机信号基站，连接到了山谷外的世界。尼巴村有个旅游特色，叫做【百年藏寨】；大致是错落有致的藏式吊脚楼布满了村北的山坡，而这连接坡上坡下的走廊通道，也是由吊脚形式的木质栈道构成。据说存在已有两百年的历史，目前这些老藏寨内还有当地人在居住。洮河自西向东把尼巴村分隔为两个区域，上图的左侧便是之前所提到的【百年藏寨】；而随着道路的连通和扶贫政策的实施，大部分村民早已搬迁到了右侧平坦的河岸新建房屋。所以洮河像是尼巴村的一条历史分割线，分隔了一旧一新的两个尼巴。</p>\n<p><img src=\"https://pica.zhimg.com/v2-f147a4af3c4df68f236fcb7d6bd7826e_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"5669\" data-rawheight=\"3543\" data-watermark=\"original\" data-original-src=\"v2-f147a4af3c4df68f236fcb7d6bd7826e\" data-watermark-src=\"v2-f427cbad57dcc38531fedf26da72d127\" data-private-watermark-src=\"v2-958882d6fa07fb5eac9ff4dd4a5a423d\" data-qrcode-action=\"none\" data-tags=\"qrcode\"></p>\n<h2>\n<br>甘南最后的秘密，甘加秘境</h2>\n<p data-pid=\"8Q_AfSqv\">这里有安多藏区的最高学府，<a href=\"https://www.zhihu.com/search?q=%E6%8B%89%E5%8D%9C%E6%A5%9E%E5%AF%BA&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">拉卜楞寺</a>。</p>\n<p><img src=\"https://pic2.zhimg.com/v2-1c94c853f05ccdac112e8b3dea7636b3_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"2214\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"uk5ku3uK\">甘加白石崖粗看上去地质构造类似洛克之路深处的光盖山，但是视觉体验还是有所不同。在这里，几百米高的石墙在草原上突然一字排开，抬头远眺会觉得它们像海浪一样朝你席卷而来。在早上的时候，不断有云雾在崖壁堆积，并且通过那道裂缝不断进出于山谷之中，你别说，确实有种秘境的感觉。你也可以沿着白石崖峡谷往上，可以到达崖顶的牧场。<br></p>\n<p><img src=\"https://pic1.zhimg.com/v2-51e752b9abc8e06258f698588a8f7573_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"2214\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"csrOeUWt\"><a href=\"https://www.zhihu.com/search?q=%E7%99%BD%E7%9F%B3%E5%B4%96&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">白石崖</a>下神秘的【八角古城】<br>目前村内没有任何的民宿酒店，也没有吃饭喝酒可消费的地方；而城中村民似乎也并不是当年守城将士们的后裔，因为这座城池曾经被废弃过，彼时的兵马也是弃城而散，有个说法是，直到清末民初人口迁徙时，客走他乡的路人才发现此地，并决定在此定居和繁衍。所以对于八角城的历史而言，也只剩下老人们从祖辈那里得来的零散传说。</p>\n<p><img src=\"https://pic3.zhimg.com/v2-726bbe35b2af4641541dc0b771b333c7_720w.jpg?source=b1748391?rss\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"3543\" data-rawheight=\"2214\" data-watermark=\"\" data-original-src=\"\" data-watermark-src=\"\" data-private-watermark-src=\"\"></p>\n<p data-pid=\"KzQCN9Ak\">在这里，还有一条小众得不能再小众的密道，从<a href=\"https://www.zhihu.com/search?q=%E9%BB%84%E5%9C%9F%E9%AB%98%E5%8E%9F&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1952337733%7D\" class=\"internal\">黄土高原</a>过渡到青藏高原——<br></p>\n<a href=\"https://www.zhihu.com/zvideo/1517812039209127937\">被废弃的丝绸之路，风景绝佳，鲜为人知，但太过惊险刺激</a><h2>\n<br>更多细节，可阅读我的甘南自驾旅行纪录片及游记<br>\n</h2>\n<a href=\"https://zhuanlan.zhihu.com/p/337072043\" data-draft-node=\"block\" data-draft-type=\"link-card\" data-image=\"https://pica.zhimg.com/v2-f1370227167c5e6989f62a331153cde0_qhd.jpg?source=b1748391\" data-image-width=\"3543\" data-image-height=\"1993\" class=\"internal\">在远方的阿伦：甘肃以南，雪藏深闺的无敌路线，我要在此做个吃泡面的神仙144 赞同 · 30 评论文章</a>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/another-sight?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">在远方的阿伦</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br><br>\n此问题还有 <a href=\"http://www.zhihu.com/question/364784408/answer/2560741493?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">48 个回答，查看全部。</a><br>\n                延伸阅读：<br><a href=\"http://www.zhihu.com/question/510601776?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">甘肃崆峒山值得一去吗？为什么？</a><br><a href=\"http://www.zhihu.com/question/454053172?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=title\" target=\"_blank\">甘肃省武威市有哪些旅游景点?</a><br>\n","link":"http://www.zhihu.com/question/364784408/answer/2560741493?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"基于方言之间的预测相似度进行方言聚类","date":"2022-07-05 12:49:06","description":"\n<h2>问题</h2>\n<p data-pid=\"C4RiD3vW\">去年，我在<a href=\"https://zhuanlan.zhihu.com/p/349689590\" class=\"internal\">基于自编码器的方言祖语音系嵌入</a>中尝试根据某个字在多个方言点中的读音对字进行聚类，实际上，由于这些读音构成了以字为行、以方言点为列的矩阵，一个自然的推广就是用类似的方法对方言点也进行聚类，借助聚类的结果辅助考察方言之间的亲缘关系。</p>\n<p data-pid=\"FxOZhGyF\">但是方言点和字音不同的是，方言之间相似不一定蕴含方言字音之间相同或相似。举个极端的情况，如果 a 方言读 x 的字在 b 方言无例外都读 y，同时 a 方言读 y 的字在 b 方言无例外都读 x，从表面的音值看 a、b 两种方言是截然相反的，但是在音类上却极其相似，因为两者可以通过非常简单的规则相互推导出来。</p>\n<p data-pid=\"jxTUdazZ\">甚至有时这种音值的差异不是方言语音本身造成的，而仅仅是不同来源的材料处理的偏好不同造成的。比如广州和湛江的方言相当接近，两者都有一套咝音，这套咝音在不同的人、不同的条件有不同的变体，由于记音宽严的差别，或者由于其他音系以外的因素，《珠江三角洲方言调查报告》把广州的咝音记成 s，而《粤西湛茂地区粤语语音研究》把湛江对应的咝音记成 ʃ。如果不加处理地直接对比原始字音，其结果就是大量的字音不同，从而得出广州和湛江的方言差异很大的结论。这是比较方法以外的、材料层面的因素对分析结果造成的影响，必须先行消除。</p>\n<h2>数学描述</h2>\n<p data-pid=\"goxFGBkH\">方言比较关心的是音类而非音值的相关性。具体地说，一个方言的<b>音类</b>可以表示成由若干个等价类构成的集合</p>\n<p data-pid=\"3R7J5rJp\"><img src=\"https://www.zhihu.com/equation?tex=%5Cmathcal%7BC%7D+%3D+%5C%7B+C_s+%7C+s+%5Cin+S+%5C%7D+%5C%5C\" alt=\"\\mathcal{C} = \\{ C_s | s \\in S \\} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"goyxteUG\">每个等价类 <img src=\"https://www.zhihu.com/equation?tex=C_s\" alt=\"C_s\" eeimg=\"1\"> 是字的集合，同类的所有字都同音。 所谓同音，是指方言的字音可以表示为从字集合到音节集合的映射 </p>\n<p data-pid=\"5lJZC0sr\"><img src=\"https://www.zhihu.com/equation?tex=f%3A+C+%5Cto+S+%5C%5C\" alt=\"f: C \\to S \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"RzQ2ez8J\">或写成函数的形式</p>\n<p data-pid=\"UHdMA2mq\"><img src=\"https://www.zhihu.com/equation?tex=s+%3D+f%28c%29%2C+%5Ctext%7B%E5%85%B6%E4%B8%AD+%7D+c+%5Cin+C%2C+s+%5Cin+S+%5C%5C\" alt=\"s = f(c), \\text{其中 } c \\in C, s \\in S \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"6zRwRd3t\">其中 <img src=\"https://www.zhihu.com/equation?tex=C\" alt=\"C\" eeimg=\"1\"> 为所有方言字的集合， <img src=\"https://www.zhihu.com/equation?tex=S\" alt=\"S\" eeimg=\"1\"> 为方言所有音节的集合。如 <img src=\"https://www.zhihu.com/equation?tex=f_%7B%E5%B9%BF%E5%B7%9E%7D%28%E6%B2%99%29+%3D+%5Ctext%7Bsa%7D%5E%7B53%7D%2C+f_%7B%E6%B9%9B%E6%B1%9F%7D%28%E6%B2%99%29+%3D+%5Ctext%7B%CA%83a%7D%5E%7B55%7D\" alt=\"f_{广州}(沙) = \\text{sa}^{53}, f_{湛江}(沙) = \\text{ʃa}^{55}\" eeimg=\"1\"> 。一组字在某个方言的同音关系上构成等价类，是指这些字通过该方言的上述映射函数都映射到相同音节</p>\n<p data-pid=\"UX9e5NBq\"><img src=\"https://www.zhihu.com/equation?tex=C_s+%3D+%5C%7B+c+%7C+f%28c%29+%3D+s+%5C%7D+%5C%5C\" alt=\"C_s = \\{ c | f(c) = s \\} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"KhVBpdey\">这些等价类构成了对方言字集合 <img src=\"https://www.zhihu.com/equation?tex=C\" alt=\"C\" eeimg=\"1\"> 的一个<b>划分</b>，只与映射函数的关系有关，而与映射结果的具体值无关。如果方言 a 的所有音类划分和方言 b 相同， <img src=\"https://www.zhihu.com/equation?tex=%5Cmathcal%7BC%7D_a+%3D+%5Cmathcal%7BC%7D_b\" alt=\"\\mathcal{C}_a = \\mathcal{C}_b\" eeimg=\"1\"> ，则说 a 音类和 b 音类相同，方言的具体音值不影响比较结果。</p>\n<p data-pid=\"AnBo1NQ2\">需要说明的是上文的描述及下文的讨论中提到的<b>字</b>并不是指字符层面的汉字，而是指隐含在汉字表面下的不可拆分的字音单位，对汉语来说，通常对应于一个单音节语素。之所以需要做这么细微的区分是因为存在一字多音的情况，有些多音字对应了不同的义项，这些是大部分方言共有的，还有一些方言中的一字多音是由于存在多个语音层次造成的。确定 a 方言的某个字某个音对应于 b 方言的哪个字哪个音，或简单地称之为字音对齐，是一项极其繁琐的工作，这里不再展开。</p>\n<h2>相似度计算方法</h2>\n<p data-pid=\"CbhR1-ne\">上文通过字音映射函数以及集合划分定义了方言音类，在此基础上，在 <img src=\"https://www.zhihu.com/equation?tex=%5Cmathcal%7BC%7Da+%5Cne+%5Cmathcal%7BC%7D_b\" alt=\"\\mathcal{C}a \\ne \\mathcal{C}_b\" eeimg=\"1\"><i> 的情况下，怎样度量 </i><img src=\"https://www.zhihu.com/equation?tex=%5Cmathcal%7BC%7D_a\" alt=\"\\mathcal{C}_a\" eeimg=\"1\"><i> 和 </i><img src=\"https://www.zhihu.com/equation?tex=%5Cmathcal%7BC%7D_b\" alt=\"\\mathcal{C}_b\" eeimg=\"1\"><i> 的相似性呢？一种角度是概率分布的观点。在概率观点下，音值 </i><img src=\"https://www.zhihu.com/equation?tex=s+%5Cin+S\" alt=\"s \\in S\" eeimg=\"1\"><i> 作为随机变量形成了一个离散的分布，其概率函数为</i></p>\n<p data-pid=\"zk_Tx3FP\"><img src=\"https://www.zhihu.com/equation?tex=P%28s%29+%3D+%5Csum_%7Bc+%5Cin+C%7D+P%28c%29+P%28s%7Cc%29+%5C%5C\" alt=\"P(s) = \\sum_{c \\in C} P(c) P(s|c) \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"Pf1r0ZVT\">其中 <img src=\"https://www.zhihu.com/equation?tex=P%28c%29\" alt=\"P(c)\" eeimg=\"1\"> 取平均分布</p>\n<p data-pid=\"T8kbfosr\"><img src=\"https://www.zhihu.com/equation?tex=P%28c%29+%3D+%5Cfrac%7B1%7D%7B%7CC%7C%7D+%5C%5C\" alt=\"P(c) = \\frac{1}{|C|} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"PncEQSIh\">对于确定的字音映射函数来说</p>\n<p data-pid=\"_caQbXrU\"><img src=\"https://www.zhihu.com/equation?tex=P%28s%7Cc%29+%3D+%5Cbegin%7Bcases%7D+1%2C+%26+%5Ctext%7B%E5%A6%82%E6%9E%9C+%7D+f%28c%29+%3D+s+%5C%5C+0%2C+%26+%5Ctext%7B%E5%85%B6%E4%BB%96%7D+%5Cend%7Bcases%7D+%5C%5C\" alt=\"P(s|c) = \\begin{cases} 1, &amp; \\text{如果 } f(c) = s \\\\ 0, &amp; \\text{其他} \\end{cases} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"ZolbRuuT\">在上述模型下，方言 a 和 b 音类的相似度表现为音值的条件分布，极端情况下，如果 a 方言的 x 总是对应 b 方言的 y，则 <img src=\"https://www.zhihu.com/equation?tex=P%28s_b+%3D+%5Ctext%7By%7D+%7C+s_a+%3D+%5Ctext%7Bx%7D%29+%3D+1\" alt=\"P(s_b = \\text{y} | s_a = \\text{x}) = 1\" eeimg=\"1\"> ，反之亦然。 最简单的方法是使用 <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 的共现频率来估计条件概率。</p>\n<p data-pid=\"GkPAlisD\"><img src=\"https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+P%28s_b+%7C+s_a%29+%26%3D+%5Cfrac%7BP%28s_a%2C+s_b%29%7D%7BP%28s_a%29%7D+%5C%5C+%26%3D+%5Cfrac%7B%5Csum_c+P%28c%29+P%28s_a%7Cc%29+P%28s_b%7Cc%29%7D%7B%5Csum_c+P%28c%29+P%28s_a%7Cc%29%7D+%5C%5C+%26%3D+%5Cfrac%7B%7C+%5C%7B+c+%7C+f_a%28c%29+%3D+s_a+%5Cland+f_b%28c%29+%3D+s_b+%5C%7D+%7C%7D%7B%7C+%5C%7B+f_a%28c%29+%3D+s_a+%5C%7D+%7C%7D+%5Cend%7Balign%2A%7D+%5C%5C\" alt=\"\\begin{align*} P(s_b | s_a) &amp;= \\frac{P(s_a, s_b)}{P(s_a)} \\\\ &amp;= \\frac{\\sum_c P(c) P(s_a|c) P(s_b|c)}{\\sum_c P(c) P(s_a|c)} \\\\ &amp;= \\frac{| \\{ c | f_a(c) = s_a \\land f_b(c) = s_b \\} |}{| \\{ f_a(c) = s_a \\} |} \\end{align*} \\\\\" eeimg=\"1\"></p>\n<h2>条件熵</h2>\n<p data-pid=\"YbeQ5ecS\"><a class=\"member_mention\" href=\"https://www.zhihu.com/people/0c708d923f8fb00142e1f25cdd4951d9\" data-hash=\"0c708d923f8fb00142e1f25cdd4951d9\" data-hovercard=\"p$b$0c708d923f8fb00142e1f25cdd4951d9\">@王赟 Maigo</a> 在<a href=\"https://zhuanlan.zhihu.com/p/20176714\" class=\"internal\">9978 方言音系/韵母“存古度”的一种定量描述</a>中提出了一种使用条件熵来度量方言之间的这种分布相似度的方法。<b>条件熵（conditional entropy）</b> <img src=\"https://www.zhihu.com/equation?tex=H%28s_b%7Cs_a%29\" alt=\"H(s_b|s_a)\" eeimg=\"1\"> 量化了随机变量 <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 的出现为随机变量 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 提供了多少确定性。</p>\n<p data-pid=\"Y5n3MG7y\"><img src=\"https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+H%28s_b%7Cs_a%29+%26%3D+%5Csum_%7Bs_a+%5Cin+S_a%7D+P%28s_a%29+%5Csum_%7Bs_b+%5Cin+S_b%7D+P%28s_b%7Cs_a%29+%28-+%5Clog+P%28s_b%7Cs_a%29%29+%5C%5C+%26%3D+%5Cmathbb%7BE%7D+%5B+-+%5Clog+P%28s_b%7Cs_a%29+%5D+%5Cend%7Balign%2A%7D+%5C%5C\" alt=\"\\begin{align*} H(s_b|s_a) &amp;= \\sum_{s_a \\in S_a} P(s_a) \\sum_{s_b \\in S_b} P(s_b|s_a) (- \\log P(s_b|s_a)) \\\\ &amp;= \\mathbb{E} [ - \\log P(s_b|s_a) ] \\end{align*} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"fP2cDwCG\"><img src=\"https://www.zhihu.com/equation?tex=H%28s_b%7Cs_a%29\" alt=\"H(s_b|s_a)\" eeimg=\"1\"> 越小， <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 预测 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 的能力越强。</p>\n<p data-pid=\"vt4E6fyu\">条件熵是单向的，即 <img src=\"https://www.zhihu.com/equation?tex=H%28s_b%7Cs_a%29+%5Cnot+%5Cequiv+H%28s_a%7Cs_b%29\" alt=\"H(s_b|s_a) \\not \\equiv H(s_a|s_b)\" eeimg=\"1\"> 。这很好理解，a 方言能推导 b 方言，反过来不一定成立。为了得到对称性，使用</p>\n<p data-pid=\"BfsCmAhQ\"><img src=\"https://www.zhihu.com/equation?tex=D%28a%2C+b%29+%3D+%5Cfrac%7B1%7D%7B2%7D%28H%28s_b%7Cs_a%29+%2B+H%28s_a%7Cs_b%29%29+%5C%5C\" alt=\"D(a, b) = \\frac{1}{2}(H(s_b|s_a) + H(s_a|s_b)) \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"8utxcQH5\">作为 a、b 方言之间的距离。对此直观的解释是，如果 a 方言可以预测 b 方言，同时 b 方言也可以预测 a 方言，那么这两种方言是相似的。条件熵作为距离有一个很好的性质</p>\n<p data-pid=\"BqVq6tgF\"><img src=\"https://www.zhihu.com/equation?tex=D%28s_a%2C+s_a%29+%3D+H%28s_a%7Cs_a%29+%3D+%5Cmathbb%7BE%7D+%5B+-+%5Clog+P%28s_a%7Cs_a%29+%5D+%3D+0+%5C%5C\" alt=\"D(s_a, s_a) = H(s_a|s_a) = \\mathbb{E} [ - \\log P(s_a|s_a) ] = 0 \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"8LDvmegS\">即任一方言到它自己的距离为0。</p>\n<p data-pid=\"iiS63S8M\">在实际操作中，统计的粒度细到音节会使统频率数据过于稀疏，降低结果可信度，比如说某个音节辖字极少，其中某个字由于偶然的原因读音不规则，或者仅仅由于使用的材料没有收录某个字的读音，都会大大影响统计出的概率。为了提高结果健壮性，对条件熵 <img src=\"https://www.zhihu.com/equation?tex=H%28s_b%7Cs_a%29\" alt=\"H(s_b|s_a)\" eeimg=\"1\"> 切分为声母、韵母、声调作一些近似，把 <img src=\"https://www.zhihu.com/equation?tex=s\" alt=\"s\" eeimg=\"1\"> 拆分成声母、韵母、声调的三元组 <img src=\"https://www.zhihu.com/equation?tex=%5Clangle+i%2C+f%2C+t+%5Crangle\" alt=\"\\langle i, f, t \\rangle\" eeimg=\"1\"> 分别计算条件熵。</p>\n<p data-pid=\"2EKyuCtU\"><img src=\"https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+H%28s_b%7Cs_a%29+%26%3D+%5Cmathbb%7BE%7D+%5B+P%28s_b%7Cs_a%29+%5D+%5C%5C+%26%3D+%5Cmathbb%7BE%7D+%5B+-+%5Clog+P%28i_b%2C+f_b%2C+t_b+%7C+i_a%2C+f_a%2C+t_a%29+%5D+%5C%5C+%26+%5Capprox+%5Cmathbb%7BE%7D+%5B+-+%5Clog+%28+P%28i_b+%7C+i_a%2C+f_a%2C+t_a%29+P%28f_b+%7C+i_a%2C+f_a%2C+t_a%29+P%28t_b+%7C+i_a%2C+f_a%2C+ta%29%29%5D+%5C%5C+%26%3D+H%28i_b+%7C+i_a%2C+f_a%2C+t_a%29+%2B+H%28f_b+%7C+i_a%2C+f_a%2C+t_a%29+%2B+H%28t_b+%7C+i_a%2C+f_a%2C+t_a%29+%5C%5C+%26+%5Capprox+%5Cmin+%5C%7B+H%28i_b+%7C+i_a%2C+f_a%29%2C+H%28i_b+%7C+i_a%2C+t_a%29+%5C%7D+%2B+%5Cmin+%5C%7B+H%28f_b+%7C+i_a%2C+f_a%29%2C+H%28f_b+%7C+f_b%2C+t_b%29+%5C%7D+%2B+%5Cmin+%5C%7B+H%28t_b+%7C+i_a%2C+t_a%29%2C+H%28t_b+%7C+f_a%2C+t_a%29+%5C%7D+%5Cend%7Balign%2A%7D+%5C%5C\" alt=\"\\begin{align*} H(s_b|s_a) &amp;= \\mathbb{E} [ P(s_b|s_a) ] \\\\ &amp;= \\mathbb{E} [ - \\log P(i_b, f_b, t_b | i_a, f_a, t_a) ] \\\\ &amp; \\approx \\mathbb{E} [ - \\log ( P(i_b | i_a, f_a, t_a) P(f_b | i_a, f_a, t_a) P(t_b | i_a, f_a, ta))] \\\\ &amp;= H(i_b | i_a, f_a, t_a) + H(f_b | i_a, f_a, t_a) + H(t_b | i_a, f_a, t_a) \\\\ &amp; \\approx \\min \\{ H(i_b | i_a, f_a), H(i_b | i_a, t_a) \\} + \\min \\{ H(f_b | i_a, f_a), H(f_b | f_b, t_b) \\} + \\min \\{ H(t_b | i_a, t_a), H(t_b | f_a, t_a) \\} \\end{align*} \\\\\" eeimg=\"1\"> 上式最后一步的近似的考虑为，存在这样一种情况，a 方言的声母不能预测 b 方言的声母，但是 a 方言的声母加韵母、或者声母加声调能预测 b 方言的声母，只统计声母之间的条件熵会这种预测能力抹杀掉。例如广州的 p 对应上海的 p、b，单独根据广州的 p 不能预测上海是 p 还是 b，但是再增加考虑声调是阴调还是阳调其实是可以预测的。基于这一点，分别统计 a 方言声母和韵母、声母和声调联合分布对 b 方言声母的条件熵，取其中较小者。</p>\n<p data-pid=\"AWu9mZiR\">举 <img src=\"https://www.zhihu.com/equation?tex=H%28i_b+%7C+i_a%2C+f_a%29\" alt=\"H(i_b | i_a, f_a)\" eeimg=\"1\"> 为例</p>\n<p data-pid=\"Ee8BWWTm\"><img src=\"https://www.zhihu.com/equation?tex=%5Cbegin%7Balign%2A%7D+H%28i_b+%7C+i_a%2C+f_a%29+%26%3D+%5Cmathbb%7BE%7D+%5B+-+%5Clog+P%28i_b+%7C+i_a%2C+f_a%29+%5D+%5C%5C+%26%3D+%5Cfrac%7B1%7D%7B%7CC%7C%7D+%5Csum_%7Bc+%5Cin+C%7D+-+%5Clog+P%28f%5E%7B%28I%29%7D_b%28c%29+%7C+f%5E%7B%28I%29%7D_a%28c%29%2C+f%5E%7B%28F%29%7D_a%28c%29%29+%5Cend%7Balign%2A%7D+%5C%5C\" alt=\"\\begin{align*} H(i_b | i_a, f_a) &amp;= \\mathbb{E} [ - \\log P(i_b | i_a, f_a) ] \\\\ &amp;= \\frac{1}{|C|} \\sum_{c \\in C} - \\log P(f^{(I)}_b(c) | f^{(I)}_a(c), f^{(F)}_a(c)) \\end{align*} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"tfCCijzL\">其中 <img src=\"https://www.zhihu.com/equation?tex=f%5E%7B%28I%29%7D%2C+f%5E%7B%28F%29%7D\" alt=\"f^{(I)}, f^{(F)}\" eeimg=\"1\"> 分别表示字到声母、韵母的映射函数。上式的条件概率可以通过统计样本的频率估算得到。</p>\n<h2>卡方检验</h2>\n<p data-pid=\"OnBnTb7h\">本质上，上述方法中的互信息量度量的是方言之间预测的能力，因此可以尝试使用其他度量指标来代替，比如说特征选择中用的比较多的<b>卡方检验（chi-square test）</b>。卡方检验的思路是假设 <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 是独立随机变量，由此它们分组统计共现得到的 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 统计量符合自由度为 <img src=\"https://www.zhihu.com/equation?tex=k\" alt=\"k\" eeimg=\"1\"> 的卡方分布</p>\n<p data-pid=\"lhckc9tP\"><img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2+%3D+%5Csum+%5Cfrac%7B%28f_o+-+f_e%29%5E2%7D%7Bf_e%7D+%5Csim+%5Cchi%5E2%28k%29+%5C%5C\" alt=\"\\chi^2 = \\sum \\frac{(f_o - f_e)^2}{f_e} \\sim \\chi^2(k) \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"zzMqG-Qu\">其中 <img src=\"https://www.zhihu.com/equation?tex=f_e\" alt=\"f_e\" eeimg=\"1\"> 表示每组期望出现的频次，一般通过统计频率估计， <img src=\"https://www.zhihu.com/equation?tex=f_o\" alt=\"f_o\" eeimg=\"1\"> 表示实际观察到的频次，自由度 <img src=\"https://www.zhihu.com/equation?tex=k\" alt=\"k\" eeimg=\"1\"> 由分组数量得到。然后根据卡方分布的累积分布函数计算 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 对应的剩余概率 <img src=\"https://www.zhihu.com/equation?tex=p\" alt=\"p\" eeimg=\"1\"> ， <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 越大， <img src=\"https://www.zhihu.com/equation?tex=p\" alt=\"p\" eeimg=\"1\"> 越小，说明实际情况偏离假设越多， <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 越不可能相互独立，或者反过来说， <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 越相关。</p>\n<p data-pid=\"JJHEkakF\">理论上说，由于不同方言对的自由度 <img src=\"https://www.zhihu.com/equation?tex=k\" alt=\"k\" eeimg=\"1\"> 不同，在进行方言之间相似度比较时，应该比较置信度 <img src=\"https://www.zhihu.com/equation?tex=p\" alt=\"p\" eeimg=\"1\"> 而不是直接比较 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值。但由于方言之间的相关性足够显著，即使差别很大的方言之间也是如此，统计出来的 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值普遍很大，导致对应的 <img src=\"https://www.zhihu.com/equation?tex=p\" alt=\"p\" eeimg=\"1\"> 值下溢为0，无法使用。另一方面这些 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 的自由度 <img src=\"https://www.zhihu.com/equation?tex=k\" alt=\"k\" eeimg=\"1\"> 也足够大，根据卡方分布的定义及中心极限定理，当 <img src=\"https://www.zhihu.com/equation?tex=k\" alt=\"k\" eeimg=\"1\"> 趋向正无穷时， <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 趋向于高斯分布</p>\n<p data-pid=\"X4SMlMts\"><img src=\"https://www.zhihu.com/equation?tex=%5Clim_%7Bk+%5Cto+%2B+%5Cinfty%7D+%5Cchi%5E2+%5Csim+%5Cmathcal%7BN%7D+%28k%2C+2k%29+%5C%5C\" alt=\"\\lim_{k \\to + \\infty} \\chi^2 \\sim \\mathcal{N} (k, 2k) \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"iAJh1KCs\">标准化之后</p>\n<p data-pid=\"Z3fDIgj2\"><img src=\"https://www.zhihu.com/equation?tex=%5Clim_%7Bk+%5Cto+%2B+%5Cinfty%7D+%5Cfrac%7B%5Cchi%5E2+-+k%7D%7B%5Csqrt%7B2k%7D%7D+%5Csim+%5Cmathcal%7BN%7D+%280%2C+1%29+%5C%5C\" alt=\"\\lim_{k \\to + \\infty} \\frac{\\chi^2 - k}{\\sqrt{2k}} \\sim \\mathcal{N} (0, 1) \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"Wf3yqVVw\">从而允许比较 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值的大小，方言之间的 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值越大，表明越相似。</p>\n<p data-pid=\"JHpk-HtF\">为了降低统计数据的稀疏性，采用和条件熵类似的、 分声母、韵母、声调统计 $\\chi^2$ 的处理方法。所不同的是，卡方检验对于 <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 是对称的。为了保持这种对称性，在拆分统计共现矩阵的时候对 <img src=\"https://www.zhihu.com/equation?tex=s_a\" alt=\"s_a\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=s_b\" alt=\"s_b\" eeimg=\"1\"> 的处理也是对称的，即统计 a 方言的声母韵母组合、和 b 方言的声母韵母组合的共现矩阵的 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值，如此类推。最后取所有 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值的平均。</p>\n<p data-pid=\"gggY5LXY\">由此，方言两两之间的 <img src=\"https://www.zhihu.com/equation?tex=%5Cchi%5E2\" alt=\"\\chi^2\" eeimg=\"1\"> 值组成了方言之间的相似度矩阵 <img src=\"https://www.zhihu.com/equation?tex=S\" alt=\"S\" eeimg=\"1\"> ，该矩阵经过一定的变换可以得到和条件熵相似的距离矩阵。</p>\n<p data-pid=\"wdUzMgt4\"><img src=\"https://www.zhihu.com/equation?tex=d_%7Bij%7D+%3D+%5Csqrt%7B2+-+2+s_%7Bij%7D%7D+%5C%5C\" alt=\"d_{ij} = \\sqrt{2 - 2 s_{ij}} \\\\\" eeimg=\"1\"></p>\n<h2>数据</h2>\n<p data-pid=\"tVR1wXJH\">以下统计分析使用<a href=\"https://link.zhihu.com/?target=https%3A//zhongguoyuyan.cn/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">中国语言资源保护工程采录展示平台</a>的汉语方言字音数据，使用其中的方言老男单字音。共1287个方言点，每点收录1000个单字音，有些点一个字有多个音，有些点个别字缺数据。</p>\n<p data-pid=\"tlGwNgt9\">数据概览：</p>\n<table data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"normal\"><tbody>\n<tr>\n<th>方言点数</th>\n<th>单字数</th>\n<th>记录数</th>\n</tr>\n<tr>\n<td>1287</td>\n<td>1004</td>\n<td>1341693</td>\n</tr>\n</tbody></table>\n<p data-pid=\"4XAZlwut\">广州的数据样例：</p>\n<table data-draft-node=\"block\" data-draft-type=\"table\" data-size=\"normal\" data-row-style=\"normal\"><tbody>\n<tr>\n<th>iid</th>\n<th>finals</th>\n<th>initial</th>\n<th>tone</th>\n<th>name</th>\n</tr>\n<tr>\n<td>0001</td>\n<td>ɔ</td>\n<td>t</td>\n<td>53</td>\n<td>多</td>\n</tr>\n<tr>\n<td>0002</td>\n<td>ɔ</td>\n<td>th</td>\n<td>53</td>\n<td>拖</td>\n</tr>\n<tr>\n<td>0003</td>\n<td>ai</td>\n<td>t</td>\n<td>22</td>\n<td>大</td>\n</tr>\n<tr>\n<td>0004</td>\n<td>ɔ</td>\n<td>l</td>\n<td>21</td>\n<td>锣</td>\n</tr>\n<tr>\n<td>0005</td>\n<td>ɔ</td>\n<td>tʃ</td>\n<td>35</td>\n<td>左</td>\n</tr>\n</tbody></table>\n<p data-pid=\"X3oxNDR5\">对于方言中一字多音的情况，只取每个字在该方言的第一个读音，由于语保的数据格式规范，实际通过字 ID 做了字级别的对齐，而且往往把白读排在文读的前面，这样简单处理对结果的影响较小。</p>\n<h2>相似度结果</h2>\n<h3>条件熵</h3>\n<p data-pid=\"veZ0ke6s\">对上述方言两两一对使用上述卡方统计计算相似性，得到1278 × 1278的相似度矩阵和距离矩阵。对归一化的相似度矩阵分别使用 SVD、spectral embedding 和 t-SNE 降维，结果如下图所示，方言点在图中的距离越近表示越相似。 </p>\n<figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-2c3a683c07413ab97eb3e1d019b6a148_b.jpg\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"371\" class=\"origin_image zh-lightbox-thumb\" width=\"1157\" data-original=\"https://pic1.zhimg.com/v2-2c3a683c07413ab97eb3e1d019b6a148_r.jpg\"><figcaption>汉语方言条件熵降维散点图</figcaption></figure><p data-pid=\"eNO29786\">下图是从中抽样100个方言点的距离矩阵热度图。 </p>\n<figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-727ed73588f2633cd7beee142632d090_b.jpg\" data-size=\"normal\" data-rawwidth=\"1196\" data-rawheight=\"1161\" class=\"origin_image zh-lightbox-thumb\" width=\"1196\" data-original=\"https://pic1.zhimg.com/v2-727ed73588f2633cd7beee142632d090_r.jpg\"><figcaption>抽样100方言条件熵相似度距离热度图</figcaption></figure><p data-pid=\"4jwUZjaI\">把上述 spectral embedding 降维的结果映射到 CIE L*a*b 色度，然后标注在地图上，就得到方言相似度地图，方言点的颜色越接近表示越相似。 </p>\n<figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-c4bbbe4053791ae18fdcc29cb79e022d_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"825\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic2.zhimg.com/v2-c4bbbe4053791ae18fdcc29cb79e022d_r.jpg\"><figcaption>汉语方言相似度地图条件熵</figcaption></figure><h3>卡方相似度</h3>\n<figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-ab70c6129185ea4f3da70ed36d7146e3_b.jpg\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"371\" class=\"origin_image zh-lightbox-thumb\" width=\"1157\" data-original=\"https://pic4.zhimg.com/v2-ab70c6129185ea4f3da70ed36d7146e3_r.jpg\"><figcaption>汉语方言卡方相似度降维散点图</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-496f035aa4f11cda87e807816351822b_b.jpg\" data-size=\"normal\" data-rawwidth=\"1191\" data-rawheight=\"1161\" class=\"origin_image zh-lightbox-thumb\" width=\"1191\" data-original=\"https://pic4.zhimg.com/v2-496f035aa4f11cda87e807816351822b_r.jpg\"><figcaption>抽样100方言卡方距离热度图</figcaption></figure><h2>方言聚类</h2>\n<p data-pid=\"2rz_bv3c\">得到方言点之间的相似度或距离矩阵之后，就可以对该矩阵实施各种聚类算法。由于矩阵不代表方言点在欧氏空间中的位置，因此常用的 K-means 算法不适用。但是可以把该矩阵看成图的邻接矩阵，因此可以应用各种针对图的聚类算法。</p>\n<p data-pid=\"uSocjJA9\">下文主要描述根据条件熵计算的聚类结果，只在结果差异较大的时候，适当补充一些根据卡方相似度聚类的结果。需要说明的是，统计的方法受数据扰动影响较大，由于对原始方言读音数据进行了一次较大的清洗修正，部分聚类的结果对比之前放出的版本有较大不同。</p>\n<h3>条件熵</h3>\n<h3>AP 聚类</h3>\n<p data-pid=\"V7AsByei\">首先尝试对原始的相似度矩阵实施 <b>AP 聚类（affinity propagation）</b>，但效果不理想，结果就不放出来了。</p>\n<h3>谱聚类</h3>\n<p data-pid=\"OrHqmcME\"><b>谱聚类（spectral clustering）</b> 的思想是先把相似度矩阵表示的样本间相似度分解到低维的向量空间，再针对降维后的样本应用 K-means 等基于样本坐标的聚类算法。 使用归一化的相似度矩阵进行谱聚类，设置聚类数量为10，所得结果在不同的降维方法下表示如下图。 </p>\n<figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-7f3d61125634d1dcd04527dbac340a19_b.jpg\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"371\" class=\"origin_image zh-lightbox-thumb\" width=\"1157\" data-original=\"https://pic2.zhimg.com/v2-7f3d61125634d1dcd04527dbac340a19_r.jpg\"><figcaption>汉语方言谱聚类降维散点图条件熵10类</figcaption></figure><p data-pid=\"0QRyQlDP\">聚类的结果在地图上的分布如下图。 </p>\n<figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-35858ab8ed536a0963a1419eb4d87bb4_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"825\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic1.zhimg.com/v2-35858ab8ed536a0963a1419eb4d87bb4_r.jpg\"><figcaption>汉语方言谱聚类地图条件熵10类</figcaption></figure><p data-pid=\"fZfA-TUV\">从图中可以看到，聚类的结果总体体现了主流意见对汉语方言的分类，几大方言区的边界大致都落在聚类的边界上。在划分方言区的同一层级也划分了官话的大区，一些边界也和主流的划分一致。所不同的有以下几点：</p>\n<ol>\n<li data-pid=\"OS8fLUbf\">雷琼闽语单独分为一类，其他闽语为另一类</li>\n<li data-pid=\"o3dB8VRr\">赣语和客家话合为一类</li>\n<li data-pid=\"Lh_cWOXr\">长江中游的湘语、一部分西南官话、一部分江淮官话、以及一部分赣语组成一个大类</li>\n<li data-pid=\"YjKQa3a-\">晋语从北方官话分出，但又和江淮官话合并了，少量应该是保留入声的西南官话也归这一类</li>\n<li data-pid=\"ZyxuXFDO\">北方官话分为两类，一类大致就是中原官话加蓝银官话，另一类包含了北京官话、东北官话、冀鲁官话和胶辽官话，但两类的边界不完全和传统分区重合</li>\n</ol>\n<p data-pid=\"FcooZCsD\">一些更细微的观察：</p>\n<ol>\n<li data-pid=\"N-QfkgCO\">无论桂南平话还是桂北平话都没有分立，归入粤语同一类</li>\n<li data-pid=\"MCCdjP-i\">湘南粤北土话大部分归入湘语一类，一部分归客家话，少数归粤语</li>\n<li data-pid=\"hqVJDEZ_\">通泰归北吴</li>\n</ol>\n<h3>层次聚类</h3>\n<p data-pid=\"HOogt5fN\">从传统观点来看，方言之间的亲缘关系是树状的，因此更适合使用层次聚类。<b>层次聚类（hierarchical clustering）</b> 每次按样本的距离和计算子树间距离的方法，取距离最小的两棵子树合并，直到所有样本合并为一类。由此生成的结果是树状图，树状图可以直观地表示出方言在什么层级被分开到不同的子树。层次聚类和树状图的不便之处是当方言数量很多的时候树状图会非常庞大，而且通常各个分支下面的方言数量会非常悬殊，不便于查看。</p>\n<p data-pid=\"S7cG6BlN\">需要注意的是层次聚类的结果不能直接等同于方言谱系树，层次聚类的依据是方言之间的距离而不是历史上的亲缘关系。虽然在计算方言相似度和距离时谨慎地消除了具体音值的影响，但方言音类相似度和亲缘关系之间的相关性还没经过严格检验，特别是存在方言接触产生的影响，使得相似度计算的结果和真实的亲缘关系不相称。因此在检验了具体方言的音类细节之前，层次聚类的结果只是作为参考。</p>\n<p data-pid=\"4Omz7z7A\">对距离矩阵实施层次聚类，最开始分出来的是湘西南、桂东北的一些很小的分支，以及零星的单点方言，第一次分离的大分支是闽语和非闽语。截取树状图的最根部如下图： </p>\n<figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-a73e4848ef234f1156c7b8d1088e65a9_b.jpg\" data-size=\"normal\" data-rawwidth=\"1152\" data-rawheight=\"1288\" class=\"origin_image zh-lightbox-thumb\" width=\"1152\" data-original=\"https://pic2.zhimg.com/v2-a73e4848ef234f1156c7b8d1088e65a9_r.jpg\"><figcaption>汉语方言树状图条件熵</figcaption></figure><p data-pid=\"LhKA8ALz\">较早区分闽语和非闽语这一点符合部分学者认为闽语和其他方言关系较远的观点。然后非闽语在分出了徽语等较小的分支之后，其主体部分分成了南北两大支，南支包含吴语、大部分赣语、客家话、粤语和平话，另一支则依次分出一小部分赣语、湘语、一小部分江淮官话，最终官话的主体和晋语，超过样本半数的方言点，全部挤在剩余的一个末端分支上。</p>\n<p data-pid=\"wlIxQ7xn\">下面是根据树状图分成64类的降维散点图和地图，在这个层级上，各大类大致沿着传统分区的边界划分，官话和晋语为一类，赣语、客家话、粤语、平话为一类，吴语为一类，而闽语已经细分到方言片一级了。</p>\n<figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-6af410ab13030f7b251626d1268fad7d_b.jpg\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"371\" class=\"origin_image zh-lightbox-thumb\" width=\"1157\" data-original=\"https://pic2.zhimg.com/v2-6af410ab13030f7b251626d1268fad7d_r.jpg\"><figcaption>汉语方言层次聚类降维散点图条件熵64类</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-d76ec49842d3bd8bf9d02b3a7b213cad_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"825\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic2.zhimg.com/v2-d76ec49842d3bd8bf9d02b3a7b213cad_r.jpg\"><figcaption>汉语方言层次聚类地图条件熵64类</figcaption></figure><p data-pid=\"WrYRudc5\">举其中方言数较少而分支比较丰富的闽语为例，下图是闽语方言之间的距离热度图： </p>\n<figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-62a9aadf9d45fde453672ebe306bf2f7_b.jpg\" data-size=\"normal\" data-rawwidth=\"1201\" data-rawheight=\"1161\" class=\"origin_image zh-lightbox-thumb\" width=\"1201\" data-original=\"https://pic4.zhimg.com/v2-62a9aadf9d45fde453672ebe306bf2f7_r.jpg\"><figcaption>汉语方言距离热度图条件熵闽语</figcaption></figure><p data-pid=\"ZAJWgbYl\"> 闽南语和闽东语分别构成了两个大聚类中心，闽南内部的潮汕、漳州又构成了次一级的中心。而内陆闽语和雷琼闽语虽然数量也不少，但是和其他闽语的距离较远，内部相互也不集中。</p>\n<p data-pid=\"ZrjJJk1O\">下面的树状图和聚类地图也反映了这种情况，在树状图上，雷琼闽语很早就分出来，然后依次是闽中和莆仙。剩余的主体分成闽南和闽东两大支，闽南语中比较大的子群有泉州和厦门、漳州、潮汕。较低层级的大子群大致对应了历史上大的行政中心，比如福州、泉州、漳州、潮州。</p>\n<figure data-size=\"normal\"><img src=\"https://pic2.zhimg.com/v2-7b4239a4537f87845ab9cb445972a0c9_b.jpg\" data-size=\"normal\" data-rawwidth=\"1152\" data-rawheight=\"1258\" class=\"origin_image zh-lightbox-thumb\" width=\"1152\" data-original=\"https://pic2.zhimg.com/v2-7b4239a4537f87845ab9cb445972a0c9_r.jpg\"><figcaption>汉语方言树状图条件熵闽语</figcaption></figure><p data-pid=\"TSs-iyIf\">下图是上述树状图分成10类的地图，可见在总的树状图较小的分支上，仍然表现出了马太效应，在其他闽语已经分得比较细碎的层级上，闽南、闽东和莆仙还没有从沿海闽语分出来。</p>\n<figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-1d074dc296d54f0788abce146e513da8_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"1071\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic1.zhimg.com/v2-1d074dc296d54f0788abce146e513da8_r.jpg\"><figcaption>汉语方言层次聚类地图条件熵闽语10类</figcaption></figure><p data-pid=\"vyq5tnIL\">再举规模较大的官话为例，官话的雏形分出来之后，又经过了很多层级的分化才显得比较均衡的样子，之前一直是一支独大。这时南方官话、北方官话、较早就单独分为一支的长江中游的官话、以及在不同层级分出来的几支晋语在树状图中才初具规模，而从树根到这些分支的共组已经经过了6次分化，每次分为10类。</p>\n<figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-51f2343f49cbc1e58d177613f3b395ab_b.jpg\" data-size=\"normal\" data-rawwidth=\"1152\" data-rawheight=\"1298\" class=\"origin_image zh-lightbox-thumb\" width=\"1152\" data-original=\"https://pic4.zhimg.com/v2-51f2343f49cbc1e58d177613f3b395ab_r.jpg\"><figcaption>汉语方言树状图条件熵官话</figcaption></figure><p data-pid=\"ukdOUSo8\">下图是在官话主体的树状图又往下一个层级分10类得到的地图，这样各类的数量才显得均衡一点。 </p>\n<figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-65788aeaa5931fe7f29c4b234b38b5f7_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"844\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic4.zhimg.com/v2-65788aeaa5931fe7f29c4b234b38b5f7_r.jpg\"><figcaption>汉语方言层次聚类地图条件熵官话10类</figcaption></figure><p data-pid=\"Y__62oAP\">江淮官话除一部分已经在早前分出以外，剩余的部分这时仍然和西南官话合为一类。北方除了一部分晋语已经先一步分出，剩余的晋语也在这一层分出为一类，胶辽官话也单独分为一类，剩余包括传统分区的北京官话、东北官话、冀鲁官话、胶辽官话、中原官话、兰银官话，在这个层级仍然合在一大类。值得一提的是，此后又经过了4次、总共11次分化，北京官话和东北官话才开始分离，按本文的相似度度量方法来看，传统分区在大区一级划分北京官话和东北官话确实过分苛细了。</p>\n<p data-pid=\"TBU4kya6\">最后是包含大多数南方汉语的一支，这一支作为一个整体较早从非闽语中分离，包括传统的吴语、大部分赣语、客家话、粤语和平话。下图是这一支的树状图：</p>\n<figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-8a1be18eb01ef09516841b1799ba8708_b.jpg\" data-size=\"normal\" data-rawwidth=\"1152\" data-rawheight=\"1258\" class=\"origin_image zh-lightbox-thumb\" width=\"1152\" data-original=\"https://pic1.zhimg.com/v2-8a1be18eb01ef09516841b1799ba8708_r.jpg\"><figcaption>汉语方言树状图条件熵吴赣客粤语</figcaption></figure><p data-pid=\"tcVatz8x\">虽然树状图显示从这一支分离的顺序依次为吴语、粤语，最后是赣语和客家话，但它们分离的节点非常接近，可以认为是相互非常独立的分支。。粤语首先分出粤北的零星方言点和桂北平话，然后是四邑片，剩余的主体部分分成两支，一支是桂南平话和部分勾漏片，另一支包括大部分狭义的粤语。客家话首先分出四川、重庆等地的方言岛，然后是江西、福建的几支本地客家话，然后是东江本地话，剩余的部分其主要分支即为核心客家话。</p>\n<p data-pid=\"AB-oj-6S\">根据树状图分10类得到的地图反映出吴、赣客、粤平三分的情况。</p>\n<figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-1713a71b29d4238a07ca62de026e142a_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"951\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic3.zhimg.com/v2-1713a71b29d4238a07ca62de026e142a_r.jpg\"><figcaption>汉语方言层次聚类地图条件熵吴赣客粤语10类</figcaption></figure><h3>卡方相似度</h3>\n<h3>谱聚类</h3>\n<p data-pid=\"gyQ5SYIj\">使用卡方相似度进行谱聚类的结果如下图：</p>\n<figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-61ae0bf7c3a95f1971efde5e82c6c792_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"825\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic3.zhimg.com/v2-61ae0bf7c3a95f1971efde5e82c6c792_r.jpg\"><figcaption>汉语方言谱聚类地图卡方10类</figcaption></figure><p data-pid=\"i5H0kHXh\">和条件熵差别较大的地方有如下几点：</p>\n<ol>\n<li data-pid=\"fcXwgKfu\">北方官话和晋语合在一起分两大类，西边的一类包括晋语、中原官话西边的部分、和兰银官话，东边的一类包括北京官话、东北官话、冀鲁官话、胶辽官话、和中原官话东边的部分。</li>\n<li data-pid=\"cfCku3ob\">赣语、湘语、以及长江中游的一部分官话合并成了一个大类。</li>\n</ol>\n<h3>层次聚类</h3>\n<p data-pid=\"w1qWFtFL\">使用卡方距离的层次聚类倒是把沿海闽语和内陆闽语都归在了一类，但内陆闽语仍然非常早就和沿海闽语分开，紧接着分出的是雷琼闽语。从距离热度图也可以看出，这两类和其他闽语的相似度非常低。</p>\n<figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-0c1ee6cf30463b125e176d137baa79ee_b.jpg\" data-size=\"normal\" data-rawwidth=\"1191\" data-rawheight=\"1161\" class=\"origin_image zh-lightbox-thumb\" width=\"1191\" data-original=\"https://pic3.zhimg.com/v2-0c1ee6cf30463b125e176d137baa79ee_r.jpg\"><figcaption>汉语方言距离热度图卡方闽语</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic4.zhimg.com/v2-dd971f1f6161e27a0d399082e88ab497_b.jpg\" data-size=\"normal\" data-rawwidth=\"1157\" data-rawheight=\"1258\" class=\"origin_image zh-lightbox-thumb\" width=\"1157\" data-original=\"https://pic4.zhimg.com/v2-dd971f1f6161e27a0d399082e88ab497_r.jpg\"><figcaption>汉语方言树状图卡方闽语</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-0c1ee6cf30463b125e176d137baa79ee_b.jpg\" data-size=\"normal\" data-rawwidth=\"1191\" data-rawheight=\"1161\" class=\"origin_image zh-lightbox-thumb\" width=\"1191\" data-original=\"https://pic3.zhimg.com/v2-0c1ee6cf30463b125e176d137baa79ee_r.jpg\"><figcaption>汉语方言层次聚类地图卡方闽语10类</figcaption></figure><p data-pid=\"dU23Xh4A\">官话上的层次聚类结果和条件熵差别较大，胶辽官话最先分出，然后是西北地区的一部分兰银官话。除此以外，在如下地图的层级上，剩余的北方官话更早地分成了东西两大类，而南方官话还是合而不分。</p>\n<figure data-size=\"normal\"><img src=\"https://pic3.zhimg.com/v2-53dddb6eb6c1419b4ed5c799a666398e_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"1298\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic3.zhimg.com/v2-53dddb6eb6c1419b4ed5c799a666398e_r.jpg\"><figcaption>汉语方言树状图卡方官话</figcaption></figure><figure data-size=\"normal\"><img src=\"https://pic1.zhimg.com/v2-162db12e91c4e0184ff80a786e8e49cc_b.jpg\" data-size=\"normal\" data-rawwidth=\"1147\" data-rawheight=\"758\" class=\"origin_image zh-lightbox-thumb\" width=\"1147\" data-original=\"https://pic1.zhimg.com/v2-162db12e91c4e0184ff80a786e8e49cc_r.jpg\"><figcaption>汉语方言层次聚类地图卡方官话10类</figcaption></figure><h2>不足及改进</h2>\n<h3>相似度计算的不足</h3>\n<p data-pid=\"7hkbcilX\">在计算方言之间相似度的时候，为了平衡数据准确性和平滑性，做了很多琐碎的处理，这些处理还没有得到严格的证明。更好的办法是找到平滑的、最好是参数化的方法来估计 <img src=\"https://www.zhihu.com/equation?tex=P%28s_b%7Cs_a%29\" alt=\"P(s_b|s_a)\" eeimg=\"1\"> ，但是这样通常会增加计算方言对的耗时。</p>\n<p data-pid=\"VfMZIcCN\">在计算 <img src=\"https://www.zhihu.com/equation?tex=P%28s_b%7Cs_a%29\" alt=\"P(s_b|s_a)\" eeimg=\"1\"> 时假设每个字的出现是等概率的，或者说每条样本对期望的贡献一样大，实际情况不是这样的。特别是在对比不同来源的材料时，不同材料调查记录的字集可能会很不同，是否包含数量较多的非常用字会对统计结果有较大影响。处理这个问题的困难在于，反映方言用字频率的语料非常稀缺。另一方面，在统计两个方言相似度时，应该怎样折合两个方言的字频呢？</p>\n<p data-pid=\"hdaDlq-h\">文章开头已经提到了字音对齐的困难，即确定 a 方言的某个字某个音对应 b 方言的哪个字哪个音不是一件显而易见的事情，这个问题不仅出现在一字多音的情况，而且出现在有音无字、或者不同方言用了不同俗字借字的情况。在进行词汇级别的对比的时候就更是如此。本文通过简单地取每个字的第一个读音回避了这个问题。改进思路是采用迭代的方法启发式地寻找跨方言的字音对应，这是一项庞大的工作，做完这一步，所有方言的音变规律基本也都找到了。</p>\n<h3>聚类的不足</h3>\n<p data-pid=\"yAoEKPsE\">上文已经指出聚类的结果不能等同于方言历史上的发生关系，但是仍然希望聚类的结果对方言谱系树有一定的启示。当前的方法无论从理论还是从聚类结果显示的一些情况来说，对这方面的支持还很欠缺。</p>\n<p data-pid=\"oOvGSI5b\">本文使用的聚类方法只是沿用了常规算法对距离的简单处理，并没有对方言的生成过程建模。方言相似并不等于同源，在分析方言谱系的时候，一些方面的区别比另一些更加核心和本质，这些因素不一定能通过总体的相似度表现出来。例如罗杰瑞在《What is a Kejia Dialect?》中深有见地地指出，客家话鼻流音调类两分，可以和闽语的表现关联，应能追溯到共同祖语的清鼻流音。凭这一点，客家话应该很早就和赣语分开。但是这个特征体现的字不够多，被其他大量客家话和赣语的共同点所掩盖，其结果是谱聚类把赣语和客家话分了在一类。</p>\n<p data-pid=\"TaFBm59m\">方言音类相似也可能是由共同存古造成的，另一方面，由于语言接触引起的共同创新，和较小概率的音变巧合，音类相似在反映共同创新上也不太可靠。上面谱聚类的结果把晋语和江淮官话归为一类，可能就是因为它们都存古保存了入声，并且在入声韵、调的简并方面巧合了。层次聚类在处理晋语和官话的关系的时候，把通常认为的晋语分了三大批次从官话中分离出来，而不是作为一个整体一次分出，可能就是因为接触趋同影响了方言之间的相似性，而不是因为通常认为的晋语在来源上真的不统一。</p>\n<p data-pid=\"UO7cNX7C\">反之当语言接触引起的借用深到一定程度，会造成边界位置的方言距两边的距离都较远，从而被层次聚类错误地安排在较顶层的分支。层次聚类最开始分出来的都是湘桂交界一带的方言，每支都只有一两个点，很难说每个方言都古老且独立，也可能是周边的方言以各种不同的方式借用混合，从而产生了多种多样和周边都不同的方言。</p>\n<h3>改进方向</h3>\n<p data-pid=\"lVLIRZp4\">本文度量方言相似度的方法只考虑了音类，音类在方言比较上很重要，但有时对比音值的相似性也是有意义的。鉴于音标代表的音值是离散值不便度量相似度或距离，因此首先要建立把音值映射到连续空间的方法。我在<a href=\"https://zhuanlan.zhihu.com/p/349689590\" class=\"internal\">基于自编码器的方言祖语音系嵌入</a>中提出了一种音系 embedding 的方法，实际上，考虑音值的语音学特征，应该能得到更有代表性的方法。获得了音值的连续表示之后，度量方言之间音值的距离，以及根据音值距离聚类，可以参考上面的方法修改而来。</p>\n<p data-pid=\"1YTE7h2z\">另一个方向是方言音类的连续表示。本文用非参数化的方法构造了方言之间的相似度矩阵 <img src=\"https://www.zhihu.com/equation?tex=S\" alt=\"S\" eeimg=\"1\"> ，即隐含假设了一个方言音类的连续空间</p>\n<p data-pid=\"te72pVDz\"><img src=\"https://www.zhihu.com/equation?tex=D+D%5ET+%3D+S+%5C%5C\" alt=\"D D^T = S \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"8imZkaHj\">方言音类矩阵 <img src=\"https://www.zhihu.com/equation?tex=D\" alt=\"D\" eeimg=\"1\"> 的行数为方言点数，每一行为该方言在连续空间的向量表示。SVD 降维结果是这个音类矩阵在低维的投影，spectral embedding 则是另一种非线性变换的投影。既然字和方言点分别是字音矩阵的行和列，既然字的 embedding 是可行的，那么方言点的参数化 embedding 应该也是可行的。经过细致设计和训练，应该能找到一个非线性的矩阵分解映射函数 <img src=\"https://www.zhihu.com/equation?tex=f\" alt=\"f\" eeimg=\"1\"> ，以及最优的字矩阵 <img src=\"https://www.zhihu.com/equation?tex=C\" alt=\"C\" eeimg=\"1\"> 、方言矩阵 <img src=\"https://www.zhihu.com/equation?tex=D\" alt=\"D\" eeimg=\"1\"> ，使得</p>\n<p data-pid=\"wnGEOzGJ\"><img src=\"https://www.zhihu.com/equation?tex=+f%28c_i%2C+d_j%29+%3D+s_%7Bij%7D+%5C%5C\" alt=\" f(c_i, d_j) = s_{ij} \\\\\" eeimg=\"1\"></p>\n<p data-pid=\"jZo2cpRm\">即通过字 embedding 和 方言 embedding 最大限度地还原字音矩阵。幸运的话，字 embedding <img src=\"https://www.zhihu.com/equation?tex=c\" alt=\"c\" eeimg=\"1\"> 能表征字的相似度，方言 embedding <img src=\"https://www.zhihu.com/equation?tex=d\" alt=\"d\" eeimg=\"1\"> 能表征方言的相似度，那么， <img src=\"https://www.zhihu.com/equation?tex=c\" alt=\"c\" eeimg=\"1\"> 和 <img src=\"https://www.zhihu.com/equation?tex=d\" alt=\"d\" eeimg=\"1\"> 就可以直接拿来比较和聚类。</p>\n<p data-pid=\"IJn9CBAN\">另一个考虑的角度是相似度矩阵构成了一个图的邻接矩阵，原始的相似度对应于有向图，规范化的相似度对应于无向图。在此基础上可以尝试各种图算法，特别是把图的顶点或子图映射到连续空间的<b>图嵌入（graph embedding）</b>算法。</p>\n<h2>代码</h2>\n<p data-pid=\"Yt_gNCgO\">代码托管在 GitHub，也备份了一份在 Gitee。所有分析过程和图表都在其中的 Jupyter notebook，由于部分算法的随机性，更新后的 notebook 内容主要是地图配色和本文有细微差别，但本质是一样的。</p>\n<ul>\n<li data-pid=\"V3uOm023\"><a href=\"https://link.zhihu.com/?target=https%3A//github.com/lernanto/sinetym/blob/master/scripts/zhongguoyuyan/dialect_cluster.ipynb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">sinetym/dialect_cluster.ipynb at master · lernanto/sinetym (github.com)</a></li>\n<li data-pid=\"u8Ku7Y0b\"><a href=\"https://link.zhihu.com/?target=https%3A//gitee.com/lernanto/sinetym/blob/master/scripts/zhongguoyuyan/dialect_cluster.ipynb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\">scripts/zhongguoyuyan/dialect_cluster.ipynb · 黄艺华/sinetym - 码云 - 开源中国 (gitee.com)</a></li>\n</ul>\n<br><br>\n来源：知乎 www.zhihu.com<br>\n    \n作者：<a href=\"http://www.zhihu.com/people/huang-yi-hua-74?utm_campaign=rss&amp;utm_medium=rss&amp;utm_source=rss&amp;utm_content=author\">黄艺华</a><br><br>\n【知乎日报】千万用户的选择，做朋友圈里的新鲜事分享大牛。\n        <a href=\"http://daily.zhihu.com/?utm_source=rssyanwenzi&amp;utm_campaign=tuijian&amp;utm_medium=rssnormal\" target=\"_blank\">点击下载</a><br>\n","link":"http://zhuanlan.zhihu.com/p/464735745?utm_campaign=rss&utm_medium=rss&utm_source=rss&utm_content=title"},{"title":"创建自己的第一个 Power Automate 工作流，从此繁琐操作是路人","date":"2022-07-05 10:44:47","description":"\n<p>[......]</p>\n<a href=\"https://sspai.com/post/73710\" target=\"_blank\">查看全文</a><p>本文为付费栏目文章，出自<a href=\"https://sspai.com/series/273\" target=\"_blank\">《59 分钟就上手 Power Automate Desktop》</a>，订阅后可阅读全文。</p>\n","link":"https://sspai.com/post/73710"},{"title":"优化博客的累计布局偏移（CLS）问题","date":"2022-06-07 17:24:00","description":"\n<p>距离上一篇文章发布已有四个月了，是时候写几篇文章给博客除草了。上一次我介绍了我如何迁移、重构了我的博客的架构，这次我想来谈谈我在重构中优化和打磨访客体验时解决的一个问题。我的博客优化之旅 图片 lazyload 的学问和在 Hexo 上的最佳实践 我的博客有多快？ 天下武功，唯快不破 —— 我是这样优化博客的 再快一点，再快一点 ......</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/206311/26/14625/38940/629f7f81Eb11312de/b1e67f07b1cc9bc7.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/fix-blog-cls/\">https://blog.skk.moe/post/fix-blog-cls/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/fix-blog-cls/"},{"title":"使用 Next.js + Hexo 重构我的博客","date":"2022-03-17 16:24:00","description":"\n<p>在咕咕了一整年、只发布了三篇文章（其中两篇还是译文）之后，我决定还是稍微花一点时间好好折腾一下自己的博客，以 React 作为抓手，通过 Next.js 和 Hexo 深度共建，对标 Gatsby，打通静态 HTML 与用户交互之间的垂直领域屏障，实现多维矩阵闭环，为个人博客赋能（咳咳咳），然后水出 2022 年第一篇文章（逃）技术选型：Gatsby vs Next.js我使用 Hexo 驱动博客已经三年之久了，之前写过一个 开源的 Hexo 主题，后来还成为了 Hexo 的 Core Team Member、为 Hexo 贡献了不少代码。Hexo 是一个诞生于 2012 年的、由 Node.j......</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/218492/18/14257/25439/6227858fE1517791d/63119f6e39dc9389.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/use-nextjs-and-hexo-to-rebuild-my-blog/\">https://blog.skk.moe/post/use-nextjs-and-hexo-to-rebuild-my-blog/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/use-nextjs-and-hexo-to-rebuild-my-blog/"},{"title":"在 Windows 上快速安装 Hexo · 安装 Node.js","date":"2022-01-14 10:30:00","description":"\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%89%8D%E8%A8%80\" class=\"headerlink\" title=\"前言\"></a>前言</h2>\n<p><strong>本文未经允许，禁止转载！</strong></p>\n<p><strong>视频教程正在制作，等待更新。</strong></p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95\" class=\"headerlink\" title=\"文章目录\"></a>文章目录</h2>\n<ul>\n<li><a href=\"https://blog.yfun.top/posts/hexo-blog/install-git\">安装 Git</a></li>\n<li><a href=\"https://blog.yfun.top/posts/hexo-blog/install-nodejs\">安装 Node.js</a></li>\n</ul>\n<blockquote><p>更多文章等待更新...</p></blockquote>\n<h2>\n<a href=\"https://blog.yfun.top/#%E4%B8%8B%E8%BD%BD\" class=\"headerlink\" title=\"下载\"></a>下载</h2>\n<p>前往 Node.js 官网 (<a href=\"https://node.js.org/\">https://node.js.org</a>)</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/image-20220114174925675.png\" alt=\"image-20220114174925675\"></p>\n<p>下载 Node.js 安装包（推荐下载 LTS 版本）</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114175645.png\" alt=\"image-20220114175645642\"></p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%AE%89%E8%A3%85\" class=\"headerlink\" title=\"安装\"></a>安装</h2>\n<p>双击运行安装文件。</p>\n<p>点击 <code>Next</code>。</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114175750.png\" alt=\"image-20220114175749822\"></p>\n<p>勾选同意协议，点击 <code>Next</code>。</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114175835.png\" alt=\"image-20220114175835742\"></p>\n<p>修改文件安装位置，点击 <code>Next</code>。（也可以不用改）</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114175929.png\" alt=\"image-20220114175929226\"></p>\n<p>点击 <code>Next</code>。</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114180010.png\" alt=\"image-20220114180010036\"></p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114180044.png\" alt=\"image-20220114180043895\"></p>\n<p>点击 <code>Install</code> 开始安装。</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114180108.png\" alt=\"image-20220114180107827\"></p>\n<p>等待安装完成。<img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114180122.png\" alt=\"image-20220114180122728\"></p>\n<p>点击 <code>Finish</code> 完成安装。</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114180206.png\" alt=\"image-20220114180206024\"></p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E6%B5%8B%E8%AF%95\" class=\"headerlink\" title=\"测试\"></a>测试</h2>\n<p>打开 <code>Git Bash</code>.</p>\n<blockquote><p>在文件夹处右击，点击 <code>Git Bash Here</code> 进入 Git Bash。<br>或是在开始菜单中找到 Git Bash.</p></blockquote>\n<p>输入 <code>node -v</code> 和 <code>npm -v</code> 查看版本，正确输出版本信息即代表安装成功。</p>\n<p><img src=\"https://unpkg.zhimg.com/ocoke-osg@0.0.14/rawimg/20220114180458.png\" alt=\"image-20220114180458685\"></p>\n","link":"https://blog.yfun.top/posts/hexo-blog/install-nodejs/"},{"title":"2022: 新年快乐！","date":"2021-12-31 16:00:00","description":"\n<p>转眼间，2021 年已经过去。这一年非常忙碌，以至于博客一周年的纪念来不及写，许多文章计划停留在了 To Do 里。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%8D%9A%E5%AE%A2\" class=\"headerlink\" title=\"博客\"></a>博客</h2>\n<p>由于 Cloudflare Web Analytics 是在 2021 年 4 月份启用的，再加上后来又将统计代码去除，所以关于访问量的信息不可用。</p>\n<p>截止至 2021 年 12 月 31 日，博客共发布 15 篇文章，其中 2021 年发布 11 篇文章，原创文章 10 篇。</p>\n<p>目前采用 <code>LeanCloud + Waline</code> 的评论方式，自 7 月份被刷评论后将评论权限改为登录（支持 <code>GitHub</code> 登录），还有部分评论在迁移中丢失，实在抱歉。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E4%B8%BB%E9%A2%98\" class=\"headerlink\" title=\"主题\"></a>主题</h2>\n<p>博客自 2021 年 1 月 13 日将主题改为 <code>Miracle</code>，这是一款简洁、轻量的单栏 Hexo 主题。</p>\n<p><code>Miralce</code> 目前的版本是 <code>2.0.1</code>，全新的版本去除 jQuery，进一步提升性能。</p>\n<p>GitHub 仓库：<a href=\"https://github.com/hifun-team/hexo-theme-miracle\">https://github.com/hifun-team/hexo-theme-miracle</a></p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E6%9B%B4%E5%A4%9A\" class=\"headerlink\" title=\"更多\"></a>更多</h2>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">=&gt; ...</span><br></pre></td></tr></table></figure>\n","link":"https://blog.yfun.top/posts/2022/"},{"title":"无垠 2021 年度总结","date":"2021-12-31 08:36:10","description":"\n<p>真是忙碌的一年啊。转眼 2021 已经过去，2022 即将到来。又到了该总结这一年的时候了。</p>\n<h1>统计数据</h1>\n<p>年度总结的第一部分仍然是一些统计数据。以下数据截止 2021 年 12 月 29 日 23:39:59。</p>\n<h2>博客主站</h2>\n<p>无垠博客主站，年 UV 29,073 (<span>+0.6%</span>)，年 PV 67,688 (<span>-11.61%</span>)，日均 UV 79.65，平均停留时间 3分34秒 (<span>-13.7%</span>)，平均跳出率 55% (<span>-9.8%</span>)。一年有效文章数 1 (<span>-80%</span>)，新增评论 109 条 (<span>-54.96%</span>)。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/blog.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/blog.jpg\" alt=\"\" width=\"515\" height=\"620\" class=\"aligncenter size-full wp-image-2537\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/blog.jpg 515w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/blog-249x300.jpg 249w\" sizes=\"(max-width: 515px) 100vw, 515px\"></a>\n<p>除了 UV 较去年提高 100 多之外，其他数据全部下滑。主要原因还是因为今年实在太过忙碌，只更新了一篇博客，评论区也没有怎么维护。不过目前已经有两篇新的文章在路上了，希望可以尽快写完吧。</p>\n<h2>个人主页</h2>\n<p>个人页总 UV 3,515 (<span>-18.12%</span>)，总 PV 3,929 (<span>-4.56%</span>)，日均 UV 9.63，平均停留时间 55秒 (<span>-12.7%</span>)。访问的主要来源是知乎和 GitHub。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/axton.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/axton.jpg\" alt=\"\" width=\"515\" height=\"647\" class=\"aligncenter size-full wp-image-2538\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/axton.jpg 515w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/axton-239x300.jpg 239w\" sizes=\"(max-width: 515px) 100vw, 515px\"></a>\n<p>仍然是没有更新个人主页的一年，我也没有继续宣传这个页面，统计数据下滑大概是正常的。</p>\n<h2>MDx</h2>\n<p>一年中，MDx 更新了 4 次，新增 149 commits (<span>-54.57%</span>)，Star 数增加了 174，现有 788。</p>\n<p>终于，MDx 2.0 发布了。但是因为今年的过于忙碌，MDx 并没有得到足够的维护，版本发布周期也拉得比较长，很多 Bug 没能及时修复。希望明年可以把更多的时间花在维护 MDx 上。无论如何，还是感谢各位对于 MDx 的支持！</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"yrccondor\" data-mdxgithubp=\"mdx\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/yrccondor/mdx\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<h1>2021 大事记</h1>\n<p>说起来，2021 真的太多“第一次”了...</p>\n<ul>\n<li>一月：由于电脑电池鼓包，第一次用 iPad 外接屏幕远程桌面到服务器来考期末🌚太痛苦了</li>\n<li>一月：MDx 喜提 600 Stars</li>\n<li>三月：第一次测核酸（真的酸）</li>\n<li>三月：第一次坐上 A350！(B-309W）</li>\n<li>三月：第一次来到英国</li>\n<li>六月：第一次来到伦敦</li>\n<li>六月：第一次去猫咖撸猫🐱</li>\n<li>六月：第一次坐上 B777！(B-2025）</li>\n<li>七月：酒店隔离十四天🌚</li>\n<li>七月：MDx 喜提 700 Stars</li>\n<li>七月：第一次和猫一起住（时刻有猫撸真的爽😆）</li>\n<li>七月：入职<a href=\"https://75.team/\">奇舞团</a>实习</li>\n<li>八月：北京景点怎么这么多</li>\n<li>九月：北京景点怎么还有这么多</li>\n<li>九月：<a href=\"https://flyhigher.top/develop/2160.html\">谈谈 WebAuthn</a> 被 <a href=\"https://weibo.com/1893751011/KyipM3tOM\" rel=\"noopener noreferrer\">w3c中国微博转发</a><del>（虽然并没有人看）</del>\n</li>\n<li>九月：从奇舞团<del>跑路</del>\n</li>\n<li>九月：整了个 Stackoverflow 的复制粘贴键盘<del>，太好用了</del>\n</li>\n<li>十月：终于买了心心念念的 MSFS</li>\n<li>十一月：终于买了一台新相机</li>\n<li>十一月：第一次坐上 A380！(B-6140）</li>\n<li>十二月：第一次来到爱丁堡并和 <a href=\"https://diygod.me/\">@DIYgod</a> 面基</li>\n</ul>\n<section><div class=\"set-images-div\">\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cats.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cats.jpg\" alt=\"和猫一起住的唯一问题就是手机很快会被猫片塞满\" width=\"730\" height=\"1500\" class=\"aligncenter size-full wp-image-2518\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cats.jpg 730w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cats-146x300.jpg 146w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cats-498x1024.jpg 498w\" sizes=\"(max-width: 730px) 100vw, 730px\"></a><br><a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cat.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cat.jpg\" alt=\"看到你在写前端，猫猫很担心你\" width=\"1004\" height=\"1500\" class=\"aligncenter size-full wp-image-2523\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cat.jpg 1004w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cat-201x300.jpg 201w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cat-685x1024.jpg 685w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cat-768x1147.jpg 768w\" sizes=\"(max-width: 1004px) 100vw, 1004px\"></a><br><a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cv.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cv.jpg\" alt=\"高效开发工具（确信\" width=\"1500\" height=\"1019\" class=\"aligncenter size-full wp-image-2519\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/cv.jpg 1500w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cv-300x204.jpg 300w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cv-1024x696.jpg 1024w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/cv-768x522.jpg 768w\" sizes=\"(max-width: 1500px) 100vw, 1500px\"></a><br><a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/tt.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/tt.jpg\" alt=\"和 Ralph 在天坛\" width=\"947\" height=\"1500\" class=\"aligncenter size-full wp-image-2524\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/tt.jpg 947w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/tt-189x300.jpg 189w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/tt-646x1024.jpg 646w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/tt-768x1216.jpg 768w\" sizes=\"(max-width: 947px) 100vw, 947px\"></a><br><a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/380.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/380.jpg\" alt=\"380!\" width=\"1500\" height=\"874\" class=\"aligncenter size-full wp-image-2517\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/380.jpg 1500w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/380-300x175.jpg 300w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/380-1024x597.jpg 1024w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/380-768x447.jpg 768w\" sizes=\"(max-width: 1500px) 100vw, 1500px\"></a>\n</div>\n<div class=\"set-images-div2\">\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/play2.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/play2.jpg\" alt=\"到处玩.jpg\" width=\"1500\" height=\"1080\" class=\"aligncenter size-full wp-image-2521\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/play2.jpg 1500w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/play2-300x216.jpg 300w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/play2-1024x737.jpg 1024w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/play2-768x553.jpg 768w\" sizes=\"(max-width: 1500px) 100vw, 1500px\"></a><br><a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/play.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/play.jpg\" alt=\"还是到处玩.jpg\" width=\"977\" height=\"1500\" class=\"aligncenter size-full wp-image-2520\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/play.jpg 977w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/play-195x300.jpg 195w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/play-667x1024.jpg 667w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/play-768x1179.jpg 768w\" sizes=\"(max-width: 977px) 100vw, 977px\"></a><br><a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/stars.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/stars.jpg\" alt=\"380 上的星空\" width=\"1002\" height=\"1500\" class=\"aligncenter size-full wp-image-2522\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/stars.jpg 1002w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/stars-200x300.jpg 200w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/stars-684x1024.jpg 684w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/stars-768x1150.jpg 768w\" sizes=\"(max-width: 1002px) 100vw, 1002px\"></a>\n</div>\n</section><p><span>点击图片查看描述</span></p>\n<p>对了，对于可爱的猫猫们，我整了一个 Telegram 贴纸包，你可以在这里获取：<a href=\"https://telegram.me/addstickers/huanAndDan\">https://telegram.me/addstickers/huanAndDan</a>。</p>\n<h1>跨年红包</h1>\n<p>今年的解题之旅，从下面这张图片开始：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/b.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/b.jpg\" alt=\"\" width=\"1510\" height=\"1250\" class=\"aligncenter size-full wp-image-2556\"></a>\n<p>不过，鉴于今年的题目较以往对于认真解题的人更难，我还准备了隐藏红包，在解题中收集线索即可发现隐藏红包。共有 20 个普通红包和 10 个隐藏红包。</p>\n<p>解题计划持续到东八区 2022.02.03 23:59:59 或红包被领完为止，之后我会发布题解。不过由于去年情况混乱，今年在解题过程中我一旦发现有不正常的现象就会立即停止活动。Anyway，新年快乐！祝玩得开心。</p>\n<h1>跨年海报</h1>\n<p>依然是传统艺能，今年的海报用到了 PS 和 Adobe 家的新玩具 Dimension。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1.jpg\" alt=\"\" width=\"707\" height=\"1000\" class=\"aligncenter size-full wp-image-2547\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1.jpg 1414w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1-212x300.jpg 212w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1-724x1024.jpg 724w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1-768x1086.jpg 768w, https://acdn.flyhigher.top/wp-content/uploads/2021/12/2022-in-post-1-1086x1536.jpg 1086w\" sizes=\"(max-width: 707px) 100vw, 707px\"></a>\n<p>那么祝各位新年快乐！</p>\n","link":"https://flyhigher.top/diary/2507.html"},{"title":"[译] 不，Web3 不是去中心化","date":"2021-12-14 14:01:00","description":"加密货币社区对元宇宙和 Web3 的狂热仍在继续，大量投资人和开发者前仆后继加入其中。但是，Web3 真的能实现支持者们的种种愿景吗？亦或是另一个镜中月、水中花？也许让历史照进现实，能给我们答案。<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/123139/11/24965/54827/62215eedE5e3da14a/80c24408e97057dd.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/web3-is-not-decentralization/\">https://blog.skk.moe/post/web3-is-not-decentralization/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/web3-is-not-decentralization/"},{"title":"[译] 捍卫自由的互联网，对 Web3 说不","date":"2021-12-12 13:40:00","description":"作为一个充满泡沫和噱头的新概念，Web3 和元宇宙在区块链的社区中掀起了一波浪潮。鼓吹者坚信 Web3 就是互联网的未来、不惜砸下大把的金钱和精力、希望能在未来中捞一杯羹；而大部分人保持观望的态度。是时候来一点 Web3 的反对意见了。<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/87908/13/23797/13415/622032afE3a2f9e9f/95c01e98cd4a707a.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/keep-web-free-say-no-to-web3/\">https://blog.skk.moe/post/keep-web-free-say-no-to-web3/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/keep-web-free-say-no-to-web3/"},{"title":"2021 年 JavaScript Promise 性能对比","date":"2021-12-07 08:19:00","description":"\n<p>我们正生活在一个「Any application that can be written in JavaScript, will eventually be written in JavaScript」的时代。作为一门兼具动态性和简单性的语言，JavaScript 已经占领了客户端、服务端，甚至在机器学习中也占据一席之地；不可避免的，异步执行也逐渐成为这门语言不可缺少的一部分。TL; DR Bluebird 依然是速度最快、内存占用最少的 Promise 实现 Runtime 的 async / await 实现越来越快、顺序执行的性能已经超过 Native Promise，占用的内存也更少 对于平行并发执行的 Promise，Bluebird 的性能依然一骑绝尘。......</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/157404/28/28495/143414/622032b2Ef7b495fd/6a9bd02e79392c9d.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/promise-performance-benchmark/\">https://blog.skk.moe/post/promise-performance-benchmark/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/promise-performance-benchmark/"},{"title":"在 Windows 上快速安装 Hexo · 安装 Git","date":"2021-11-12 13:30:00","description":"\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%89%8D%E8%A8%80\" class=\"headerlink\" title=\"前言\"></a>前言</h2>\n<p><strong>本文未经允许，禁止转载！</strong></p>\n<p><strong>视频教程正在制作，等待更新。</strong></p>\n<h3>\n<a href=\"https://blog.yfun.top/#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95\" class=\"headerlink\" title=\"文章目录\"></a>文章目录</h3>\n<ul><li><a href=\"https://blog.yfun.top/posts/hexo-blog/install-git\">安装 Git</a></li></ul>\n<blockquote><p>更多文章等待更新...</p></blockquote>\n<h2>\n<a href=\"https://blog.yfun.top/#%E4%B8%8B%E8%BD%BD\" class=\"headerlink\" title=\"下载\"></a>下载</h2>\n<p>前往 Git 官网 (<a href=\"https://git-scm.com/\">https://git-scm.com</a>).</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112204849.png\"></p>\n<p>点击页面中的 <code>Download For Windows</code> 下载 Windows 版本。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211507.png\"></p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%AE%89%E8%A3%85\" class=\"headerlink\" title=\"安装\"></a>安装</h2>\n<p>双击运行安装文件。</p>\n<p>点击 <code>Next</code>，同意协议。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211528.png\"></p>\n<p>修改程序安装位置，点击 <code>Next</code>（直接装在 C 盘也不是不行）。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211604.png\"></p>\n<p>组件选项，可选桌面快捷键、右键菜单、LFS 支持、自动检查更新等。</p>\n<p>点击 <code>Next</code> 进入下一步。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211609.png\"></p>\n<p>开始菜单文件夹名，保持默认就可以，点击 <code>Next</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211613.png\"></p>\n<p>默认编辑器，保持 Vim 就可以，点击 <code>Next</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211616.png\"></p>\n<p>环境变量，选择第 2 个，点击 <code>Next</code>。</p>\n<blockquote><p>如果选择第 1 个，则只能在 Git Bash 中使用，可能会出现问题</p></blockquote>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211619.png\"></p>\n<p>剩下的都可以保持默认，一路 Next，然后点击 <code>Install</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211622.png\"><br><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211624.png\"><br><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211627.png\"><br><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211630.png\"><br><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/20211112211633.png\"></p>\n<p>等待安装完毕。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E6%B5%8B%E8%AF%95\" class=\"headerlink\" title=\"测试\"></a>测试</h2>\n<p>在文件夹处右击，点击 <code>Git Bash Here</code> 进入 Git Bash。</p>\n<p>（或是在开始菜单中找到 Git Bash）</p>\n<p>输入 <code>git --version</code> 查看版本，正确输出版本信息即代表安装成功。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.11/rawimg/7ec315b7764cc.png\"></p>\n<p>大功告成！</p>\n","link":"https://blog.yfun.top/posts/hexo-blog/install-git/"},{"title":"前端时间国际化 101","date":"2021-10-14 15:58:23","description":"\n<blockquote>\n<p>时间只是幻觉。</p>\n<footer>—— 阿尔伯特·爱因斯坦</footer>\n</blockquote>\n<p>最近在开发一个需要完善国际化方案的前端项目，在处理时间国际化的时候遇到了一些问题。于是花了一些时间研究，有了这篇文章。不过由于网上关于 JavaScript 中 <code>Date</code> 对象的坑的文章已经一抓一大把了，<strong>因此这篇文章不是 JavaScript 中 <code>Date</code> 对象的使用指南，而是只专注于前端时间国际化。</strong></p>\n<h1>从时区说起</h1>\n<p>要想处理时间，UTC 是一个绕不开的名字。协调世界时（Coordinated Universal Time）是目前通用的世界时间标准，计时基于原子钟，但并不等于 TAI（国际原子时）。TAI 不计算闰秒，但 UTC 会不定期插入闰秒，因此 UTC 与 TAI 的差异正在不断扩大。UTC 也接近于 GMT（格林威治标准时间），但不完全等同。可能很多人都发现近几年 GMT 已经越来越少出现了，这是因为 GMT 计时基于地球自转，由于地球自转的不规则性且正在逐渐变慢，目前已经基本被 UTC 所取代了。</p>\n<blockquote><p>JavaScript 的 <code>Date</code> 实现不处理闰秒。实际上，由于闰秒增加的不可预测性，Unix/POSIX 时间戳完全不考虑闰秒。在闰秒发生时，Unix 时间戳会重复一秒。这也意味着，一个时间戳对应两个时间点是有可能发生的。</p></blockquote>\n<p>由于 UTC 是标准的，我们有时会使用 UTC+/-N 的方式表达一个时区。这很容易理解，但并不准确。中国通行的 <code>Asia/Shanghai</code> 时区<strong>大部分</strong>情况下可以用 UTC+8 表示，但英国通行的 <code>Europe/London</code> 时区并不能用一个 UTC+N 的方式表示——由于夏令时制度，<code>Europe/London</code> 在夏天等于 UTC+1，在冬天等于 UTC/GMT。</p>\n<blockquote><p>一个时区与 UTC 的偏移并不一定是整小时。如 <code>Asia/Yangon</code> 当前为 UTC+6:30，而 <code>Australia/Eucla</code> 目前拥有奇妙的 UTC+8:45 的偏移。</p></blockquote>\n<p>夏令时的存在表明<strong>时间的表示不是连续的</strong>，时区之间的时差也并不是固定的，我们并不能用固定时差来处理时间，这很容易意识到。但一个不容易意识到的点是，时区还包含了其历史变更信息。中国目前不实行夏令时制度，那我们就可以放心用 UTC+8 来表示中国的时区了吗？你可能已经注意到了上一段中描述 <code>Asia/Shanghai</code> 时区时我使用了<strong>大部分</strong>一词。<code>Asia/Shanghai</code> 时区在历史上实行过夏令时，因此 <code>Asia/Shanghai</code> 在部分时间段可以使用 UTC+9 来表示。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">new Date('1988-04-18 00:00:00')\r\n// Mon Apr 18 1988 00:00:00 GMT+0900 (中国夏令时间)</pre>\n<blockquote><p>夏令时已经够混乱了，但它实际上比你想象得更混乱——部分穆斯林国家一年有四次夏令时切换（进入斋月时夏令时会暂时取消），还有一些国家使用混沌的 15/30 分钟夏令时而非通常的一小时。</p></blockquote>\n<blockquote><p><strong>不要总是基于 <code>00:00</code> 来判断一天的开始。</strong>部分国家使用 0:00-1:00 切换夏令时，这意味着 23:59 的下一分钟有可能是 1:00。</p></blockquote>\n<p>事实上，虽然一天只有 24 个小时，但当前（2021.10）正在使用的时区有超过 300 个。<strong>每一个时区都包含了其特定的历史。</strong>虽然有些时区在现在看起来是一致的，但它们都包含了不同的历史。时区也会创造新的历史。由于政治、经济或其他原因，一些时区会调整它们与 UTC 的偏差（萨摩亚曾经从 UTC-10 切换到 UTC+14，导致该国 2011.12.30 整一天都消失了），或是启用/取消夏令时，甚至有可能导致一个时区重新划分为两个。因此，为了正确处理各个时区，我们需要一个数据库来存放时区变更信息。还好，已经有人帮我们做了这些工作。目前大多数 *nix 系统和大量开源项目都在使用 <a href=\"https://www.iana.org/time-zones\" rel=\"noopener\">IANA 维护的时区数据库</a>（IANA TZ Database），其中包含了自 Unix 时间戳 0 以来各时区的变更信息。当然这一数据库也包含了大量 Unix 时间戳 0 之前的时区变更信息，但并不能保证这些信息的准确性。IANA 时区数据库会定期更新，以反映新的时区变更和新发现的历史史实导致的时区历史变更。</p>\n<blockquote><p>Windows 不使用 IANA 时区数据库。微软为 Windows 自己维护了一套<a href=\"https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/system-management-components/daylight-saving-time-help-support\" rel=\"noopener\">时区数据库</a>，这有时会导致在一个系统上合法的时间在另一系统上不合法。</p></blockquote>\n<p>既然我们不能使用 UTC 偏移来表示一个时区，那就只能为每个时区定义一个标准名称。通常地，我们使用 <code>/</code> 来命名一个时区。这里的城市一般为该时区中人口最多的城市。于是，我们可以将中国的通行时区表示为 <code>Asia/Shanghai</code>。也有一些时区有自己的别名，如太平洋标准时间 <code>PST</code> 和协调世界时 <code>UTC</code>。</p>\n<blockquote><p>时区名称使用城市而非国家，是由于国家的变动通常比城市的变动要快得多。</p></blockquote>\n<blockquote><p><strong>城市不是时区的最小单位。</strong>有很多城市同时处于多个时区，甚至澳大利亚<a href=\"https://en.wikipedia.org/wiki/Gold_Coast_Airport\" rel=\"noopener\">有一个机场</a>的跑道两端处于不同的时区。</p></blockquote>\n<h1>处理时区困难重重</h1>\n<p>几个月前的一天，<a href=\"https://milkice.me/\" rel=\"noopener\">奶冰</a>在他的 Telegram 频道里发了这样的一条消息：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-1.jpg\"><img src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-1.jpg\" alt=\"奶冰频道的消息\" width=\"500\" class=\"aligncenter size-medium wp-image-2490\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-1.jpg 800w, https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-1-244x300.jpg 244w, https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-1-768x944.jpg 768w\" sizes=\"(max-width: 800px) 100vw, 800px\"></a>\n<p>你想的没错，这个问题正是由时区与 UTC 偏移的不同造成的。<code>Asia/Shanghai</code> 时区在 1940 年前后和 1986 年前后曾实行过夏令时，<strong>而夏令时的切换会导致一小时的出现和消失。</strong>具体来说，启用夏令时当天会有一个小时消失，如 2021.3.28 英国启用夏令时，1:00 直接跳到 3:00，导致 <code>2021-03-28 01:30:00</code> 在 <code>Europe/London</code> 时区中是不合法的；取消夏令时当天又会有一个小时重复，如 2021.10.31 英国取消夏令时，2:00 会重新跳回 1:00 一次，导致 <code>2021-10-31 01:30:00</code> 在 <code>Europe/London</code> 时区中对应了两个时间点。而在奶冰的例子中，<code>1988-04-10 00:46:50</code> 正好处于因夏令时启用而消失的一小时中，因此系统会认为此时间字符串不合法而拒绝解析。</p>\n<blockquote><p>你可能会注意到在历史上 1988.4.10 这一天 <code>Asia/Shanghai</code> 时区实际上是去掉了 1:00-2:00 这一小时而不是 0:00-1:00。上文问题更深层次的原因是，在 IANA TZDB 2018a 及更早版本中，IANA 因缺乏历史资料而设置了错误的夏令时规则，规则设定了夏令时交界于 0:00-1:00 从而导致上文问题发生。而随后社区<a href=\"http://mm.icann.org/pipermail/tz/2018-August/026760.html\" rel=\"noopener\">发现了更准确的史实</a>，因此 IANA 更新了数据库。上文的问题在更新了系统的时区数据库后便解决了。</p></blockquote>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2.jpg\" alt=\"IANA TZDB 2018a 及之前版本的错误数据\" width=\"1750\" height=\"595\" class=\"aligncenter size-full wp-image-2491\" srcset=\"https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2.jpg 1750w, https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2-300x102.jpg 300w, https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2-1024x348.jpg 1024w, https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2-768x261.jpg 768w, https://acdn.flyhigher.top/wp-content/uploads/2021/10/time-2-1536x522.jpg 1536w\" sizes=\"(max-width: 1750px) 100vw, 1750px\"></a>\n<p><span>IANA TZDB 2018a 及之前版本的错误数据</span></p>\n<p>再来考虑另一种情况。你的应用的某位巴西用户在 2018 年保存了一个未来时间 <code>2022-01-15 12:00</code>（按当时的规律那应该是个夏令时时间），不巧那时候你的应用是以格式化的时间字符串形式保存的时间。之后你发现巴西已经于 2019 年 4 月宣布彻底取消夏令时制度，那么 <code>2022-01-15 12:00</code> 这个时间对应的 Unix 时间戳发生了变化，变得不再准确，要正确处理这一字符串就需要参考这一字符串生成的时间（或生成时计算的 UTC 偏移）来做不同的处理。<strong>因此，应用从一开始就应该避免使用字符串来传输、存储时间，而是使用 Unix 时间戳。</strong>如果不得不使用字符串存储时间，请尽可能：</p>\n<ul>\n<li>使用 UTC 描述时间，你永远不会知道本地时区在未来会发生什么</li>\n<li>如果需要以当地时间描述时间，一定带上当前 UTC 偏移</li>\n</ul>\n<p>时区历史带来的问题往往意想不到而且远比想象得多。实际上时区历史数据非常详细而繁多且跨设备不一致，并没有简单而统一的处理方法。在需要严谨处理时区时可能需要在应用程序中内嵌一套各端统一的时区数据库，但这样的方案放在前端又会带来不少问题：</p>\n<ul>\n<li>体积过大。moment.js 曾经设计过<a href=\"https://github.com/moment/moment-timezone/blob/develop/data/packed/2021a.json\" rel=\"noopener\">一种简洁的 TZDB 表示</a>，但尽管已经尽可能压缩整个文件仍然达到了 180+KB。在性能优先的 Web 应用中这是不可接受的</li>\n<li>需要持续更新。时区数据一直在变动，需要在时区数据更新时尽快更新应用内的时区数据，这带来了额外的维护成本</li>\n</ul>\n<p>ES6 为我们带来了 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl\" rel=\"noopener\"><code>Intl</code> 命名空间</a>。在这里，JavaScript 运行时提供了不少时间相关的国际化能力。因此，在不使用额外数据的情况下准确处理时区是可能的，但这并不完美：</p>\n<ul>\n<li>各端不统一。浏览器提供的时区数据受浏览器版本、系统版本等可能变化，最新的时区更新可能无法快速反映到所有设备上</li>\n<li>实现复杂。<code>JavaScript</code> 中 <code>Date</code> 对象的不良设计导致实现完善的时区处理并不容易，且 <code>Intl</code> 命名空间下的对象实例化性能开销较大，需要额外优化</li>\n</ul>\n<blockquote><p><code>Intl</code> 命名空间下还有很多实用的国际化相关方法，值得我们另开一篇文章来讲讲了。</p></blockquote>\n<p>在真实开发中，这需要取舍。目前主流的 JavaScript 时间处理库都已转向浏览器内置方法，并在需要时通过 Polyfill 保证跨端一致性。在这篇文章中，我们将尝试在不使用第三方库的情况下实现基本的时间国际化处理。此外，还有一些诸如需要使用 Unix 时间戳才能正确地在各端交换时间等细节需要注意。</p>\n<h1>时区转换</h1>\n<p>JavaScript 中的 <code>Date</code> 并不是不包含时区信息——实际上，<code>Date</code> 对象表示的一定是当前时区。通过尝试：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">new Date('1970-01-01T00:00:00Z')\r\n// Thu Jan 01 1970 08:00:00 GMT+0800 (中国标准时间)</pre>\n<p>就可以知道，JavaScript 运行时其实知道当前时区，并会在需要的时候将其他时区的时间转换为当前时区的时间。那么，如何将本地时间转换为其他时区的时间呢？从 <code>Date</code> 的角度看，这并不行，因为我们无法设置一个 <code>Date</code> 对象的时区。但我们可以“投机取巧”：将 <code>Date</code> 对象的时间加上/减去对应的时差，尽管 <code>Date</code> 对象仍然认为自己在本地时区，但这样不就可以正确显示了嘛！但我们会碰到上文提到的问题：时区之间的时间差并不固定，在没有额外数据的情况下很难正确计算。</p>\n<p>还好，ES6 基于 <code>Intl</code> 命名空间扩展了 <code>Date.prototype.toLocaleString()</code> 方法，使其可以接受时区参数并按指定时区格式化时间。如果你在搜索引擎中搜索如何使用 JavaScript 转换时区，你大概率会在 StackOverflow 上找到类似这样的答案：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const convertTimeZone = (date, timeZone) =&gt; {\r\n    return new Date(date.toLocaleString('en-US', { timeZone }))\r\n}\r\n\r\nconst now = new Date() // Wed Oct 13 2021 01:00:00 GMT+0800 (中国标准时间)\r\nconvertTimeZone(now, 'Europe/London') // Tue Oct 12 2021 18:00:00 GMT+0800 (中国标准时间)</pre>\n<p>很好理解，我们使用 <code>en-US</code> 的区域设置要求 JavaScript 运行时以我们指定的时区格式化时间，再将时间字符串重新解析为时间对象。这里的 <code>timeZone</code> 就是诸如 <code>Asia/Shanghai</code> 等的 IANA TZDB 时区名称。这个字符串确实需要自己提供，但这就是我们唯一需要自己准备的数据了！只要提供了时区名称，浏览器就会自动计算正确的时间，无需我们自行计算。</p>\n<blockquote><p>对于时区名称，你可以考虑使用 <a href=\"https://github.com/vvo/tzdb/\" rel=\"noopener\">@vvo/tzdb</a>。这是一个声称为自动更新的 IANA TZDB 的 JSON 导出，并已被数个大型项目使用。你可以从这个包中导出所有时区名称。</p></blockquote>\n<p>这个方法看起来还不错，对吧？但实际上，它有两个问题：</p>\n<ul>\n<li>指定了区域设置和时区的 <code>toLocaleString()</code> 实际上每次调用都会在 JavaScript 运行时中创建新的 <code>Intl.DateTimeFormat</code> 对象（在后文详述），而后者会带来昂贵的性能开销（在 Node 14 中，实例化一次会在 V8 中增加内存使用约 46.3Kb。但这是符合预期的，详见 <a href=\"https://bugs.chromium.org/p/v8/issues/detail?id=6528\" rel=\"noopener\">V8 Issue</a>）。因此，在密集调用的情况下需要考虑计算并缓存时差，并在一定时间后或需要时进行更新</li>\n<li>使用 <code>toLocaleString()</code> 并使用 <code>en-US</code> 区域设置格式化的默认时间格式类似于 <code>10/13/2021, 1:00:00 AM</code>。这可以被大部分浏览器正确解析，<strong>但这是不规范的，不同浏览器有可能产生不同结果。</strong>你也可以自行配置格式（同下文的 <code>Intl.DateTimeFormat</code>），但仍然无法构造出规范的字符串</li>\n</ul>\n<p>因此，更佳的方案是，我们需要建立一个可反复使用的格式化器以避免重复创建 <code>Intl.DateTimeFormat</code> 带来的额外开销，并需要手动构造出符合规范的时间字符串，并将其重新解析为 <code>Date</code> 对象。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const timeZoneConverter = (timeZone) =&gt; {\r\n    // 新建 DateTimeFormat 对象以供对同一目标时区重用\r\n    // 由于时区属性必须在创建 DateTimeFormat 对象时指定，我们只能为同一时区重用格式化器\r\n    const formatter = new Intl.DateTimeFormat('zh-CN', {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit',\r\n        hour12: false,\r\n        timeZone\r\n    })\r\n    return {\r\n        // 提供 conver 方法以将提供的 Date 对象转换为指定时区\r\n        convert (date) {\r\n            // zh-CN 的区域设置会返回类似 1970/01/01 00:00:00 的字符串\r\n            // 替换字符即可构造出类似 1970-01-01T00:00:00 的 ISO 8601 标准格式时间字符串并被正确解析\r\n            return new Date(formatter.format(date).replace(/\\//g, '-').replace(' ', 'T').trim())\r\n        }\r\n    }\r\n}\r\n\r\nconst toLondonTime = timeZoneConverter('Europe/London') // 对于同一时区，此对象可重用\r\n\r\nconst now = new Date() // Wed Oct 13 2021 01:00:00 GMT+0800 (中国标准时间)\r\ntoLondonTime.convert(now) // Tue Oct 12 2021 18:00:00 GMT+0800 (中国标准时间)</pre>\n<blockquote><p>目前 <code>zh-CN</code> 的区域设置会产生类似 <code>1970/01/01 00:00:00</code> 的格式化字符串。这一格式目前跨端一致，但由于规范没有指定时间格式，<strong>这个格式在未来有可能变更。</strong>更好的方案是使用 <code>formatToParts()</code> 方法（在后文详述）获取时间字符串的各部分并手动拼接出标准格式的字符串，但在这个例子中直接 <code>replace</code> 拥有更好的性能。</p></blockquote>\n<p>现在，尝试反复转换时间至同一时区 1000 次，耗时从 <code>toLocaleString()</code> 1.5 秒降低到了 0.04 秒。尽管代码长了点，但这次重写在最好的情况下为我们带来了超过 20 倍的性能提升。</p>\n<p>需要注意的是，虽然这看起来就算最终方案了，但这个方案依然不完美。主要有以下两个问题：</p>\n<ul>\n<li>在需要密集转换为不同时区时，由于无法重用格式化器，性能依然较差且难以进一步优化</li>\n<li>由于 <code>Intl.DateTimeFormat</code> 不支持格式化毫秒，在格式化字符串的过程中毫秒会丢失，导致最终结果可能会与期望结果产生最高 999ms 的误差，需要额外处理。比如需要计算时差时，我们可能需要这么写：\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const calcTimeDiff = (date, converter) =&gt; {\r\n    const secDate = date - date.getMilliseconds() // 去掉毫秒，避免转换前后精度差异\r\n    return converter.convert(new Date(secDate), tzName) - secDate\r\n}\r\n\r\ncalcTimeDiff(new Date(), timeZoneConverter('Europe/London')) // -25200000</pre>\n</li>\n</ul>\n<p>无论如何，在折腾一番后我们还是把时区正确转换了。接下来准备格式化时间字符串了吗？不过在此之前，我们得先来聊聊语言、文字和区域。</p>\n<h1>语言文字区域傻傻分不清</h1>\n<blockquote><p>如何在计算机中表示中文？</p></blockquote>\n<p>“这不简单，”你可能会说，“用 <code>zh</code> 啊。”</p>\n<blockquote><p>那简体中文呢？</p></blockquote>\n<p>“<code>zh-CN</code>。”你或许会说出这个答案。</p>\n<blockquote><p>那用于新加坡的简体中文和用于中国大陆的简体中文该如何区分呢？</p></blockquote>\n<p>嗯……好问题。</p>\n<p>要能正确区分不同的简体中文，我们还得先回到定义上。实际上，“国际化”并不只是语言的翻译而已，国际化包含的是一整套对于各个<strong>区域</strong>的本地化方案。要准确表示一个国际化方案，我们实际至少需要确定三个属性：语言（Language）、文字（Script）和区域（Locale）。</p>\n<ul>\n<li>\n<strong>语言</strong>通常指的是<strong>声音语言</strong>。不同的语言都有一套自己的发音规则，很难互通。如中文和英语都属于语言</li>\n<li>\n<strong>文字</strong>对应的是某个语言的书写方式，同样的语言可能会有多种书写方案。如中文主要有简体和繁体两种书写方案</li>\n<li>\n<strong>区域</strong>指国际化面向的地区，相同的语言和文字，在不同地区也有可能会有不同的使用习惯。如新加坡和中国大陆都使用简体中文，但两地的用词习惯等有些许差异</li>\n</ul>\n<p>只有确定了这三个属性，我们才能正确定义一个国际化方案（或者说<strong>区域设置</strong>）。当然，还有很多其他属性可以更准确的表达某个区域设置，但通常有语言、文字和区域就已经足够了。</p>\n<p>于是，基于 <a href=\"https://tools.ietf.org/rfc/bcp/bcp47.txt\" rel=\"noopener\">BCP 47</a>，我们可以知道：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"raw\">cmn-Hans-CN = 中文普通话-简体-中国大陆\r\ncmn-Hans-SG = 中文普通话-简体-新加坡\r\ncmn-Hant-TW = 中文普通话-繁体-台湾\r\nyue-Hant-HK = 中文粤语-繁体-香港</pre>\n<p>等等，这都是啥？还有 BCP 47 又是啥？BCP 是 IETF 发布的“最佳当前实践”文档，而 BCP 47 是一些国际化相关的 ISO 和备忘录的集合，也是目前事实上由 HTML 和 ECMAScript 所使用的表达区域设置的标准。BCP 47 定义的区域设置标签实际上比较复杂，但对于大部分简单使用情况，上文示例中的格式已经完全够用了。简单来说，<strong>要表达一个区域设置，我们会使用 <code>语言[-文字][-区域]</code> 的格式，而文字和区域都是可选的。</strong>而对于每个部分的具体代码，BCP 47 也有做具体定义。其中：</p>\n<ul>\n<li>语言使用 ISO 639-1 定义的两位字母代码（如中文为 <code>zh</code>，英文为 <code>en</code>）或 <a href=\"https://iso639-3.sil.org/code_tables/639/data\" rel=\"noopener\">ISO 639-2/3</a> 定义的三位字母代码（如中文普通话为 <code>cmn</code>，英文为 <code>eng</code>），通常小写</li>\n<li>文字使用 <a href=\"https://unicode.org/iso15924/iso15924-codes.html\" rel=\"noopener\">ISO 15924</a> 定义的四位字母代码，通常首字母大写。如简体中文是 <code>Hans</code>，繁体中文是 <code>Hant</code>\n</li>\n<li>区域通常使用 <a href=\"https://www.iso.org/iso-3166-country-codes.html\" rel=\"noopener\">ISO 3166-1</a> 定义的两位字母代码，通常大写，如中国大陆为 <code>CN</code>，英国为 <code>GB</code>\n</li>\n</ul>\n<blockquote><p>ISO 639-1/2/3 的关系实际是：ISO 639-1 是最早制定的规范，使用两位字母表示语言，但语言数量之多并不能只用两位代码表示。因此后来修订了 ISO 639-2 和 3，使用三位字母表示了更多语言。通常 639-1 代码和 ISO-2/3 代码是一对多的关系。如中文 <code>zh</code> 其实是中文普通话 <code>cmn</code> 的宏语言（macrolanguage），同样使用 <code>zh</code> 为宏语言的语言还有 <code>wuu</code>（中文吴语）、<code>hak</code>（中文客家话）、<code>yue</code>（中文粤语）等数十种。<strong>从规范上我们现在应该使用 ISO 639-2/3 代码来替代 ISO 639-1 代码了</strong>，但由于历史阻力和真实需求中分类无需如此细致等原因，<strong>使用 ISO 639-1 指定语言仍然非常常见而且完全可以接受。</strong>此外，特别地，我们在 ISO 639-3 中定义未指明的语言为 <code>und</code>。</p></blockquote>\n<p>因此，对于这一节开头的两个问题，在 BCP 47 中正确答案其实是：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"raw\">zh = 中文\r\ncmn = 中文普通话\r\n\r\nzh-Hans = 中文-简体\r\ncmn-Hans = 中文普通话-简体</pre>\n<p>而 <code>zh-CN</code> 实际是指在中国大陆使用的中文，当然也包含在中国大陆使用的繁体中文。<strong>不过，由于大部分情况下一个区域只会通用一种文字，很多情况下我们可以忽略文字这一项</strong>，即使用 <code>zh-CN</code>（或者 <code>cmn-CN</code>）来表示中国大陆的简体中文普通话——毕竟在大部分业务中在中国大陆使用繁体和非普通话的情况非常少。</p>\n<blockquote><p>事实上，类似 <code>zh-Hans</code> 和 <code>zh-Hant</code> 开头的区域设置名称已经被标记为 <code>redundant 废弃</code>，因此尽可能只使用 <code>zh-CN</code> 或者 <code>cmn-Hans-CN</code> 这样的区域设置名称。所有区域设置名称的列表可以在 <a href=\"https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry\" rel=\"noopener\">IANA</a> 找到。</p></blockquote>\n<p>现在我们可以准确定义一个区域设置了。不过我们还有一些小小的需求。比如我们想在 <code>cmn-Hans-CN</code> 的区域设置中使用农历来表示日期，但显然我们上文定义的表示方法并不能表达这一需求。好在，Unicode 为 BCP 47 提供了 u 扩展。在区域设置名称后面加上 <code>-u-[选项]</code> 就可以表达更细致的变体了。所以我们有：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"raw\">cmn-Hans-CN-u-ca-chinese = 中文普通话-简体-中国大陆-u-日历-中国农历\r\njpn-Jpan-JP-u-ca-japanese = 日语-日文汉字/平假名/片假名-日本-u-日历-日本日历\r\ncmn-Hans-CN-u-nu-hansfin = 中文普通话-简体-中国大陆-u-数字-简体大写数字</pre>\n<p>u 扩展的具体可选项可以在 <a href=\"https://www.unicode.org/reports/tr35/tr35-21.html#Unicode_locale_identifier\" rel=\"noopener\">Unicode 网站</a>上找到。而多个 u 扩展还可以连接——于是我们甚至可以写出 <code>cmn-Hans-CN-u-ca-chinese-nu-hansfin</code> 这种丧心病狂的区域设置名称。当然，相信你现在已经可以看懂这个区域设置的意思了。</p>\n<blockquote><p>不同地区可能会有不同的日历使用习惯，如中国有使用农历的需求，泰国有使用佛历的需求，我们可以通过 u 扩展指定不同的日历。不过，大部分情况下我们会使用标准的 ISO 8601 日历（gregory），JavaScript 的 <code>Date</code> 对象也只支持这种日历。</p></blockquote>\n<blockquote><p>你可以使用 <a href=\"https://r12a.github.io/app-subtags/\" rel=\"noopener\">BCP47 language subtag lookup</a> 工具快速检查你编写的 BCP 47 区域标签是否规范。</p></blockquote>\n<p>终于我们可以正确表达一个完美符合我们需求的区域设置了。接下来，让我们开始格式化时间吧。</p>\n<h1>格式化时间</h1>\n<p>这题我会！</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const formatDate(date) =&gt; {\r\n    return `${date.getFullYear()}-${`${date.getMonth() + 1}`.padStart(2, '0')}-${`${date.getDate()}`.padStart(2, '0')} ${`${date.getHours()}`.padStart(2, '0')}:${`${date.getMinutes()}`.padStart(2, '0')}:${`${date.getSeconds()}`.padStart(2, '0')}`\r\n}\r\n\r\nformatDate(new Date()) // 2021-10-13 01:00:00</pre>\n<p>就完事了……吗？先不论这样的格式化代码难以阅读，尽管上文这样的日期格式国际通用，<strong>但并非所有区域都习惯于这样的日期表示方法。</strong>比如英语国家/地区在很多时候习惯在日期中加入星期，而阿拉伯语国家/地区在部分情况下习惯使用阿拉伯语数字（而非常用的阿拉伯-印度数字）；再比如美式英语国家/地区习惯月-日-年的日期表示法，而英式英语国家/地区习惯日-月-年的日期表示法……不同区域在时间表示格式习惯上的差异是巨大的，<strong>我们很难通过一个简单的方法来正确地、国际化地格式化一个日期。</strong></p>\n<p>好在 ES6 早就为我们铺平了道路。还记得上文提到过的 <code>Intl.DateTimeFormat</code> 吗？我们通过它来实例化一个日期格式化器并用进行日期的国际化。</p>\n<p>直接来看例子吧：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const options = {\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric',\r\n    weekday: 'long'\r\n}\r\nconst now = new Date()\r\n\r\nconst enUSFormatter = new Intl.DateTimeFormat('en-US', options)\r\n\r\nconst zhCNFormatter = new Intl.DateTimeFormat('zh-CN', options)\r\nconst zhCNAltFormatter = new Intl.DateTimeFormat('zh-CN-u-ca-chinese', options)\r\nconst zhCNAlt2Formatter = new Intl.DateTimeFormat('zh-CN-u-ca-roc-nu-hansfin', options)\r\n\r\nconst jaFormatter = new Intl.DateTimeFormat('ja', options)\r\nconst jaAltFormatter = new Intl.DateTimeFormat('ja-JP-u-ca-japanese', options)\r\n\r\nconst arEGFormatter = new Intl.DateTimeFormat('ar-EG', options)\r\n\r\nenUSFormatter.format(now) // Wednesday, Oct 13, 2021\r\n\r\nzhCNFormatter.format(now) // 2021年10月13日星期三\r\nzhCNAltFormatter.format(now) // 2021辛丑年九月8星期三\r\nzhCNAlt2Formatter.format(now) // 民国壹佰壹拾年拾月拾叁日星期三\r\n\r\njaFormatter.format(now) // 2021年10月13日水曜日\r\njaAltFormatter.format(now) // 令和3年10月13日水曜日\r\n\r\narEGFormatter.format(now) // الأربعاء، ١٣ أكتوبر ٢٠٢١</pre>\n<blockquote><p>在这里我们使用 ISO 639-1 代码来表示语言，是由于事实上 ISO 639-1 代码更加常见与通用。在大部分支持 <code>Intl.DateTimeFormat</code> 的 JavaScript 运行时中我们也可以使用 ISO 639-2/3 代码来表示语言（但实际会 fallback 至对应的 ISO 639-1 代码）。</p></blockquote>\n<blockquote><p>你也可以通过在 <code>options</code> 中设置 <code>calendar</code> 属性和 <code>numberingSystem</code> 属性来替换区域设置名称中对 u 扩展的使用。这也是推荐方式。</p></blockquote>\n<p>这非常直观，我们可以指定区域设置和格式化选项来初始化一个格式化器，并在之后使用格式化器对象的 <code>format</code> 方法来格式化一个 <code>Date</code> 对象。这里的格式化选项其实非常灵活，能格式化的不只是日期，时间也可以被灵活地格式化，有非常多的组合可以选择。我们不会在这里详细解释每一个选项，你可以访问 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat\" rel=\"noopener\">MDN 文档</a>来了解更多。</p>\n<blockquote><p>如前文所述，<code>Intl.DateTimeFormat</code> 无法格式化毫秒。</p></blockquote>\n<p>不过需要注意的是，<strong>JavaScript 运行时不一定支持所有区域设置，也不一定支持所有格式化选项。</strong>在遇到不支持的情况时，<code>Intl.DateTimeFormat</code> 默认会静默 fallback 到最匹配的支持项，因此在处理不常见的区域设置或选项时，你可能需要再额外检查。你可以通过 <code>Intl.DateTimeFormat.supportedLocalesOf()</code> 静态方法判断当前运行时是否支持指定的区域设置，也可以在实例化格式化器后在对象上调用 <code>resolvedOptions()</code> 方法来检查运行时的解析结果是否与预期一致。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">new Intl.DateTimeFormat('yue-Hant-CN').resolvedOptions()\r\n// {locale: 'zh-CN', calendar: 'gregory', …}\r\n// fallback 至 zh-CN，与 yue-CN 的预期不一致</pre>\n<p>此外，正如你所看到的，各种语言在日期格式化中使用的文本 JavaScript 运行时都已经帮我们内置了。因此，我们甚至可以利用这些国际化特性来为我们的应用减少一点需要翻译的字符串——打包进应用的翻译越少，应用体积也就越小了嘛——比如说获取一周七天对应的名字：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const getWeekdayNames = (locale) =&gt; {\r\n     // 基于一个固定日期计算，这里选择 1970.1.1\r\n     // 不能使用 0，因为 Unix 时间戳 0 在不同时区的日期不一样\r\n    const base = new Date(1970, 0, 1).getTime()\r\n    const formatter = new Intl.DateTimeFormat(locale, { weekday: 'short' })\r\n    return Array.from({ length: 7 }, (_, day) =&gt; (\r\n        formatter.format(new Date(base + 3600000 * 24 * (-4 + day))) // 1970.1.1 是周四\r\n    ))\r\n}\r\n\r\ngetWeekdayNames('en-US') // ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\r\ngetWeekdayNames('zh-CN') // ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\r\ngetWeekdayNames('ja') // ['日', '月', '火', '水', '木', '金', '土']\r\ngetWeekdayNames('ar-EG') // ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت']</pre>\n<p>当然，如果你还是不喜欢运行时为你提供的格式，我们还有上文提到过的 <code>formatToParts()</code> 方法可以用。来看一个简单的例子吧：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">new Intl.DateTimeFormat('zh-CN', {\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric',\r\n    weekday: 'long',\r\n    hour: 'numeric',\r\n    minute: 'numeric',\r\n    second: 'numeric',\r\n}).formatToParts(new Date())\r\n// [\r\n//     { type: 'year', value: '2021' },\r\n//     { type: 'literal', value: '年' },\r\n//     { type: 'month', value: '10' },\r\n//     { type: 'literal', value: '月' },\r\n//     { type: 'day', value: '13' },\r\n//     { type: 'literal', value: '日' },\r\n//     { type: 'weekday', value: '星期三' },\r\n//     { type: 'literal', value: ' ' },\r\n//     { type: 'dayPeriod', value: '上午' },\r\n//     { type: 'hour', value: '1' },\r\n//     { type: 'literal', value: ':' },\r\n//     { type: 'minute', value: '00' },\r\n//     { type: 'literal', value: ':' },\r\n//     { type: 'second', value: '00' }\r\n// ]</pre>\n<p>随后，你就可以自己解析这个数组来构造出你想要的时间格式了。最后，我们还可以使用 <code>Intl.RelativeTimeFormat</code> 来格式化相对日期。当然我们不会在这里详细讲解这个 API，你可以参考 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Intl/RelativeTimeFormat\" rel=\"noopener\">MDN 文档</a>。直接来看一个简单例子吧：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const getRelativeTime = (num, unit, locale) =&gt; {\r\n    return new Intl.RelativeTimeFormat(locale, { numeric: 'auto' }).format(num, unit)\r\n}\r\n\r\ngetRelativeTime(-3, 'day', 'en-US') // 3 days ago\r\ngetRelativeTime(-1, 'day', 'zh-CN') // 昨天\r\ngetRelativeTime(0, 'second', 'zh-CN') // 现在\r\ngetRelativeTime(3, 'hour', 'ja') // 3 時間後</pre>\n<blockquote><p><code>Intl.RelativeTimeFormat</code> 是一个相对较晚进入标准的对象，因此浏览器支持程度较差，可能需要使用 <a href=\"https://formatjs.io/docs/polyfills/intl-relativetimeformat\" rel=\"noopener\">Polyfill</a>。不过目前（2021.10）主流浏览器的最新版本均已支持此 API。</p></blockquote>\n<h1>未来</h1>\n<p>我希望这篇文章时区转换的部分可以很快过时——这并非无稽之谈，目前（2021.10）TC39 的 <a href=\"https://github.com/tc39/proposal-temporal\" rel=\"noopener\"><code>Temporal</code> 提案</a>已经进入 Stage 3 了。<strong><code>Temporal</code> 提案定义了一个新的、时区友好的 <code>Temporal</code> 命名空间，并期望在不久后就能进入标准并最终应用于生产环境。</strong><code>Temporal</code> 定义了完整的时区、时间段、日历规则的处理，且拥有简单明了的 API。那时候，JavaScript 的时区处理就不会再如此痛苦了。由于目前 <code>Temporal</code> 提案还未进入标准，API 暂未稳定，我们无法将其用于生产环境，但我们可以来看一个简单的例子感受一下这个 API 的强大。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">const zonedDateTime = Temporal.ZonedDateTime.from({\r\n  timeZone: 'America/Los_Angeles',\r\n  year: 1995,\r\n  month: 12,\r\n  day: 7,\r\n  hour: 3,\r\n  minute: 24,\r\n  second: 30,\r\n  millisecond: 0,\r\n  microsecond: 3,\r\n  nanosecond: 500,\r\n  calendar: 'iso8601'\r\n}) // 1995-12-07T03:24:30.0000035-08:00[America/Los_Angeles]</pre>\n<p>如果你希望立刻开始使用 <code>Temporal</code>，现在已有 Polyfill 可用。</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"js-temporal\" data-mdxgithubp=\"temporal-polyfill\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/js-temporal/temporal-polyfill\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<p>不过，时区问题不会消失，各地区的习惯也很难融合到一起。时间的国际化处理是<a href=\"https://yourcalendricalfallacyis.com/\" rel=\"noopener\">极其复杂</a>的，前端中的时间国际化仍然值得我们认真关注。</p>\n","link":"https://flyhigher.top/develop/2482.html"},{"title":"使用 Python 爬取故宫壁纸","date":"2021-07-17 05:55:00","description":"\n<p>我非常喜欢故宫壁纸，但是一张一张下载的速度就太慢了。</p>\n<p>于是，我就写了个简单的 Python 小程序自动爬取故宫壁纸。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E4%BB%A3%E7%A0%81\" class=\"headerlink\" title=\"代码\"></a>代码</h2>\n<p>首先，我们通过简单的查看，知道故宫壁纸的页面并没有使用 JavaScript 载入。</p>\n<p>但是故宫壁纸很多，所以还需要分类。</p>\n<p>故宫壁纸大多都是以分类开头，如 <code>爱上紫禁城 紫藤</code>, <code>清   虚谷紫藤金鱼图轴（局部）</code> 等等，所以一般只需要做个简单的 <code>startswith()</code> 判断就 OK 了。</p>\n<p>很多壁纸的标题都是一样的，所以还可以使用 <code>random</code> 库在文件名末尾追加一个随机数。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests, bs4, time, random</span><br><span class=\"line\">path = <span class=\"string\">\"./wallpaper/爱上紫禁城\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">catch = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">119</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 组合请求 URL</span></span><br><span class=\"line\">    url = <span class=\"string\">\"https://www.dpm.org.cn/lights/royal/p/{}.html\"</span>.<span class=\"built_in\">format</span>(i)</span><br><span class=\"line\">    <span class=\"comment\"># 发送请求</span></span><br><span class=\"line\">    response = requests.get(url)</span><br><span class=\"line\">    <span class=\"comment\"># 设定页面编码为 UTF-8</span></span><br><span class=\"line\">    response.encoding = <span class=\"string\">\"UTF-8\"</span></span><br><span class=\"line\">    <span class=\"comment\"># 从 HTML 中解析数据</span></span><br><span class=\"line\">    soup = bs4.BeautifulSoup(response.text, <span class=\"string\">\"lxml\"</span>)</span><br><span class=\"line\">    image = soup.find_all(name=<span class=\"string\">\"div\"</span>, class_=<span class=\"string\">\"pic\"</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 循环输出图片</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> image:</span><br><span class=\"line\">        catch = catch + <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"comment\"># 获得壁纸名称</span></span><br><span class=\"line\">        <span class=\"comment\"># 分类，不是以【爱上紫禁城】开头的壁纸都忽略</span></span><br><span class=\"line\">        img_name = n.a.img[<span class=\"string\">\"title\"</span>]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> img_name.startswith(<span class=\"string\">\"明\"</span>):</span><br><span class=\"line\">            print(<span class=\"string\">\"{}. {}\"</span>.<span class=\"built_in\">format</span>(catch, n.a.img[<span class=\"string\">\"title\"</span>]))</span><br><span class=\"line\">            <span class=\"comment\"># 组合获得壁纸页面</span></span><br><span class=\"line\">            url_1080 = <span class=\"string\">\"https://www.dpm.org.cn\"</span> + n.a[<span class=\"string\">\"href\"</span>]</span><br><span class=\"line\">            <span class=\"comment\"># 请求高清版网页</span></span><br><span class=\"line\">            response_img = requests.get(url_1080)</span><br><span class=\"line\">            <span class=\"comment\"># 再次解析</span></span><br><span class=\"line\">            soup_img = bs4.BeautifulSoup(response_img.text, <span class=\"string\">\"lxml\"</span>)</span><br><span class=\"line\">            <span class=\"comment\"># 获取页面中的图片</span></span><br><span class=\"line\">            data = soup_img.find_all(name=<span class=\"string\">\"img\"</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">            <span class=\"comment\"># 获得壁纸图片的链接</span></span><br><span class=\"line\">            img_url = data[<span class=\"string\">\"src\"</span>]</span><br><span class=\"line\">            <span class=\"comment\"># 保存图片</span></span><br><span class=\"line\">            pic = requests.get(img_url).content</span><br><span class=\"line\">            file_name = path + img_name + <span class=\"string\">\"-\"</span> + <span class=\"built_in\">str</span>(random.randint(<span class=\"number\">100000</span>, <span class=\"number\">999999</span>)) + <span class=\"string\">\".jpg\"</span></span><br><span class=\"line\">            <span class=\"comment\"># 写入文件</span></span><br><span class=\"line\">            <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_name, <span class=\"string\">\"wb\"</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">                file.write(pic)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"!Ignore: \"</span> + img_name)</span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#%E5%90%8E\" class=\"headerlink\" title=\"后\"></a>后</h2>\n<p>我把一些我下载下来的壁纸放在了 <a href=\"https://t.yfun.top/dpm-wallpaper\">这里</a>，可以直接预览并下载。</p>\n<p><del>OK，又水了一篇文（</del></p>\n","link":"https://blog.yfun.top/posts/2021/dpm-wallpaper/"},{"title":"使用 Prettier 格式化代码","date":"2021-07-15 06:45:00","description":"\n<p>格式化代码可以提高代码的可读性，使代码更加美观。</p>\n<p>Prettier 支持：</p>\n<ul>\n<li>JavaScript (including experimental features)</li>\n<li>JSX</li>\n<li>Angular</li>\n<li>Vue</li>\n<li>Flow</li>\n<li>TypeScript</li>\n<li>CSS, Less, and SCSS</li>\n<li>HTML</li>\n<li>JSON</li>\n<li>GraphQL</li>\n<li>Markdown, including GFM and MDX</li>\n<li>YAML</li>\n</ul>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%AE%89%E8%A3%85\" class=\"headerlink\" title=\"安装\"></a>安装</h2>\n<h3>\n<a href=\"https://blog.yfun.top/#%E6%8F%92%E4%BB%B6\" class=\"headerlink\" title=\"插件\"></a>插件</h3>\n<p>你可以很方便的在 VSCode 等 IDE 上安装插件，插件名为 <code>Prettier</code>.</p>\n<p>以 VSCode 为例：</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.10/rawimg/6a3ad0ea42d55.png\"></p>\n<blockquote><p>如果安装了其他格式化插件，则需要点击 [格式化文档的方式]，选择 <code>Prettier</code>。</p></blockquote>\n<h3>\n<a href=\"https://blog.yfun.top/#CLI\" class=\"headerlink\" title=\"CLI\"></a>CLI</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo npm i -g prettier</span><br></pre></td></tr></table></figure><p>相关的文档可参见官网: <a href=\"https://prettier.io/docs/en/cli.html\">https://prettier.io/docs/en/cli.html</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">prettier --write . <span class=\"comment\"># 格式化当前文件夹的所有文件</span></span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#%E9%85%8D%E7%BD%AE\" class=\"headerlink\" title=\"配置\"></a>配置</h2>\n<p>参见官方文档：</p>\n<ul>\n<li><p><a href=\"https://prettier.io/docs/en/configuration.html\">https://prettier.io/docs/en/configuration.html</a></p></li>\n<li><p><a href=\"https://prettier.io/docs/en/options.html\">https://prettier.io/docs/en/options.html</a></p></li>\n</ul>\n<p>Prettier 的配置文件有多种写法：</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.10/rawimg/a4cc583d84c12.png\"></p>\n<p>以使用 <code>YAML</code> 书写的 <code>.prettierrc</code> 为例：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 单行最长字符数</span></span><br><span class=\"line\"><span class=\"attr\">printWidth:</span> <span class=\"number\">80</span></span><br><span class=\"line\"><span class=\"comment\"># 制表符长度</span></span><br><span class=\"line\"><span class=\"attr\">tabWidth:</span> <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"comment\"># 是否使用 Tab</span></span><br><span class=\"line\"><span class=\"attr\">useTabs:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"comment\"># 是否加入分号</span></span><br><span class=\"line\"><span class=\"attr\">semi:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"comment\"># 单引号</span></span><br><span class=\"line\"><span class=\"attr\">singleQuote:</span> <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#%E6%95%88%E6%9E%9C\" class=\"headerlink\" title=\"效果\"></a>效果</h2>\n<p>格式化前：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">\"https://blog.yfun.top/search.json\"</span>).then(<span class=\"function\"><span class=\"params\">res</span>=&gt;</span>res.json()).then(<span class=\"function\">(<span class=\"params\">content</span>) =&gt;</span> {<span class=\"built_in\">console</span>.log(content);<span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; content.length; i++){<span class=\"built_in\">console</span>.log(content[i][<span class=\"string\">'title'</span>] + <span class=\"string\">\" --- https://blog.yfun.top\"</span> + content[i][<span class=\"string\">'url'</span>])}})</span><br></pre></td></tr></table></figure><p>格式化后：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">fetch(<span class=\"string\">\"https://blog.yfun.top/search.json\"</span>)</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> res.json())</span><br><span class=\"line\">    .then(<span class=\"function\">(<span class=\"params\">content</span>) =&gt;</span> {</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(content);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; content.length; i++) {</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(</span><br><span class=\"line\">                content[i][<span class=\"string\">\"title\"</span>] +</span><br><span class=\"line\">                    <span class=\"string\">\" --- https://blog.yfun.top\"</span> +</span><br><span class=\"line\">                    content[i][<span class=\"string\">\"url\"</span>]</span><br><span class=\"line\">            );</span><br><span class=\"line\">        }</span><br><span class=\"line\">    });</span><br></pre></td></tr></table></figure>\n","link":"https://blog.yfun.top/posts/2021/format-code-using-prettier/"},{"title":"树莓派超频","date":"2021-06-25 07:50:00","description":"\n<div class=\"note note-info\">            <p>本文操作系统为 Ubuntu Server 20.04，其他操作系统可能有所不同。</p>          </div>\n<div class=\"note note-warning\">            <p>超频是有风险的，温度也会更高，需要比较良好的散热。</p>          </div>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%BC%80%E5%A7%8B\" class=\"headerlink\" title=\"开始\"></a>开始</h2>\n<p>登录树莓派，进入 <code>/boot/firmware/</code> 目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /boot/firmware/</span><br></pre></td></tr></table></figure><div class=\"note note-warning\">            <p>网上很多教程让你修改 <code>config.txt</code> 文件，但注释里已经很明确的写了：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\"># Please DO NOT modify this file; if you need to modify the boot config, the</span><br><span class=\"line\"># \"usercfg.txt\" file is the place to include user changes. Please refer to</span><br><span class=\"line\"># the README file for a description of the various configuration files on</span><br><span class=\"line\"># the boot partition.</span><br></pre></td></tr></table></figure>\n</div>\n<p>我们修改 <code>usercfg.txt</code> 文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo vim usercfg.txt</span><br></pre></td></tr></table></figure><p>在文件末尾追加配置信息，以下是我的，仅供参考：</p>\n<div class=\"note note-danger\">            <p>我使用的是 <code>Raspberry Pi 4 (4GB)</code>，并且有小风扇和散热片。<br>请根据自己的需要和配置进行更改。</p>          </div>\n<figure class=\"highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">force_turbo=0</span><br><span class=\"line\">arm_freq=1850</span><br><span class=\"line\">over_voltage=6</span><br><span class=\"line\">gpu_freq=650</span><br><span class=\"line\">core_freq=650</span><br><span class=\"line\">gpu_mem=620</span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#%E9%87%8D%E5%90%AF\" class=\"headerlink\" title=\"重启\"></a>重启</h2>\n<p>保存文件，使用命令重启：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo reboot</span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#%E5%90%8E\" class=\"headerlink\" title=\"后\"></a>后</h2>\n<p>重启完毕后，再使用 <code>lscpu</code> 命令看看 CPU 状况。</p>\n","link":"https://blog.yfun.top/posts/1445549919/"},{"title":"加速 GitHub 下载","date":"2021-06-18 09:30:00","description":"\n<p>GitHub 在国内的访问情况不太稳定，仓库克隆速度也非常慢。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E2%9C%88%EF%B8%8F\" class=\"headerlink\" title=\"✈️\"></a>✈️</h2>\n<p>不必多说。</p>\n<p>例如 <a href=\"http://127.0.0.1:7890/\">http://127.0.0.1:7890</a> 为代理地址，你可以使用下方的命令更改：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --global http.proxy http://127.0.0.1:7890</span><br></pre></td></tr></table></figure><p>如果有一天不需要了，输入下面代码取消：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --global --<span class=\"built_in\">unset</span> http.proxy</span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#FastGit\" class=\"headerlink\" title=\"FastGit\"></a>FastGit</h2>\n<p>使用 <a href=\"https://fastgit.org/\">FastGit</a> 提供的 GitHub 镜像。</p>\n<p>镜像地址：<a href=\"https://hub.fastgit.org/\">https://hub.fastgit.org</a></p>\n<p>支持 HTTPS 克隆，并且提供 raw.githubusercontent.com 的镜像，地址为 <a href=\"https://raw.fastgit.org/\">https://raw.fastgit.org</a></p>\n<h2>\n<a href=\"https://blog.yfun.top/#CNPM\" class=\"headerlink\" title=\"CNPM\"></a>CNPM</h2>\n<p>使用 <a href=\"https://cnpmjs.org/\">CNPM</a> 提供的 GitHub 镜像。</p>\n<p>镜像地址：<a href=\"https://github.com.cnpmjs.org/\">https://github.com.cnpmjs.org</a></p>\n<p>支持 HTTPS 克隆。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#Hosts\" class=\"headerlink\" title=\"Hosts\"></a>Hosts</h2>\n<p>通过更改 Hosts 文件的方式解决，但大有可能失效：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">199.232.69.194  github.global.ssl.fastly.net</span><br><span class=\"line\">140.82.113.4    github.com</span><br></pre></td></tr></table></figure><p>GitHub 上的 <a href=\"https://github.com/521xueweihan/GitHub520\">521xueweihan/GitHub520</a> 项目提供了更多关于 GitHub Hosts 列表。</p>\n<blockquote><p><a href=\"https://github.com/521xueweihan/GitHub520/issues/53\">521xueweihan/GitHub520 #53</a></p></blockquote>\n<h2>\n<a href=\"https://blog.yfun.top/#Gitee\" class=\"headerlink\" title=\"Gitee\"></a>Gitee</h2>\n<p>网上挺多教程，使用 Gitee 的「从 GitHub 导入」功能。</p>\n<p>不过 Gitee 限制仓库 500MB。。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#Coding\" class=\"headerlink\" title=\"Coding\"></a>Coding</h2>\n<p>进入 Coding 控制台，点击「创建项目」。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/k7uHJm.png\"></p>\n<p>项目模版选择「代码托管」就好，仅做下载的话无需开启太多。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/bEO0vX.png\"></p>\n<p>填写项目基本信息，如名称、标识等。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/N4xjSv.png\"></p>\n<p>新建一个镜像仓库。</p>\n<p>「Git 仓库 URL」填写 GitHub 公开仓库 HTTPS 克隆地址，如：<a href=\"https://github.com/twbs/bootstrap.git\">https://github.com/twbs/bootstrap.git</a></p>\n<p>创建完成后请稍等，系统就会自动导入。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/YxnnDj.png\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/FmfWkf.png\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/OV7w4v.png\"></p>\n<p>导入完成后，点击「克隆」就能找到克隆地址。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.9/rawimg/bWszbu.png\"></p>\n<p>克隆速度挺快的：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Cloning into <span class=\"string\">'bootstrap'</span>...</span><br><span class=\"line\">remote: Enumerating objects: 169214, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Counting objects: 100% (169214/169214), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (51634/51634), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Receiving objects:  57% (96728/169214), 90.58 MiB | 6.83 MiB/s </span><br></pre></td></tr></table></figure><p>此外，Coding 还支持自动同步，可以设置每天的同步时间。</p>\n","link":"https://blog.yfun.top/posts/2517388641/"},{"title":"GitHub Action 监测京东商品价格","date":"2021-05-18 10:32:00","description":"\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%89%8D%E8%A8%80\" class=\"headerlink\" title=\"前言\"></a>前言</h2>\n<p>我会在京东上买些电子产品和文具，那么如何获得商品降价信息，使用更低的价格购买呢？</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%BC%80%E5%A7%8B\" class=\"headerlink\" title=\"开始\"></a>开始</h2>\n<p>新建一个 <code>GitHub</code> 仓库，创建 <code>main.py</code> , <code>notify.py</code> 和 <code>.github/workflows/auto.yml</code> 三个文件，内容如下：</p>  <details class=\"post-details\"><summary><code>main.py</code> (点击展开)</summary><div class=\"details-content\">  <figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># 导入模块</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request, random, json, notify</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 商品列表</span></span><br><span class=\"line\">check = [</span><br><span class=\"line\">    <span class=\"comment\"># 闪迪（SanDisk）64GB TF（MicroSD）存储卡</span></span><br><span class=\"line\">    <span class=\"string\">'1887526'</span>,</span><br><span class=\"line\">    <span class=\"comment\"># 晨光(M&amp;G)文具 0.5mm 黑色中性笔</span></span><br><span class=\"line\">    <span class=\"string\">'277393'</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 价格列表，用于临时存储获取到的价格数据</span></span><br><span class=\"line\">price = {}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取上次的价格文件</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    file = <span class=\"built_in\">open</span>(<span class=\"string\">'./price.json'</span>, mode=<span class=\"string\">'r'</span>)</span><br><span class=\"line\">    lastPrice = json.loads(file.readlines()[<span class=\"number\">0</span>])</span><br><span class=\"line\"><span class=\"keyword\">except</span>:</span><br><span class=\"line\">    print(<span class=\"string\">\"读取文件时出现错误！\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 遍历列表，比对价格</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> itemId <span class=\"keyword\">in</span> check:</span><br><span class=\"line\">    <span class=\"comment\"># 组合请求 URL</span></span><br><span class=\"line\">    <span class=\"comment\"># http://p.3.cn/prices/mgets?skuIds=J_</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://p.3.cn/prices/mgets?skuIds=J_{}'</span>.<span class=\"built_in\">format</span>(itemId)</span><br><span class=\"line\">    <span class=\"comment\"># User-Agent 列表</span></span><br><span class=\"line\">    ua = [<span class=\"string\">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36'</span>,<span class=\"string\">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36'</span>,<span class=\"string\">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36 OPR/26.0.1656.60'</span>,<span class=\"string\">'Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50'</span>,<span class=\"string\">'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50'</span>]</span><br><span class=\"line\">    <span class=\"comment\"># 随机获得一个 User-Agent，如不带 User-Agent 请求，就会被拒绝。</span></span><br><span class=\"line\">    headers = {</span><br><span class=\"line\">        <span class=\"string\">'User-Agent'</span>: ua[random.randint(<span class=\"number\">0</span>,<span class=\"number\">4</span>)]</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"comment\"># 组合请求参数</span></span><br><span class=\"line\">    request = urllib.request.Request(url = url, headers = headers)</span><br><span class=\"line\">    <span class=\"comment\"># 向京东发起请求</span></span><br><span class=\"line\">    response = urllib.request.urlopen(request)</span><br><span class=\"line\">    <span class=\"comment\"># 将获得的数据转为 JSON</span></span><br><span class=\"line\">    page_text = json.loads(response.read().decode(<span class=\"string\">'utf-8'</span>))</span><br><span class=\"line\">    thisPrice = <span class=\"built_in\">float</span>(page_text[<span class=\"number\">0</span>][<span class=\"string\">'p'</span>])</span><br><span class=\"line\">    <span class=\"comment\"># 将价格输入至价格变量</span></span><br><span class=\"line\">    price[itemId] = thisPrice</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 尝试对比价格</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        <span class=\"keyword\">if</span> thisPrice &gt; lastPrice[itemId]:</span><br><span class=\"line\">            print(<span class=\"string\">\"{0} 涨价\"</span>.<span class=\"built_in\">format</span>(itemId))</span><br><span class=\"line\"></span><br><span class=\"line\">            print(thisPrice - lastPrice[itemId])</span><br><span class=\"line\">            notify.notify(itemId, <span class=\"number\">0</span>, thisPrice - lastPrice[itemId], thisPrice)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> thisPrice &lt; lastPrice[itemId]:</span><br><span class=\"line\">            print(<span class=\"string\">\"{0} 降价\"</span>.<span class=\"built_in\">format</span>(itemId))</span><br><span class=\"line\">            print(lastPrice[itemId] - thisPrice)</span><br><span class=\"line\">            notify.notify(itemId, <span class=\"number\">2</span>, lastPrice[itemId] - thisPrice, thisPrice)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">elif</span> lastPrice[itemId] == thisPrice:</span><br><span class=\"line\">            print(<span class=\"string\">\"{0} 价格不变\"</span>.<span class=\"built_in\">format</span>(itemId))</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"{0} 未知错误\"</span>.<span class=\"built_in\">format</span>(itemId))</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        print(<span class=\"string\">\"无法进行比对\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将 JSON 转为 字符串</span></span><br><span class=\"line\">priceStr = json.dumps(price)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入价格文件，便于下次查询</span></span><br><span class=\"line\"><span class=\"keyword\">try</span>:</span><br><span class=\"line\">    file = <span class=\"built_in\">open</span>(<span class=\"string\">'./price.json'</span>, mode = <span class=\"string\">'w'</span>)</span><br><span class=\"line\">    file.write(priceStr)</span><br><span class=\"line\">    file.close()</span><br><span class=\"line\"><span class=\"keyword\">except</span>:</span><br><span class=\"line\">    print(<span class=\"string\">\"写入文件时出现错误\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">print(price)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</div></details><details class=\"post-details\"><summary><code>notify.py</code> (点击展开)</summary><div class=\"details-content\">  <figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request, json, urllib.parse, ssl</span><br><span class=\"line\">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">提醒的服务，支持 `wechat` 与 `qmsg`。</span></span><br><span class=\"line\"><span class=\"string\">需要在下方进行下一步的配置</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\">server = [<span class=\"string\">'qmsg'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">WeChat 采用的是 Server 酱 (https://sc.ftqq.com/3.version) 提供的服务</span></span><br><span class=\"line\"><span class=\"string\">key：Server 酱提供的 Token，必填。</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\">wechat = {</span><br><span class=\"line\">    <span class=\"string\">\"key\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">Qmsg 采用的是 Qmsg 酱 (https://qmsg.zendee.cn/) 提供的服务</span></span><br><span class=\"line\"><span class=\"string\">key：Qmsg 酱提供的 KEY，必填。</span></span><br><span class=\"line\"><span class=\"string\">qid：接收消息的 QQ 号（不支持 QQ 群），可以添加多个，以半角逗号分割，如：`10001,10002`（必须均在您的 Qmsg 酱 QQ 号列表中）。</span></span><br><span class=\"line\"><span class=\"string\">'''</span></span><br><span class=\"line\">qmsg = {</span><br><span class=\"line\">    <span class=\"string\">\"key\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"qid\"</span>: <span class=\"string\">\"\"</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">wechat_send</span>(<span class=\"params\">key, title, text</span>):</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://sc.ftqq.com/{0}.send?text={1}&amp;desp={2}'</span>.<span class=\"built_in\">format</span>(key, urllib.parse.quote(title), urllib.parse.quote(text))</span><br><span class=\"line\">    headers = {</span><br><span class=\"line\">        <span class=\"string\">'User-Agent'</span>: <span class=\"string\">\"Check Price Bot\"</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    request = urllib.request.Request(url=url, headers=headers)</span><br><span class=\"line\">    response = urllib.request.urlopen(request)</span><br><span class=\"line\">    page_text = json.loads(response.read().decode(<span class=\"string\">'utf-8'</span>))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> page_text[<span class=\"string\">'errno'</span>] == <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">qmsg_send</span>(<span class=\"params\">key, <span class=\"built_in\">id</span>, text</span>):</span></span><br><span class=\"line\">    url = <span class=\"string\">'http://qmsg.zendee.cn/send/{0}?msg={1}&amp;qq={2}'</span>.<span class=\"built_in\">format</span>(key, urllib.parse.quote(text), <span class=\"built_in\">id</span>)</span><br><span class=\"line\">    headers = {</span><br><span class=\"line\">        <span class=\"string\">'User-Agent'</span>: <span class=\"string\">\"Check Price Bot\"</span></span><br><span class=\"line\">    }</span><br><span class=\"line\">    request = urllib.request.Request(url=url, headers=headers)</span><br><span class=\"line\">    response = urllib.request.urlopen(request)</span><br><span class=\"line\">    page_text = json.loads(response.read().decode(<span class=\"string\">'utf-8'</span>))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> page_text[<span class=\"string\">'code'</span>] == <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">notify</span>(<span class=\"params\"><span class=\"built_in\">id</span>,<span class=\"built_in\">type</span>,price,nowPrice</span>):</span></span><br><span class=\"line\">    <span class=\"string\">'''</span></span><br><span class=\"line\"><span class=\"string\">    type:</span></span><br><span class=\"line\"><span class=\"string\">        0: 涨价</span></span><br><span class=\"line\"><span class=\"string\">        1: 无变化</span></span><br><span class=\"line\"><span class=\"string\">        2: 降价</span></span><br><span class=\"line\"><span class=\"string\">    id: 商品 ID</span></span><br><span class=\"line\"><span class=\"string\">    price: 差价</span></span><br><span class=\"line\"><span class=\"string\">    nowPrice: 现价</span></span><br><span class=\"line\"><span class=\"string\">    '''</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> svId <span class=\"keyword\">in</span> server:</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">send</span>(<span class=\"params\">title,content</span>):</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> svId == <span class=\"string\">'wechat'</span>:</span><br><span class=\"line\">                wechat_send(wechat[<span class=\"string\">\"key\"</span>],title,content)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> svId == <span class=\"string\">'qmsg'</span>:</span><br><span class=\"line\">                qmsg_send(qmsg[<span class=\"string\">\"key\"</span>],qmsg[<span class=\"string\">\"qid\"</span>],title + <span class=\"string\">\"\\n\"</span> + content)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">type</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">            title = <span class=\"string\">\"商品 {0} 涨价!\"</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            content = <span class=\"string\">\"您关注的商品 {0} 涨价咯！价格相较于上次监测，高了 {1} 元，现价 {2} 元。商品详情：https://item.jd.com/{0}.html\"</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>,price,nowPrice)</span><br><span class=\"line\">            send(title,content)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"built_in\">type</span> == <span class=\"number\">1</span>:</span><br><span class=\"line\">            print(<span class=\"string\">\"价格没有变化，不推送通知。\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"built_in\">type</span> == <span class=\"number\">2</span>:</span><br><span class=\"line\">            title = <span class=\"string\">\"商品 {0} 降价!\"</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>)</span><br><span class=\"line\">            content = <span class=\"string\">\"您关注的商品 {0} 降价咯！价格相较于上次监测，低了 {1} 元，现价 {2} 元。商品详情：https://item.jd.com/{0}.html\"</span>.<span class=\"built_in\">format</span>(<span class=\"built_in\">id</span>, price,nowPrice)</span><br><span class=\"line\">            send(title, content)</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">False</span></span><br></pre></td></tr></table></figure>\n</div></details><details class=\"post-details\"><summary><code>.github/workflows/auto.yml</code> (点击展开)</summary><div class=\"details-content\">  <figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Check</span> <span class=\"string\">Price</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">master</span></span><br><span class=\"line\">  <span class=\"attr\">schedule:</span></span><br><span class=\"line\">    <span class=\"comment\"># 每 1 小时运行一次</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">cron:</span> <span class=\"string\">\"0 * * * *\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">check:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Clone</span> <span class=\"string\">repository</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v2</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">'Set up Python'</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/setup-python@v2</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">python-version:</span> <span class=\"number\">3.7</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Run</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">python</span> <span class=\"string\">main.py</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Push</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--local</span> <span class=\"string\">user.email</span> <span class=\"string\">\"icolabot@e.yfun.top\"</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--local</span> <span class=\"string\">user.name</span> <span class=\"string\">\"iColaBot\"</span></span><br><span class=\"line\">          <span class=\"string\">date</span> <span class=\"string\">+\"%Y-%m-%d</span> <span class=\"string\">%H:%M:%S.%N\"</span> <span class=\"string\">&gt;</span> <span class=\"string\">date.txt</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">add</span> <span class=\"string\">-A</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">commit</span> <span class=\"string\">-am</span> <span class=\"string\">\"Update price.json\"</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">push</span> <span class=\"string\">origin</span> <span class=\"string\">master</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</div></details><h2>\n<a href=\"https://blog.yfun.top/#%E6%B3%A8%E6%84%8F\" class=\"headerlink\" title=\"注意\"></a>注意</h2>\n<p>计划任务语法有 5 个字段，中间用空格分隔，每个字段代表一个时间单位。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌───────────── 分钟 (0 - 59)</span><br><span class=\"line\">│ ┌───────────── 小时 (0 - 23)</span><br><span class=\"line\">│ │ ┌───────────── 日 (1 - 31)</span><br><span class=\"line\">│ │ │ ┌───────────── 月 (1 - 12 或 JAN-DEC)</span><br><span class=\"line\">│ │ │ │ ┌───────────── 星期 (0 - 6 或 SUN-SAT)</span><br><span class=\"line\">│ │ │ │ │</span><br><span class=\"line\">│ │ │ │ │</span><br><span class=\"line\">│ │ │ │ │</span><br><span class=\"line\">* * * * *</span><br></pre></td></tr></table></figure><p>每个时间字段的含义：</p>\n<table>\n<thead><tr>\n<th align=\"center\">符号</th>\n<th align=\"center\">描述</th>\n<th align=\"center\">举例</th>\n</tr></thead>\n<tbody>\n<tr>\n<td align=\"center\"><code>*</code></td>\n<td align=\"center\">任意值</td>\n<td align=\"center\">\n<code>* * * * *</code> 每天每小时每分钟</td>\n</tr>\n<tr>\n<td align=\"center\"><code>,</code></td>\n<td align=\"center\">值分隔符</td>\n<td align=\"center\">\n<code>1,3,4,7 * * * *</code> 每小时的 1 3 4 7 分钟</td>\n</tr>\n<tr>\n<td align=\"center\"><code>-</code></td>\n<td align=\"center\">范围</td>\n<td align=\"center\">\n<code>1-6 * * * *</code> 每小时的 1-6 分钟</td>\n</tr>\n<tr>\n<td align=\"center\"><code>/</code></td>\n<td align=\"center\">每</td>\n<td align=\"center\">\n<code>*/15 * * * *</code> 每隔 15 分钟</td>\n</tr>\n</tbody>\n</table>\n<blockquote><p>注：由于 GitHub Actions 的限制，如果设置为 <code>* * * * *</code> 实际的执行频率为每 5 分执行一次。</p></blockquote>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%90%8E\" class=\"headerlink\" title=\"后\"></a>后</h2>\n<p>新建文件 并 配置 <code>notify.py</code> 后，GitHub Action 就会定时执行代码。如果有降价或涨价，就会按照 <code>notify.py</code> 的配置进行通知。</p>\n<p>京东也有降价提醒的功能，但我实在是不想给 京东 开通知权限，经常推送商品广告。</p>\n<p>本文部分内容参考：<a href=\"https://github.com/justjavac/auto-green#readme\">justjavac/auto-green#readme</a></p>\n","link":"https://blog.yfun.top/posts/1238639652/"},{"title":"我的图床解决方案","date":"2021-05-08 10:30:00","description":"\n<p>博客的文章经常需要插入图片，如果我将文档与图片放在一起，那么图片的加载速度将会很慢，于是我使用了图床。</p>\n<p>图床的选择有很多，<a href=\"https://blog.yfun.top/posts/3867215122/\">笔者之前写过一篇关于免费图床的汇总</a>，本文就来介绍下我采用的方案：NPM。</p>\n<blockquote><p>本文假设您已有 NPM 账号、GitHub 账号。</p></blockquote>\n<h2>\n<a href=\"https://blog.yfun.top/#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2>\n<h3>\n<a href=\"https://blog.yfun.top/#%E6%96%B0%E5%BB%BA%E4%BB%93%E5%BA%93\" class=\"headerlink\" title=\"新建仓库\"></a>新建仓库</h3>\n<p>新建一个 GitHub 仓库，公开或是私人都可以，此处不再赘述。</p>\n<p>在 Git 仓库中新建 <code>rawimg/.gitkeep</code> 与 <code>webpimg/.gitkeep</code> 两个文件。</p>\n<h3>\n<a href=\"https://blog.yfun.top/#%E8%8E%B7%E5%8F%96%E4%BB%A4%E7%89%8C\" class=\"headerlink\" title=\"获取令牌\"></a>获取令牌</h3>\n<p>登录 <a href=\"https://npmjs.com/\">https://npmjs.com</a> ，点击右上角的头像，进入 <code>Access Token</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/1Xbrlw.png\"></p>\n<p>点击页面中的 <code>Generate New Token</code> 获取新的令牌。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/OQMmsB.png\"></p>\n<p>选择 <code>Automation</code>，点击 <code>Generate Token</code> 生成令牌。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/4Ob3xs.png\"></p>\n<p>将生成的令牌复制下来。</p>\n<p>进入 GitHub 仓库，点击 <code>Settings</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/UfBqld.png\"></p>\n<p>点击菜单栏中的 <code>Secrets</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/SStNlF.png\"></p>\n<p>点击 <code>New repository secret</code> 新建一个 Secret。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/UYSnao.png\"></p>\n<p>Secret Name 为 <code>NPM_TOKEN</code>，Value 是你的 NPM 令牌，点击 <code>Add secret</code> 添加。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/OY4C6A.png\"></p>\n<p>在仓库中新建 <code>package.json</code> 文件，参考如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\">{</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"ocoke-osg\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"0.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Somewhere to save the file from @oCoke\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"author\"</span>: <span class=\"string\">\"YFun(@oCoke)\"</span></span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure><h2>\n<a href=\"https://blog.yfun.top/#%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E4%B8%8E%E5%8F%91%E5%B8%83\" class=\"headerlink\" title=\"图片转换与发布\"></a>图片转换与发布</h2>\n<p>为了方便多端写作，我使用 GitHub 临时存储所需的图片，GitHub Action 发布 NPM 包。</p>\n<p>WebP 可以大大缩减图片的尺寸，我们还可以借助 GitHub Action 在发布前自动转换。</p>  <details class=\"post-details\"><summary>GitHub Action 代码 (点击展开)</summary><div class=\"details-content\">  <figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">NPM</span> <span class=\"string\">&amp;</span> <span class=\"string\">WebP</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在 Release 发布时 或手动执行</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">release:</span></span><br><span class=\"line\">     <span class=\"attr\">types:</span></span><br><span class=\"line\">       <span class=\"bullet\">-</span> <span class=\"string\">published</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">workflow_dispatch:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">publish-npm:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"comment\"># Clone 仓库</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Checkout</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v2</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">ref:</span> <span class=\"string\">master</span></span><br><span class=\"line\">      <span class=\"comment\"># 安装 Node.js    </span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Setup</span> <span class=\"string\">Node</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/setup-node@v1</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">node-version:</span> <span class=\"string\">\"12.x\"</span></span><br><span class=\"line\">          <span class=\"attr\">registry-url:</span> <span class=\"string\">https://registry.npmjs.org/</span></span><br><span class=\"line\">        </span><br><span class=\"line\">      <span class=\"comment\"># rawimg/ 作为原始图片存储，webpimg/ 作为压缩图片存储处，最后合并。</span></span><br><span class=\"line\">      <span class=\"comment\"># 安装相关插件，转换图片。</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Install</span> <span class=\"string\">&amp;</span> <span class=\"string\">Convert</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">npm</span> <span class=\"string\">install</span> <span class=\"string\">-g</span> <span class=\"string\">webp-batch-convert</span></span><br><span class=\"line\">          <span class=\"string\">cwebp-batch</span> <span class=\"string\">--in</span> <span class=\"string\">rawimg</span> <span class=\"string\">--out</span> <span class=\"string\">webpimg</span> <span class=\"string\">-q</span> <span class=\"number\">75</span> <span class=\"string\">-quiet</span></span><br><span class=\"line\">          <span class=\"string\">mv</span> <span class=\"string\">webpimg/*.webp</span> <span class=\"string\">rawimg/</span></span><br><span class=\"line\">          </span><br><span class=\"line\">      <span class=\"comment\"># 发布 NPM 包</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Publish</span> <span class=\"string\">Package</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.email</span> <span class=\"string\">\"icolabot@e.yfun.top\"</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">config</span> <span class=\"string\">--global</span> <span class=\"string\">user.name</span> <span class=\"string\">\"iColaBot\"</span></span><br><span class=\"line\">          <span class=\"string\">npm</span> <span class=\"string\">version</span> <span class=\"string\">patch</span></span><br><span class=\"line\">          <span class=\"string\">npm</span> <span class=\"string\">publish</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">          <span class=\"attr\">NODE_AUTH_TOKEN:</span> <span class=\"string\">${{secrets.npm_token}}</span></span><br><span class=\"line\">          </span><br><span class=\"line\">      <span class=\"comment\"># 删除 rawimg/ 和 webpimg/ 下的所有文件</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Delete</span> <span class=\"string\">Files</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">rm</span> <span class=\"string\">-rf</span> <span class=\"string\">webpimg/*</span></span><br><span class=\"line\">          <span class=\"string\">rm</span> <span class=\"string\">-rf</span> <span class=\"string\">rawimg/*</span></span><br><span class=\"line\">          <span class=\"string\">touch</span> <span class=\"string\">webpimg/.gitkeep</span></span><br><span class=\"line\">          <span class=\"string\">touch</span> <span class=\"string\">rawimg/.gitkeep</span></span><br><span class=\"line\">          </span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Push</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">|</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">add</span> <span class=\"string\">-A</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">commit</span> <span class=\"string\">-m</span> <span class=\"string\">\"Publish\"</span></span><br><span class=\"line\">          <span class=\"string\">git</span> <span class=\"string\">push</span> <span class=\"string\">origin</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure>\n</div></details><h2>\n<a href=\"https://blog.yfun.top/#%E4%BD%BF%E7%94%A8\" class=\"headerlink\" title=\"使用\"></a>使用</h2>\n<h3>\n<a href=\"https://blog.yfun.top/#%E4%B8%8A%E4%BC%A0\" class=\"headerlink\" title=\"上传\"></a>上传</h3>\n<p>将图片文件上传至仓库的 <code>rawimg/</code> 文件夹下即可。</p>\n<p>当然也可以使用 PicGo / UPic / HexoPlusPlus 等工具上传。</p>\n<h3>\n<a href=\"https://blog.yfun.top/#%E5%8F%91%E5%B8%83\" class=\"headerlink\" title=\"发布\"></a>发布</h3>\n<p>在 GitHub 中新建 Release，将自动修改版本号并发布 NPM 包，无需手动修改 <code>package.json</code>。</p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/t2afFy.png\"></p>\n<p><img src=\"https://cdn.jsdelivr.net/npm/ocoke-osg@0.0.8/rawimg/0wAmRV.png\"></p>\n<h3>\n<a href=\"https://blog.yfun.top/#%E8%AE%BF%E9%97%AE\" class=\"headerlink\" title=\"访问\"></a>访问</h3>\n<h4>\n<a href=\"https://blog.yfun.top/#%E6%8E%A8%E8%8D%90%E7%9A%84%E9%95%9C%E5%83%8F\" class=\"headerlink\" title=\"推荐的镜像\"></a>推荐的镜像</h4>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">https://cdn.jsdelivr.net/npm/  <span class=\"comment\"># jsDelivr</span></span><br><span class=\"line\">https://unpkg.zhimg.com/ <span class=\"comment\"># 知乎</span></span><br><span class=\"line\">https://code.bdstatic.com/npm/ <span class=\"comment\"># 百度 (不推荐)</span></span><br><span class=\"line\">https://shadow.elemecdn.com/npm/ <span class=\"comment\"># 饿了么</span></span><br><span class=\"line\">https://unpkg.com/ <span class=\"comment\"># Unpkg</span></span><br></pre></td></tr></table></figure><p>镜像推荐选择访问速度快的，比较稳定的，拉取速度快的。</p>\n<p>我选择的是 jsDelivr，国内外速度都很优秀。</p>\n<h4>\n<a href=\"https://blog.yfun.top/#%E9%93%BE%E6%8E%A5\" class=\"headerlink\" title=\"链接\"></a>链接</h4>\n<p>以 jsDelivr 为例，原图链接为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">https://cdn.jsdelivr.net/npm/[package-name]@[version]/rawimg/[filename].[suffix]</span><br></pre></td></tr></table></figure><p>WebP 图片链接为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">https://cdn.jsdelivr.net/npm/[package-name]@[version]/rawimg/[filename].webp</span><br></pre></td></tr></table></figure><table>\n<thead><tr>\n<th>[值]</th>\n<th>说明</th>\n</tr></thead>\n<tbody>\n<tr>\n<td><code>package-name</code></td>\n<td>NPM 包的名称 (<code>package.json</code> 文件中 <code>name</code> 的值)</td>\n</tr>\n<tr>\n<td><code>version</code></td>\n<td>当前版本 (<code>package.json</code> 文件中 <code>version</code> 的值，通常需要在发布 Release 1 分钟后更新)</td>\n</tr>\n<tr>\n<td><code>filename</code></td>\n<td>文件名</td>\n</tr>\n<tr>\n<td><code>suffix</code></td>\n<td>文件后缀名</td>\n</tr>\n</tbody>\n</table>\n","link":"https://blog.yfun.top/posts/2876015612/"},{"title":"使用 JS 检测网址能否正常加载","date":"2021-04-09 12:42:00","description":"\n<p>有时我们需要判断用户能否加载某些网页或服务，如 Google、Disqus 等。</p>\n<p>而我们可以用 JavaScript 来实现这样的检测功能。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E6%96%B9%E6%B3%95%E4%B8%80\" class=\"headerlink\" title=\"方法一\"></a>方法一</h2>\n<p>使用 JavaScript 创建一个图片，设置图片的链接为 检测网址 + <code>favicon.ico</code>。</p>\n<p><code>onerror</code> 事件触发不能加载的事件，<code>onload</code> 事件触发可以加载的事件，并使用 <code>setTimeout</code> 设置超时时间。</p>\n<p>代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新建一个图片</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\"><span class=\"comment\">// 设置图片的链接</span></span><br><span class=\"line\">img.src = <span class=\"string\">\"https://google.com/favicon.ico\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设定超时事件，延迟 3000 毫秒</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 清除 onerror 和 onload 事件</span></span><br><span class=\"line\">img.onerror = img.onload = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"time out.\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 执行无法加载的事件</span></span><br><span class=\"line\">    canNotLoad();</span><br><span class=\"line\">},<span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设定错误事件</span></span><br><span class=\"line\">img.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 先清除超时事件</span></span><br><span class=\"line\"><span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"load error.\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 执行无法加载的事件</span></span><br><span class=\"line\">    canNotLoad();</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设定可以加载的事件</span></span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 先清除超时事件</span></span><br><span class=\"line\"><span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">\"ok.\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 执行可以加载的事件</span></span><br><span class=\"line\">    canLoad();</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">canNotLoad</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">/* code here */</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"无法加载\"</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">canLoad</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">/* code here */</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"可以加载\"</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure><p>缺点：不是每一个网站都存在 <code>/favicon.ico</code> 文件，但如果加载特定文件的话挺好的。</p>\n<h2>\n<a href=\"https://blog.yfun.top/#%E6%96%B9%E6%B3%95%E4%BA%8C\" class=\"headerlink\" title=\"方法二\"></a>方法二</h2>\n<p>使用 JavaScript 创建一个 iframe 标签，设置标签的链接为 检测网址。</p>\n<p><code>onerror</code> 事件触发不能加载的事件，<code>onload</code> 事件触发可以加载的事件，并使用 <code>setTimeout</code> 设置超时时间。</p>\n<p>代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新建 iframe 标签</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> iframe = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"iframe\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设置 iframe 标签的网址</span></span><br><span class=\"line\">iframe.src=<span class=\"string\">\"https://google.com\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 设定超时事件，延迟 3000 毫秒</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> timeout = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 清除 onerror 和 onload 事件</span></span><br><span class=\"line\">    iframe.onerror = iframe.onload = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"time out.\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 执行无法加载的事件</span></span><br><span class=\"line\">    canNotLoad();</span><br><span class=\"line\">},<span class=\"number\">3000</span>);</span><br><span class=\"line\"><span class=\"comment\">// 设定错误事件</span></span><br><span class=\"line\">iframe.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 先清除超时事件</span></span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"load error.\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 执行无法加载的事件</span></span><br><span class=\"line\">    canNotLoad();</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 设定可以加载的事件</span></span><br><span class=\"line\">iframe.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">// 先清除超时事件</span></span><br><span class=\"line\">    <span class=\"built_in\">clearTimeout</span>(timeout);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"ok.\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 执行可以加载的事件</span></span><br><span class=\"line\">    canLoad();</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">canNotLoad</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">/* code here */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">canLoad</span>(<span class=\"params\"></span>) </span>{</span><br><span class=\"line\">    <span class=\"comment\">/* code here */</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"comment\">// 设定为不可见</span></span><br><span class=\"line\">iframe.style = <span class=\"string\">\"display: none!important;\"</span>;</span><br><span class=\"line\"><span class=\"comment\">// 向 body 添加 iframe</span></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(iframe);</span><br></pre></td></tr></table></figure><p>缺点：页面上的其他外部链接也会被一并的加载过来，例如 JS 文件，CSS 文件，统计代码。</p>\n<p>您也可以 <a href=\"https://codepen.io/ocoke-the-decoder/pen/dyNZEwq\">点击此链接</a> 前往 CodePen 体验。</p>\n","link":"https://blog.yfun.top/posts/856484826/"},{"title":"无垠 2020 年度总结","date":"2020-12-29 21:04:02","description":"\n<p>2020 即将过去，2021 已在眼前。2020 实在是多灾多难的一年，新冠疫情可以说是严重打乱了我的生活计划，希望新的一年，一切都可以变好吧。</p>\n<p>2020 还剩下最后两天，是时候总结一下这一年了。</p>\n<h1>统计数据</h1>\n<p>依然是一些统计数据。以下数据截止 2020 年 12 月 29 日 23:39:59。</p>\n<h2>博客主站</h2>\n<p>无垠博客主站，年 UV 28,888 (<span>+7.4%</span>)，年 PV 76,583 (<span>-1.66%</span>)，日均 UV 79.36，平均停留时间 4分8秒 (<span>-21.4%</span>)，平均跳出率 51% (<span>-3.77%</span>)。一年有效文章数 5 (<span>+150%</span>)，新增评论 242 条 (<span>-44.9%</span>)。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/blog-2020.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/blog-2020.png\" alt=\"\" width=\"515\" height=\"670\" class=\"aligncenter size-full wp-image-2432\"></a>\n<p>文章数提升，访问量也有所提升，但 PV 和停留时间却下降了，或许我还需要继续提高文章的质量...</p>\n<h2>个人主页</h2>\n<p>个人主页依然是几乎没有更新过。什么时候能把 TODO List 上的东西做了呢？我也不知道。不过访问量倒是比去年上升了不少。</p>\n<p>个人页总 UV 3,515 (<span>+64.2%</span>)，总 PV 3,929 (<span>+43.2%</span>)，日均 UV 9.9 (<span>+65%</span>)，平均停留时间 63秒 (<span>+1.6%</span>)。和去年一样，主要来源是知乎和 V2EX。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/axton-2020.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/axton-2020.png\" alt=\"\" width=\"515\" height=\"670\" class=\"aligncenter size-full wp-image-2433\"></a>\n<h2>MDx</h2>\n<p>一年中，MDx 更新了 7 次，新增 328 commits (<span>+91.8%</span>)，Star 数增加了 306，现有 614。感谢所有人的支持。当然，虽然 2.0 咕咕咕了很久（甚至离最早的承诺已经过去将近一年半了），但我已经在对 2.0 进行最后的完善（改动确实比较大）。相信在 2021 的开头，MDx 2.0 就能顺利发布了。</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"yrccondor\" data-mdxgithubp=\"mdx\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/yrccondor/mdx\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<h1>大事记</h1>\n<ul>\n<li>一月：我经历过的最长的“寒假”开始了</li>\n<li>二月：GitHub followers 换虚拟币，成功换到 3.5k CNY 没有翻车</li>\n<li>三月：<a href=\"https://flyhigher.top/develop/2160.html\">WP-WebAuthn</a> 插件成功上线 <a href=\"https://wordpress.org/plugins/wp-webauthn/\">WordPress 插件目录</a>\n</li>\n<li>四月：Cytus II 主线大结局<del>，我当场通关 </del>\n</li>\n<li>五月：开始学车</li>\n<li>五月：MDx 达到 500 Stars</li>\n<li>七月：第一次实习，公司的前端技术栈和我熟悉的完全一致<del>，于是愉快地在公司里写了一个半月的各种表格 </del>\n</li>\n<li>八月：实习结束，部门同事都很棒，确实学到了很多</li>\n<li>九月：和 Ralph 面基一整天</li>\n<li>九月：入手树莓派 4B</li>\n<li>十月：搬家</li>\n<li>十月：和宁诺合作的 H5 上线</li>\n<li>十一月：TEDxNingbo 年度大会，H5 上线<del>，持续摸鱼中 </del>\n</li>\n<li>十一月：终于买了块副屏，<del> 秃头 </del>写代码更快乐了</li>\n<li>十二月：MDx 喜提 600 Stars</li>\n</ul>\n<h1>跨年红包</h1>\n<p><del>传统艺能时间！和以前一样，红包不是白拿的，你需要一点点技术力来解密拿到红包。有效期截至 2021 年 1 月 1 日 22 时。</del></p>\n<p>今年的解谜旅程，从下面这段颜文字开始。</p>\n<pre>ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ ['_']; o=(ﾟｰﾟ)  =_=3; c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) =(ﾟΘﾟ)= (o^_^o)/ (o^_^o);(ﾟДﾟ)={ﾟΘﾟ: '_' ,ﾟωﾟﾉ : ((ﾟωﾟﾉ==3) +'_') [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ '_')[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ==3) +'_')[ﾟｰﾟ] }; (ﾟДﾟ) [ﾟΘﾟ] =((ﾟωﾟﾉ==3) +'_') [c^_^o];(ﾟДﾟ) ['c'] = ((ﾟДﾟ)+'_') [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) ['o'] = ((ﾟДﾟ)+'_') [ﾟΘﾟ];(ﾟoﾟ)=(ﾟДﾟ) ['c']+(ﾟДﾟ) ['o']+(ﾟωﾟﾉ +'_')[ﾟΘﾟ]+ ((ﾟωﾟﾉ==3) +'_') [ﾟｰﾟ] + ((ﾟДﾟ) +'_') [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+((ﾟｰﾟ==3) +'_') [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) ['c']+((ﾟДﾟ)+'_') [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) ['o']+((ﾟｰﾟ==3) +'_') [ﾟΘﾟ];(ﾟДﾟ) ['_'] =(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)=((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+'_') [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ==3) +'_') [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+ (ﾟωﾟﾉ +'_') [ﾟΘﾟ]; (ﾟｰﾟ)+=(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]='\\\\'; (ﾟДﾟ).ﾟΘﾟﾉ=(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)=(ﾟωﾟﾉ +'_')[c^_^o];(ﾟДﾟ) [ﾟoﾟ]='\\\"';(ﾟДﾟ) ['_'] ( (ﾟДﾟ) ['_'] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) ('_')</pre>\n<p><del>和去年一样，红包限时不限量。</del>为了保持解谜乐趣，请不要将答案透露给他人，也请不要重复领取红包，否则视情况活动可能会提前结束。</p>\n<p>由于出现大量重复领取/未解题即领取红包的现象，红包解谜活动立即结束，当前红包领完后将不再更新新的红包口令码。<strong>我发起红包解谜活动是为了解题的乐趣而不是发钱，请各位理解。</strong>以下是详细信息。</p>\n<p>出于对参与者的信任，今年的题目中没有对参与者是否已完成前序步骤进行任何验证，但在最后的 WebSocket 中我记录下了所有成功连接的 IP。今年共发出了 32 个红包，但最后一个步骤的日志只记录到了 25 个不重复 IP（鉴于第一批 10 个红包领完时只记录到了四个 IP，实际人数应该小于 25）。查阅支付宝的红包领取记录可以发现有多位用户多次领取了红包，还有一些用户疑似是从他人处获取答案并直接领取的。鉴于活动已经完全失去意义，我选择提前结束了红包解谜活动。</p>\n<h2>红包答案</h2>\n<p>现在，让我们来看看答案吧。今年的题目难度不高，由于事情比较多，我的准备时间确实不多。</p>\n<p>第一阶段非常简单，这段颜文字就是 Javascript，只是使用了著名的 aaencode 将其编码为了颜文字<del>（多亏了 js 优秀的自动类型转换）</del>。将这段颜文字扔进浏览器控制台即可得到 <code>https://rp.dlij.site/2021/</code>。</p>\n<p>前往这个 URL，可以看到这张图。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/index.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/index.png\" alt=\"\" width=\"2000\" height=\"1125\" class=\"aligncenter size-full wp-image-2444\"></a>\n<p>今年八月宝塔面板 7.4.2 的 phpMyAdmin 未授权访问漏洞很多人都知道了，如果你不清楚，搜索“宝塔面板 7.4.2”也能找到相关信息。首先找到 <code>rp.dlij.site</code> 对应的 IP 是 <code>121.196.27.125</code>，访问 <code>http://121.196.27.125:888/pma</code> 即可看到一个 phpMyAdmin 的界面（为了把这个页面扒下来我还装了一个真的宝塔面板...）。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/pma.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/pma.jpg\" alt=\"\" width=\"1600\" height=\"867\" class=\"aligncenter size-full wp-image-2448\"></a>\n<p>可以看到信息是 <code>7972632E6D652F6738546D444A3132</code>。和前年一样，这其实是十六进制的 ASCII 码，每两位转为 ASCII 字符即可得到 <code>yrc.me/g8TmDJ12</code>。访问这个页面，可以看到如下信息。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/apl.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/apl.jpg\" alt=\"\" width=\"1500\" height=\"248\" class=\"aligncenter size-full wp-image-2447\"></a>\n<p>这是 APL，一种有趣的函数式编程语言。你可能不了解它，但只要你搜索网页的 <code>title</code>，就能找到这个在线运行 APL 的页面：<a href=\"https://tryapl.org/\">TryAPL</a>。在这个页面中粘贴这段代码，即可得到 <code>https://rp.dlij.site/2021/2554038.75</code>。访问这个 URL，可以看到一张图。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/2021-b.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/2021-b.jpg\" alt=\"\" width=\"720\" height=\"960\" class=\"aligncenter size-full wp-image-2445\"></a>\n<p>连续三年的传统艺能了，压缩包藏在了图片里。下载图片，将后缀改为 .zip 然后打开，可以看到一个 README.md。其中要求我们去 <code>ws://121.196.27.125:8080/NvAhoZ9@H2Au</code> 获取最终红包口令码。这是一个 WebSocket 协议的地址，在浏览器中开一个新 Console，执行 <code>new WebSocket('ws://121.196.27.125:8080/NvAhoZ9@H2Au')</code> 即可在 Network 选项卡中看见服务器下发的红包口令码。当然，别忘了将其反转。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/message.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/message.jpg\" alt=\"\" width=\"475\" height=\"179\" class=\"aligncenter size-full wp-image-2446\"></a>\n<h1>跨年海报</h1>\n<p>依然是传统艺能，今年的海报只用到了 PS。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/2021.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/12/2021.jpg\" alt=\"2021\" width=\"720\" height=\"960\" class=\"aligncenter size-full wp-image-2407\"></a>\n<p>提前祝各位新年快乐！</p>\n","link":"https://flyhigher.top/diary/2405.html"},{"title":"[译] HentaiVerse 建议和指导","date":"2020-12-24 22:31:00","description":"\n<p>著名的同人本资源集散地 E-hentai 有一个完全没有人在意的角落 ——「HentaiVerse」，一个纯文字网页 RPG 游戏。虽然这个游戏应该不会有太多新玩家了，不过还是翻译一篇给新玩家的指导文吧。</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/209138/1/18651/50218/622032acEf83a8d68/fc6db86aebb679ff.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/hentaiverse-advice/\">https://blog.skk.moe/post/hentaiverse-advice/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/hentaiverse-advice/"},{"title":"ZSH 自动读取 macOS 系统代理配置并设置环境变量","date":"2020-12-07 02:47:00","description":"\n<p>和其它 Linux 的 DE 一样，macOS 也支持在「系统偏好设置」中设置 HTTP 代理、HTTPS 代理，但是 macOS 并不会在终端（Terminal、iTerm）的 shell 中自动生效系统代理配置。为了方便日常使用，我决定好好研究一下 macOS 的系统代理。macOS 系统代理的行为和 Linux 和 Windows 只有一种系统代理配置不同，macOS 为每一种网络设备（Wi-Fi、Ethernet、Bluetooth PAN 等）维护了独立的网络配置，包括代理配置在内。因此当切换网络设备时，macOS 会使用不同的代理配置；如果同时连接了多个网络设备，则操作系统会优先采用在「系统偏好设置」网络「Service Order」靠上的设备的代理配置：...</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/207910/19/18573/59096/622032b0E05c1d4be/5d89d557f7889730.jpg\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/macos-auto-read-proxy-settings-zsh/\">https://blog.skk.moe/post/macos-auto-read-proxy-settings-zsh/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/macos-auto-read-proxy-settings-zsh/"},{"title":"谈谈 Apple M1 芯片、ARM、ARM Mac 和黑苹果的未来","date":"2020-11-11 16:13:00","description":"\n<p>2020 年 11 月 11 日，苹果在本年度最后一次 Apple Events 上发布了全新的 ARM 芯片 M1、以及三款搭载了 M1 的 Mac：MacBook Air、MacBook Pro 13‘ 和 Mac Mini。在 WWDC 2020 库克宣布 Apple Silicon 后，这次 Apple Events 再一次掀起了热潮，不少 KOL 都把 M1 奉若神明，不少人也不以为然。本文通过 8 个问题来简单聊聊 M1 和 ARM Mac。M1 芯片的性能如何？本文写就时，搭载 M1 的 Mac 尚未开始发货，我们能看到的只有 GeekBench 上流出的跑分。所以，让我们先从跑分开始看起？...</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/138186/40/23101/50775/622032b3Efa9053d7/df3a819d044a9455.jpg\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/talk-about-arm-m1-mac/\">https://blog.skk.moe/post/talk-about-arm-m1-mac/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/talk-about-arm-m1-mac/"},{"title":"USTC Hackergame 2020（中科大信安赛）write up","date":"2020-11-06 22:00:00","description":"\n<p>作为一只 CS 零基础、信安零基础、CTF 零基础的菜狐狐，苏卡卡今年又来参加 USTC Hackergame 啦！由于一边做题一边总结思路（指写 Write Up），所以苏卡卡应该是第一个发布非官方的 USTC Hackergame 2020 Write Up 的吧（嘿嘿）。</p>\n<blockquote>\n<p>题图来自 USTC Hackergame 2019「Happy LUG」</p>\n</blockquote>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/90743/25/22680/55545/622032abE6ef31d51/cfc4cb389c994c17.png\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/hackergame-2020-write-up/\">https://blog.skk.moe/post/hackergame-2020-write-up/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/hackergame-2020-write-up/"},{"title":"Bilibili 2020「1024 程序员节」CTF Write Up","date":"2020-10-25 09:44:00","description":"\n<blockquote>\n<p>周六不放假休息，还在这加班搞 CTF？</p>\n</blockquote>\n<p>10 月 24 日不睡觉、凌晨两点钟我还在水群，结果在 USTC@LUG 的群里看见有人在打 Bilibili 的 CTF。我刚刚好一年（指 370 天）没有打过 CTF 了（上一次打正式的 CTF 还是去年参加的 <a href=\"https://blog.skk.moe/post/hackergame-2019-write-up/\">USTC Hackergame 2019</a>），所以想着来玩玩。虽然 CTF 结束之前不应该分享和公开 Write Up 和题解，不过 Bilibili 这 CTF 既然这么离谱，那我也没必要按照常理出牌。</p>\n<img src=\"https://img10.360buyimg.com/ddimg/jfs/t1/86535/11/24318/75037/622032a8E4f94d4ae/89703ccc122cf4e0.jpg\"><br><p>请前往 <a href=\"https://blog.skk.moe/post/2020-bilibili-1024-ctf-write-up/\">https://blog.skk.moe/post/2020-bilibili-1024-ctf-write-up/</a> 阅读全文</p>\n","link":"https://blog.skk.moe/post/2020-bilibili-1024-ctf-write-up/"},{"title":"谈谈 WebAuthn","date":"2020-03-23 14:57:59","description":"\n<p>WebAuthn，即 Web Authentication，是一个用于在浏览器上进行认证的 API，W3C 将其表述为 \"An API for accessing Public Key Credentials\"，即“一个用于访问公钥凭证的 API”。WebAuthn 很强大，强大到被认为是 Web 身份认证的未来（当然，也很复杂）。你有想过通过指纹或者面部识别来登录网站吗？WebAuthn 就能在保证安全和隐私的情况下让这样的想法成为现实。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/wwa.gif\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/wwa.gif\" alt=\"通过 WebAuthn 调起 Windows Hello 登录网站\" width=\"1912\" height=\"966\" class=\"aligncenter size-full wp-image-2215\"></a>\n<p>你可以在<a href=\"https://webauthn.io/\" rel=\"noopener\">这个网站</a>自行体验 WebAuthn。或者，如果你有一个使用 WordPress 的站点，可以尝试一下 <a href=\"https://wordpress.org/plugins/wp-webauthn/\">WP-WebAuthn</a> 这款插件，它可以为你的站点启用 WebAuthn 登录。这是我为了写这篇文章而练手开发的插件，本文中的部分示例代码也来自这款插件。</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"yrccondor\" data-mdxgithubp=\"wp-webauthn\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/yrccondor/wp-webauthn\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<p>WebAuthn Level 1 标准已在 2019 年 3 月成为 W3C 推荐标准，而 Level 2 标准目前也已进入编辑草案阶段，但互联网上有关它的中文资料却仍然很少，国内也鲜有网站支持这一新标准。于是，在抱着各种英文资料和标准啃了几天以后，我折腾出了这篇文章。</p>\n<p>在这篇文章里，我将会从最基本的概念开始，逐渐深入 WebAuthn，直到解码公钥等深层细节。这可能是你能找到的有关 WebAuthn 最详细最基础的中文文章，也很可能是最长的。在开始之前，<strong>我强烈建议你打开菜单中的文章目录浏览一遍，以对这篇文章涉及的内容有所了解。</strong>如果你只是想了解如何简单地在你的项目中添加对 WebAuthn 的支持，那么“<a href=\"https://flyhigher.top/#webauthn-overview\">浅谈 WebAuthn</a>”部分就是你要找的；如果你想了解更多关于 WebAuthn 的底层细节，那么你可以继续阅读“<a href=\"https://flyhigher.top/#deep-into-webauthn\">深入了解 WebAuthn</a>”部分。</p>\n<p>由于在本文写作时 WebAuthn Level 2 规范尚未定稿，<strong>这篇文章我们将只专注于 Level 1 规范。</strong></p>\n<p>这篇文章最后更新于 2020.9 ，在你读到这篇文章时，部分事实可能已经发生改变，请注意判断。</p>\n<p><strong>更新日志：</strong></p>\n<ul>\n<li>2021.1.16 添加 Chrome 开发工具信息</li>\n<li>2020.9.17 更新 iOS/iPad OS 兼容性信息</li>\n<li>2020.5.20 添加部分无用户名认证的平台兼容性内容</li>\n<li>2020.5.15 添加部分 <code>extensions</code> 相关内容与链接；添加全局凭证 ID 唯一内容；添加凭证 ID 查找相关内容；添加“从 U2F 认证迁移”一节</li>\n<li>2020.4.13 更新与修正 <code>userVerification</code> 相关内容；添加部分 Firefox 相关内容</li>\n<li>2020.3.23 文章发布</li>\n</ul>\n<p>那么让我们开始吧。<span></span></p>\n<h1>浅谈 WebAuthn</h1>\n<p>在这个部分里，我们将会从基础概念开始，了解有关 WebAuthn 和密码学的一些基础知识，并最终使用第三方库实现基础的 WebAuthn 认证。如果你已经对这些内容有所了解了，可以跳到“<a href=\"https://flyhigher.top/#deep-into-webauthn\">深入了解 WebAuthn</a>”继续阅读。</p>\n<h2>为什么使用 WebAuthn</h2>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/2.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/2.png\" alt=\"钓鱼邮件\" width=\"709\" height=\"693\" class=\"aligncenter size-full wp-image-2162\"></a>\n<p>相信你一定收到过类似的邮件吧？只要你点进那个最显眼的链接，你就会进入一个设置好的圈套——钓鱼网站。如果你一时糊涂在这类网站上填写了你的账号和密码，bingo，你的账号就不再是你的账号了。</p>\n<p>不过，就算你警惕心再强，也无法避免密码泄露事件。Twitter, Facebook 等都爆出过明文密码泄露事件，证明再大的公司或组织也无法避免密码泄露问题。雪上加霜的是，很大一部分用户都非常喜欢使用重复密码，这就导致一次密码泄露会牵连很多网站，用户的账户安全性完全无法得到保证。</p>\n<p>那么，有什么办法解决这些问题吗？<strong>彻底解决的方法只有一个，那就是抛弃密码。</strong>可是没有密码还怎么验证用户身份呢？这就是 WebAuthn 的用武之地了。</p>\n<p><del>没有密码的好时代，来临力！</del></p>\n<h2>什么是 WebAuthn</h2>\n<p>那么到底什么是 WebAuthn 呢？如开头所说，WebAuthn 是“一个用于访问公钥凭证的 API”，网站可以通过这个 API 进行一些高安全性的身份验证。WebAuthn 一个最常见的应用就是用于网站登录时的 2FA（双重因素验证）甚至是无密码登录。通过网页调用 WebAuthn，在不同平台下，<strong>我们可以实现通过 USB Key、指纹、面部甚至虹膜扫描来认证身份，同时确保安全和隐私。</strong></p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/4-3.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/4-3.png\" alt=\"WebAuthn 可使用的各种身份认证方式\" width=\"1294\" height=\"566\" class=\"aligncenter size-full wp-image-2213\"></a>\n<p>WebAuthn 标准是 FIDO2 标准的一部分，而 FIDO2 则是由 FIDO 联盟和 W3C 共同推出的 U2F（现称作 FIDO1）的后继标准，旨在增强网络认证的安全性。</p>\n<blockquote><p>你可能了解过 U2F，那么 U2F 和 FIDO2 的区别在哪里呢？从名字上可以看出，U2F，即“通用第二因素协议”，是专注于作为密码后的第二道屏障的，而 FIDO2 增加了单因素认证功能，这意味着使用 FIDO2 可以完全替代密码，真正实现无密码登录。</p></blockquote>\n<p>FIDO2 标准主要包括四个部分，其一是用于网站和访客设备交互的 WebAuthn，而 Client to Authenticator Protocol 2（CTAP2，客户端-认证器协议）作为 WebAuthn 的补充，则是用于访客的设备和认证器交互的协议。标准的其他两个部分则是 U2F 和 UAF 规范。在这篇文章中，我们只关心 WebAuthn，不会涉及 CTAP, U2F 和 UAF 的相关知识。如果你对这段话中的一些概念不了解，不要紧张，接下来我们就来谈谈 WebAuthn 中一些常用的术语和概念。</p>\n<blockquote><p>WebAuthn 只能在安全上下文中使用，也就是说，页面需要使用 HTTPS 协议或是处于 <code>localhost</code> 中。</p></blockquote>\n<h2>常用术语和概念</h2>\n<p>WebAuthn 中有许多不常碰到的术语，不过我只会在这里介绍一些常用的术语和概念——如果你只是希望做出一个简单的实现，那么了解这一段中的一些概念就足够了。同时，由于我实在没能找到一部分术语的通用翻译，有一些术语我按着自己的理解尽可能地翻译了，有任何问题请告诉我。</p>\n<p>在一个完整的 WebAuthn 认证流程中，通常有这么几个角色：</p>\n<ul>\n<li>Relying Party 依赖方 (RP) ：指服务提供方，即网站</li>\n<li>User 用户：正准备登录的你</li>\n<li>Authenticator 认证器：通常指 USB Key 或是设备内置的指纹扫描器、虹膜扫描器、面部识别装置等，正是它们在使用流程中代替了密码甚至是用户名</li>\n<li>User Agent 用户代理：通常指浏览器或系统，负责与认证器交互</li>\n</ul>\n<p>认证过程通常分为两种：</p>\n<ul>\n<li>Registration Ceremony 注册仪式：用户向账户上添加认证器</li>\n<li>Authentication Ceremony 验证仪式：用户通过已注册的认证器验证身份</li>\n</ul>\n<p>同时，认证过程中还会产生这些内容：</p>\n<ul>\n<li>Challenge 挑战：通常是一串随机字符串</li>\n<li>Public Key Credential 公钥凭证：由认证器产生的凭证，在技术上代替了密码</li>\n<li>Attestation 证明：注册时认证器产生的验证数据</li>\n<li>Assertion 断言：验证时认证器产生的验证数据</li>\n</ul>\n<blockquote><p><strong>请注意区分证明 (Attestation) 和断言 (Assertion)</strong>，特别是在这两个单词有些相似的情况下。在 WebAuthn 中，它们是不同过程中的类似概念，但并不相同。</p></blockquote>\n<p>如果你对于这些内容不是很理解，没有关系，我们会在“<a href=\"https://flyhigher.top/#how-to-webauthn\">使用流程</a>”一节中将这些概念放到实际情况中解释，你只要先区分这些概念即可。</p>\n<h2>安全性的基础</h2>\n<p>WebAuthn 为什么安全？和 HTTPS 一样，WebAuthn 使用非对称加密的思路来保证安全性，但侧重点又有所不同。要理解 WebAuthn 的认证流程，我们必须对非对称加密有所了解。如果你对非对称加密比较熟悉了，就直接跳到下一段吧。</p>\n<p>WebAuthn 的核心在于“认证”，即保证产生了凭证的认证器是用户的认证器，而不是第三方在伪造凭证。但为什么要使用非对称加密呢？我们可以先来看看对称加密。</p>\n<p>让我们假设小明和小红相互写信，见不到对方。这天小红突然想，给自己写信的人是不是真的小明呢？于是小红要求对方向小红证明自己是小明。怎么证明呢？他们商量出来这么一套方案：</p>\n<ol>\n<li>在小明的身份已经验证的情况下，小明和小红商量一个统一的密码和密钥</li>\n<li>一段时间后，在小红要求小明验证身份时，小红发送一段文本给小明</li>\n<li>小明用提前和小红商量好的密码和密钥加密文本后发回给小红</li>\n<li>小红使用相同的密码和密钥解密文本，如果得到文本和之前发送的一致，就表明对方拥有正确的密码和密钥</li>\n</ol>\n<blockquote><p>在密码学中，我们通常把“加密算法”称为密码 (code)，和通常登录时用的密码 (password) 并非同一个概念。</p></blockquote>\n<p>在这种情况下，<strong>只要密钥不泄露</strong>，即拥有正确密钥的只有小明和小红，那么小红就能确定对方一定是小明。但这样的问题也很明显，如果小明和小红不能见面，那么他们就必须先以明文交换密码——<strong>在这个过程中一旦有人窃取到了密码，这个认证就无效了。</strong></p>\n<p>这时我们就需要使用<strong>非对称加密</strong>来拯救破碎的信任了。非对称加密的基础是一对密钥，也就是公钥和私钥，它们是互相关联但（几乎）无法互相推导的。在非对称加密的过程中，选择相同的密码后，使用私钥加密明文得到的密文只能由对应的公钥解密，无法使用私钥解密，同时这个过程反过来也是成立的。</p>\n<blockquote><p>本文的核心并不是非对称加密算法，因此不会详述非对称加密在数学上的证明，若有兴趣可以自行了解。</p></blockquote>\n<p>这就完美解决密钥泄露的问题了。让我们回过头来看之前的例子。现在小明和小红决定使用非对称加密来证明身份，过程如下：</p>\n<ol>\n<li>在小明的身份已经验证的情况下，小明提前生成一对公私钥，将公钥发送给小红，私钥自己保管，同时商量好统一的密码</li>\n<li>一段时间后，在小红要求小明验证身份时，小红发送一段文本给小明</li>\n<li>小明使用商量好的密码和自己的私钥加密文本，发送给小红</li>\n<li>小红使用相同的密码和小明的公钥解密文本，如果得到文本和之前发送的一致，就表明对方拥有正确的密码和私钥</li>\n</ol>\n<p>在这种情况下，<strong>只要私钥不泄露</strong>，那么小红解密得到的文本和之前发送的一致，那么就可以证明收到的密文一定是由小明加密后发送过来的。而在整个过程中，私钥都没有离开过小明，更没有经过传输，也就几乎没有泄露的可能了。这时，小红终于可以确定对面和她通信的人的确是小明了。</p>\n<p>题外话：HTTPS 虽然也应用了非对称加密，但 HTTPS 更侧重于“加密”而非“认证”，因此思路上会有些许差异。要了解关于 HTTPS 和非对称加密的更多信息，你可以阅读我之前写的这篇文章：</p>\n<p></p>\n<div class=\"mdx-post-cot\" data-mdxposturl=\"https://flyhigher.top/develop/1093.html\"><div class=\"mdx-post-wait-out-c2\"><div class=\"mdx-post-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://flyhigher.top/develop/1093.html\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<span></span>\n<h2>使用流程</h2>\n<p>了解了非对称加密，我们就可以来看看 WebAuthn 的认证流程了。</p>\n<p>和普通的密码一样，<strong>使用 WebAuthn 分为两个部分，注册和验证。</strong>注册仪式会在依赖方中将认证器的一些信息和用户建立关联；而验证仪式则是验证这些信息以登确保是用户本人在登录。根据上一节的思路，我们可以知道，注册仪式就是认证器生成一对公私钥，然后将公钥交给依赖方；而验证仪式是依赖方发送给认证器一段文本，要求认证器用自己的私钥加密后发回以验证。</p>\n<p>在实际情况中，WebAuthn 是基于<strong>挑战-应答模型</strong>工作的。要更好地理解，我们直接来看具体流程。先来看看注册的流程。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/lc1.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/lc1.png\" alt=\"WebAuthn 注册流程\" width=\"1100\" height=\"604\" class=\"aligncenter size-full wp-image-2224\"></a>\n<ol>\n<li>浏览器向依赖方发送某个用户的注册请求</li>\n<li>依赖方向浏览器发送挑战、依赖方信息和用户信息</li>\n<li>浏览器向认证器发送挑战、依赖方信息、用户信息和客户端信息以请求创建公钥凭证</li>\n<li>认证器请求用户动作，随后创建一对公私钥，并使用私钥签名挑战（即证明），和公钥一起交给浏览器</li>\n<li>浏览器将签名后的挑战和公钥发送给依赖方</li>\n<li>依赖方用公钥验证挑战是否与发送的一致，如果成功则将公钥与用户绑定，注册完成</li>\n</ol>\n<p>我也做了一个交互式的 Demo，你可以对照流程来更好地理解。</p>\n<p><button class=\"mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent\">开始注册</button> <span></span></p>\n<div></div>\n<blockquote><p>注意，这个 Demo 和下方的 Demo 都只是一个本地模拟的简单示例，没有任何数据会被上传，当然也不会对数据进行验证。</p></blockquote>\n<p>而之后的验证流程如下：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/lc2.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/lc2.png\" alt=\"WebAuthn 验证流程\" width=\"1100\" height=\"604\" class=\"aligncenter size-full wp-image-2226\"></a>\n<ol>\n<li>浏览器向依赖方发送某个用户的验证请求</li>\n<li>依赖方向浏览器发送挑战</li>\n<li>浏览器向认证器发送挑战、依赖方信息和客户端信息以请求获取公钥凭证</li>\n<li>认证器请求用户动作，随后通过依赖方信息找到对应私钥，并使用私钥签名挑战（即断言），交给浏览器</li>\n<li>浏览器将签名后的挑战发送给依赖方</li>\n<li>依赖方用之前存储的公钥验证挑战是否与发送的一致，一致则验证成功</li>\n</ol>\n<p><button class=\"mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme-accent\" disabled>开始验证</button> <span>在上方注册后才能验证</span></p>\n<div></div>\n<p>可以看到，WebAuthn 不仅在理论上是安全的，同时<strong>在整个过程中并没有隐私数据被传输</strong>——用户信息实际上只包含用户名和用户 ID。因此我们完全可以说 WebAuthn 是安全且私密的。</p>\n<blockquote><p>为了避免用户在不同依赖方之间被追踪，认证器通常会为每个依赖方和用户的组合都创建一对公私钥。不过，由于认证器的存储空间有限，认证器通常不会存储每一个私钥，而是会通过各类信息和烧录在认证器内的主密钥“算”出对应的私钥以实现无限对公私钥。具体算法根据不同厂商会有所不同。对于 Yubikey，你可以在<a href=\"https://developers.yubico.com/U2F/Protocol_details/Key_generation.html\">这里</a>了解更多。</p></blockquote>\n<blockquote><p>如果依赖方需要，用户同意后，发送给依赖方的公钥凭证中可以包含用于辨认认证器型号的信息，不过这对隐私的影响微乎其微。</p></blockquote>\n<h2>浏览器接口</h2>\n<p>要使用 WebAuthn，我们必须要依靠浏览器作为媒介和验证器进行交互，而这就需要浏览器对于 WebAuthn 的支持了。绝大多数新版本的现代浏览器都为 WebAuthn 提供了统一的接口，而在这一段中我们会了解如何使用相关的接口。但是在开始之前，我们可以先来看看浏览器的支持程度（2020.9）。</p>\n<div class=\"mdui-table-fluid\"><table class=\"mdui-table\">\n<thead><tr>\n<th>浏览器</th>\n<th>支持情况</th>\n</tr></thead>\n<tbody>\n<tr>\n<td>桌面端 Chrome</td>\n<td>67+</td>\n</tr>\n<tr>\n<td>移动端 Chrome</td>\n<td>67+<sup>[1]</sup>\n</td>\n</tr>\n<tr>\n<td>桌面端 Firefox</td>\n<td>60+</td>\n</tr>\n<tr>\n<td>移动端 Firefox</td>\n<td>不支持<sup>[2]</sup>\n</td>\n</tr>\n<tr>\n<td>桌面端 Edge</td>\n<td>18+</td>\n</tr>\n<tr>\n<td>移动端 Edge</td>\n<td>不支持<sup>[3]</sup>\n</td>\n</tr>\n<tr>\n<td>桌面端 Safari</td>\n<td>13+</td>\n</tr>\n<tr>\n<td>移动端 Safari</td>\n<td>13.3+<sup>[4]</sup>\n</td>\n</tr>\n<tr>\n<td>桌面端 Opera</td>\n<td>54+</td>\n</tr>\n<tr>\n<td>移动端 Opera</td>\n<td>不支持</td>\n</tr>\n</tbody>\n</table></div>\n<p><sup>[1]</sup> 受平台限制，Chrome 在 iOS 平台上不支持 WebAuthn，在 Android 平台上支持大部分 WebAuthn 功能，但仍不支持部分特性（如 <code>userVerification</code>）。<br><sup>[2]</sup> 移动端 Firefox 80 以下的版本支持 WebAuthn 但似乎会忽略 <code>authenticatorAttachment</code> 等一部分参数，同时移动端 Firefox Beta 80 以下的版本支持 WebAuthn 但无法成功调用。自 80 版本起移动端 Firefox 暂时取消了对 WebAuthn 的支持（可能是 Bug）。<br><sup>[3]</sup> 移动端 Edge 似乎支持 WebAuthn 但无法成功调用。<br><sup>[4]</sup> Safari iOS/iPad OS 13 仅支持外部认证器，无法调用 Touch ID 或 Face ID；自 iOS/iPad OS 14 起 Safari 已支持全功能 WebAuthn，可以调用 Touch ID/Face ID</p>\n<p>当然，一众国产浏览器，包括 Samsung Browser 和 Yandex Browser，目前都不支持 WebAuthn。此外，由于 WebAuthn 涉及外部验证器和 TPM 可信平台模块等，用户的操作系统也会对 WebAuthn 的可用性造成影响。以下是一些需要注意的信息：</p>\n<ul>\n<li>Windows 10 1903 以下版本仅 Edge 能提供完整支持，其他浏览器只能使用 USB Key 等外部认证器；1903+ 中所有浏览器都可以通过 Windows Hello 带来完整的 WebAuthn 支持</li>\n<li>Android 需要安装并开启 Google 服务</li>\n<li>iOS/iPad OS 13.3 以下的版本不支持 WebAuthn，iOS/iPad OS 14 以下的版本支持有限（参考上文），iOS/iPad OS 14 开始 Safari 已支持全功能 WebAuthn（功能完整度甚至超过了 Android）</li>\n</ul>\n<p>可以看出，WebAuthn 的发展之路仍然很漫长，但好在桌面端对它的支持已经比较完善了，在一些情况下我们完全有理由使用它。</p>\n<hr>\n<p>来看看浏览器提供了怎么样的接口吧。要使用 WebAuthn，我们可以使用 <code>navigator.credentials.create()</code> 请求认证器生成公钥凭证和 <code>navigator.credentials.get()</code> 请求获取公钥凭证。</p>\n<blockquote><p>你或许已经对 Credential Management API 有所了解了。通过这些 API，我们还可以实现一些有趣的特性，不过这值得另开一篇文章来讲了。</p></blockquote>\n<p>对于一个基础的实现，<code>navigator.credentials.create()</code> 需要传入的参数如下：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">navigator.credentials.create({\r\n    publicKey: {\r\n        challenge,\r\n        rp: {\r\n            id,\r\n            name\r\n        },\r\n        user: {\r\n            id,\r\n            name,\r\n            displayName\r\n        },\r\n        pubKeyCredParams: [\r\n            {\r\n                type: \"public-key\",\r\n                alg\r\n            }\r\n        ],\r\n        authenticatorSelection: {\r\n            authenticatorAttachment,\r\n            userVerification\r\n        },\r\n        excludeCredentials: [\r\n            {\r\n                id,\r\n                transports: [],\r\n                type: \"public-key\"\r\n            }\r\n        ],\r\n        timeout\r\n    }\r\n})</pre>\n<p>在 <code>navigator.credentials.create()</code> 方法中，我们必须传入一个对象，其中只有一对名为 <code>publicKey</code> 的键值。这指明了我们需要创建公钥凭证，而非普通的密码凭证。然后，在 <code>publicKey</code> 对象中设置这些常用参数：</p>\n<ul>\n<li>\n<code>challenge: Uint8Array</code>：转换为 <code>Uint8Array</code> 的挑战，长度至少为 16，建议为 32</li>\n<li>\n<code>rp: Object</code>：依赖方信息，其中有一项为必须：\n<ul>\n<li>\n<code>rp.id: String</code>：（可选）依赖方 ID，必须为当前域名或为当前域名的子集的域名（不是子域名）。如域名为 <code>test.123.example.com</code>，则依赖方 ID 可以是 <code>test.123.example.com</code>, <code>123.example.com</code> 或 <code>example.com</code>。不指定则默认使用当前域名</li>\n<li>\n<code>rp.name: String</code>：依赖方名称，用于方便用户辨认</li>\n</ul>\n</li>\n<li>\n<code>user: Object</code>：用户信息，其中有三项为必须：\n<ul>\n<li>\n<code>user.id: Uint8Array</code>：转换为 <code>Uint8Array</code> 的字符串。<strong>出于安全考量，这应尽可能不与任何用户信息相关联，如不要包含用户名、用户邮箱等</strong>\n</li>\n<li>\n<code>user.name: String</code>：登录用户名</li>\n<li>\n<code>user.dispalyName: String</code>：用于显示的用户名称，显示与否的具体行为取决于浏览器</li>\n</ul>\n</li>\n<li>\n<code>pubKeyCredParams: Array</code>：一个算法列表，指明依赖方接受哪些签名算法。列表的每一项都是一个对象，拥有两个属性：\n<ul>\n<li>\n<code>pubKeyCredParams[].type: String</code>：值只能为 \"public-key\"</li>\n<li>\n<code>pubKeyCredParams[].alg: Number</code>：一个负整数，用于标明算法。具体算法对应的数字可以在 <a href=\"https://www.iana.org/assignments/cose/cose.xhtml#algorithms\">COSE</a> 找到</li>\n</ul>\n</li>\n<li>\n<code>authenticatorSelection: Object</code>：（可选）用于过滤正确的认证器，这里介绍常用的一个参数：\n<ul>\n<li>\n<code>authenticatorSelection.authenticatorAttachment: String</code>：（可选）指定要求的认证器类型。如果没有满足要求的认证器，认证可能会失败。该参数可以为 <code>null</code>（表示接受所有类型的认证器）或是以下两个值之一：\n<ul>\n<li>\n<code>platform</code>：表示仅接受平台内置的、无法移除的认证器，如手机的指纹识别设备</li>\n<li>\n<code>cross-platform</code>：表示仅接受外部认证器，如 USB Key</li>\n</ul>\n</li>\n<li>\n<code>authenticatorSelection.userVerification: String</code>：（可选）指定认证器是否需要验证“用户为本人 (User Verified, UV)”，否则只须“用户在场 (User Present, UP)”。具体验证过程取决于认证器（不同认证器的认证方法不同，也有认证器不支持用户验证），而对验证结果的处理情况则取决于依赖方。该参数可以为以下三个值之一：\n<ul>\n<li>\n<code>required</code>：依赖方要求用户验证</li>\n<li>\n<code>preferred</code>：（默认）依赖方希望有用户验证，但也接受用户在场的结果</li>\n<li>\n<code>discouraged</code>：依赖方不关心用户验证。对于 iOS/iPad OS 13，必须设置为此值，否则验证将失败</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<code>excludeCredentials: Array</code>：（可选）用于标识要排除的凭证，可以避免同一个用户多次注册同一个认证器。如果用户试图注册相同的认证器，用户代理会抛出 <code>InvalidStateError</code> 错误。数组中的每一项都是一个公钥凭证对象，包含以下属性：\n<ul>\n<li>\n<code>excludeCredentials[].type: String</code>：值只能为 \"public-key\"</li>\n<li>\n<code>excludeCredentials[].id: Uint8Array</code>：要排除的凭证 ID</li>\n<li>\n<code>excludeCredentials[].transports: Array</code>：（可选）用于指定该凭证所需的认证器与用户代理的通信方式，可以包含以下的一或多个字符串：\n<ul>\n<li>\n<code>usb</code>：可以通过 USB 连接的认证器</li>\n<li>\n<code>nfc</code>：可以通过 NFC 连接的认证器</li>\n<li>\n<code>ble</code>：可以通过蓝牙连接的认证器</li>\n<li>\n<code>internal</code>：平台内置的、无法移除的认证器</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<code>timeout: Number</code>：（可选）方法超时时间的毫秒数，超时后将强制终止 <code>create()</code> 并抛出错误。若不设置，将使用用户代理的默认值；若太大或太小，则使用最接近的用户代理默认值范围中的值。推荐值为 5000-120000</li>\n</ul>\n<blockquote><p>对于 <code>pubKeyCredParams</code>，通常我们只需添加 ES256 (alg: -7) 算法即可兼容大部分外部认证器，此外，再添加 RS256 (alg: -257) 算法即可兼容大部分平台内置认证器（如 Windows Hello）。当然，前端添加算法之后，后端也需要相应的算法支持。</p></blockquote>\n<blockquote><p>对于 <code>userVerification</code>，由于默认值 \"preferred\" 并不能很好地被所有设备支持，因此无论在 <code>create()</code> 中还是 <code>get()</code> 中不指定该参数都会在 Chrome 中触发一条警告。具体请参阅<a href=\"https://chromium.googlesource.com/chromium/src/+/master/content/browser/webauth/uv_preferred.md\">这个页面</a>。</p></blockquote>\n<p>调用 <code>create()</code> 之后，我们就可以拿到一个 <code>Promise</code>，并可以在 <code>then</code> 中获得认证器返回的 <code>PublicKeyCredential</code> 对象。以下是一个 <code>create()</code> 返回的 <code>PublicKeyCredential</code> 对象的例子：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">PublicKeyCredential {\r\n    rawId: ArrayBuffer(32) {},\r\n    response: AuthenticatorAttestationResponse {\r\n        attestationObject: ArrayBuffer(390) {},\r\n        clientDataJSON: ArrayBuffer(121) {}\r\n    },\r\n    id: \"VByF2w2hDXkVsevQFZdbOJdyCTGOrI1-sVEzOzsNnY0\",\r\n    type: \"public-key\"\r\n}</pre>\n<p>其中有：</p>\n<ul>\n<li>\n<code>id: String</code>：Base64URL 编码的凭证 ID</li>\n<li>\n<code>rawId: ArrayBuffer</code>：<code>ArrayBuffer</code> 的原始凭证 ID</li>\n<li>\n<code>type: String</code>：一定是 \"public-key\"</li>\n<li>\n<code>response: Object</code>：<code>AuthenticatorAttestationResponse</code> 对象，是 <code>PublicKeyCredential</code> 的主要部分，包含以下两个内容：\n<ul>\n<li>\n<code>response.clientDataJSON: ArrayBuffer</code>：客户端数据，包含 origin（即凭证请求来源）、挑战等信息</li>\n<li>\n<code>response.attestationObject: ArrayBuffer</code>：CBOR 编码的认证器数据，包含凭证公钥、凭证 ID、签名（如果有）、签名计数等信息</li>\n</ul>\n</li>\n</ul>\n<p>然后将 <code>ArrayBuffer</code> 们以合适的方式编码成字符串，我们就可以把 <code>PublicKeyCredential</code> 发送给依赖方以供验证与注册了。具体怎么操作，我们会在下文详细讨论。当然，别忘了 <code>catch()</code> 注册过程中抛出的任何错误。</p>\n<blockquote><p>你可能会认为在所有情况下，注册时认证器都会对挑战进行签名。实际上在大部分情况下（同时也是默认情况），<strong>注册时认证器并不会对挑战进行签名</strong>，<code>attestationObject</code> 并不会包含签名后的挑战。只有依赖方明确要求证明且用户同意（部分浏览器要求）后认证器才会对挑战进行签名（具体实现据情况会有所不同）。对此，<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API/Attestation_and_Assertion#Attestation\">MDN 解释道</a>“大部分情况下，用户注册公钥时我们会使用「初次使用时信任模型」(TOFU) ，此时验证公钥是没有必要的。”要了解更多关于证明的内容，请参阅“<a href=\"https://flyhigher.top/#verify-authenticator\">验证认证器</a>”一节。</p></blockquote>\n<p>而对于 <code>navigator.credentials.get()</code>，我们可以传入如下的参数：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">navigator.credentials.get({\r\n    publicKey: {\r\n        challenge,\r\n        rpId,\r\n        userVerification,\r\n        allowCredentials: [\r\n            {\r\n                id,\r\n                transports: [],\r\n                type: \"public-key\"\r\n            }\r\n        ],\r\n        timeout\r\n    }\r\n})</pre>\n<p>和 <code>create()</code> 一样，对于 <code>get()</code> 我们需要传入一个对象，其中只有一对名为 <code>publicKey</code> 的键值，指明我们需要获取的是公钥凭证而非普通的密码凭证。在 <code>publicKey</code> 对象中我们可以设置这些常用参数：</p>\n<ul>\n<li>\n<code>challenge: Uint8Array</code>：转换为 <code>Uint8Array</code> 的挑战，长度至少为 16，建议为 32</li>\n<li>\n<code>rpID: String</code>：（可选）依赖方 ID，需要和注册认证器时的一致。规则和上述的 <code>rp.id</code> 一致，不指定默认使用当前域名</li>\n<li>\n<code>userVerification: String</code>：和上文一样，只是需要注意它这次不在 <code>authenticatorSelection</code> 中了</li>\n<li>\n<code>allowCredentials: Array</code>：（可选）用于标识允许的凭证 ID，使用户代理找到正确的认证器。只有符合这个列表中凭证 ID 的凭证才能被成功返回。数组中的每一项都是对象，包含以下属性：\n<ul>\n<li>\n<code>allowCredentials[].type: String</code>：值只能为 \"public-key\"</li>\n<li>\n<code>allowCredentials[].id: Uint8Array</code>：允许的凭证 ID</li>\n<li>\n<code>allowCredentials[].transports: Array</code>：（可选）用于指定该凭证所需的认证器与用户代理的通信方式，可以包含以下的一或多个字符串：\n<ul>\n<li>\n<code>usb</code>：可以通过 USB 连接的认证器</li>\n<li>\n<code>nfc</code>：可以通过 NFC 连接的认证器</li>\n<li>\n<code>ble</code>：可以通过蓝牙连接的认证器</li>\n<li>\n<code>internal</code>：平台内置的、无法移除的认证器</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<code>timeout: Number</code>：（可选）方法超时时间的毫秒数，和上面的一样，推荐值为 5000-120000</li>\n</ul>\n<p>嗯，要传入的参数少多了。之后，和 <code>create()</code> 一样，调用 <code>get()</code> 之后，我们就可以拿到一个 <code>Promise</code> 并在 <code>then</code> 中获得认证器返回的 <code>PublicKeyCredential</code> 对象。以下是一个 <code>get()</code> 返回的 <code>PublicKeyCredential</code> 对象的例子：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">PublicKeyCredential {\r\n    rawId: ArrayBuffer(32) {},\r\n    response: AuthenticatorAssertionResponse {\r\n        authenticatorData: ArrayBuffer(37) {},\r\n        signature: ArrayBuffer(256) {},\r\n        userHandle: ArrayBuffer(64) {},\r\n        clientDataJSON: ArrayBuffer(118) {}\r\n    }\r\n    id: \"VByF2w2hDXkVsevQFZdbOJdyCTGOrI1-sVEzOzsNnY0\"\r\n    type: \"public-key\"\r\n}</pre>\n<p>这里的东西就比 <code>create()</code> 时拿到的要多了。看看我们拿到了什么吧：</p>\n<ul>\n<li>\n<code>id: String</code>：Base64URL 编码的凭证 ID</li>\n<li>\n<code>rawId: ArrayBuffer</code>：<code>ArrayBuffer</code> 的原始凭证 ID</li>\n<li>\n<code>type: String</code>：一定是 \"public-key\"</li>\n<li>\n<code>response: Object</code>：对于验证流程，认证会返回 <code>AuthenticatorAssertionResponse</code> 而不是 <code>AuthenticatorAttestationResponse</code> 对象，这个对象包含以下 4 个属性：\n<ul>\n<li>\n<code>response.authenticatorData: ArrayBuffer</code>：认证器信息，包含认证状态、签名计数等</li>\n<li>\n<code>response.signature: ArrayBuffer</code>：被认证器签名的 <code>authenticatorData</code> + <code>clientDataHash</code>（<code>clientDataJSON</code> 的 SHA-256 hash）</li>\n<li>\n<code>response.userHandle: ArrayBuffer</code>：<code>create()</code> 创建凭证时的用户 ID <code>user.id</code>。许多 U2F 设备不支持这一特性，这一项将会是 <code>null</code>\n</li>\n<li>\n<code>response.clientDataJSON: ArrayBuffer</code>：客户端数据，包含 origin（即凭证请求来源）、挑战等信息</li>\n</ul>\n</li>\n</ul>\n<p>同样地，我们将 <code>ArrayBuffer</code> 们以合适的方式编码成字符串后就可以把 <code>PublicKeyCredential</code> 发送给依赖方以供验证了。至于具体怎么做，别急，马上就来讲一讲。</p>\n<h2>简单实现</h2>\n<p>了这么多，我们终于可以实现一个简单的 WebAuthn 认证页面了。由于在实际操作中 WebAuthn 相关的数据解码和密码计算比较复杂，在服务器端我们可以使用第三方库来帮我们做这些脏活累活，我们只需专注于具体流程就可以了。</p>\n<p>要寻找可用的第三方库，你可以在 <a href=\"https://webauthn.io/\">webauthn.io</a> 上找到适用于各种语言的第三方库——除了 PHP（笑）。不过好在你可以在 GitHub 上找到几个不错的 PHP WebAuthn 库，比如 <a href=\"https://github.com/web-auth/webauthn-framework\">web-auth/webauthn-framework</a>。</p>\n<p>在我们的这个例子中，我们关心的主要是前端逻辑；而后端我们可以使用各类几乎已经做到开箱即用的第三方库，这样我们可以专注于流程而不必关心细节。当然如果你想了解后端的解码细节，可以阅读“<a href=\"https://flyhigher.top/#webauthn-decode\">手动解个码</a>”一节。</p>\n<hr>\n<p>让我们先从注册开始吧。现在，用户点击了注册认证器的按钮，一个请求被发送给服务器（也就是依赖方）。在最简单的情况中，依赖方需要将三个内容发送给浏览器：<strong>挑战、用户信息和用户已注册的凭证 ID 列表（即 <code>excludeCredentials</code>）</strong>。当然依赖方也可以自由选择发送更多信息，只要最终前端能构建合法的参数即可。</p>\n<p>挑战最终会被转换为 <code>Uint8Array</code>，即一组 0-255 的整数。如果使用 PHP，在后端我们可以这样生成 Base64 编码的挑战：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"php\">$challenge = \"\";\r\nfor($i = 0; $i \n<p>对于用户信息，我们需要登录名、显示名称和 ID 三项内容。我们可以从数据库中取出用户信息，也可以新建一份。需要注意的是，<strong>出于安全和隐私的考量，ID 不应该包含用户的任何信息，比如用户邮箱等。</strong>推荐的做法是和挑战一样，生成一个随机字符串/一组随机数，并将其于用户关联起来以供之后使用。</p>\n<p>发送已注册的凭证 ID 列表是为了防止用户重复注册同一个认证器。正确设置该列表后，如果用户试图注册同一个认证器，浏览器会中止流程并抛出 <code>InvalidStateError</code>。</p>\n<p>最后，别忘了将挑战等一些后续可能会用到的信息临时存储起来。Session 就是一个很好的选择。</p>\n<p>将所有信息发送到浏览器之后，我们应该可以构建出新建凭证所需的参数了。由于有多个参数需要以 <code>Uint8Array</code> 的形式传入，我们可以准备一个简单的工具函数帮我们将 Base64 的字符串转为 <code>Uint8Array</code>。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">function str2ab(str){\r\n    return Uint8Array.from(window.atob(str), c=&gt;c.charCodeAt(0));\r\n}</pre>\n<p>除了 <code>challenge</code>, <code>rp</code>, <code>user</code> 和 <code>excludeCredentials</code> 几部分需要你根据具体情况设置外，上文提到的其他参数一般可以这么设置：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">publicKey: {\r\n    challenge, // 自行设置\r\n    rp, // 自行设置\r\n    user, // 自行设置\r\n    pubKeyCredParams: [\r\n        {\r\n            type: \"public-key\",\r\n            alg: -7 // ES256\r\n        },\r\n        {\r\n            type: \"public-key\",\r\n            alg: -257 // RS256\r\n        }\r\n    ],\r\n    authenticatorSelection: {\r\n        userVerification: \"discouraged\",\r\n        authenticatorAttachment: null // 除非用户指定，大部分情况下无需指定\r\n    },\r\n    excludeCredentials, // 自行设置\r\n    timeout: 60000\r\n}</pre>\n<p>然后就是传入 <code>navigator.credentials.create()</code>，拿到 <code>PublicKeyCredential</code>。如果一切顺利，接下来我们就需要考虑如何将返回的内容传回依赖方了。由于我们拿到的很多都是 <code>ArrayBuffer</code>，我们需要将其进行编码。再准备一个工具函数吧：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">function array2b64String(a) {\r\n    return window.btoa(String.fromCharCode(...a));\r\n}</pre>\n<p>然后适当处理，我们就可以得到一个方便传输的 JSON 字符串了：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">navigator.credentials.create({publicKey}).then((credentialInfo) =&gt; {\r\n    const publicKeyCredential = {\r\n        id: credentialInfo.id,\r\n        type: credentialInfo.type,\r\n        rawId: array2b64String(new Uint8Array(credentialInfo.rawId)),\r\n        response: {\r\n            clientDataJSON: array2b64String(new Uint8Array(credentialInfo.response.clientDataJSON)),\r\n            attestationObject: array2b64String(new Uint8Array(credentialInfo.response.attestationObject))\r\n        }\r\n    };\r\n    return publicKeyCredential;\r\n}).then(JSON.stringify).then((authenticatorResponseJSON) =&gt; {\r\n    // 可以发送了\r\n}).catch((error) =&gt; {\r\n    console.warn(error); // 捕获错误\r\n})</pre>\n<p>依赖方收到数据以后，还需要做三件事：验证挑战、存储凭证 ID 和存储公钥。如果数据解码顺利，且收到的挑战和之前发送的一致，就可以认为注册成功，将凭证 ID 及公钥与用户关联起来。这一步有很多第三方库可以帮我们做，对于基础实现我们就不深入探究了。</p>\n<blockquote><p>由于不同厂商的认证器的实现方式不同，<strong>我们并不能保证凭证 ID 一定是全局唯一的</strong>，也就是说，凭证 ID 有可能碰撞——即使这些凭证实际上是不同的。依赖方在实现凭证 ID 的存储及查找时，需要注意和用户 ID 结合进行存储或查找，或是直接在注册认证器时在服务器端对比阻止相同的凭证 ID。</p></blockquote>\n<hr><p>接下来就可以进行验证了。某天，用户点击了验证按钮准备登录，于是浏览器发送了验证请求到依赖方，同时附上要登录的用户名。接下来依赖方至少需要发送两项内容给浏览器：<strong>挑战和用户已绑定的凭证 ID 列表（即 <code>allowCredentials</code>）。</strong></p>\n<p>之后前端的处理流程就和注册时基本一致了。只是需要注意验证流程中获取到的 <code>PublicKeyCredential</code> 的结构和注册时的稍有不同。</p>\n<p>当浏览器将数据传回后，依赖方需要做的事情就比之前要麻烦一些了。依赖方需要验证挑战，并用之前存储的公钥验证签名和签名计数。同样地，这一步有很多第三方库可以帮我们做。最后，如果验证全部通过，我们就可以允许用户登录了。</p>\n<p>到目前为止，我们已经实现了一个简单的 WebAuthn 验证服务。不过这只是一个最基础的实现，对于很多高安全要求的身份认证这是远远不够的。因此，我们需要摆脱对第三方库的依赖，深入了解 WebAuthn。你可以继续阅读“<a href=\"https://flyhigher.top/#deep-into-webauthn\">深入了解 WebAuthn</a>”部分，不过对于基础的 WebAuthn 实现，我们的旅程就到这里了。</p>\n<h2>拓展阅读</h2>\n<p>如果你的目标只是快速了解如何开发 WebAuthn，那么你阅读到这里就可以了。同时，上一节例子中的部分代码来自于我为了这篇文章开发的 WordPress 插件 WP-WebAuthn，这个插件可以为你的 WordPress 启用 WebAuthn 无密码登录（并非二步验证），你可以查阅插件的 <a href=\"https://github.com/yrccondor/wp-webauthn\">GitHub 存储库</a>了解更多，也可以自己安装试一试。</p>\n<p>如果你正在使用 Chrome 开发，Chrome 87+ 版本添加了一个 WebAuthn 开发者面板，可以帮助你在没有任何实体验证器的情况下开发 WebAuthn 功能。你可以在 Google 的<a href=\"https://developers.google.com/web/tools/chrome-devtools/webauthn\">这篇文章</a>中了解更多。不够，如果你正在使用 Firefox，很遗憾目前我还没有找到对应的开发工具或是浏览器扩展可用。</p>\n<p>如果你希望了解更多关于非对称加密的数学证明，可以查阅阮一峰老师的<a href=\"http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html\">这篇文章</a>。</p>\n<p>如果你希望了解更多关于 Credential Management API 的信息，可以查阅<a href=\"https://medium.com/dev-channel/sign-in-on-the-web-credential-management-api-and-best-practices-d21aed14b6fe\">这篇文章</a>（英文）。</p>\n<p>如果你希望了解更多 WebAuthn 的细节，可以继续往下阅读。<span></span></p>\n<h1>深入了解 WebAuthn</h1>\n<p>如上文所说，如果摆脱对第三方库的依赖，或是要实现更安全的 WebAuthn，我们必须深入了解 WebAuthn。在这一部分中，我们会详细讨论上文没有提到的一些概念和参数，并了解 WebAuthn 中各类数据的结构以实现解码与验证。先来看一看一些进阶的选项吧。</p>\n<h2>进阶选项</h2>\n<p>没错，上文提到的传入 <code>navigator.credentials.create()</code> 和 <code>navigator.credentials.get()</code> 方法的参数其实只是所有参数的一部分。对于 <code>create()</code>，我们还可以配置这些可选内容（上文提及的已省略）：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">navigator.credentials.create({\r\n    publicKey: {\r\n        rp: {\r\n            icon\r\n        },\r\n        user: {\r\n            icon\r\n        },\r\n        attestation,\r\n        authenticatorSelection: {\r\n            requireResidentKey\r\n        },\r\n        extensions\r\n    }\r\n})</pre>\n</pre>\n<ul>\n<li>\n<code>rp.icon: String</code> 和 <code>user.icon</code>：是的，你可以为依赖方和用户设置图标，可以使用 HTTPS URL 或 Base64，一般长度不能超过 128 字节，不过大部分浏览器不会显示图标，或是有非常小的图片体积限制，所以一般没有使用这一属性的必要</li>\n<li>\n<code>attestation: String</code>：表明依赖方是否需要证明。可选三个值：\n<ul>\n<li>\n<code>none</code>：（默认）不需要证明。如上文所述，依赖方不关心证明，因此认证器不会签名。对于 iOS/iPad OS 13，必须设置为此值，否则验证将失败</li>\n<li>\n<code>indirect</code>：依赖方需要证明，但证明方式可由认证器选择。在支持匿名证明的认证器上，认证器会通过匿名证明的方式签名挑战，并向依赖方提供签名方式等信息</li>\n<li>\n<code>direct</code>：依赖方要求直接证明。此时认证器会使用烧录在认证器中的公钥进行签名，同时向依赖方提供签名方式等信息以供依赖方验证认证器是否可信。更多信息可以阅读“<a href=\"https://flyhigher.top/#verify-authenticator\">验证认证器</a>”一节</li>\n</ul>\n</li>\n<li>在 <code>authenticatorSelection</code> 中，我们还可以设置两个可选属性：\n<ul>\n<li>\n<code>authenticatorSelection.requireResidentKey: Boolean</code>：是否要求将私钥钥永久存储于认证器中。默认值为 <code>false</code>。对于 iOS/iPad OS 13，必须设置为 <code>false</code>，否则验证将失败</li>\n</ul>\n</li>\n</ul>\n<li>\n<code>extensions: Object</code>：WebAuthn 扩展，可以提供规范之外的配置和响应。由于实际情况中很少会使用这一特性，我们不会在这篇文章中讨论它</li>\n\n<blockquote><p>将 <code>requireResidentKey</code> 设置为 <code>true</code> 可以实现无用户名的登录，即认证器同时替代了用户名和密码。需要注意的是，尽管大部分认证器可以实现无限对公私钥，<strong>但能永久存储的私钥数量是有限的</strong>（对于 Yubikey，这通常是 25），因此只应在真正需要的时候启用此特性。我们会在“<a href=\"https://flyhigher.top/#login-without-username\">无用户名登录</a>”一节中详细讨论原因。</p></blockquote>\n<blockquote><p><strong>如果你没有高安全需求（如银行交易等），请不要向认证器索取证明</strong>，即将 <code>attestation</code> 设置为 \"none\"。对于普通身份认证来说，要求证明不必要的，且会有浏览器提示打扰到用户。</p></blockquote>\n<blockquote><p>Android 暂时无法实施用户验证，进而会导致依赖方验证失败。你可以在<a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=997538\">这里</a>追踪这个特性的实现情况。</p></blockquote>\n<blockquote>\n<p>对于 <code>extensions</code>，由于目前浏览器支持和应用范围有限，我们不会在这篇文章中涉及，不过你可以看一个例子：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">extensions: {\r\n    uvm: true, // 要求认证器返回用户进行验证的方法\r\n    txAuthSimple: \"Please proceed\" // 在认证器上显示与交易有关的简短消息\r\n}</pre>\n<p>你可以在<a href=\"https://www.w3.org/2019/01/webauthn-extensions.html\">这个页面</a>了解更多关于 <code>extensions</code> 的信息。</p>\n</blockquote>\n<p>对于 <code>get()</code>，我们其实只有一个可选内容没讲了，即 <code>extensions</code>。和上文一样，我们不会在这篇文章中讨论它。</p>\n<p>就这些了！<span></span></p>\n<h2>手动解个码</h2>\n<p>是时候看看如何手动解码了。我们将会在这一节中讨论认证器返回的数据的结构以及如何正确地解码它们。</p>\n<p>首先我们来看看如何处理注册过程中认证器发回的数据。假设所有 <code>ArrayBuffer</code> 类型的值都被正确地以 Base64 编码，且后端已经将 JSON 的字符串解析为字典。先来复习一下，我们得到的数据应该是这样的（数据较长，已省略一部分）：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    id: \"ZRBkDBCEtq...9XY8atOcbg\",\r\n    type: \"public-key\",\r\n    rawId: \"ZRBkDBCEtq...9XY8atOcbg==\",\r\n    response: {\r\n        clientDataJSON: \"eyJjaGFsbGVuZ2U...i5jcmVhdGUifQ==\",\r\n        attestationObject: \"o2NmbXRkbm9uZWd...xNHuAMzz2LxZA==\"\r\n    }\r\n}</pre>\n<p>这里的 <code>id</code> 就是凭证的 ID，如果验证正确，我们最终要将它存储起来并于用户关联。同时可以看到 Base64 编码后的 <code>rawId</code> 其实和 <code>id</code> 是一致的（不过 <code>id</code> 是 Base64URL 编码的）。而 <code>type</code> 则一定是 \"public-key\"。</p>\n<p>不过，我们主要关心的还是 <code>respose</code> 中的两项内容。首先是 <code>clientDataJSON</code>。它的处理比较简单，看名字就知道，它应该是一个 JSON 字符串。</p>\n<blockquote><p>小技巧：如果你看到一个 Base64 编码的字符串以 \"ey\" 开头，那么它大概率是一个 Base64 编码的 JSON。</p></blockquote>\n<p>将<code>clientDataJSON</code> Base64 解码再 JSON 解码之后我们就能得到一个字典：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    challenge: \"NI4i1vsNmP2KHcmyFnBCKRVQPfHgg34SsYZUOPZY2lM\",\r\n    extra_keys_may_be_added_here: \"do not compare clientDataJSON against a template. See https://goo.gl/yabPex\",\r\n    origin: \"https://dev.axton.cc\",\r\n    type: \"webauthn.create\"\r\n}</pre>\n<p>结构一目了然。在这里，我们需要验证三项内容：</p>\n<ul>\n<li>\n<code>challenge</code> 和之前发送的一致</li>\n<li>\n<code>origin</code> 为创建凭证的页面的源（协议+主机名+端口号，并非 URL）</li>\n<li>\n<code>type</code> 为 \"webauthn.create\"</li>\n</ul>\n<p>同时可以注意到有一个奇怪的 <code>extra_keys_may_be_added_here</code>。这其实是 Google 在 Chrome 中搞的一点小把戏，有一定概率会出现，提醒我们需要将 JSON 解析后再验证键值以防额外插入的键值影响验证。具体信息你可以访问那个 URL 看一看。</p>\n<p>对于 Firefox，我们会多得到两项 <code>clientExtensions</code> 和 <code>hashAlgorithm</code> ，分别指明了客户端扩展数据和签名算法。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\" data-enlighter-highlight=\"3-4\">{\r\n    challenge: \"dg6ost6ujhAA0g6WqLe-SOOH-tbhvjW9Sp90aPKlLJI\",\r\n    clientExtensions: {},\r\n    hashAlgorithm: \"SHA-256\",\r\n    origin: \"https://dev.axton.cc\",\r\n    type: \"webauthn.create\"\r\n}</pre>\n<p>由于本文不考虑扩展数据，因此我们可以不考虑 <code>clientExtensions</code>。同时由于目前规范中指定的签名算法只有 SHA-256 一种，因此现阶段我们也可以简单地忽略 <code>hashAlgorithm</code>。</p>\n<p><code>clientDataJSON</code> 很简单地就处理完了。接下来我们要来看看 <code>attestationObject</code>。先来看看 <code>attestationObject</code> 的结构图示：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/s1-3.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/s1-3.png\" alt=\"attestationObject 的结构\" width=\"1056\" height=\"532\" class=\"aligncenter size-full wp-image-2245\"></a>\n<p><code>attestationObject</code> 是 CBOR 编码后再被 Base64 编码的，因此我们需要额外对其进行 CBOR 解码。</p>\n<blockquote><p>CBOR (Concise Binary Object Representation, 简明二进制对象表示) 是一种多应用于物联网领域的编码方式，你可以将它看作体积更小、更方便物联网传输的二进制 JSON。大部分语言都可以找到对应的 CBOR 解码库。</p></blockquote>\n<p>我们当然不会手解 CBOR，直接来看看解开之后的样子吧：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    fmt: \"none\",\r\n    attStmt: {},\r\n    authData: [211, 217, 43, 24, 199, ..., 97, 238, 166, 67, 107]\r\n}</pre>\n<p>这些键值的含义如下：</p>\n<ul>\n<li>\n<code>fmt</code>：标明证明的格式。WebAuthn 预定义了几种格式，分别为：\n<ul>\n<li>\n<code>none</code>：没有证明</li>\n<li>\n<code>packed</code>：为 WebAuthn 优化的证明格式</li>\n<li>\n<code>android-safetynet</code>：Android 使用的格式</li>\n<li>\n<code>android-key</code>：又是 Android 使用的格式</li>\n<li>\n<code>fido-u2f</code>：FIDO U2F 认证器使用的格式</li>\n<li>\n<code>tpm</code>：TPM 可信平台模块使用的格式</li>\n</ul>\n</li>\n<li>\n<code>attStmt</code>：证明对象，具体格式根据 <code>fmt</code> 的不同会有所不同</li>\n<li>\n<code>authData</code>：包含公钥、签名计数等来自认证器的数据</li>\n</ul>\n<p>诶，例子里的 <code>attStmt</code> 怎么是空的？还记得之前说的吗？大部分情况下，<strong>如果依赖方不要求证明，那么认证器不会签名挑战</strong>，于是 <code>fmt</code> 会变为 \"none\"，<code>attstmt</code> 会为空。如果不是高安全要求，我们可以只对这一种情况做支持。</p>\n<blockquote><p>注意，部分情况下 Firefox 会在不要求证明（即 <code>attestation</code> 为 \"none\"）时会返回 <code>fmt</code> 为 \"packed\" 的证明。<strong>这是符合规范的。</strong>此时认证器会进行自证明，你可以视情况进行处理。具体可以阅读“<a href=\"https://flyhigher.top/#verify-authenticator\">验证认证器</a>”一节。</p></blockquote>\n<p>对于非 \"none\" 的 <code>fmt</code> 我们稍后再谈，现在我们先来看看 <code>authData</code>。来复习一下 <code>authData</code> 的结构：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/s2-3.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/s2-3.png\" alt=\"authData 的结构\" width=\"1056\" height=\"384\" class=\"aligncenter size-full wp-image-2240\"></a>\n<p>对于它的解码比较简单粗暴，我们要做的就是根据图示将它切开，然后适当地转换类型。其中各部分的含义如下：</p>\n<ul>\n<li>\n<code>rpIdHash</code>：如其名，SHA-256 的 <code>rpId</code>，长度 32 字节</li>\n<li>\n<code>flags</code>：标识认证状态，长度 1 字节。其中 8 位分别为：\n<ul>\n<li>\n<code>ED</code>：是否有扩展数据</li>\n<li>\n<code>AT</code>：是否包含 <code>attestedCredentialData</code>。通常注册认证器时会包含 <code>attestedCredentialData</code>，而验证时不包含</li>\n<li>保留位</li>\n<li>保留位</li>\n<li>保留位</li>\n<li>\n<code>UV</code>：用户是否已验证</li>\n<li>保留位</li>\n<li>\n<code>UP</code>：用户是否在场</li>\n</ul>\n</li>\n<li>\n<code>signCount</code>：签名计数，长度 4 字节</li>\n<li>\n<code>attestedCredentialData</code>：包含公钥等凭据数据，变长。其结构如下：\n<ul>\n<li>\n<code>aaguid</code>：认证器的 AAGUID (Authenticator Attestation GUID)，对于同一型号的认证器，它们的 AAGUID 是相同的</li>\n<li>\n<code>credentialIdLength</code>：标识 <code>credentialId</code> 的长度，长度 2 字节</li>\n<li>\n<code>credentialId</code>：凭证 ID，和 <code>rawId</code> 一致，长度由 <code>credentialIdLength</code> 定义</li>\n<li>\n<code>credentialPublicKey</code>：CBOR 编码的 COSE 格式的凭证公钥，变长</li>\n</ul>\n</li>\n<li>\n<code>extensions</code>：扩展数据，变长，本文不讨论</li>\n</ul>\n<blockquote><p>出于隐私考虑，如果不要求证明，认证器会以 0 填充 AAGUID。</p></blockquote>\n<p>如果你的后端在使用 Node.js，这里有个工具函数可以帮你完成这一步（不考虑 <code>extensions</code>）：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">function parseAuthData(buffer){\r\n    let rpIdHash = buffer.slice(0, 32);\r\n    buffer = buffer.slice(32);\r\n  \r\n    let flagsBuf = buffer.slice(0, 1);\r\n    buffer = buffer.slice(1);\r\n\r\n    let flagsInt = flagsBuf[0];\r\n    let flags = {\r\n        up: !!(flagsInt &amp; 0x01),\r\n        uv: !!(flagsInt &amp; 0x04),\r\n        at: !!(flagsInt &amp; 0x40),\r\n        ed: !!(flagsInt &amp; 0x80),\r\n        flagsInt\r\n    }\r\n\r\n    let counterBuf = buffer.slice(0, 4);\r\n    buffer = buffer.slice(4);\r\n  \r\n    let counter = counterBuf.readUInt32BE(0);\r\n\r\n    let aaguid = undefined;\r\n    let credID = undefined;\r\n    let COSEPublicKey = undefined;\r\n\r\n    if(flags.at) {\r\n        aaguid = buffer.slice(0, 16);\r\n        buffer = buffer.slice(16);\r\n\r\n        let credIDLenBuf = buffer.slice(0, 2);\r\n        buffer = buffer.slice(2);\r\n\r\n        let credIDLen = credIDLenBuf.readUInt16BE(0);\r\n        credID = buffer.slice(0, credIDLen);\r\n\r\n        buffer = buffer.slice(credIDLen);\r\n        COSEPublicKey = buffer;\r\n    }\r\n\r\n    return {rpIdHash, flagsBuf, flags, counter, counterBuf, aaguid, credID, COSEPublicKey}\r\n}</pre>\n<p>这段代码来自 <a href=\"https://gist.github.com/herrjemand/dbeb2c2b76362052e5268224660b6fbc\">herrjemand</a></p>\n<p>解开后，依赖方至少需要做四件事情：</p>\n<ol>\n<li>验证 <code>rpIdHash</code> 和预期的一致</li>\n<li>按预期检查用户在场和用户验证状态</li>\n<li>存储签名计数</li>\n<li>存储公钥</li>\n</ol>\n<blockquote><p>签名计数不一定从 0 开始。</p></blockquote>\n<p>对于公钥，也就是 <code>credentialPublicKey</code>，我们需要多一次 CBOR 解码，然后就可以得到类似这样的公钥：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    kty: \"EC\",\r\n    alg: \"ECDSA_w_SHA256\",\r\n    crv: \"P-256\",\r\n    x: \"ZGQALNfqo0L7HFYQHFHCS/X5db49z0ePnuQEs3w3X8w=\",\r\n    y: \"6qYxhnjYuez/Q8N6vX7nIIGfxFWdZ25NzQfZYuYOalA=\"\r\n}</pre>\n<p>然后可以选择适当的方法将其存储起来，之后的步骤本文就不再赘述了。现在，将目光拉回来，让我们看看包含证明的 <code>attestationObject</code> 是怎么样的。我们来看一个例子：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    fmt: \"packed\",\r\n    attStmt: {\r\n        alg: -7,\r\n        sig: [48, 70, 2, 33, 0, ..., 132, 78, 46, 100, 21],\r\n        x5c: [\r\n            [48, 130, 2, 189, 48, 130, 1, 165, 160, 3, ..., 177, 48, 125, 191, 145, 24, 225, 169, 41, 248]\r\n        ]\r\n    },\r\n    authData: [211, 217, 43, 24, 199, ..., 158, 54, 87, 126, 54]\r\n}</pre>\n<p>这里有一个使用 \"packed\" 格式的证明。此时，<code>attStmt</code> 中包含三个值：</p>\n<ul>\n<li>\n<code>alg</code>：签名算法</li>\n<li>\n<code>sig</code>：签名值</li>\n<li>\n<code>x5c</code>：X.509 编码的证书链</li>\n</ul>\n<p>我们不会在这一节中详述对签名的验证。要了解更多信息，你可以阅读“<a href=\"https://flyhigher.top/#verify-authenticator\">验证认证器</a>”一节。现在，让我们来看看如何处理验证过程中认证器发回的数据。我们得到的数据应该是这样的（数据较长，已省略一部分）：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    id: \"hmqdxPLit9...BWeVxZqdvU\",\r\n    type: \"public-key\",\r\n    rawId: \"hmqdxPLit9V...BWeVxZqdvU=\",\r\n    response: {\r\n        authenticatorData: \"09krGMcWTf...UFAAAABA==\",\r\n        clientDataJSON: \"eyJjaGFsbGVuZ2U...XRobi5nZXQifQ==\",\r\n        signature: \"UsXZV3pvT3np8btj6V0g...WBkaqyt88DrD40qh+A==\",\r\n        userHandle: \"MmYxNWYzZjQyZjM...Tg2ZDY4NzhlNw==\"\r\n    }\r\n}</pre>\n<p><code>id</code>, <code>rawId</code> 和 <code>type</code> 和之前一样，这里就不再赘述了。让我们来看看 <code>response</code>。首先是 <code>clientDataJSON</code>，和之前的解法一样，要验证的内容也一样，只是 <code>type</code> 从 \"webauthn.create\" 变成了 \"webauthn.get\"。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    challenge: \"bnkd2CmrEuvKnAFXs2QlC3SKlg4XFvGtP4HJL1yEWyU\",\r\n    origin: \"https://dev.axton.cc\",\r\n    type: \"webauthn.get\"\r\n}</pre>\n<p>然后是 <code>userHandle</code>。前面讲过，这是认证器在创建凭证时的用户 ID。如果用户在使用 U2F 认证器，很可能这一项为空，所以大部分情况下我们不关心这一项。</p>\n<p>接着来看 <code>authenticatorData</code>。这其实就是之前的 <code>attestedCredentialData</code>，只是这次不包含公钥。以相同的方式切开数据，我们应该可以得到 <code>rpIdHash</code>, <code>flags</code>和 <code>signCount</code> 三项。此时，依赖方至少需要做这三样事情：</p>\n<ol>\n<li>验证 <code>rpIdHash</code> 和预期的一致</li>\n<li>按预期检查用户在场和用户验证状态</li>\n<li>验证签名计数大于之前存储的计数，并更新存储的计数</li>\n</ol>\n<blockquote><p>如果签名计数比之前的小，那么这个认证器很可能是伪造的，应该中止验证并返回验证失败。同时，签名计数不一定每次按 1 递增，通常只要计数比此前的大就认为计数检查通过。</p></blockquote>\n<p>最后，我们来看 <code>signature</code>，也就是签名。不过这个签名不是简单的对挑战的签名，具体算法如图所示：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/s3-2.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/s3-2.png\" alt=\"签名过程\" width=\"1034\" height=\"587\" class=\"aligncenter size-full wp-image-2231\"></a>\n<p>计算签名时，认证器会将 <code>authenticatorData</code> 与 <code>clientDataHash</code>（也就是 <code>clientDataJSON</code> 的 SHA-256 Hash）拼接起来，并使用对应的私钥签名。依赖方应该使用对应的公钥将其解密，并验证内容是否是 <code>authenticatorData</code> 与 <code>clientDataHash</code> 的拼接。这部分的计算不在本文的讨论范围内。</p>\n<p>最后，如果全部验证通过，返回验证成功。<span></span></p>\n<h2>验证认证器</h2>\n<p>WebAuthn 已经很安全了，但有的时候我们还要让它更安全一点。比如，如果用户在使用伪造的或是自制的认证器，认证器的安全性就得不到保证。此时，依赖方就需要验证认证器是否是可信的认证器。</p>\n<blockquote><p>这一过程仅发生在注册认证器时。此时，如果认证器验证通过，就可以存储公钥，后续步骤和之前描述的一致。</p></blockquote>\n<blockquote><p>再次说明，如果不是对安全性有极高的要求，向认证器索取证明以验证认证器是否可信是没有必要的。此外，验证认证器需要依赖方自行维护可信认证器列表，大大增加了维护的复杂性。</p></blockquote>\n<p>在调用 <code>navigator.credentials.create()</code> 时，我们可以将 <code>attestation</code> 设置为非 \"none\" 来向认证器索取证明。除无证明外，WebAuthn 定义了四种证明方式：</p>\n<ul>\n<li>Basic Attestation (Basic) ：基础的证明方式，认证器会使用认证器私钥签名</li>\n<li>Self Attestation (Self) ：自证明，认证器会使用凭证私钥签名</li>\n<li>Attestation CA (AttCA) ：认证器会使用多个证明私钥之一签名</li>\n<li>Elliptic Curve based Direct Anonymous Attestation (ECDAA) ：通过 <a href=\"https://en.wikipedia.org/wiki/Direct_Anonymous_Attestation\">DAA</a> 实现的匿名证明</li>\n</ul>\n<blockquote><p>和验证过程一样，这里签名的目标是 <code>authenticatorData</code> 和 <code>clientDataHash</code> 的连接。</p></blockquote>\n<p>还记得 <code>create()</code> 时 <code>attestation</code> 可选的三个值吗？这个值会决定认证器最终使用哪种方式进行证明。复习一下：</p>\n<ul>\n<li>\n<code>none</code>：大部分情况下认证器会选择不进行证明，部分认证器会进行自证明。此时 AAGUID 会被 0 填充</li>\n<li>\n<code>indirect</code>：认证器会试图通过替换 AAGUID 和选择合适的证明方式来进行匿名证明，具体方式由认证器选择</li>\n<li>\n<code>direct</code>：认证器会提供最直接的证明信息</li>\n</ul>\n<p>注意，大部分情况下，当认证器需要向依赖方证明自己可信时需要提供认证器公钥，<strong>这会触发浏览器提示，只有用户同意后认证器才会进行证明，否则认证器将不提供证明。</strong></p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/5.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/5.png\" alt=\"浏览器提示\" width=\"446\" height=\"283\" class=\"aligncenter size-full wp-image-2217\"></a>\n<blockquote><p>为什么浏览器会说“安全密钥的品牌和型号”？事实上，为了避免用户通过认证器证书被跨依赖方追踪，FIDO 要求使用相同认证器证书的认证器的数量不能少于 100,000。于是大部分认证器厂商会选择<strong>让同一型号的认证器共用同一份证书。</strong>因此，浏览器的会询问用户是否同意“查看安全密钥的品牌和型号”。</p></blockquote>\n<blockquote><p>Android Safety Net 不会向用户询问是否同意，而是会静默进行证明。</p></blockquote>\n<p>当证明不为空时，依赖方收到数据后根据 <code>attestationObject.fmt</code> 的不同，需要选择不同的验证方式来验证认证器的可信情况。出于篇幅原因，这里我们不会讨论每一种 <code>fmt</code> 的验证方式，更多信息你可以查阅 <a href=\"https://www.w3.org/TR/webauthn/#defined-attestation-formats\">W3C 文档</a>。</p>\n<p>当 <code>fmt</code> 为 <code>packed</code> 时，<code>attestationObject.attStmt</code> 可能会有三种格式：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">// 自证明\r\n{\r\n    alg, // 算法\r\n    sig // 签名\r\n}\r\n// 基础或证明 CA 证明\r\n{\r\n    alg,\r\n    sig,\r\n    x5c // X.509 证书链\r\n}\r\n// 椭圆曲线证明\r\n{\r\n    alg,\r\n    sig,\r\n    ecdaaKeyId // ECDAA-Issuer 公钥标识符\r\n}</pre>\n<p>此时，依赖方需要检查证书符合预期格式并检查证书是否在可信链上。首先，如果证明中既没有 <code>ecdaaKeyId</code> 也没有 <code>x5c</code>，就说明这个证明使用的是自证明，只需使用认证器提供的公钥验证即可；如果有 <code>x5c</code>，那么就需要验证 <code>x5c</code> 中的证书是否在可信链上。将 <code>x5c</code> 中的每个证书以 Base64 编码，按 64 个字符切开，并在头尾加上 <code>-----BEGIN CERTIFICATE-----</code> 和 <code>-----END CERTIFICATE-----</code>就能得到一个证书字符串了。之后，依赖方需要验证证书是否可信。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">function base64ToPem(b64cert){\r\n    let pemcert = '';\r\n    for(let i = 0; i \n<p>这段代码来自 <a href=\"https://gist.github.com/herrjemand/dbeb2c2b76362052e5268224660b6fbc\">herrjemand</a></p>\n<p>至于 <code>ecdaaKeyId</code>，由于目前应用较少，处理方法可能需要你另寻资料了。检查证书的具体步骤已经超出了本文的范围，具体可以查阅<a href=\"https://medium.com/@herrjemand/verifying-fido2-packed-attestation-a067a9b2facd\">这篇文章</a>（英文）。</p>\n<blockquote><p>你可以在 <a href=\"https://fidoalliance.org/metadata/\">FIDO Metadata Service</a> 找到各大厂商认证器的可信证书链。</p></blockquote>\n<p>当在 Android 上调起 WebAuthn 时，大部分情况下 <code>fmt</code> 将会为 <code>safety-net</code>。此时 <code>attestationObject.attStmt</code> 的结构会是：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    ver: \"200616037\",\r\n    response: {\r\n        type: \"Buffer\",\r\n        data: [101, 121, 74, 104, 98, ..., 115, 104, 104, 82, 65]\r\n    }\r\n}</pre>\n<p>此时，<code>clientDataJSON</code> 中还会出现 <code>androidPackageName</code> 键，值是调起 WebAuthn 验证的应用的包名，如 Chrome 就是 \"com.android.chrome\"。</p>\n<p>在这个证明中，<code>data</code> 其实是一个 JWT 字符串，我们可以将它编码为字符串并将其按照 JWT 进行解码（别忘了验证 JWT 签名）。最终我们会得到一个类似这样的 Payload：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    nonce: \"0QAurN4F9wik6GEkblDJhGuf4kuaqZn5zaaxlvD1hlA=\",\r\n    timestampMs: 1584950686460,\r\n    apkPackageName: \"com.google.android.gms\",\r\n    apkDigestSha256: \"2BQHno+bmWWwdLUYylS8HLt5ESJzci3nt2uui71ojyE=\",\r\n    ctsProfileMatch: true,\r\n    apkCertificateDigestSha256: [\r\n        \"8P1sW0EPicslw7UzRsiXL64w+O50Ed+RBICtay2g24M=\"\r\n    ],\r\n    basicIntegrity: true,\r\n    evaluationType: \"BASIC\"\r\n}</pre>\n<p>其中包含了有关设备状态的一些信息。比如说，如果 <code>ctsProfileMatch</code> 为 <code>false</code>，那么该设备很有可能被 root 了。对于高安全要求的场景，我们可以视情况进行验证。</p>\n<p>同时我们可以在 JWT Header 中验证证明的有效性。我们应该能取得这样的 Header：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">{\r\n    alg: \"RS256\",\r\n    x5c: [\r\n        \"MIIFkzCCBHugAwIBAgIR...uvlyjOwAzXuMu7M+PWRc\",\r\n        \"MIIESjCCAzKgAwIBAgIN...UK4v4ZUN80atnZz1yg==\"\r\n    ]\r\n}</pre>\n<p>这里的结构就和上方的 <code>x5c</code> 验证类似了。具体步骤可以参考<a href=\"https://medium.com/@herrjemand/verifying-fido2-safetynet-attestation-bd261ce1978d\">这篇文章</a>（英文）。</p>\n<p>其他所有格式的验证方式也都可以在<a href=\"https://medium.com/@herrjemand/verifying-fido2-responses-4691288c8770\">这篇文章</a>（英文）中找到。<span></span></p>\n<h2>无用户名登录</h2>\n<p>认证器已经代替了密码，可是这还不够！在进行第一因素认证（即使用 WebAuthn 登录）时，我们还是需要输入用户名，然后才能进行身份认证。懒惰是第一生产力，我们能不能不输入用户名就进行身份认证呢？实际上，大部分认证器都允许我们无用户名登录。<strong>而这一特性的核心就是 Resident Key 客户端密钥驻留。</strong></p>\n<p>你可以思考一下，为什么普通的 WebAuthn 为什么不能实现无用户名登录？事实上，大部分认证器为了实现无限对公私钥，会将私钥通过 Key Warp 等技术加密后包含在凭证 ID 中发送给依赖方，这样认证器本身就不用存储任何信息。不过，这就导致需要身份认证时，依赖方必须通过用户名找到对应的凭证 ID，将其发送给认证器以供其算出私钥。</p>\n<blockquote><p>Yubikey 实现了一个基于 HMAC 的算法，认证器可以在私钥不离开认证器的前提下（常规的 Key Warp 算法中实际上私钥离开了认证器）通过一些输入和凭证 ID 重新计算私钥，你可以阅读<a href=\"https://www.yubico.com/blog/yubicos-u2f-key-wrapping/\">这篇文章</a>了解更多。</p></blockquote>\n<blockquote><p>客户端通过凭证 ID 查找对应认证器的算法根据系统的不同是不同的。通常凭证 ID 中会包含认证器信息，因此系统可以通过凭证 ID 找到对应的认证器。</p></blockquote>\n<p>要避免输入用户名，我们可以要求认证器将私钥在自己的内存中也存储一份。这样，依赖方无需提供凭证 ID，认证器就可以通过依赖方 ID 找到所需的私钥并签名公钥。以下是具体流程：</p>\n<p>注册时：</p>\n<ol>\n<li>依赖方请求新建凭证，同时要求启用客户端密钥</li>\n<li>认证器生成一对公私钥，并将私钥存储在永久内存中且与依赖方 ID 及用户 ID 绑定，随后将公钥发送给依赖方以供存储</li>\n<li>依赖方将用户 ID 即公钥与用户绑定</li>\n</ol><p>验证时：</p>\n<ol>\n<li>依赖方请求验证，但不必提供除依赖方 ID 以外的更多信息</li>\n<li>用户选择认证器</li>\n<li>认证器根据依赖方 ID 找到对应私钥</li>\n<li>如果有多个对应私钥，认证器会询问用户应该使用哪个身份信息登录</li>\n<li>确定私钥后，认证器签名挑战并将其返回，同时返回用户 ID</li>\n<li>依赖方通过用户 ID 找到对应用户并用对应公钥检查签名，正确则允许对应用户登录</li>\n</ol><blockquote><p>可以看到，这个特性同时要求认证器存储用户 ID，即上面提到过的 <code>userHandle</code>。依赖方需要根据此信息找到对应用户，因此不支持 <code>userHandle</code> 的 U2F 认证器无法进行无用户名登录。</p></blockquote>\n<blockquote><p>如之前所说，<strong>认证器能永久存储的私钥数量是有限的</strong>，因此只应在真正需要无用户名登录的时候启用此特性。</p></blockquote>\n<blockquote><p>目前暂时没有办法检测认证器是否支持客户端密钥驻留，因此在无用户名验证失败时应 fallback 至常规的 WebAuthn 验证，即向用户询问用户名。</p></blockquote>\n<p>现在让我们来看看如何实现这一特性吧。首先，调用 <code>navigator.credentials.create()</code> 时我们需要注意两个参数：<code>requireResidentKey</code> 必须为 <code>true</code>，<code>userVerification</code> 必须为 \"required\"。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\" data-enlighter-highlight=\"5-6\">navigator.credentials.create({\r\n    publicKey: {\r\n        ...\r\n        authenticatorSelection: {\r\n            requireResidentKey: true,\r\n            userVerification: \"required\"\r\n            ...\r\n        },\r\n        ...\r\n    }\r\n})</pre>\n<blockquote><p>Windows Hello <strong>似乎</strong>会存储所有已注册的凭据，因此无论是否指定 <code>requireResidentKey</code>，你都可以通过 Windows Hello 进行无用户名登录。</p></blockquote>\n<p>随后，浏览器会询问用户是否允许认证器存储私钥。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/3.png\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/03/3.png\" alt=\"浏览器提示\" width=\"445\" height=\"285\" class=\"aligncenter size-full wp-image-2208\"></a>\n<p>如果用户同意，认证器会存储私钥，并和普通的 WebAuthn 一样返回信息。不过，依赖方收到数据之后，只需将公钥、用户 ID 与用户关联起来，而不必再将凭证 ID 与用户关联起来。至此注册完成。</p>\n<p>之后，在用户请求登录时，无需再向依赖方提供用户名。同时在传入 <code>navigator.credentials.get()</code> 的参数中也有两个需要注意：<code>userVerification</code> 必须为 \"required\"，同时 <code>allowCredentials</code> 必须为空。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\" data-enlighter-highlight=\"4-5\">navigator.credentials.get({\r\n    publicKey: {\r\n        ...\r\n        userVerification: \"required\",\r\n        allowCredentials: [],\r\n        ...\r\n    }\r\n})</pre>\n<blockquote><p>Android 暂不支持无用户名验证，空的 <code>allowCredentials</code> 会导致浏览器返回 <code>NotSupportedError</code> 错误。</p></blockquote>\n<p>此时，认证器会根据依赖方 ID 找到对应的私钥。如果有多个对应私钥，认证器会询问用户应该使用哪个身份信息登录。用户选择后，认证器就会使用对应的私钥签名挑战并将其返回。此时，<code>userHandle</code> 一定不为空。</p>\n<p>依赖方收到数据后，需要将 <code>userHandle</code> 作为用户 ID 找到对应的用户，并使用对应的公钥验证签名。如果验证成功，则认为对应的用户身份认证成功，依赖方可以允许其登录。至此验证结束。</p>\n<blockquote><p>有的时候你可能会需要清除认证器中的密钥。绝大多数认证器都提供了对应的软件以供清除存储的密钥，但大部分情况下这会重置整个认证器，这意味着相关认证器此前的所有凭证均会失效。因此建议不要将日常使用的认证器作为开发测试用的认证器。</p></blockquote>\n<h2>从 U2F 认证迁移</h2>\n<p>如果你的服务此前提供了 U2F 第二因素认证，你可能会希望在将依赖方从 U2F 升级到 WebAuthn 时用户此前注册的 U2F 认证器仍然可用而无需重新注册。由于 WebAuthn 向后兼容 U2F 设备，用户是可以继续使用原有的 U2F 认证器的。不过，由于 WebAuthn 的依赖方 ID 与 U2F 的 <code>appid</code> 并不一定相同，你需要将原有的 U2F <code>appid</code> 随 WebAuthn 流程一起传递给认证器，认证器才能使用正确的私钥进行响应。</p>\n<p>要实现这一点，我们只需要在注册及认证仪式中使用 WebAuthn 的 <code>appid</code> 扩展。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">extensions: {\r\n    appid: \"https://example.com\" //U2F appid\r\n}</pre>\n<p>此时认证器便可以得到正确的私钥，之后的流程与正常情况一致；依赖方除了正常的 WebAuthn 流程外，不需要再做任何其它操作。</p>\n<h2>拓展阅读</h2>\n<p>我们的 WebAuthn 之旅到这里就真的结束了。不过，你仍然可以自行探究，了解更多。<strong>本文只是一个粗浅的使用指南</strong>，而被称为“Web 身份认证的未来”的 WebAuthn 的深层还要很多细节值得我们挖掘学习，不过本文不会再继续讨论了。</p>\n<p>如果你想了解更多关于 WebAuthn 的信息，最好的方法是直接阅读 <a href=\"https://www.w3.org/TR/webauthn\">W3C 规范</a>。此外，Yubico 也提供了不错的 <a href=\"https://developers.yubico.com/WebAuthn/WebAuthn_Developer_Guide/\">WebAuthn 文档</a>。</p>\n<p>要了解更多认证器存储凭证的信息，你可以阅读<a href=\"https://duo.com/labs/tech-notes/how-security-keys-store-credentials\">这篇文章</a>（英文）。</p>\n<p>如果你想了解更多 Android Safety Net 是怎样运作的，可以观看<a href=\"https://youtu.be/8lv_9mydrjg\">这个视频</a>，并通过 <a href=\"https://developer.android.com/training/safetynet/attestation\">Google 的文档</a>了解 Android Safety Net 的更多信息。</p>\n<p>如果你想方便地调试 WebAuthn，<a href=\"https://webauthn.me/\">webauthn.me</a> 提供了一个非常直观方便的<a href=\"https://webauthn.me/debugger\">调试器</a>。</p>\n<h1>参考资料</h1>\n<p><a href=\"https://www.w3.org/TR/webauthn\">WebAuthn Level 1 规范 - W3C</a><br><a href=\"https://github.com/w3c/webauthn\">WebAuthn Level 2 草案 - W3C</a><br><a href=\"https://blog.techbridge.cc/2019/08/17/webauthn-intro/\">一起来了解Web Authentication - TechBridge 技术共笔部落格</a><br><a href=\"https://medium.com/@herrjemand/introduction-to-webauthn-api-5fd1fb46c285\">Introduction to WebAuthn API - Medium</a><br><a href=\"https://medium.com/@herrjemand/verifying-fido2-responses-4691288c8770\">WebAuthn/FIDO2: Verifying responses - Medium</a><br><a href=\"https://obeta.me/posts/2019-03-01/WebAuthn%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8\">WebAuthn介绍与使用 - obeta</a><br><a href=\"https://webauthn.io/\">webauthn.io</a><br><a href=\"https://webauthn.guide/\">webauthn.guide</a><br><a href=\"https://webauthn.me/\">webauthn.me</a><br><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API/Attestation_and_Assertion\">Attestation and Assertion - MDN</a><br><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Authentication_API\">Web Authentication API - MDN</a>（顺便翻译了一半）<br><a href=\"https://fidoalliance.org/fido-technotes-the-truth-about-attestation/\">FIDO TechNotes: The Truth about Attestation - FIDO Alliance</a><br><a href=\"https://developers.yubico.com/WebAuthn/WebAuthn_Developer_Guide/\">WebAuthn Developer Guide - Yubico</a><br><a href=\"https://en.wikipedia.org/wiki/WebAuthn\">WebAuthn - Wikipedia</a><br><a href=\"https://techcommunity.microsoft.com/t5/identity-standards-blog/all-about-fido2-ctap2-and-webauthn/ba-p/288910\">All about FIDO2, CTAP2 and WebAuthn - Microsoft Tech Community</a><br><a href=\"https://webauthn-doc.spomky-labs.com/\">Webauthn Framework</a><br><a href=\"https://zhuanlan.zhihu.com/p/25279015\">如何开发支持 FIDO U2F 登录的网站 - 知乎专栏</a><br></p></pre>\n","link":"https://flyhigher.top/develop/2160.html"},{"title":"NLP 找门：用朴素贝叶斯进行文本分类","date":"2020-01-29 11:39:58","description":"\n<blockquote>\n<p>有一天，神收到了一封垃圾邮件，于是世界上就有了朴素贝叶斯算法。</p>\n<footer>——我瞎编的</footer>\n</blockquote>\n<p>为什么这篇文章的标题是 NLP 找门呢？因为如果你看完了这篇文章，你就可以<strong>准备入门</strong>自然语言处理 (<strong>N</strong>atural <strong>L</strong>anguage <strong>P</strong>rocessing) 了。我会把这篇文章当作一篇彻彻底底的 NLP 入门文章来写，尽量避免“专业高端”词汇和“全是奇怪符号”的式子，这样<strong>只要你有高中数学基础</strong>，就能毫无压力地看完这篇文章，学会使用朴素贝叶斯分类算法分类文本。</p>\n<p>让我们开始吧。</p>\n<h1>所以，啥是朴素贝叶斯？</h1>\n<p>简单来说，朴素贝叶斯 (Naïve Bayes) <strong>是一个简单但高效的分类算法</strong>，在进行不复杂的文本分类时高效且拥有不低的准确度，判断垃圾邮件就是用朴素贝叶斯进行文本分类的一个经典例子。当然朴素贝叶斯分类不仅能用在 NLP 中，在许多分类问题中朴素贝叶斯也有非常好的效果，但我们今天只关注它在 NLP 中的应用。</p>\n<p>要了解朴素贝叶斯，我们要先来了解一下贝叶斯定理。</p>\n<blockquote>\n<p>每增加一个数学公式都会使读者减半。</p>\n<footer>——霍金</footer>\n</blockquote>\n<p>那么，就让我们先来看看贝叶斯定理的公式吧（笑</p>\n<p>$$P(A|B) = \\frac{P(AB)}{P(B)} = \\frac{P(B|A)P(A)}{P(B)}$$</p>\n<p>其实还是很简单的，运用高中的条件概率知识就能理解。本质上，贝叶斯定理给出了一种方法，使得我们可以在 \\(P(A|B)\\) 和 \\(P(B|A)\\) 之间互相转换，因为通常情况下它们是不一样的。</p>\n<p>要更好地理解，请考虑这样一个例子：</p>\n<blockquote><p>假设有一个学校图书馆，图书管理员正为找不到某本书而发愁。已知老师有 70% 的意愿借走这本书，而是学生的意愿是 30%，这个学校的师生比例是 1:10，那么借走这本书的人是老师的概率有多大？</p></blockquote>\n<p>设学校总人数为 \\(T\\)，我们可以很容易地写出这样的一个式子：</p>\n<p>$$\\begin{align} P &amp; = \\frac{T\\cdot\\frac{1}{11}\\cdot 70\\%}{T\\cdot\\frac{1}{11}\\cdot 70\\%+T\\cdot\\frac{10}{11}\\cdot 30\\%} \\\\ &amp; = \\frac{70\\%}{70\\%+10\\times30\\%} \\\\ &amp; = \\frac{7}{37} \\end{align}$$</p>\n<p>这就是贝叶斯定理了！等等，你可能会挠挠头，这哪里是贝叶斯了？别急，如果我们把最上面的式子换个字母的话...</p>\n<p>$$P(H|E) = \\frac{P(E|H)P(H)}{P(E)}$$</p>\n<p>在这里，\\(H\\) 指 Hypothesis，即假设，而 \\(E\\) 指 Evidence，即证据。这样，这个式子就很好理解了，在我们上面的例子里，借走书是证据，那么 \\(P(E)\\) 就是某个人选择借走这本书的概率；这个人是老师是假设，那么这个人是老师的概率是 \\(P(H)\\)。<strong>注意这里的概率指在学校中抽一个人是老师的概率，并不是“在借走书的前提下”这个人是老师的概率</strong>，而“在借走书的前提下”这个人是老师的概率应该是 \\(P(H|E)\\)，也正是我们要求的概率。同样地，而“这个人是老师”的前提下借走书的概率就是 \\(P(E|H)\\) 了。</p>\n<p>那么再来看看上面我们凭小学知识就列出的计算式，如果把里面的具体数据换成概率来表示的话，这个式子就会变成...</p>\n<p>$$P(H|E) = \\frac{T\\cdot P(E|H)P(H)}{T\\cdot P(E|H)P(H) + T\\cdot P(E|\\neg H)P(\\neg H)}$$</p>\n<p>好吧，这里解释一下，\\(\\neg\\) 符号表示“非”，所以 \\(P(E|\\neg H)\\) 表示在“这个人不是老师”的前提下借走书的概率。而 \\(T\\cdot P(E|H)P(H)\\) + \\(T\\cdot P(E|\\neg H)P(\\neg H)\\)，即“可能借走书的老师的数量 + 可能借走书的学生的数量”，就是“可能借走书的人的数量”了，也就是 \\(T\\cdot P(E)\\)。上下消去 \\(T\\)，我们就能得到上面的式子了。</p>\n<p>$$P(H|E) = \\frac{P(E|H)P(H)}{P(E)}$$</p>\n<p>这就是贝叶斯了定理。如果你还是不太清楚，可以去看看 3Blue1Brown 的<a href=\"https://www.bilibili.com/video/av84799361\">这个视频</a>，图形化的讲解会清晰很多。</p>\n<p>这里我要提一下这个式子里各部分的专有名称了（“专业高端”词汇警告），你可以不记住，直接看后面。</p>\n<ul>\n<li>\\(P(H|E)\\) 叫做 \\(H\\) 的<strong>后验概率</strong>，反之亦然</li>\n<li>\\(P(H)\\) 叫做 \\(H\\) 的<strong>先验概率</strong>，反之亦然</li>\n<li>特别地，我们把 \\(P(E|H)\\) 称作<strong>“似然值”</strong>，即 likelihood</li>\n</ul>\n<p>那什么是朴素贝叶斯呢？按上面所说的，朴素贝叶斯是一种分类算法。简单来说，朴素贝叶斯将一个对象的各个特征考虑为互相独立，然后根据这些特征的概率的乘积来判断对象所属的分类。基本原理如下：</p>\n<p>$$P(H|E) = \\frac{P(E|H)P(H)}{P(E)} \\propto P(E|H)P(H) = P(H)\\prod_{i}P(W_i|H)$$</p>\n<p>在这里，\\(W_i\\) 指某一对象的第 \\(i\\) 个特征，对于文本分类来说，这就是一段文本中的某个单词。</p>\n<p>朴素贝叶斯之所以“朴素”，是因为它要求<strong>各个特征间是独立的</strong>，在文本分类中也就是各个单词之间互不干扰。虽然思路简单的代价是适用范围变窄，不过由于这样的简化在很多情况下已经足够了，因此实际上朴素贝叶斯的应用范围非常广。<del>你看朴素贝叶斯 <strong>N</strong>aïve <strong>B</strong>ayes 的缩写都是 NB 了，能不厉害吗（逃</del></p>\n<h1>那么，咋分类啊</h1>\n<p>看来你这下完全听懂了呢（笑），是时候看看如何在 NLP 中应用朴素贝叶斯了。和上面一样，我们用一个具体的例子来说明。我们的目标是让电脑学会分类美国共和党和民主党的演讲稿，由于两个党派的演讲风格不同，所以这样的分类在理论上是可行的。</p>\n<div class=\"wp-block-file\">\n<a href=\"https://acdn.flyhigher.top/nlp/material.zip\" download>material.zip</a><a href=\"https://acdn.flyhigher.top/nlp/material.zip\" class=\"wp-block-file__button\" download>下载</a>\n</div>\n<p>上面我们要用到的数据集，你可以下载下来一起动手玩一玩。先说一下数据集的数据结构吧，压缩包里有两个文件，<code>train.txt</code> 将会被当作训练数据集，而 <code>test.txt</code> 则会作为训练结束后的验证数据集。两个文本文件里数据的结构是类似的，就像这样：</p>\n<pre class=\"EnlighterJSRAW\">BLUE WELL I AM SO HONORED AND PERSONALLY UNKNOWNWORD TO BE HERE...\r\nRED THANK YOU . THIS IS QUITE AN INSTITUTION . IT'S GOOD TO BE...</pre>\n<p>每行都是一篇演讲稿，每行的第一个单词指明了这篇演讲稿所属的党派，<code>RED</code> 指共和党，而 <code>BLUE</code> 指民主党。所有单词和符号都已经被转为大写并由空格分隔方便处理。<code>train.txt</code> 有共和党演讲稿和民主党演讲稿各 23 篇，<code>test.txt</code> 有 6 篇共和党演讲稿，12 篇民主党演讲稿。</p>\n<p>明白了？那我们就开始吧。</p>\n<h2>捋捋思路</h2>\n<p>首先，我们需要考虑如何在文本分类中应用朴素贝叶斯。很简单，按朴素贝叶斯的思路，<strong>计算每个词在某一分类下的出现概率，然后将某篇文章的所有词的概率相乘，再乘以该分类的先验概率，就可以得到某篇文章在某一分类下的概率。</strong></p>\n<p>$$P(Class|Article) = P(Class)\\prod_{i}P(Word_i|Class)$$</p>\n<p>各个分类概率都计算完成后，概率最高的那个分类就是这篇文章可能所属的分类。这个思路的核心就是用词决定了文本风格，文本的不同类别用词会有差异，只要能量化这些差异就可以分类文本。在我们的例子中，我们可以从 <code>train.txt</code> 中统计各个词汇的出现情况，然后用 <code>test.txt</code> 中的数据按上面的算法验证我们算法的准确性。</p>\n<p>这个思路很简单也很清晰，但还有一些问题需要解决。<strong>第一，有的时候，我们的测试数据集中可能会出现一个在训练数据集中没有出现过的词语。这个时候，朴素贝叶斯的计算结果会是 0。</strong>如果我们把 0 乘进式子中，那就别想得到正常的结果了。所以，我们还需要对计算某一单词在某一分类中的式子稍加改进。使用拉普拉斯平滑，就可以避免出现概率为 0 的情况。别被名字吓到，拉普拉斯平滑是一种非常简单的平滑方法：在分子上 +1，在分母上加整个取值范围，这样就可以给整个分式加上非常微小的偏移，避免出现 0。</p>\n<p>$$\\begin{align} P(Word_i|Class) &amp; = \\frac{Word_iCountInClass}{AllWordCountInClass} \\\\ &amp; \\approx \\frac{Word_iCountInClass + 1}{AllWordCountInClass + UniqueWordCount} \\end{align}$$</p>\n<p><strong>第二，对于长文本，大部分词语在某一分类中的出现概率是远小于 1 的，加上长文本词汇量大，往往概率相乘的结果会非常小。</strong>受限于计算机处理浮点数的原理，精确处理这么小的数字是很麻烦的。幸好，运用一些简单的数学知识就可以将其转化为更精确的表达，<strong>那就是取对数。</strong></p>\n<p>首先，将概率计算结果取对数并不影响我们的计算结果。因为取对数是一个单调递增的操作，而我们计算概率只是为了排序选择概率最高的分类，因此取对数是不影响我们排序的。而把多项式取对数，等于把多项式的每一项取对数后相加。所以我们有：</p>\n<p>$$\\lg{\\Big(P(Class)\\prod_{i}P(Word_i|Class)\\Big)} = \\lg{P(Class)} + \\sum_i\\lg{P(Word_i|Class)}$$</p>\n<p>大部分情况下，在每一次取对数的时候，要取对数的数字的大小，即 \\(P(Word_i|Class)\\) 尚还在计算机能处理的范围内，<strong>因此我们可以放心地使用取对数的方法</strong>，避免计算机精度不够影响结果。</p>\n<p><strong>第三就是在某些情况下，可能会有部分词语干扰计算结果</strong>，如 and, is 这类的被大量使用的中性词。如果希望得到更好的结果，我们可以维护一个停用词表，在计算时排除停用词即可。或者，我们可以在计算完每个单词的出现数量后，排除数量最多的前 \\(N\\) 个单词，避免这些单词过多地影响计算。</p>\n<h2>写点代码</h2>\n<p>现在我们终于可以开始实战，写点代码了。我会用简单的 Python 来表达思路。好了，理一理思绪，第一步我们要做的，是统计训练数据集中的用词情况。具体来说，根据上面的思考，我们需要统计的有：</p>\n<ul>\n<li>每个单词在各分类中出现的数量</li>\n<li>各分类中的不重复词数量</li>\n</ul>\n<p>用 Python 简单表示如下：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\"># 读入数据过程略...\r\ndata_raw = \"读入的数据\".split('\\n') # 按行分隔\r\ndata_blue = []\r\ndata_red = []\r\nword_count_blue = {}\r\nword_count_red = {}\r\n\r\nfor line_data in data_raw:\r\n    word_list = line_data.split(\" \") # 分隔单词\r\n    if word_list[0] == \"BLUE\":\r\n        for i in range(1,len(word_list)):\r\n            if not is_excluded(word_list[i]): # 判断是否为停用词\r\n                data_blue.append(word_list[i])\r\n                # 统计单词出现次数\r\n                word_count_blue.setdefault(word_list[i], 0)\r\n                word_count_blue[word_list[i]] += 1\r\n    elif word_list[0] == \"RED\":\r\n        # Class = red 时同理...\r\n\r\n#统计非重复词\r\nunique_words_blue = list(set(data_blue))\r\nunique_words_red = list(set(data_red))</pre>\n<p>训练过程到这里就结束了，计算机已经知道了各政党演讲的用词习惯。很简单吧？接下来我们就要使用测试数据集来测试准确度了。<strong>这里开始就涉及到朴素贝叶斯的计算了</strong>，可能会稍微复杂一点点。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"python\">import math\r\n#读入测试数据过程略...\r\ntest_data_raw = \"读入的数据\".split('\\n') # 按行分隔\r\ntest_data = []\r\n\r\nfor line_data in test_data_raw:\r\n    if line_data[0] == \"BLUE\":\r\n        content_data = line_data.split(\" \").pop(0)\r\n        test_data.append({\"class\": \"blue\", \"content\": content_data})\r\n    elif line_data[0] == 'RED':\r\n        # ...\r\n\r\nfor line_data in test_data:\r\n    posibility_blue = 0\r\n    for word in line_data[\"content\"]:\r\n        # 计算各单词概率，取对数后相加，使用了拉普拉斯平滑\r\n        if word in word_count_blue:\r\n            posibility_blue += math.log((word_count_blue[word]+1)/(len(data_blue)+len(unique_words_blue)+len(unique_words_red)))\r\n        else:\r\n            posibility_blue += math.log(1/(len(data_blue)+len(unique_words_blue)+len(unique_words_red)))\r\n    # 最后加上该分类概率的对数\r\n    posibility_blue += math.log(len(data_blue)/(len(data_blue)+len(data_red)))\r\n\r\n    # 计算 Red 同理...</pre>\n<p>计算完成后，我们就得到每篇演讲稿在各分类下的概率了。之后，简单的比较就能得出推断的分类：如果 \\(P(Red|Article)\\) 大于 \\(P(Blue|Article)\\)，那么这篇演讲稿就更可能是共和党的演讲稿，反之则是民主党的演讲稿。</p>\n<p>很好理解吧？那么这么简单的思路，准确性怎么样呢？对于我们的例子，这是我设置了个别停用词后的结果：</p>\n<pre class=\"EnlighterJSRAW\">+-----+-------+--------------+--------------+-------+-------+\r\n|   ID|  Class|        P(Red)|       P(Blue)|  Guess| Status|\r\n+-----+-------+--------------+--------------+-------+-------+\r\n|    1|   Blue|  -23204.68377|  -22998.67066|   Blue|      √|\r\n|    2|   Blue|  -16438.44625|  -16137.48257|   Blue|      √|\r\n|    3|   Blue|  -33468.81214|  -32567.61801|   Blue|      √|\r\n|    4|   Blue|    -8606.2193|   -8601.50426|   Blue|      √|\r\n|    5|   Blue|  -12430.97436|  -11935.70662|   Blue|      √|\r\n|    6|   Blue|  -44033.02883|  -43877.55367|   Blue|      √|\r\n|    7|   Blue|   -16947.2851|  -16758.57542|   Blue|      √|\r\n|    8|   Blue|  -26957.26997|  -26889.62444|   Blue|      √|\r\n|    9|   Blue|  -27503.73985|  -27249.21828|   Blue|      √|\r\n|   10|   Blue|   -20528.4457|   -19991.1248|   Blue|      √|\r\n|   11|   Blue|  -20337.96493|  -19860.12831|   Blue|      √|\r\n|   12|   Blue|  -28409.28489|  -28118.98017|   Blue|      √|\r\n|   13|    Red|  -13756.01015|  -14488.11751|    Red|      √|\r\n|   14|    Red|  -17221.22732|  -17710.15936|    Red|      √|\r\n|   15|    Red|  -17397.45136|  -17899.98659|    Red|      √|\r\n|   16|    Red|  -10724.69095|  -11092.77837|    Red|      √|\r\n|   17|    Red|  -10402.40027|  -10859.48681|    Red|      √|\r\n|   18|    Red|   -9371.53792|    -9669.6769|    Red|      √|\r\n+-----+-------+--------------+--------------+-------+-------+\r\n|                                      Total: 18/18, 100.0% |\r\n+-----------------------------------------------------------+</pre>\n<p><strong>100% 的准确率哦！</strong>事实上，对于我们的这个例子，就算不设置停用词，我们仍能达到 100% 的分类准确率。朴素贝叶斯分类的确很 NB 呢。</p>\n<h1>更进一步</h1>\n<p>我们的探索到这里就结束了，但如果你有兴趣，完全可以继续探索下去。我们的例子是一个非常简化的例子，在实际情况中，还有很多问题需要解决。比如，对于中文及类似语言，不存在拉丁语系的天然分词结构，而朴素贝叶斯的文本分类是基于单词的，那么<strong>中文的分词就会是个问题；</strong>再比如，对于朴素贝叶斯分类来说，<strong>词语之间的顺序是不影响分类结果的</strong>，但这就会导致“今天心情很好，但昨天不好”和“昨天心情很好，但今天不好”在朴素贝叶斯看来是一样的，要想获得更好的结果，我们必须<strong>考虑词语的顺序。</strong></p>\n<p>这些问题，今天我们就不再深究了，但你可以自己探索。比如，引入思路同样很简洁的马尔科夫链，我们就可以让计算机学会考虑词语间的顺序，不过那就会是另一个话题了。</p>\n","link":"https://flyhigher.top/develop/1989.html"},{"title":"MDx 中增强页面可访问性的细节","date":"2020-01-25 16:45:04","description":"\n<blockquote><p>这篇文章本来是打算发在 <a href=\"https://mdxblog.flyhigher.top/\">MDx Blog</a> 的，不过写到后来发现这篇文章相对来说还是有价值的，于是就将这篇文章转移到了无垠，MDx Blog 则不再发表这篇文章。</p></blockquote>\n<p>从 MDx 开发之初，增强页面的可访问性就被列为了一个重要目标。从 HTML 语义化，到 ARIA 地标，再到 <code>prefers-reduced-motion</code>，随着浏览器对于增强页面可访问性的支持功能越来越多，MDx 也在不断地更新，让更多的人都能毫无困难地浏览、查看由 MDx 渲染的网页。本文会详细说明一些 MDx 中增强页面可访问性的细节，<strong>如果你希望增强自己开发的网页的可访问性，本文可能会对你有所帮助。</strong></p>\n<h1>基础性增强</h1>\n<p>增强可访问性，最重要也是最基础的一点就是 HTML 语义化。通过使用 HTML 5 语义化标签和 ARIA Role 标签，我们可以很方便地<strong>将整个网页在语义上分为几部分，而这将有效地改善屏幕阅读器对网页的分析质量，使视力障碍用户更好地浏览网页。</strong></p>\n<h2>HTML 语义化</h2>\n<p><strong>HTML 语义化属于增强页面可访问性的基础中的基础。</strong>通过使用语义化的 HTML 标签，我们可以方便地为网页中的各部分标记功能而不影响页面样式。随着符合 HTML 5 的现代化网页成为主流，语义化标签已被很大一部分网站所支持，我也不过多赘述了。就举几个常用的“地标性”标签吧：</p>\n<ul>\n<li>\n<code>header</code> 标签标记页眉，默认样式同 <code>div</code>，不要把它和 <code>head</code> 搞混了</li>\n<li>\n<code>main</code> 标签标记页面的主要内容，默认样式同 <code>div</code>\n</li>\n<li>\n<code>article</code> 标签标记文章（在 HTML 5 中它指任何独立或可复用的文本），默认样式同 <code>div</code>\n</li>\n<li>\n<code>footer</code> 标签标记页脚，默认样式同 <code>div</code>\n</li>\n<li>\n<code>nav</code> 标签标记页面导航栏区域，默认样式同 <code>div</code>\n</li>\n<li>\n<code>aside</code> 标签标记侧栏，默认样式同 <code>div</code>\n</li>\n<li>\n<code>section</code> 标签标记“一组内容”，你可以把它看作是划定网页中一块区域的通用标签，默认样式同 <code>div</code>\n</li>\n</ul>\n<p>只要用这些标签替代 <code>div</code> 而不是无脑使用 <code>div</code> 就能提高页面的可访问性。MDx 使用了这些标签来增强页面的可访问性。</p>\n<h2>下一步，ARIA</h2>\n<p>有的时候，出于一些原因，我们没法使用语义化的 HTML 标签，或者没有合适的语义化标签来标记内容，这时候<strong>我们就需要使用 ARIA (Accessible Rich Internet Applications，可访问的富互联网应用)。</strong>ARIA 的基础用法很简单，只要在相应元素上加上 <code>role</code> 属性指定该元素的功能即可。下面是一个简单的例子：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"html\">&lt;div role=\"navigation\"&gt;\r\n  &lt;ul&gt;\r\n    &lt;li&gt;&lt;a href=\"#\"&gt;Page A&lt;/a&gt;&lt;/li&gt;\r\n    &lt;li&gt;&lt;a href=\"#\"&gt;Page B&lt;/li&gt;\r\n    &lt;li&gt;&lt;a href=\"#\"&gt;Page C&lt;/a&gt;&lt;/li&gt;\r\n  &lt;/ul&gt;\r\n&lt;/div&gt;</pre>\n<p>通过 <code>role=\"navigation\"</code>，我们把一个 <code>div</code> 标记为了导航栏区域。实际上，对屏幕阅读器来说，这和 <code>nav</code> 标签在语义上是一致的。上一节中的例子都可以分别用以下 ARIA Role 表示：</p>\n<ul>\n<li><code>role=\"heading\"</code></li>\n<li><code>role=\"main\"</code></li>\n<li><code>role=\"article\"</code></li>\n<li><code>role=\"contentinfo\"</code></li>\n<li><code>role=\"navigation\"</code></li>\n<li><code>role=\"complementary\"</code></li>\n<li><code>role=\"region\"</code></li>\n</ul>\n<p>除此以外，MDx 还使用了 <code>role=\"banner\"</code> 和 <code>role=\"search\"</code> 来分别标记页面中的顶部栏和搜索表单。另外，<strong>有的时候 <code>role</code> 属性还需配合 <code>aria-*</code> 属性一同使用</strong>，具体规则比较复杂，我就不在这里赘述了，具体可参考 <a href=\"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles\">WAI-ARIA Roles - MDN</a>。</p>\n<h1>媒体查询来帮忙</h1>\n<p>CSS 的媒体查询其实是一个非常强大的特性，<strong>妥善利用其中的一些特性，我们可以在网页外观上大大增强网页的可访问性。</strong>除了已经烂大街的“对浏览器窗口大小”响应的媒体查询，我会介绍 3 个很少有网站充分利用的媒体查询。</p>\n<h2>print</h2>\n<p><code>print</code> 媒体查询其实已经“历史悠久”了，<strong>只要使用 <code>@media print {...}</code> 就可以创建只在打印页面时生效的样式。</strong>通过这种方式，我们可以让页面在打印时应用一套为打印优化的样式，增强页面在物理纸张上的可访问性。</p>\n<blockquote><p>维基百科是对打印样式做了单独适配的著名例子。</p></blockquote>\n<p><strong>由于在打印的情况下，页面已经离开了“可交互”的范围，还有分页这种在屏幕中无需考虑的问题，要让页面在物理纸张上仍能被轻松地阅读，我们需要做一些特殊的适配。</strong>直接来看一个例子吧。以下是 MDx 针对打印情况进行的一些特殊优化，样式的具体理由已经写在了注释中。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"css\">@media print {\r\n    /*隐藏不必要的元素*/\r\n    header, .mdx-ad-after-article, .mdx-ad-in-article, .mdx-post-money, .page-footer-nav, .mdx-same-posts, .spanout button, .mdui-drawer, .mdui-overlay, .mdui-menu, .mdx-share-img-dialog, .mdx-share-wechat-dialog {\r\n        display: none!important;\r\n    }\r\n\r\n    /*使用下划线标记链接*/\r\n    article a {\r\n        text-decoration: underline!important;\r\n    }\r\n    /*由于纸张不可交互，在链接后显示链接到的 URL*/\r\n    article a::after {\r\n        content: \"(\" attr(href) \")\";\r\n    }\r\n\r\n    /*强制白底黑字*/\r\n    html &gt; body {\r\n        background-color: white!important;\r\n    }\r\n    article p {\r\n        color: rgba(0,0,0,.8)!important;\r\n    }\r\n\r\n    /*对于纸张上的长文章，衬线字体拥有更好的可读性。以下字体列表来自 fonts.css*/\r\n    article {\r\n        font: 13pt Georgia, \"Nimbus Roman No9 L\", \"Songti SC\", \"Noto Serif CJK SC\", \"Source Han Serif SC\", \"Source Han Serif CN\", STSong, \"AR PL New Sung\", \"AR PL SungtiL GB\", NSimSun, SimSun, \"TW\\-Sung\", \"WenQuanYi Bitmap Song\", \"AR PL UMing CN\", \"AR PL UMing HK\", \"AR PL UMing TW\", \"AR PL UMing TW MBE\", PMingLiU, MingLiU, serif!important;\r\n    }\r\n\r\n    /*除部分元素外，禁止在元素内部分页*/\r\n    * {\r\n        page-break-inside: avoid;\r\n    }\r\n    article p, article a, #comments, article {\r\n        page-break-inside: auto;\r\n    }\r\n}</pre>\n<p>MDx 自 1.9.3 版本起已经包含了对文章页的打印样式优化。可以很容易地看出，优化后的样式在物理纸张上将更容易阅读。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/6.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/6.jpg\" alt=\"\" width=\"1345\" height=\"1602\" class=\"aligncenter size-full wp-image-1959\"></a>\n<h2>prefers-color-scheme</h2>\n<p><code>prefers-color-scheme</code> 是最近才被浏览器广泛支持的一个媒体查询，但它的功能却很强大：<strong>响应系统级黑暗模式。</strong>这样，我们可以在开启黑暗模式的系统中让网页具有更好的可读性。不过由于这个媒体查询直到最近才被广泛支持，因此大部分网站对此并没有进行适配。</p>\n<blockquote><p>一些适配这一特性的网站：少数派、微信公众平台（文章页）等。</p></blockquote>\n<p>通过像这样的媒体查询，我们可以在系统启用黑暗模式时让页面实时响应：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"css\">@media (prefers-color-scheme: dark) {\r\n    body {\r\n        background-color: #212121;\r\n        color: rgba(255, 255, 255, .7);\r\n    }\r\n}</pre>\n<p><code>prefers-color-scheme</code> 一共有 3 个可能值：<code>no-preference</code>, <code>light</code> 和 <code>dark</code>。你也可以不像上面的例子那样默认使用亮色样式并在黑暗模式下启用黑暗样式，而可以反过来将黑暗样式作为默认，用亮色样式覆盖。在不支持的浏览器上将会显示默认样式（即媒体查询不会生效）。</p>\n<p>MDx 已经在 1.9.6 版本中包含对这一媒体查询的支持。</p>\n<h2>prefers-reduced-motion</h2>\n<p>看名字就猜得出，<code>prefers-reduced-motion</code> 是和 <code>prefers-color-scheme</code> 师出同门的媒体查询。因此，和 <code>prefers-color-scheme</code> 一样，它也是在最近才获得了浏览器的广泛支持。它的作用也很强大：<strong>响应系统的“减弱动态效果”模式。</strong>这对某些不喜欢甚至无法接受动画的用户可能很有帮助。要知道，对有些用户来说这甚至是医疗上的必要。使用如下的媒体查询，我们可以在系统启用减弱动态效果模式时让页面实时响应，减弱动画：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"css\">@media (prefers-reduced-motion: reduce) {\r\n    /*只是一个示例，实际情况中可以保留一些淡入淡出效果*/\r\n    * {\r\n        transition: all 0s!important;\r\n        transform: none!important;\r\n    }\r\n}</pre>\n<p><code>prefers-reduced-motion</code> 只有 2 个可能值：<code>no-preference</code> 和 <code>reduce</code>，在不支持的浏览器上该媒体查询不会生效。</p>\n<p>MDx 已经在 1.9.6 版本中包含对这一媒体查询的支持。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/5.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/5.jpg\" alt=\"\" width=\"792\" height=\"515\" class=\"aligncenter size-full wp-image-1962\"></a>\n<h1>黑暗模式适配</h1>\n<p>黑暗模式可不是简单地切换到黑底白字这么简单。<strong>单纯地使用黑底白字会导致页面元素之间对比度过高，文字刺眼，反而降低了页面的可访问性。</strong>我在下面总结了几条应用在了 MDx 中的黑暗模式优化规则和 Google 推荐的优化规则：</p>\n<p><strong>一是避免黑底白字。</strong>黑底白字看起来真的很难受，事实上，深灰和浅灰是黑暗模式最好的配色。比较下方例子里的两段文本，毫无疑问深灰色背景和浅灰色文字搭配的样式的可读性要比黑底白字高很多。（p.s. 有时候这条规则在白底黑字时也适用）</p>\n<p><strong>二是更改部分元素的亮度和对比度以增强可读性。</strong>你可能已经注意到了，下面优化的例子里标题文字的颜色改变了。很明显，未优化的黑暗模式中标题可读性不如优化的版本。在实际中，我们通常可以通过 CSS 滤镜来实现这一更改。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"css\">@media (prefers-color-scheme: dark) {\r\n    h1 {\r\n        /*反相颜色后再将色相旋转 180 度，使亮度反相*/\r\n        filter: invert(1) hue-rotate(180deg);\r\n    }\r\n}</pre>\n<p><strong>三是避免让图片过亮。</strong>未经处理的图片通常会导致过高的对比度，降低可读性。在 MDx 中，我选择降低图片的亮度来避免图片刺眼，而 Google 的建议则是使图片灰度，不过这会影响图片的整体观感。无论是哪一种方案，都可以使用 CSS 滤镜来轻松实现。</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"css\">@media (prefers-color-scheme: dark) {\r\n    img { \r\n        /*MDx 方案*/\r\n        filter: brightness(.8);\r\n        /*Google 方案*/\r\n        filter: grayscale(.5);\r\n    }\r\n}</pre>\n<div>\n<div>\n<h1>Cats\n</h1>\n<p>这里是未优化的黑暗模式预览。接下来，让我们来看点可爱的猫猫吧。</p>\n<p><img src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/demo.jpg\"></p>\n</div>\n<div>\n<h1>Cats\n</h1>\n<p>这里是经过优化的黑暗模式预览。接下来，让我们来看点可爱的猫猫吧。</p>\n<p><img src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/demo.jpg\"></p>\n</div>\n</div>\n<h1>其他细节</h1>\n<p>还有一些细节，虽然简单，但不可或缺。我把一部分没有在上文提到的 MDx 中的细节列在了这里。</p>\n<p><strong>一是允许页面缩放。</strong>在开发响应式页面时，很多网站会在页面头部添加这样一个 <code>meta</code>：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"html\">&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\"&gt;</pre>\n<p>这样的 <code>meta</code> 设定了页面的宽度，却也固定了页面的缩放比例，用户难以手动放大网页。<strong>这样的设置对一部分视力障碍用户非常不友好</strong>，以至于苹果决定在自家的浏览器上忽略禁止缩放的 <code>meta</code>。按照 Google 的推荐，如果你在 MDx 设置中启用了“允许页面缩放”，那么 MDx 会输出这样的 <code>meta</code> 标签，允许页面进行五倍以内的缩放：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"html\">&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=5\"&gt;</pre>\n<p><strong>尽管很多时候放大页面会导致页面结构被破坏，但这大大增强了页面的可访问性，利大于弊。</strong>因此，在 MDx 中，“允许页面缩放”是默认启用的。</p>\n<p><strong>二是在跨设备阅读时同步阅读记录。</strong>这属于 MDx 的“元老级”功能之一。注意到页面右上角的那个“在其他设备上继续阅读”的按钮了吗？如果你滚动页面后重新点击它，你会发现二维码发生变化了。通过在二维码中记录阅读进度，用户在扫描二维码切换设备阅读时，MDx 在新设备上会自动滚动到和原设备上一致的位置——好吧，目前基于百分比的算法在某些情况下可能不太准，但我已经设计了一个更复杂但更精确的阅读进度记录算法，之后就会更新到 MDx 中。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/8.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/8.jpg\" alt=\"\" width=\"1000\" height=\"574\" class=\"aligncenter size-full wp-image-1976\"></a>\n<p><strong>三是避免 Web 字体阻塞渲染。</strong>如果你在页面中使用了 Web 字体，在字体加载完成之前，浏览器可能不会渲染任何文本，这就导致用户可能需要等待一段时间才能开始浏览网页。Google 推荐使用 <code>font-display: swap;</code> 来向浏览器指定网页的 Web 字体渲染策略。这一规则会提供一个比较短的等待周期，如果在这段时间内 Web 字体没有完成加载，那么浏览器会以 fallback 字体渲染文本。任意时刻一旦 Web 字体完成渲染，浏览器就会使用 Web 字体重新渲染文本。这在大多数情况下都能满足可访问性的需求。</p>\n<p><strong>四是确保 html 元素具有合适的 <code>lang</code> 属性。</strong>这一属性声明了页面的主要语言，浏览器可以据此调整渲染策略，或者触发自动翻译；屏幕阅读器也能更好地阅读网页。</p>\n<p><strong>五是确保页面主要内容在丢失/禁用了 Javascript 甚至 CSS 的情况下仍然可用。</strong>作为一个以内容为主的网站，MDx 在禁用了 Javascript 的情况下页面主要内容仍然可用。这不只是为了 SEO，更是为了保证页面的可访问性。的确，目前的情况下，如果开启了 Lazyload，MDx 在禁用 Javascript 的情况下图片的确无法显示，但我会在后续版本中尽可能的优化这一问题。</p>\n<h1>附录：媒体查询开发技巧</h1>\n<p>有的时候，光有 CSS 响应媒体查询还不够，我们可能需要在 Javascript 中实时响应媒体查询。用如下代码就可以很简单地响应媒体查询：</p>\n<pre class=\"EnlighterJSRAW\" data-enlighter-language=\"js\">let mql = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\r\nmql.addListener(handleMediaChange);\r\n\r\n//在添加监听后先调用一次，获得当前查询结果\r\nhandleMediaChange(mql);\r\n\r\nfunction handleMediaChange(mql){\r\n    if(mql.matches){\r\n        //查询匹配\r\n    }else{\r\n        //查询不匹配\r\n    }\r\n}</pre>\n<p>在开发上述媒体查询的过程中，我们需要频繁地切换系统的相应模式或者调出打印窗口。<strong>实际上，Chrome 提供了更简单的调试方法：</strong></p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/2333.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1946\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/2333.jpg\" alt=\"\" width=\"723\" height=\"681\"></a>\n<p>只要在这里更改模式，相关媒体查询就能实时生效。这不会影响其他标签页，在关闭开发者工具之后也会自动恢复系统设置。</p>\n","link":"https://flyhigher.top/develop/1912.html"},{"title":"MDx Blog 现已随 MDx 1.9.5 发布","date":"2020-01-22 17:54:11","description":"<p>随着 MDx 发布 1.9.5 更新，<a href=\"https://mdxblog.flyhigher.top/\" rel=\"noopener noreferrer\" target=\"_blank\">MDx Blog</a> 现已建立。我将会在 MDx Blog 中分享一些开发故事并发布 MDx 更新日志。</p>","link":"https://flyhigher.top/diary/1905.html"},{"title":"GitHub 2019 统计无垠版","date":"2020-01-12 13:02:00","description":"\n<h1>缘起</h1>\n<p>2019 年底，我突发奇想想要自己统计一番 GitHub 上存储库的一些信息。尽管 GitHub 有自己的<a href=\"https://octoverse.github.com/\" target=\"_blank\" rel=\"noopener noreferrer\">年度统计</a>，我还是想试着自己爬取一下，说不定能挖出什么有意思的信息，何况这是我第一次有机会处理比较大量的数据，也算是一种学习的过程吧。于是花了一下午写了个简单的爬虫（时间都花在增加 Rate Limit 上了...），然后扔在了两台服务器上开始跑（GitHub  API 真是好文明）。</p>\n<p>从 2019.11.21 3 时到 2020.1.12 24 时的 52 天 21 小时内，我的爬虫一共爬取了<strong>与 2,024,705 个用户有关<sup>*</sup>的 14,651,923 个公共存储库的基础信息</strong>，平均每秒爬取 3.2 个存储库。据 GitHub 的官方数据计算，我爬取了大约 15% 的存储库信息，但由于封禁库和私有库的数量未知，我暂时无法确定我爬取的存储库占公共库的比例。同时由于存储库数量较多，基本可以认为爬取到的样本在时间尺度上已经足够随机，可以通过统计得出一般结论。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/1.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/1.jpg\" alt=\"\" width=\"700\" height=\"606\" class=\"aligncenter size-full wp-image-1892\"></a>\n<p>爬到自己了，合影.jpg</p>\n<p>那么下面就来看看统计出来的一些结果吧。爬虫的技术细节和数据集下载放在文末。</p>\n<p>* 指这些用户拥有至少一个库</p>\n<h1>统计信息</h1>\n<p><strong>以下统计结果均基于已放于文末的数据集。</strong>由于爬虫爬取的时间跨度长，加上我并没有完整爬取 GitHub 所有存储库，因此我<strong>不能保证以下统计结果符合真实情况</strong>，各位可以下载数据集或自行爬取进行验证。</p>\n<h2>一些数据</h2>\n<div>\n<div>\n<div>\n<span>3,120,930</span><br>总爬取用户数</div>\n<div>\n<span>44.7%</span><br>的存储库创建<br>自 Fork</div>\n<div>\n<span>6.59%</span><br>的账户被删除或<br>封禁<sup>1</sup>\n</div>\n<div>\n<span>23,913</span><br>单用户拥有最大<br>库数量<sup>2</sup>\n</div>\n</div>\n</div>\n<p><sup>1</sup> 基于用户 ID 规律合理推断<br><sup>2</sup> 统计范围仅限于当前数据集</p>\n<p>比较出乎我意料的是创建自 Fork 的存储库的占比。我预估这样的存储库占比不会太低，但没有想到能接近一半。此外单用户拥有最大库数量也大大超出了我的预期，<a href=\"https://github.com/pombredanne\" rel=\"noopener noreferrer\" target=\"_blank\">pombredanne</a> 这个用户名下拥有将近 24k 的存储库，不过绝大多数都是 Fork 来的，在情理之中。此外<strong>这个数据集中</strong>拥有最多存储库的账户其实是一个组织 <a href=\"https://github.com/gitpan\" rel=\"noopener noreferrer\" target=\"_blank\">gitpan</a>，这个组织拥有 36,377 个存储库。</p>\n<h2>语言</h2>\n<p><canvas></canvas><br>\n首先必须要说明的是，在这个榜单中我<strong>排除了 HTML 和 CSS</strong>，因为在严格意义上它们不属于“编程语言”。如果把它们计算进来的话，分别有 640,368 个和 361,425 个存储库的主要语言分别是 HTML 和 CSS，这样在这份榜单中它们可以排到第 6 和 第 10 名。JavaScript 毫无疑问获得第一，第二名 Python 的热度则和 JavaScript 相差将近一半。<strong>此外还有 2,448,486 个存储库未能识别出语言，占比 16.7%。</strong>在上面的榜单之外，与机器学习和数据科学相关的语言还有 Jupyter Notebook 排名第 13，R 排名 20，Julia 排名 43。</p>\n<p>说实话这份排名和 GitHub 官方的排名<strong>差别很大</strong>，除了前三名，后面的基本都不太一样。我的排名统计结果完全基于 GitHub 对于存储库的主要语言识别，加上我的存储库数据不完整，和官方的数据不同是很正常的，可以做一个参考，但大概率还是官方排名更加准确。</p>\n<h2>许可证</h2>\n<p><canvas></canvas></p>\n<p>自 GitHub 推出许可证功能以来，拥有许可证的存储库比例升升降降，却始终没有超过一半。<strong>选择一个合适的许可证对项目的良好发展真的很有帮助</strong>，要了解如何选择合适的许可证，请参阅<a href=\"https://www.runoob.com/w3cnote/open-source-license.html\" rel=\"noopener noreferrer\" target=\"_blank\">这篇文章</a>。</p>\n<p><canvas></canvas></p>\n<p>对于拥有许可证的存储库，MIT<del> 麻省理工许可证 </del>总是占比最大的；第二则是 Apache-2.0 许可证。此外，WTFPL 许可证也挤入了前 15 名。</p>\n<h2>星标</h2>\n<p><canvas></canvas><br>\nStar 数量毫无疑问是一个存储库受欢迎程度的体现，而 Star 数高的项目基本上大家都了解过。<strong>截至爬取结束时间</strong>，GitHub 中 Star 数最多的库是 <a href=\"https://github.com/freeCodeCamp/freeCodeCamp\" rel=\"noopener noreferrer\" target=\"_blank\">freeCodeCamp</a> <del>非常完美的驼峰命名法</del>，其次则是著名项目 <a href=\"https://github.com/996icu/996.ICU\" rel=\"noopener noreferrer\" target=\"_blank\">996.ICU</a>。<a href=\"https://github.com/vuejs/vue\" rel=\"noopener noreferrer\" target=\"_blank\">Vue</a> 现在的 Star 数已经稳压 <a href=\"https://github.com/facebook/react\" rel=\"noopener noreferrer\" target=\"_blank\">React</a> 一头，Vue YES! 此外 <a href=\"https://github.com/sindresorhus/awesome\" rel=\"noopener noreferrer\" target=\"_blank\">awesome</a> 也挤进第七名。<br><canvas></canvas><br>\n由于 Star 需要时间积累，新项目的 Star 数量很可能是比不过老项目的，这就会导致有实力的新项目无法出现在榜单中。因此我还统计了日均 Star 数，试图通过日均 Star 数来反映项目受欢迎的程度。<strong>由于正热门的项目会比老牌热门项目有优势，这一项的统计范围是 2020-01-01 之前的所有存储库。</strong>996.ICU 和 freeCodeCamp 再次出现在前 10 名，而最近的热门项目 <a href=\"https://github.com/wenyan-lang/wenyan\" rel=\"noopener noreferrer\" target=\"_blank\">wenyan</a> 则飙升至第 2 名。此外还有 <a href=\"https://github.com/menzi11/BullshitGenerator\" rel=\"noopener noreferrer\" target=\"_blank\">BullshitGenerator</a>，即最近热门的“狗屁不通文章生成器”和 <a href=\"https://github.com/evil-huawei/evil-huawei\" rel=\"noopener noreferrer\" target=\"_blank\">evil-huawei</a> 分列第 3 和第 5 名。<br><canvas></canvas><br>\n说实话这个曲线<strong>比我预估的陡多了。</strong>你可能已经注意到了，这个图表的横轴不是均匀缩放的，实际上曲线要比看起来陡很多。同时受爬取方式的影响，GitHub 中 Star 数较少的存储库数量远比我爬取到的多。也就是说，<strong>实际情况下曲线远比这个图表上的陡。</strong>拿点 Star 不容易啊。</p>\n<h2>名称</h2>\n<p><canvas></canvas><br>\n终于知道了原来存储库的名称是有长度限制的...尽管最长有 100 位，<strong>大部分人还是喜欢 8 位长的存储库名。</strong>此外 1 位长的名称也比我预估的要多一些。举几个存储库名称长度为 100 的例子吧。</p>\n<ul>\n<li>testing-something-elsetesting-something-elsetesting-something-elsetesting-something-elsetesting-some</li>\n<li>acts_as_validated_config_so_app_will_not_run_in_random_situation_and_qa_gays_will_not_cry_to_you_whe</li>\n<li>............................................________-....................................-.---......</li>\n<li>----------------------------------------------------------------------------------------------------</li>\n<li>nyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyannyan</li>\n</ul>\n<p>...创造力有够丰富的。</p>\n<p><canvas></canvas></p>\n<p>最近 GitHub 上有一种奇怪的风气，那就是建立 Awesome 合集<del>骗 Star</del>。看起来 Awesome 存储库满地都是，甚至还出现了关于 Awesome 的 Awesome 合集这种迷惑行为。于是我统计了一下，<del>还好，</del>占比<del>才</del> 0.5% 不到<del>，Awesomer 们任重而道远呐</del>。</p>\n<p><canvas></canvas></p>\n<p>尽管要在 github.io 上托管网站，存储库不一定要以 .github.io 结尾，但我还是统计了一下。拥有这类存储库的用户比我预想的要少一些，看来还有很多人没有完全发挥 GitHub 的完整实力啊<del>（比如我 Doge）</del>。同时<strong>这类存储库在所有存储库中占比 1.12%</strong>，看起来不多<del>，不过至少比 Awesome 多</del>。<br><canvas></canvas><br>\n看得出来 GitHub 对于用户名长度的限制是 1-40 位。用户名最短的 27 位占据了 <code>A-Z</code> 外加 <code>-</code> 的所有可能，而用户名最长的则是一个组织 <a href=\"https://github.com/UOIT-RESEARCH-database-information-group\" rel=\"noopener noreferrer\" target=\"_blank\">UOIT-RESEARCH-database-information-group</a>。不知道是巧合还是某种规律，<strong>最受欢迎的用户名长度和存储库名称长度一样，都是 8</strong>，有点意思。</p>\n<h2>创建时间</h2>\n<p><canvas></canvas><br>\n由于我并没有完整爬取所有存储库，我只能以相对值来统计每月新增存储库数量的变化趋势。<strong>在这个图表中，我将 2017-09 的数据设为了 100%。</strong>你一定一眼就能注意到 2017 年 6,7,8 月的“一柱擎天”。<del datetime=\"2020-02-05T09:18:30+00:00\">我第一次看到这个数据的时候的确愣了一下，不过就着这条新闻看就能明白为什么了：<strong>2017 年 6 月微软收购 GitHub。</strong></del></p>\n<blockquote><p>重新确认了一下，微软收购 GitHub 比这个高峰晚了一年，目前我对这个高峰没有什么很好的解释，如果你有什么思路的话欢迎评论。</p></blockquote>\n<p><strong>需要注意的是这张图表中我排除了 Fork 存储库</strong>，因为 Fork 存储库在 API 中的创建时间是原始存储库的时间，会影响整体趋势。此外，GitHub 中还有一个创建于 2007 年 10 月 29 日的存储库，那就是 <code>id: 1</code> 的...</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"mojombo\" data-mdxgithubp=\"grit\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/mojombo/grit\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<p>而它的创建者正是 GitHub 的创始人之一 Tom Preston-Werner。</p>\n<h1>一些有趣的结果</h1>\n<p>当初打算自己爬的目的之一就是想看看能不能挖出什么有意思的信息，结果真的有一些不挖不知道的信息。</p>\n<h2>奇怪的存储库</h2>\n<p>在爬取到的所有存储库中，<strong>有 3 个存储库是“无主”的</strong>，即它们的 owner 属性为空。这三个存储库的基本信息如下。</p>\n<div class=\"mdui-table-fluid mdui-table-hoverable\"><table class=\"mdui-table\">\n<thead><tr>\n<th>ID</th>\n<th>名称</th>\n<th>Forked</th>\n<th>Star</th>\n<th>语言</th>\n<th>许可证</th>\n<th>创建于</th>\n</tr></thead>\n<tbody>\n<tr>\n<td>72385291</td>\n<td>vscode-redprl</td>\n<td>否</td>\n<td>10</td>\n<td>TypeScript</td>\n<td>apache-2.0</td>\n<td>2016-10-31 08:50:01</td>\n</tr>\n<tr>\n<td>181218346</td>\n<td>electron-sys</td>\n<td>否</td>\n<td>10</td>\n<td>Rust</td>\n<td>other</td>\n<td>2019-04-14 03:20:56</td>\n</tr>\n<tr>\n<td>181391880</td>\n<td>node-sys</td>\n<td>否</td>\n<td>6</td>\n<td>Rust</td>\n<td>other</td>\n<td>2019-04-15 09:33:08</td>\n</tr>\n</tbody>\n</table></div>\n<p><strong>更奇怪的是这三个存储库“无主”的情况还不一样。</strong>第一个存储库可以通过 <code>/repositories</code> 这个 GitHub API 找到， <a href=\"https://api.github.com/repositories?since=72385290\" target=\"_blank\" rel=\"noopener noreferrer\">这个链接</a>中的第一个存储库就是它；而其余两个存储库甚至无法在 <code>/repositories</code> API 中找到。不过就算能在 API 中找到第一个存储库，它的 <code>html_url</code>，即 <code>https://github.com//vscode-redprl</code> 仍然是不可访问的。这可能是 GitHub 早期的一个 Bug 导致的，不过我仍然对爬虫是如何找到这三个存储库的以及这些 Stars 是哪里来的感到好奇。</p>\n<h2>奇怪的用户名</h2>\n<p>在爬虫爬了一段时间以后，API 中突然开始出现大量的以 fdp 开头的 18 位乱码作为用户名的用户。这些用户拥有的存储库和 starred 的存储库都为 0，而他们的 <code>html_url</code> 为 404。以下是几个例子。</p>\n<ul>\n<li>fdpEpolGCEdQX4ZlRJ</li>\n<li>fdp8XaVrdtmDZnO5pR</li>\n<li>fdp8XRAGnwAOkTr2Ya</li>\n</ul>\n<p>由于我的爬虫并没有超过 Rate Limit，所以我排除了这是污染数据的可能。我怀疑这可能是某种 Bot 账户，于是一边更新爬虫过滤掉了这些用户，一边给 GitHub 支持发邮件问了具体情况。过了两天 GitHub 回复我说这些是<strong>被自动判为可疑进而被封禁的用户</strong>（原话是 they have been flagged by our automated measures for detecting suspicious behavior）。<del>想到我正在疯狂爬取 GitHub，突然害怕.webp</del></p>\n<p>行吧。</p>\n<h1>技术细节</h1>\n<p>爬虫使用 Python3 编写，数据库使用 MySQL。爬虫共使用了 4 个 API Token，在两台服务器上分布式爬取。爬取思路为：</p>\n<ol>\n<li>通过 <code>/users</code> API 遍历用户，每个请求最多获取 30 个用户信息</li>\n<li>循环 30 个用户，分别获取 <code>/users/&lt;user_name&gt;/starred</code> 和 <code>/users/&lt;user_name&gt;/repos</code> API 中的存储库信息，每个请求最多获取 100 个存储库信息，超过 100 个的分页获取</li>\n<li>提取存储库信息，插入数据库。对于已存在的存储库，更新数据</li>\n<li>获取下 30 个用户信息</li>\n</ol>\n<p>由于爬取过程中我多次调整了爬虫逻辑，爬虫爬取到的用户 ID 区间并非连续的，具体区间为1-839586, 14800001-14885493 及 28965251-31161101。</p>\n<h1>免责声明</h1>\n<p>本站会尽可能地提供准确信息，但本站不对此文章中信息的准确性和即时性及带来的任何影响负责。</p>\n<p>本站不代表 GitHub 官方，本文仅供学习之用，请不要将本文内容直接用于任何商业项目中。</p>\n<h1>数据集下载</h1>\n<p>导出的 SQL 文件大约为 1.38GB，全部放在了 GitHub 上（在危险的边缘试探.webp</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"yrccondor\" data-mdxgithubp=\"github-analysis-2019\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/yrccondor/github-analysis-2019\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<p>此外我也提供了 MEGA 下载，链接<a href=\"https://mega.nz/#F!juxm3A6T!7Vwpzi82W1OFrqTLu1A1pQ\">在这里</a>。</p>\n","link":"https://flyhigher.top/develop/1564.html"},{"title":"Milkice 跨年红包解谜 Writeup 及无垠跨年红包解谜答案","date":"2020-01-02 04:29:19","description":"\n<blockquote><p><del>又到了水文章的时间呢</del></p></blockquote>\n<p>先说明一下，这篇文章原本不是在计划中的，而原来说好的「在路上的两篇」文章<del>绝对不会咕</del>。我自己的红包答案本来打算直接塞在年度总结里的，结果发现稍微有些长，再加上我还花了一些时间解了<a href=\"https://milkice.me/\">奶冰</a>的红包解谜游戏，就打算把两个解谜过程放在一起单独写一篇文章。<del>真是个水文章的好理由</del>（被打死</p>\n<h1>奶<del> 子 </del>冰的红包</h1>\n<p>奶冰的红包题目比我的难多了，所以让我们先从难的开始吧。首先看一下<a href=\"https://milkice.me/2019/12/31/2019-summary/\">题目</a>：</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-2.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1524\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-2.jpg\" alt=\"\" width=\"746\" height=\"410\"></a>\n<p>入口是 <code>happy.2020.milkice.me</code>，扔到浏览器里面表示找不到 IP，那么大概率就是 DNS 的 TXT 记录了，查一下得到 <code>nb2hi4dthixs63ljnrvwsy3ffzwwkl3tivrvezluomxxg5dsmvqw2ltqmnqxa3th</code>。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-3.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1525\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-3.jpg\" alt=\"\" width=\"896\" height=\"278\"></a>\n<p>第一眼没看出来是什么编码，直觉是 BaseXX 系列的编码，加上提示“不只有 Base64”，可以推断出是 Base32，转大写解码得到 <code>https://milkice.me/sEcRets/stream.pcapng</code>。是个 URL，下载得到一个 Wireshark 文件，打开一看是和某 USB 设备的通讯抓包。<del>不会做，不做了。</del></p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-4.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1526\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-4.jpg\" alt=\"\" width=\"1500\" height=\"813\"></a>\n<p>奶冰提示我“Google 上搜得到”，结合第二条提示搜索“wacom pcapng”找到了<a href=\"https://blogs.tunelko.com/2017/02/05/bitsctf-tom-and-jerry-50-points/\">这篇文章</a>（<del>这™就是答案啊</del>）。看起来是一样的套路，即通过解析数据得到数位板上画的内容，于是按文章的思路筛选出数位板发给主机的数据，导出，然后再用 tshark 导出文本数据。本来我想直接用文章中的 POC 的，结果折腾半天因为源的蜜汁原因库没装上，于是按文章中给出的数据结构自己写了段代码，分别导出 X、Y 轴数据扔进 Excel 画散点图。（<del>别问我为什么用 Excel，因为我手边没有更好的工具了</del>）</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-8.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1528\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-8.jpg\" alt=\"\" width=\"1280\" height=\"530\"></a>\n<p><span>翻车现场之一</span></p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-13.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1539\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-13.jpg\" alt=\"\" width=\"1000\" height=\"286\"></a>\n<p><span>懵逼奶冰.webp</span></p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-1.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1533\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-1.jpg\" alt=\"\" width=\"1500\" height=\"462\"></a>\n<p>看得出有手写文字，不过是上下颠倒的，翻转图片得 <code>https://milkice.me/2020/uso.zip</code>。是个 zip，下载打开一看，有密码。<del>不会解，不做了。</del> 第一反应是暴力解密码，但是暴力跑了 15 分钟还是没有跑出来。暴力太不优雅了，肯定不是正确思路，但奶冰什么都不肯说了。不过在这时我终于发现第一个红包口令码就藏在压缩包的注释中，Get。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-15.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1544\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-15.jpg\" alt=\"\" width=\"806\" height=\"593\"></a>\n<p>然而题还没解完，回去看提示，看到提供了 osu 谱面下载，于是打算不管怎么样先下载来看看。然而 osu 谱面下载要登录，只好又花了几分钟找到第三方站点，成功下载。这时候可以注意到 uso.zip 里有个同名文件（432314 Mike Greene - Bill Nye the Science Guy Theme Song (Chinese Intro).osz），可以联想到是明文攻击。好吧，上 ARCHPR，十秒解出。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-5.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1530\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-5.jpg\" alt=\"\" width=\"462\" height=\"643\"></a>\n<p><span>现场还原.jpg</span></p>\n<p>.osz 文件并不是明文，猜测是压缩包（和 .pptx 一个思路嘛），于是改后缀 .zip 顺利打开。然后红包口令码就藏在奶冰的 .osu 文件中了，由提示可知是明文，打开即可得到。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-14.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1542\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-14.jpg\" alt=\"\" width=\"457\" height=\"255\"></a>\n<h1>我的红包</h1>\n<p>相比起来<a href=\"https://flyhigher.top/diary/1464.html\">我的题目</a>就简单很多了嘛...三天时间一共发出了 25 个红包，包括一位重复领取的🌚，比前几年还是多了一些的。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-16.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-16.jpg\" alt=\"\" width=\"500\" height=\"306\" class=\"aligncenter size-full wp-image-1554\"></a>\n<p><span>这位同学以后请不要多次领取🌚</span></p>\n<p>那么来看看答案吧。</p>\n<h2>第一阶段</h2>\n<p><code>=CE=B1=D1=85t=D0=BEn.=D1=96m/=D1=81=D0=BEd=D0=B5_=D0=BEf_2020_=E2=92=88m=CF=81=D0=B7</code></p>\n<p>首先观察字符串，可以发现 <code>.</code> <code>/</code> <code>_</code> 等一些 ASCII 字符原样留在了字符串中，而其他字符被由 <code>=</code> 和十六进制构成的某种编码所替代。如果你正好有所了解，你应该能认出这是 Quoted-printable 编码，这是一种常用于邮件中的编码，可以用<a href=\"https://mothereff.in/quoted-printable\">这个页面</a>解码。如果你不了解，你也应该可以发现这种编码和 URL 编码非常相似。如果你把 <code>=</code> 替换为 <code>%</code>，那么你就可以用各种方法顺利地把它按 URL 编码来进行解码，最后可以得到 <code>αхtоn.іm/соdе_оf_2020_⒈mρз</code>。这个字符串里大部分字符都不是 ASCII 字符，只是长得像而已。根据第一个提示“全是 ASCII 字符”，按样子把字符串用 ASCII 字符抄一遍，可以得到最终 URL 为 <code>axton.im/code_of_2020_1.mp3</code>。</p>\n<h2>第二阶段</h2>\n<p>下载音频，可以听出音频是经过某种处理的白噪音。白噪音的特点是各频段的功率都均匀分布，在白噪音上做文章，很容易就可以联想到线索藏在频谱中。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-8-1.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1534\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-8-1.jpg\" alt=\"\" width=\"1200\" height=\"719\"></a>\n<p>频谱被处理成了 24x3 的网格，结合第二条提示“24x3，横向读取”可以推断出是将频谱当作二进制读取，得到 <code>01111001 01110010 01100011 00101110 01101101 01100101 00101111 00110010 00110000</code>，转为 ASCII 字符可得 <code>yrc.me/20</code>。</p>\n<h2>第三阶段</h2>\n<p>打开上一步得到的页面，提示要求输入十位数密码。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-10.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1536\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-10.jpg\" alt=\"\" width=\"663\" height=\"460\"></a>\n<p>如果你在上一步注意到了这个音频文件奇怪的属性，你可以反应过来这里的密码就是 <code>2000202020</code>。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-11.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1537\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-11.jpg\" alt=\"\" width=\"421\" height=\"651\"></a>\n<p>如果你没有注意到，查看页面代码可以看到一条注释 <code>&lt;!-- Tips: the attribute of the audio --&gt;</code> 将你引导向音频文件的属性。输入密码，解锁即可进入下一步。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-9.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1535\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-9.jpg\" alt=\"\" width=\"397\" height=\"223\"></a>\n<h2>第四阶段</h2>\n<p>可以看到是一张图片，内容为“<del>.JPG</del>”和“.ZIP”。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/2020-1-scaled.jpg\"><img loading=\"lazy\" class=\"aligncenter size-large wp-image-1532\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/2020-1-scaled.jpg?imageView2/1/w/724/h/1024/interlace/1/q/90#\" alt=\"\" width=\"724\" height=\"1024\"></a>\n<p>和去年一样的套路，下载图片，将后缀名改为 .zip 然后打开，可以看到 README.txt。</p>\n<h2>最后一步</h2>\n<p>查看 README.txt 的内容，可以了解到需要去 🤔.axton.cc 获取红包口令码。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-12.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1538\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-12.jpg\" alt=\"\" width=\"1131\" height=\"278\"></a>\n<p>扔到浏览器里会出现奶冰同款找不到 IP，于是可以联想到 TXT 记录。唯一的问题是 🤔 这个 Emoji 需要如何处理。域名使用 Punycode 将 Unicode 字符转换为 ASCII 字符，特点是以 <code>xn--</code> 开头。如果你把上面这个域名扔进浏览器，你会发现它变成了 <code>xn--wp9h.axton.cc</code>。然后查询 TXT 记录，即可得到红包口令码。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-7.jpg\"><img loading=\"lazy\" class=\"aligncenter size-full wp-image-1527\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2020/01/rp-7.jpg\" alt=\"\" width=\"804\" height=\"557\"></a>\n","link":"https://flyhigher.top/develop/1519.html"},{"title":"无垠 2019 年度总结","date":"2019-12-29 12:25:52","description":"\n<p>又是时间飞快的一年...写 2018 总结的情景似乎还在眼前，转眼居然已经到 2019 年末了。</p>\n<p>2019 年，发生了太多事情，包括真的转折了人生的高考，这也导致我博客更新的不多（难以置信居然才更了两篇...），不过两篇技术性文章已经在路上了，可以期待一下。</p>\n<p>2019 年我也学了不少东西（单指技术方面），比如终于认真学了 Vue（但是还要练手）。书买了一大堆，看完的倒是没几本orz</p>\n<p>呼，好吧，是时候回顾一下充满坎坷的这一年了。2019 年还剩下最后两天，希望 2020 年，我能做得更好。</p>\n<h1>一些数据</h1>\n<p>照惯例先来看看一些数据吧。今年是统计系统完整统计了的第二年，终于可以和去年的数据比较一下了。以下数据的统计范围是 2019年1月1日0时至 2019年12月29日20时。</p>\n<h2>博客主站</h2>\n<p>无垠博客主站，年 UV 26,901 (<span>+4%</span>)，年 PV 76,583 (<span>+3%</span>)，日均 UV 73.7，平均停留时间 5分13秒 (<span>-13.8%</span>)，平均跳出率 53% (<span>+20.5%</span>)。一年有效文章数 2 (<span>-50%</span>)，新增评论 439 条。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2019/12/fh.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2019/12/fh.jpg\" alt=\"\" width=\"1000\" height=\"1143\" class=\"aligncenter size-full wp-image-1511\"></a>\n<p>有趣的是今年文章数腰斩，访问数反而小有提升。<del>如果我哪天不更新了，访问数是不是可以无限大呢？</del></p>\n<p>今年博客最大的改动就是把整体风格切换到了 Material Design 2（当然这是 <a href=\"https://flyhigher.top/develop/788.html\">MDx</a> 中的可选功能，给自己打个广告2333），此外还有比较失败的 WebP 改造计划，因为和缓存冲突已经回滚了。<a href=\"https://flyhigher.top/develop/1245.html\">ABS 系统</a>进展不大，主要是真的没有太多时间，还是要再学习一个。</p>\n<h2>个人主页</h2>\n<p>虽然个人主页的 TODO List 列了老长，但今年完全没有更新，也没有推广，从今年 8 月底开始还莫名被某墙认证了，直到 11 月底才恢复，于是今年总访问量比去年少了很多，</p>\n<p>有多少呢？这么少：总 UV 2,141 (<span>-65.9%</span>)，总 PV 2,744 (<span>-66.6%</span>)，日均 UV 6 (<span>-65.9%</span>)，平均停留时间 62秒 (<span>+19.2%</span>)。主要来源是知乎和 V2EX，还有一些甚至是从微信来的。</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2019/12/axton.jpg\"><img loading=\"lazy\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2019/12/axton.jpg\" alt=\"\" width=\"1000\" height=\"1103\" class=\"aligncenter size-full wp-image-1512\"></a>\n<h2>MDx</h2>\n<p>一年中，MDx 更新了 8 次，新增 171 commits，2 种语言的翻译，Star 数增加了 175，现有 408。感谢所有人的支持，尤其是 <a href=\"https://github.com/Sn0bzy\" rel=\"noopener noreferrer\" target=\"_blank\">Hasan CAN</a>, <a href=\"https://github.com/yechs\" rel=\"noopener noreferrer\" target=\"_blank\">Ye Shu</a>, <a href=\"https://github.com/StarryLeo\" rel=\"noopener noreferrer\" target=\"_blank\">StarryLeo</a>, <a href=\"https://github.com/DCTewi\" rel=\"noopener noreferrer\" target=\"_blank\">冻葱Tewi</a>, <a href=\"https://github.com/syfxlin\" rel=\"noopener noreferrer\" target=\"_blank\">Otstar Lin</a> 等为 MDx 做出了不小贡献的你们。</p>\n<div class=\"mdx-github-cot\" data-mdxgithuba=\"yrccondor\" data-mdxgithubp=\"mdx\" data-mdxgithubg=\"https://api.github.com/\"><div class=\"mdx-github-wait-out-c2\"><div class=\"mdx-github-wait-out-c mdui-valign\"><div class=\"mdx-github-wait-out\"><div class=\"mdx-github-wait\"><a href=\"https://github.com/yrccondor/mdx\"><div class=\"mdui-spinner\"></div></a></div></div></div></div></div>\n<h1>大事记</h1>\n<ul>\n<li>一月：<a href=\"https://flyhigher.top/photograph/1309.html\">上手</a> DJI OSMO Pocket</li>\n<li>四月：最后一次参加浙江省普通高中学业水平考试</li>\n<li>五月：MDx 喜提 300 Stars</li>\n<li>六月：高考 <del>炸了，差亿点点上浙大</del>\n</li>\n<li>六月：入手了 Oneplus 7 Pro</li>\n<li>六月：和同学一起去成都重庆旅行</li>\n<li>六月：第一次近距离感受到地震</li>\n<li>六月：<a href=\"https://flyhigher.top/diary/1411.html\">入手</a>了一台雷蛇灵刃 15，目前是主力机</li>\n<li>七月：参与组织 THE Hack 2019 活动</li>\n<li>七月：面基了 <a href=\"https://itroy.cc/\" rel=\"noopener noreferrer\" target=\"_blank\">Tory</a>, Bie Shi 和 <a href=\"https://oxz.me/\" rel=\"noopener noreferrer\" target=\"_blank\">FHYunCai</a>\n</li>\n<li>八月：一个人去厦门武汉转了一圈，拍了自己的第一个 Vlog</li>\n<li>八月：入手了一个 Kindle Paperwhite 4，没有泡面可以压，于是用来看英文小说了</li>\n<li>八月：加入 TEDxNingbo 志愿者团队</li>\n<li>八月：和 Ralph 面基</li>\n<li>八月：入手了一个 Yubikey</li>\n<li>九月：人生第一次参加雅思考试 <del>7分，蛮开心的</del>\n</li>\n<li>十月：入手了一个 Samsung Galaxy Watch Active 2 <del>觉得不值</del>\n</li>\n<li>十一月：MDx 达到 400 Stars</li>\n<li>十一月：为 TEDxNingbo 设计开发的 H5 上线</li>\n<li>十一月：入手了第一台胶片相机，试图入坑胶片摄影</li>\n<li>十一月：参加 TEDxNingbo 2019 大会</li>\n<li>十二月：<del>我 Cytus II 入门了</del>\n</li>\n</ul>\n<h1>跨年红包</h1>\n<p>这算「传统习俗」了。和以前一样，红包不是白拿的，你需要一点点技术力来解密拿到红包。有效期截至 2020年1月2日。</p>\n<p>今年的解谜旅程，从下面这个字符串开始。</p>\n<p><code>=CE=B1=D1=85t=D0=BEn.=D1=96m/=D1=81=D0=BEd=D0=B5_=D0=BEf_2020_=E2=92=88m=CF=81=D0=B7</code></p>\n<p>由于今年的题目比以前稍微难了一些，所以今年的红包金额还是比较大的，而且不限量，尽你所能试一试吧。</p>\n<p>一点你可能用得上的提示：URL 里全是 ASCII 字符 / 24x3，横向读取。</p>\n<p><a href=\"https://flyhigher.top/develop/1519.html\">答案</a>已公布。</p>\n<h1>跨年海报</h1>\n<p>这算是另一个「传统习俗」（笑）。因为我有做跨年海报的习惯，所以以下就是今年份的海报啦。</p>\n<p>用了 C4D+PS，还有我的一整个下午。</p>\n<p>提前祝各位新年快乐！</p>\n<a href=\"https://acdn.flyhigher.top/wp-content/uploads/2019/12/2020-f-web-scaled.jpg\"><img loading=\"lazy\" class=\"aligncenter wp-image-1467 size-large\" src=\"https://acdn.flyhigher.top/wp-content/uploads/2019/12/2020-f-web-scaled.jpg?imageView2/1/w/724/h/1024/interlace/1/q/90#\" alt=\"\" width=\"724\" height=\"1024\"></a>\n","link":"https://flyhigher.top/diary/1464.html"}]